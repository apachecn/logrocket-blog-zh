# è®¾è®¡ GraphQL æœåŠ¡å™¨ä»¥è·å¾—æœ€ä½³æ€§èƒ½

> åŸæ–‡ï¼š<https://blog.logrocket.com/designing-graphql-server-optimal-performance/>

å¦‚æœæ‚¨æ›¾ç»ä½¿ç”¨ä¸€äº›å¯ç”¨çš„æ¡†æ¶å®ç°è¿‡ä¸€ä¸ª [GraphQL](https://graphql.org) æœåŠ¡å™¨ï¼Œæ¯”å¦‚ [Apollo Server](https://github.com/apollographql/apollo-server) ã€ [graphql-yoga](https://github.com/prisma-labs/graphql-yoga) ã€ [graphql-php](https://webonyx.github.io/graphql-php/) ã€ [Sangria](https://github.com/sangria-graphql/sangria) æˆ–ä»»ä½•è¯­è¨€çš„ä»»ä½•å…¶ä»–[ä¸­çš„ä»»ä½•ä¸€ä¸ª](https://github.com/chentsulin/awesome-graphql)ï¼Œæ‚¨å¯èƒ½ä¼šå‘ç°è®¸å¤šæ‚¨å–œæ¬¢çš„ç‰¹æ€§ï¼Œå®ƒä»¬æ»¡è¶³äº†æ‚¨çš„åº”ç”¨ç¨‹åºéœ€æ±‚ã€‚

ç„¶è€Œï¼Œå¾ˆæœ‰å¯èƒ½ï¼Œä½ ä¹Ÿé‡åˆ°äº†ä¸€äº›éšœç¢ã€‚æ‚¨å¯èƒ½æ— æ³•å®ç°æŸäº›åŠŸèƒ½æ¥æ”¹è¿›æ‚¨çš„åº”ç”¨ç¨‹åºï¼Œè¿™ä¸ä»¥ä¸‹é—®é¢˜æœ‰å…³:

*   GraphQL æœåŠ¡å™¨æ”¯æŒæœåŠ¡å™¨ç«¯ç¼“å­˜å—ï¼Ÿ
*   å®ƒçš„æ¨¡å¼ä¼˜å…ˆæˆ–ä»£ç ä¼˜å…ˆçš„æ–¹æ³•ä¼šé˜»ç¢å¼€å‘å—ï¼Ÿ
*   å®ƒæ”¯æŒè®¢é˜…å—ï¼Ÿ
*   æ˜“äºå®ç°å’Œæ‰©å±•å—ï¼Ÿ
*   å®ƒæ”¯æŒå¼‚æ­¥æ“ä½œå—ï¼Ÿ
*   å®ƒæ”¯æŒè”ç›Ÿå—ï¼Ÿ
*   å®ƒæ˜¯å¦å…è®¸æ‚¨åˆ›å»ºè‡ªå®šä¹‰æŒ‡ä»¤ï¼Ÿ
*   å’Œå…¶ä»–å‡ ä¸ªäºº

å’Œè‡ªå·±çš„ç»å†ç›¸ä¼¼ï¼Ÿå¦‚æœæ˜¯è¿™æ ·ï¼Œæ‚¨æ˜¯å¦æ£€æŸ¥è¿‡æ‚¨æ­£åœ¨ä½¿ç”¨çš„å¼€æºæ¡†æ¶çš„æ–‡æ¡£å’Œä»£ç ï¼Œä»¥äº†è§£å®ƒä¸ºä»€ä¹ˆä¼šé‡åˆ°è¿™äº›éšœç¢ï¼Ÿæ˜¯å› ä¸ºå®ƒçš„è¯­è¨€(å³ Node.js/Ruby/PHP/etc.å›ºæœ‰çš„å±€é™æ€§)?è¿˜æ˜¯ç”±äºå…¶åº•å±‚æ¶æ„ï¼Ÿè¿˜èƒ½æ”¹è¿›å—ï¼Ÿ

æ›´è¿›ä¸€æ­¥ï¼Œæ‚¨æ˜¯å¦å°è¯•è¿‡é€šè¿‡è´¡çŒ®ä¸€ä¸ªæ‹‰è¯·æ±‚æ¥æä¾›æ‚¨çš„åº”ç”¨ç¨‹åºæ‰€éœ€çš„ç¼ºå¤±ç‰¹æ€§ï¼Œæˆ–è€…ï¼Œå¦‚æœæ‚¨å¤Ÿå¤§èƒ†çš„è¯ï¼Œé€šè¿‡æ´¾ç”Ÿä¸€ä¸ªç°æœ‰çš„æœåŠ¡å™¨æ¥æ„å»ºæ‚¨è‡ªå·±çš„æœåŠ¡å™¨ï¼Ÿæˆ–è€…ç”šè‡³ä»é›¶å¼€å§‹ï¼Ÿå¦‚æœä½ æœ‰ï¼Œæƒ…å†µå¦‚ä½•ï¼Ÿä½ å­¦åˆ°äº†ä»€ä¹ˆæ•™è®­ï¼Ÿä½ æˆåŠŸäº†å—ï¼Ÿ(è¯·åœ¨è¯„è®ºé‡Œå‘Šè¯‰æˆ‘ä»¬ï¼)

æˆ‘æ›¾ç»èµ°è¿‡æœ€ç–¯ç‹‚çš„è·¯:æˆ‘æ„å»ºäº†è‡ªå·±çš„ GraphQL æœåŠ¡å™¨ï¼Œç”¨ PHP å®ç°ã€‚æˆ‘æœ€è¿‘å®Œæˆäº†å®ƒçš„å®ç°(æ¯”å¦‚â€œå®ƒæ­£åœ¨å·¥ä½œâ€ï¼Œè€Œä¸æ˜¯â€œå®ƒå·²ç» 100%å®Œæˆäº†ï¼Œæˆ‘ä¸ä¼šå†åšå®ƒäº†â€)ï¼Œå¼€æºäº†å®ƒï¼Œå¹¶ç»™å®ƒèµ·äº†ä¸ªåå­—: [GraphQL by PoP](https://graphql.getpop.org/) ã€‚åœ¨åšè¿™ä»¶äº‹çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘è·å¾—äº†å¤§é‡çš„çŸ¥è¯†ï¼Œæˆ‘æƒ³ä¸å¤§å®¶åˆ†äº«ã€‚

è¿™æ˜¯ä¸€ç³»åˆ—æ–‡ç« ï¼Œå…¶ä¸­æˆ‘æ ¹æ®è‡ªå·±çš„ç»éªŒæè¿°äº†å¦‚ä½•è®¾è®¡ä¸€ä¸ª GraphQL æœåŠ¡å™¨ã€‚æ¯ç¯‡æ–‡ç« éƒ½å°†å…³æ³¨ä¸€äº›ç‰¹å®šçš„ç‰¹æ€§(å…³äºæ€§èƒ½ã€ç”Ÿäº§ç‡ã€å¯æ‰©å±•æ€§ã€å¯ç”¨æ€§ç­‰ç­‰)ï¼Œæè¿°å®ç°å®ƒçš„ç­–ç•¥ï¼Œæœ€åå±•ç¤ºä¸€äº›å®ç°ä»£ç ã€‚

æˆ‘å°†å°½å¯èƒ½æŠ½è±¡åœ°æè¿°æ¦‚å¿µå’Œè§£å†³æ–¹æ¡ˆï¼Œè¿™æ ·å³ä½¿å®ç°ä»£ç æ˜¯ PHPï¼Œç­–ç•¥ä¹Ÿå¯ä»¥è·¨å…¶ä»–è¯­è¨€å¤åˆ¶ã€‚ä¸ä»…åœ¨æœåŠ¡å™¨ç«¯ï¼Œåœ¨å®¢æˆ·ç«¯ä¹Ÿä¼šæœ‰ç»éªŒå’Œåº”ç”¨(ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¦‚ä½•å‡å°‘è¦æ‰§è¡Œçš„ JavaScript ä»£ç çš„æ•°é‡)ã€‚

å¼€å§‹å§ï¼åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†è®¨è®ºæ€§èƒ½ï¼Œå¹¶äº†è§£ GraphQL æœåŠ¡å™¨å¦‚ä½•é€šè¿‡æ¶æ„è®¾è®¡é¿å… N+1 é—®é¢˜ã€‚

## N+1 é—®é¢˜

[N+1 é—®é¢˜](https://itnext.io/what-is-the-n-1-problem-in-graphql-dd4921cb3c1a)åŸºæœ¬ä¸Šæ„å‘³ç€å¯¹æ•°æ®åº“æ‰§è¡Œçš„æŸ¥è¯¢é‡å¯ä»¥å’Œå›¾ä¸­èŠ‚ç‚¹çš„æ•°é‡ä¸€æ ·å¤§ã€‚

è®©æˆ‘ä»¬ç”¨ä¸€ä¸ªä¾‹å­æ¥éªŒè¯ä¸€ä¸‹ã€‚å‡è®¾æˆ‘ä»¬æƒ³è¦ä½¿ç”¨ä»¥ä¸‹æŸ¥è¯¢æ£€ç´¢å¯¼æ¼”åˆ—è¡¨ä»¥åŠä»–ä»¬æ¯ä¸ªäººçš„ç”µå½±:

```
{
  query {
    directors(first: 10) {
      name
      films(first: 10) {
        title
      }
    }
  }
}
```

ä¸ºäº†æé«˜æ•ˆç‡ï¼Œæˆ‘ä»¬å¸Œæœ›åªæ‰§è¡Œä¸¤ä¸ªæŸ¥è¯¢æ¥ä»æ•°æ®åº“ä¸­æ£€ç´¢æ•°æ®:ä¸€ä¸ªè·å–å¯¼æ¼”çš„æ•°æ®ï¼Œå¦ä¸€ä¸ªæ£€ç´¢æ‰€æœ‰å¯¼æ¼”çš„æ‰€æœ‰ç”µå½±çš„æ•°æ®ã€‚

ç„¶è€Œï¼Œä¸ºäº†æ»¡è¶³è¿™ä¸ªæŸ¥è¯¢ï¼ŒGraphQL éœ€è¦å¯¹æ•°æ®åº“æ‰§è¡Œ N+1 ä¸ªæŸ¥è¯¢:é¦–å…ˆæ£€ç´¢ N ä¸ªå¯¼æ¼”çš„åˆ—è¡¨(åœ¨è¿™ä¸ªä¾‹å­ä¸­æ˜¯ 10 ä¸ª)ï¼Œç„¶åï¼Œå¯¹äº N ä¸ªå¯¼æ¼”ä¸­çš„æ¯ä¸€ä¸ªï¼Œä¸€ä¸ªæŸ¥è¯¢æ£€ç´¢ä»–ä»¬çš„ç”µå½±åˆ—è¡¨ã€‚åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å¿…é¡»æ‰§è¡Œ 1+10=11 ä¸ªæŸ¥è¯¢ã€‚

å‡ºç°è¿™ä¸ªé—®é¢˜æ˜¯å› ä¸º GraphQL è§£æå™¨ä¸€æ¬¡åªå¤„ç†ä¸€ä¸ªå¯¹è±¡ï¼Œè€Œä¸æ˜¯åŒæ—¶å¤„ç†æ‰€æœ‰åŒç±»çš„å¯¹è±¡ã€‚åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œå¤„ç†`Query`ç±»å‹(å®ƒæ˜¯æ ¹ç±»å‹)å¯¹è±¡çš„è§£æå™¨ç¬¬ä¸€æ¬¡å°†è¢«è°ƒç”¨ä¸€æ¬¡ï¼Œä»¥è·å–æ‰€æœ‰`Director`å¯¹è±¡çš„åˆ—è¡¨ï¼Œç„¶åå¤„ç†`Director`ç±»å‹çš„è§£æå™¨å°†è¢«è°ƒç”¨ä¸€æ¬¡ï¼Œä»¥è·å–æ¯ä¸ª`Director`å¯¹è±¡çš„ç”µå½±åˆ—è¡¨ã€‚

æ¢å¥è¯è¯´ï¼ŒGraphQL è§£æå™¨çœ‹åˆ°çš„æ˜¯æ ‘ï¼Œè€Œä¸æ˜¯æ£®æ—ã€‚

è¿™ä¸ªé—®é¢˜å®é™…ä¸Šæ¯”å®ƒæœ€åˆå‡ºç°æ—¶æ›´ç³Ÿç³•ï¼Œå› ä¸ºå›¾ä¸­èŠ‚ç‚¹çš„æ•°é‡éšç€å›¾çš„å±‚æ•°å‘ˆæŒ‡æ•°å¢é•¿ã€‚æ‰€ä»¥ N+1 è¿™ä¸ªåå­—åªå¯¹ä¸¤å±‚æ·±çš„å›¾æœ‰æ•ˆã€‚å¯¹äºä¸‰å±‚æ·±åº¦çš„å›¾ï¼Œåº”è¯¥å«â€œN Â² +N+1â€é—®é¢˜ï¼è¯¸å¦‚æ­¤ç±»â€¦

> æ•°å­¦å®¶ä»¬å¯èƒ½æƒ³ç§°ä¹‹ä¸ºâ€œ`âˆ‘N` ^(`i`) â€é—®é¢˜ï¼Œå…¶ä¸­`i`åœ¨ 0 å’Œå›¾ä¸­çš„å±‚æ•°å‡ 1 ä¹‹é—´è¿­ä»£ï¼Œè€Œ`N`æ˜¯å›¾ä¸­æ¯ä¸€å±‚çš„æŸ¥è¯¢ç»“æœæ•°â€¦â€¦ä½†å¹¸è¿çš„æ˜¯ï¼Œå¯¹æˆ‘ä»¬æ‰€æœ‰å¼€å‘äººå‘˜æ¥è¯´ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸º N+1 é—®é¢˜ğŸ˜‚ã€‚

ä¾‹å¦‚ï¼ŒæŒ‰ç…§ä¸Šé¢çš„ä¾‹å­ï¼Œæˆ‘ä»¬ä¹Ÿå°†æ¯éƒ¨ç”µå½±çš„ç”·æ¼”å‘˜/å¥³æ¼”å‘˜åˆ—è¡¨æ·»åŠ åˆ°æŸ¥è¯¢ä¸­ï¼Œå¦‚ä¸‹æ‰€ç¤º:

```
{
  query {
    directors(first: 10) {
      name
      films(first: 10) {
        title
        actors(first: 10) {
          name
        }
      }
    }
  }
}
```

å¯¹æ•°æ®åº“æ‰§è¡Œçš„æŸ¥è¯¢æ˜¯:é¦–å…ˆæ£€ç´¢ 10 ä¸ªæ§åˆ¶å™¨çš„åˆ—è¡¨ï¼›ç„¶åä¸€ä¸ªæŸ¥è¯¢æ£€ç´¢ 10 ä¸ªå¯¼æ¼”ä¸­çš„æ¯ä¸ªå¯¼æ¼”çš„ç”µå½±åˆ—è¡¨ï¼›æœ€åï¼Œä¸€ä¸ªæŸ¥è¯¢æ£€ç´¢ 10 ä½å¯¼æ¼”çš„ 10 éƒ¨ç”µå½±çš„ç”·/å¥³æ¼”å‘˜åˆ—è¡¨ã€‚è¿™æ€»å…±ç»™å‡ºäº† 1+10+100=111 ä¸ªæŸ¥è¯¢ã€‚

æ³¨æ„åˆ°è¿™ç§è¡Œä¸ºåï¼ŒN+1 é—®é¢˜å¾ˆå®¹æ˜“è¢«è®¤ä¸ºæ˜¯ GraphQL æœ€å¤§çš„æ€§èƒ½éšœç¢ã€‚å¦‚æœä¸åŠ æ£€æŸ¥ï¼ŒæŸ¥è¯¢å‡ ä¸ªå±‚æ¬¡çš„å›¾å¯èƒ½ä¼šå˜å¾—éå¸¸æ…¢ï¼Œä»¥è‡³äºå®é™…ä¸Šä½¿ GraphQL å˜å¾—éå¸¸æ— ç”¨ã€‚

## å¤„ç† N+1 é—®é¢˜

N+1 é—®é¢˜çš„è§£å†³æ–¹æ¡ˆé¦–å…ˆæ˜¯ç”±è„¸ä¹¦é€šè¿‡å…¶åä¸º [DataLoader](https://github.com/graphql/dataloader) çš„å®ç”¨ç¨‹åºæä¾›çš„ï¼Œè¯¥å®ç”¨ç¨‹åºæ˜¯ä¸º Node.js å®ç°çš„ã€‚å®ƒçš„ç­–ç•¥éå¸¸ç®€å•:é€šè¿‡ [promises](https://blog.logrocket.com/improve-async-programming-with-javascript-promises-1652ac8d036d/) ï¼Œå®ƒå°†æŸ¥è¯¢ç‰‡æ®µçš„è§£ææ¨è¿Ÿåˆ°ç¨åé˜¶æ®µï¼Œå…¶ä¸­æ‰€æœ‰åŒç±»å¯¹è±¡éƒ½å¯ä»¥åœ¨å•ä¸ªæŸ¥è¯¢ä¸­ä¸€èµ·è§£æã€‚è¿™ç§ç­–ç•¥ç§°ä¸ºæ‰¹å¤„ç†ï¼Œæœ‰æ•ˆåœ°è§£å†³äº† N+1 é—®é¢˜ã€‚

æ­¤å¤–ï¼ŒDataLoader åœ¨æ£€ç´¢å¯¹è±¡åç¼“å­˜å®ƒä»¬ï¼Œä»¥ä¾¿å¦‚æœåç»­æŸ¥è¯¢éœ€è¦åŠ è½½å·²ç»åŠ è½½çš„å¯¹è±¡ï¼Œå®ƒå¯ä»¥è·³è¿‡æ‰§è¡Œå¹¶ä»ç¼“å­˜ä¸­æ£€ç´¢å¯¹è±¡ã€‚è¿™ç§ç­–ç•¥(ä¸è¶³ä¸ºå¥‡)è¢«ç§°ä¸ºç¼“å­˜ï¼Œä¸»è¦æ˜¯æ‰¹å¤„ç†ä¹‹ä¸Šçš„ä¼˜åŒ–ã€‚

æ‰¹å¤„ç†ç­–ç•¥(æœ‰æ—¶è¢«é‡å‘½åä¸ºâ€œdeferredâ€ï¼Œæˆ–ç±»ä¼¼çš„)å·²ç»æˆä¸º N+1 é—®é¢˜çš„æ ‡å‡†è§£å†³æ–¹æ¡ˆï¼Œè¢«ä¸åŒçš„ GraphQL æœåŠ¡å™¨ç”¨å‡ ç§è¯­è¨€å¤åˆ¶ï¼Œæ¯”å¦‚:[graph QL::Batch](https://github.com/Shopify/graphql-batch)for[graph QL-Ruby](https://graphql-ruby.org/)(Ruby)[graph QL-PHP by Webonyx](https://webonyx.github.io/graphql-php/data-fetching/#solving-n1-problem)(PHP)ï¼Œä»¥åŠ [Sangria](https://sangria-graphql.org/learn/#deferred-value-resolution) (Scala)ã€‚

## æ‰¹å¤„ç†/å»¶è¿Ÿè§£å†³æ–¹æ¡ˆçš„é—®é¢˜

ä»æŠ€æœ¯ä¸Šè®²ï¼Œæ‰¹å¤„ç†/å»¶è¿Ÿç­–ç•¥æ²¡æœ‰ä»»ä½•é—®é¢˜ï¼›å®ƒåªæ˜¯å·¥ä½œã€‚(ä¸ºäº†ç®€å•èµ·è§ï¼Œä»ç°åœ¨å¼€å§‹ï¼Œæˆ‘å°†æŠŠè¿™ä¸ªç­–ç•¥ç§°ä¸ºâ€œå»¶è¿Ÿçš„â€)

ç„¶è€Œï¼Œé—®é¢˜æ˜¯è¿™ä¸ªç­–ç•¥æ˜¯äº‹åæ‰æƒ³åˆ°çš„ï¼›å¼€å‘äººå‘˜å¯èƒ½é¦–å…ˆå®ç°æœåŠ¡å™¨ï¼Œç„¶åæ³¨æ„åˆ°è§£ææŸ¥è¯¢æœ‰å¤šæ…¢ï¼Œå°†å†³å®šå¼•å…¥å»¶è¿Ÿæœºåˆ¶ã€‚

å› æ­¤ï¼Œå®ç°è§£æå™¨å¯èƒ½æ¶‰åŠä¸€äº›äººä¸ºçš„æ­¥éª¤ï¼Œå¢åŠ äº†å¼€å‘è¿‡ç¨‹ä¸­çš„æ‘©æ“¦ã€‚æ­¤å¤–ï¼Œç”±äºå¼€å‘äººå‘˜å¿…é¡»äº†è§£å»¶è¿Ÿæœºåˆ¶æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œè¿™ä½¿å¾—å®ƒçš„å®ç°æ¯”å…¶ä»–æƒ…å†µæ›´åŠ å¤æ‚ã€‚

è¿™ä¸ªé—®é¢˜ä¸åœ¨äºç­–ç•¥æœ¬èº«ï¼Œè€Œåœ¨äºè®© GraphQL æœåŠ¡å™¨ä½œä¸ºä¸€ä¸ªé™„åŠ ç»„ä»¶æä¾›è¿™ä¸ªåŠŸèƒ½â€”â€”å³ä½¿æ²¡æœ‰å®ƒï¼ŒæŸ¥è¯¢å¯èƒ½ä¼šéå¸¸æ…¢ï¼Œä»¥è‡³äºè®© GraphQL å˜å¾—å‡ ä¹æ²¡æœ‰ç”¨(æ­£å¦‚æˆ‘å‰é¢æåˆ°çš„)ã€‚

å› æ­¤ï¼Œè¿™ä¸ªé—®é¢˜çš„è§£å†³æ–¹æ¡ˆå¾ˆç®€å•:å»¶è¿Ÿç­–ç•¥ä¸åº”è¯¥æ˜¯ä¸€ä¸ªé™„åŠ ç»„ä»¶ï¼Œè€Œæ˜¯åµŒå…¥åˆ° GraphQL æœåŠ¡å™¨æœ¬èº«ã€‚ä¸åº”è¯¥æœ‰ä¸¤ç§æŸ¥è¯¢æ‰§è¡Œç­–ç•¥â€”â€”æ­£å¸¸å’Œå»¶è¿Ÿâ€”â€”è€Œåº”è¯¥åªæœ‰ä¸€ç§:å»¶è¿Ÿã€‚å¹¶ä¸” GraphQL æœåŠ¡å™¨å¿…é¡»æ‰§è¡Œå»¶è¿Ÿæœºåˆ¶ï¼Œå³ä½¿å¼€å‘äººå‘˜ä»¥æ­£å¸¸æ–¹å¼å®ç°è§£æå™¨(æ¢å¥è¯è¯´ï¼ŒGraphQL æœåŠ¡å™¨å¤„ç†é¢å¤–çš„å¤æ‚æ€§ï¼Œè€Œä¸æ˜¯å¼€å‘äººå‘˜)ã€‚

å¦‚ä½•å®ç°è¿™ä¸€ç‚¹ï¼Ÿ

## ä½¿å¾— deferred æˆä¸º GraphQL æœåŠ¡å™¨æ‰§è¡Œçš„å”¯ä¸€ç­–ç•¥

é—®é¢˜æ˜¯å°†å¯¹è±¡ç±»å‹(`object`ã€`union`å’Œ`interface`)è§£æä¸ºå¯¹è±¡æ˜¯ç”±è§£æå™¨åœ¨å¤„ç†çˆ¶èŠ‚ç‚¹(ä¾‹å¦‚`films` = > `directors`)æ—¶è‡ªå·±å®Œæˆçš„ã€‚

è§£å†³æ–¹æ¡ˆæ˜¯å°†æ­¤èŒè´£ä»è§£æå™¨è½¬ç§»åˆ°æœåŠ¡å™¨çš„æ•°æ®åŠ è½½å¼•æ“ï¼Œå¦‚ä¸‹æ‰€ç¤º:

1.  åœ¨è§£æçˆ¶èŠ‚ç‚¹å’Œå­èŠ‚ç‚¹ä¹‹é—´çš„å…³ç³»æ—¶ï¼Œè®©è§£æç¨‹åºè¿”å› idï¼Œè€Œä¸æ˜¯å¯¹è±¡
2.  æœ‰ä¸€ä¸ª`DataLoader`å®ä½“ï¼Œç»™å®šä¸€ä¸ªç‰¹å®šç±»å‹çš„ id åˆ—è¡¨ï¼Œä»è¯¥ç±»å‹è·å¾—ç›¸åº”çš„å¯¹è±¡
3.  è®© GraphQL æœåŠ¡å™¨çš„æ•°æ®åŠ è½½å¼•æ“æˆä¸ºè¿™ä¸¤ä¸ªéƒ¨åˆ†ä¹‹é—´çš„ç²˜åˆå‰‚:å®ƒé¦–å…ˆä»è§£æå™¨è·å¾—å¯¹è±¡ idï¼Œç„¶ååœ¨æ‰§è¡Œå…³ç³»çš„åµŒå¥—æŸ¥è¯¢ä¹‹å‰(æ­¤æ—¶å®ƒå·²ç»ç´¯ç§¯äº†è¦ä¸ºç‰¹å®šç±»å‹è§£æçš„æ‰€æœ‰ id)ï¼Œå®ƒé€šè¿‡`DataLoader`(å¯ä»¥æœ‰æ•ˆåœ°å°†æ‰€æœ‰ id åŒ…å«åœ¨ä¸€ä¸ªæŸ¥è¯¢ä¸­)æ£€ç´¢è¿™äº› id çš„å¯¹è±¡

è¿™ç§æ–¹æ³•å¯ä»¥æ¦‚æ‹¬ä¸º:â€œå¤„ç† idï¼Œè€Œä¸æ˜¯å¯¹è±¡ã€‚â€

è®©æˆ‘ä»¬ä½¿ç”¨å‰é¢çš„åŒä¸€ä¸ªä¾‹å­æ¥å½¢è±¡åŒ–è¿™ä¸ªæ–°æ–¹æ³•ã€‚ä»¥ä¸‹æŸ¥è¯¢æ£€ç´¢å¯¼æ¼”åŠå…¶ç”µå½±çš„åˆ—è¡¨:

```
{
  query {
    directors(first: 10) {
      name
      films(first: 10) {
        title
      }
    }
  }
}
```

è¯·æ³¨æ„è¦ä»æ¯ä¸ªæ§åˆ¶å™¨ä¸­æ£€ç´¢çš„ä¸¤ä¸ªå­—æ®µâ€” `name`å’Œ`films` â€”ä»¥åŠå®ƒä»¬ç›®å‰æœ‰ä½•ä¸åŒã€‚

`name`å­—æ®µå±äº[æ ‡é‡ç±»å‹](https://graphql.org/learn/schema/#scalar-types)ã€‚å®ƒæ˜¯ç«‹å³å¯è§£æçš„ï¼Œå› ä¸ºæˆ‘ä»¬å¯ä»¥é¢„æœŸç±»å‹ä¸º`Director`çš„å¯¹è±¡åŒ…å«ç±»å‹ä¸º`string`çš„å±æ€§ï¼Œåä¸º`name`ï¼ŒåŒ…å«å¯¼æ¼”çš„åå­—ã€‚å› æ­¤ï¼Œä¸€æ—¦æˆ‘ä»¬æœ‰äº†`Director`å¯¹è±¡ï¼Œå°±ä¸éœ€è¦æ‰§è¡Œé¢å¤–çš„æŸ¥è¯¢æ¥è§£æè¿™ä¸ªå±æ€§ã€‚

ç„¶è€Œï¼Œ`films`å­—æ®µæ˜¯[å¯¹è±¡ç±»å‹](https://graphql.org/learn/schema/#object-types-and-fields)çš„[åˆ—è¡¨](https://graphql.org/learn/schema/#lists-and-non-null)ã€‚å®ƒé€šå¸¸ä¸å¯ç«‹å³è§£æï¼Œå› ä¸ºå®ƒå¼•ç”¨äº†ä¸€ä¸ªç±»å‹ä¸º`Film`çš„å¯¹è±¡åˆ—è¡¨ï¼Œè¯¥åˆ—è¡¨ä»ç„¶å¿…é¡»é€šè¿‡ä¸€ä¸ªæˆ–å¤šä¸ªé¢å¤–çš„æŸ¥è¯¢ä»æ•°æ®åº“ä¸­æ£€ç´¢ã€‚å› æ­¤ï¼Œå¼€å‘äººå‘˜éœ€è¦ä¸ºå®ƒå®ç°å»¶è¿Ÿæœºåˆ¶ã€‚

ç°åœ¨è®©æˆ‘ä»¬è€ƒè™‘ä¸åŒçš„è¡Œä¸ºï¼Œå°†å­—æ®µ`films`è§£æä¸º id åˆ—è¡¨(è€Œä¸æ˜¯å¯¹è±¡åˆ—è¡¨)ã€‚å› ä¸ºæˆ‘ä»¬å¯ä»¥é¢„æœŸ`Director`å¯¹è±¡åŒ…å«ä¸€ä¸ªåä¸º`filmIDs`çš„å±æ€§ï¼Œè¯¥å±æ€§åŒ…å«å…¶æ‰€æœ‰ç±»å‹ä¸º`array of string`çš„ç”µå½±çš„ ID(å‡è®¾ ID è¡¨ç¤ºä¸ºå­—ç¬¦ä¸²)ï¼Œé‚£ä¹ˆè¿™ä¸ªå­—æ®µä¹Ÿå¯ä»¥ç«‹å³è¢«è§£æï¼Œè€Œä¸éœ€è¦å®ç°å»¶è¿Ÿæœºåˆ¶ã€‚

æœ€åï¼Œé™¤äº† ID ä¹‹å¤–ï¼Œè§£æå™¨è¿˜å¿…é¡»ç»™å‡ºä¸€æ¡é¢å¤–çš„ä¿¡æ¯:é¢„æœŸå¯¹è±¡çš„ç±»å‹ã€‚åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œå®ƒå¯èƒ½æ˜¯`[(Film, 2), (Film, 5), (Film, 9)]`ã€‚ä¸è¿‡ï¼Œè¿™äº›ä¿¡æ¯æ˜¯å†…éƒ¨çš„ï¼Œä¼šä¼ é€’ç»™å¼•æ“ï¼Œä¸éœ€è¦åœ¨å¯¹æŸ¥è¯¢çš„å“åº”ä¸­è¾“å‡ºã€‚

## ç±»å‹å®‰å…¨å—æŸï¼Ÿ

è¿™ç§æ–°æ–¹æ³•çš„å«ä¹‰æ˜¯ï¼Œå¯¹è±¡ç±»å‹çš„å­—æ®µå°†ä»¥ä¸¤ç§ä¸åŒçš„æ–¹å¼è§£æ:å¦‚æœå®ƒåŒ…å«åµŒå¥—æŸ¥è¯¢ï¼Œå®ƒå°†è¢«è¡¨ç¤ºä¸ºä¸€ä¸ªå¯¹è±¡(æˆ–å¯¹è±¡åˆ—è¡¨)ï¼Œå¦‚æœä¸åŒ…å«ï¼Œåˆ™è¢«è¡¨ç¤ºä¸ºä¸€ä¸ª ID(æˆ– ID åˆ—è¡¨)ã€‚

ä¾‹å¦‚ï¼Œæ£€æŸ¥æ¥è‡ªä»¥ä¸‹æŸ¥è¯¢çš„å“åº”çš„å·®å¼‚(è¦äº²è‡ªæŸ¥çœ‹å®ƒçš„è¿è¡Œæƒ…å†µï¼Œè¯·é’ˆå¯¹ [this endpoint](https://newapi.getpop.org/api/graphql/) æ‰§è¡ŒæŸ¥è¯¢):

> `author`å¸¦åµŒå¥—æŸ¥è¯¢çš„å­—æ®µ:

```
{
  query {
    post(id: 1) {
      title
      author {
        name
      }
    }
  }
}
```

![Author Field With Nested Query](img/ee8d1b87cf9fe9e4e06705dcb9dd2b91.png)

> `author`æ— åµŒå¥—æŸ¥è¯¢çš„å­—æ®µ:

```
{
  query {
    post(id: 1) {
      title
      author
    }
  }
}
```

![Author Field Without Nested Query](img/de0911661bd7b0548f46b25c3761e65e.png)

å¦‚æ‚¨æ‰€è§ï¼Œåœ¨ç¬¬ä¸€ç§æƒ…å†µä¸‹ï¼Œå¯¹å­—æ®µ`author`çš„å“åº”æ˜¯å¯¹è±¡`{"name": "leo"}`ï¼Œåœ¨ç¬¬äºŒç§æƒ…å†µä¸‹ï¼Œå®ƒæ˜¯å­—ç¬¦ä¸²`"1"`ã€‚

å®é™…ä¸Šï¼Œè¿™ç§ä¸ä¸€è‡´å¯èƒ½æ°¸è¿œä¸ä¼šå‡ºç°ï¼Œå› ä¸ºå¯¹è±¡ç±»å‹çš„å­—æ®µæ€»æ˜¯è¢«æœŸæœ›æä¾›åµŒå¥—æŸ¥è¯¢(æˆ–è€…å®ƒå°†äº§ç”Ÿç©ºå¯¹è±¡ï¼Œè¿™æ˜¯æ²¡æœ‰æ„ä¹‰çš„)ã€‚äº‹å®ä¸Šï¼ŒGraphiQL ä¸å…è®¸æˆ‘ä»¬æŸ¥è¯¢æ²¡æœ‰åµŒå¥—æŸ¥è¯¢çš„å¯¹è±¡ï¼›å®ƒæ€»æ˜¯æ·»åŠ ä¸€äº›é¢„å®šä¹‰çš„é»˜è®¤å­—æ®µ(ä¸ºæ­¤ï¼Œæˆ‘ä¸å¾—ä¸ä½¿ç”¨ GraphQL Playground æ¥æ¼”ç¤ºä¸Šé¢çš„ä¾‹å­)ã€‚

ä½†æ˜¯ï¼Œå¦‚æœå¿…é¡»æ¶ˆé™¤è¿™ç§è¡Œä¸ºâ€”â€”ä¾‹å¦‚ï¼Œä½¿è¿”å›çš„ç±»å‹æ€»æ˜¯ä¸æ¨¡å¼ä¸€è‡´â€”â€”é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥æ·»åŠ ä¸€ä¸ªéå¸¸ç®€å•çš„è§£å†³æ–¹æ¡ˆã€‚

æˆ‘ä»¬æ²¡æœ‰å°†å­—æ®µè§£æä¸º IDï¼Œè€Œæ˜¯å°†å®ƒè§£æä¸º ID å­˜å‚¨åœ¨å±æ€§`"id"`ä¸‹çš„æ•°ç»„(æˆ–è€…ç›¸åº”ç±»å‹ä¸Šè¯¥å±æ€§çš„åç§°)ï¼Œå¹¶è®©æ•°æ®åŠ è½½å¼•æ“ä»æ•°ç»„ä¸­æ£€ç´¢ IDã€‚ç„¶åï¼ŒæŸ¥è¯¢æ²¡æœ‰åµŒå¥—æŸ¥è¯¢çš„å¯¹è±¡å°†è¿”å›`{id: ...}`ï¼Œè¿™å°†ä¸è¯¥ç±»å‹çš„æ¨¡å¼ä¸­çš„å®šä¹‰å…¼å®¹ã€‚

## åœ¨ä»£ç ä¸­å®ç°è°ƒæ•´åçš„æ–¹æ³•

è®©æˆ‘ä»¬çœ‹çœ‹è¿™ä¸ªè°ƒæ•´åçš„ç­–ç•¥åœ¨(PHP)ä»£ç ä¸­æ˜¯æ€æ ·çš„ï¼Œæ­£å¦‚ PoP åœ¨ [GraphQL ä¸­å®ç°çš„é‚£æ ·ã€‚ä¸‹é¢çš„ä»£ç æ¼”ç¤ºäº†ä¸åŒçš„è§£æå™¨ï¼›æ•°æ®åŠ è½½å¼•æ“çš„ä»£ç ä¸ä¼šè¢«æ¼”ç¤ºï¼Œå› ä¸ºå®ƒå¹¶ä¸ç®€å•ï¼Œå¹¶ä¸”è¶…å‡ºäº†æœ¬æ–‡çš„èŒƒå›´ã€‚](https://graphql.getpop.org/)

å¦‚å‰æ‰€è¿°ï¼Œæˆ‘ä»¬éœ€è¦å°†è§£æå™¨åˆ†æˆä¸¤ä¸ªä¸åŒçš„å®ä½“ï¼Œ`FieldResolvers`å’Œ`TypeDataLoaders`ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬å°†ä¸`TypeResolvers`æ‰“äº¤é“ã€‚è®©æˆ‘ä»¬ä¸€ä¸ªä¸€ä¸ªæ¥çœ‹è¿™äº›å®ä½“ã€‚

> ä¸ºäº†æ¸…æ¥šèµ·è§ï¼Œä¸‹é¢çš„æ‰€æœ‰ä»£ç éƒ½ç»è¿‡äº†ç¼–è¾‘ã€‚å›è´­ä¸­ä¼šæœ‰æŒ‡å‘åŸå§‹ä»£ç çš„é“¾æ¥ï¼Œåœ¨é‚£é‡Œå¯ä»¥æ‰¾åˆ°æœªç»ç¼–è¾‘çš„æºä»£ç ã€‚

### `FieldResolvers`

æ¥æ”¶ä¸€ä¸ªç‰¹å®šç±»å‹çš„å¯¹è±¡å¹¶è§£æå®ƒçš„å­—æ®µã€‚å¯¹äºå…³ç³»ï¼Œå®ƒè¿˜å¿…é¡»æŒ‡ç¤ºå®ƒè§£æåˆ°çš„å¯¹è±¡çš„ç±»å‹ã€‚ä»–ä»¬çš„åˆåŒæ˜¯é€šè¿‡[è¿™ä¸ªæ¥å£](https://github.com/getpop/component-model/blob/8e3b56f2f5fd9e88002b932a552a72826e70e8b5/src/FieldResolvers/FieldResolverInterface.php)å®šä¹‰çš„:

```
interface FieldResolverInterface
{
  public function resolveValue($object, string $field, array $args = []);
  public function resolveFieldTypeResolverClass(string $field, array $args = []): ?string;
}
```

å®ƒçš„å®ç°çœ‹èµ·æ¥åƒè¿™æ ·:

```
class PostFieldResolver implements FieldResolverInterface
{
  public function resolveValue($object, string $field, array $args = [])
  {
    $post = $object;
    switch ($field) {
      case 'title':
        return $post->title;
      case 'author':
        return $post->authorID; // This is an ID, not an object!
    }

    return null;
  }

  public function resolveFieldTypeResolverClass(string $field, array $args = []): ?string
  {
    switch ($field) {
      case 'author':
        return UserTypeResolver::class;
    }

    return null;
  }
}
```

è¯·æ³¨æ„ï¼Œé€šè¿‡åˆ é™¤å¤„ç†æ‰¿è¯º/å»¶è¿Ÿå¯¹è±¡çš„é€»è¾‘ï¼Œä»£ç è§£æå­—æ®µ`author`å˜å¾—éå¸¸ç®€å•å’Œç®€æ´ã€‚

### `TypeResolvers`

`TypeResolvers`æ˜¯å¤„ç†ç‰¹å®šç±»å‹çš„å¯¹è±¡ã€‚ä»–ä»¬çŸ¥é“è¯¥ç±»å‹çš„åç§°ï¼Œä»¥åŠå“ªä¸ª`TypeDataLoader`åŠ è½½äº†è¯¥ç±»å‹çš„å¯¹è±¡ï¼Œç­‰ç­‰ã€‚

GraphQL æœåŠ¡å™¨çš„æ•°æ®åŠ è½½å¼•æ“åœ¨è§£æå­—æ®µæ—¶ï¼Œå°†ä»æŸä¸ª`TypeResolver`ç±»è·å¾— idã€‚ç„¶åï¼Œå½“æ£€ç´¢è¿™äº› id çš„å¯¹è±¡æ—¶ï¼Œæ•°æ®åŠ è½½å¼•æ“å°†è¯¢é—®`TypeResolver`ä½¿ç”¨å“ªä¸ª`TypeDataLoader`å¯¹è±¡æ¥åŠ è½½è¿™äº›å¯¹è±¡ã€‚

ä»–ä»¬çš„åˆåŒæ˜¯è¿™æ ·å®šä¹‰çš„:

```
interface TypeResolverInterface
{
  public function getTypeName(): string;
  public function getTypeDataLoaderClass(): string;
}

```

åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œç±»`UserTypeResolver`å®šä¹‰äº†ç±»å‹`User`å¿…é¡»é€šè¿‡ç±»`UserTypeDataLoader`åŠ è½½å®ƒçš„æ•°æ®:

```
class UserTypeResolver implements TypeResolverInterface
{
  public function getTypeName(): string
  {
    return 'User';
  }

  public function getTypeDataLoaderClass(): string
  {
    return UserTypeDataLoader::class;
  }
}
```

### `TypeDataLoaders`

æ¥æ”¶ç‰¹å®šç±»å‹çš„ id åˆ—è¡¨ï¼Œå¹¶è¿”å›è¯¥ç±»å‹çš„ç›¸åº”å¯¹è±¡ã€‚è¯¥è¡Œä¸ºæ˜¯é€šè¿‡[æœ¬åˆåŒ](https://github.com/getpop/component-model/blob/7e1588286ce2eb67bffebe9fd6ab2e5274238777/src/TypeDataLoaders/TypeDataLoaderInterface.php)å®šä¹‰çš„:

```
interface TypeDataLoaderInterface
{
  public function getObjects(array $ids): array;
}

```

æ£€ç´¢ç”¨æˆ·æ˜¯è¿™æ ·å®Œæˆçš„(åœ¨æœ¬ä¾‹ä¸­ï¼Œåœ¨ WordPress ä¸Šè¿è¡Œ GraphQL æœåŠ¡å™¨):

```
class UserTypeDataLoader implements TypeDataLoaderInterface
{
  public function getObjects(array $ids): array
  {
    return get_users([
      'include' => $ids,
    ]);
  }
}
```

å·®ä¸å¤šå°±æ˜¯è¿™æ ·äº†ã€‚

## æµ‹è¯•æ–°æ–¹æ³•æ˜¯å¦æœ‰æ•ˆ

æˆ‘ä¸ä¼šåˆ†æè§£å†³æ–¹æ¡ˆçš„[å¤§ O ç¬¦å·](https://en.wikipedia.org/wiki/Big_O_notation)æ¥ç†è§£æŸ¥è¯¢çš„æ•°é‡æ˜¯å¦‚ä½•éšç€å›¾ä¸­èŠ‚ç‚¹æ•°é‡çš„å¢åŠ è€Œå¢åŠ çš„ï¼Œå› ä¸ºè¿™å¾ˆéš¾åšåˆ°ï¼Œå¹¶ä¸”éœ€è¦åˆ†ææ•°æ®åŠ è½½å¼•æ“æ˜¯å¦‚ä½•å·¥ä½œçš„(æˆ‘è¿˜æ²¡æœ‰è¿™æ ·åšï¼Œå¹¶è®¡åˆ’åœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­è¿›è¡Œ)ã€‚

ç›¸åï¼Œæˆ‘å°†ç®€å•åœ°æä¾›ä¸€ä¸ªéå¸¸å¤æ‚çš„æŸ¥è¯¢ï¼Œæ¶‰åŠä¸€ä¸ª 10 å±‚æ·±çš„å›¾(`posts`=>`author`=>=>`tags`=>`posts`=>=`comments`=>`author`=>`posts`=>`comments`=>`author`)ï¼Œå¦‚æœå‘ç”Ÿ N+1 ä¸ªé—®é¢˜ï¼Œå°±æ— æ³•è§£å†³è¿™ä¸ªé—®é¢˜ã€‚é—®é¢˜æ˜¯è¿™æ ·çš„:

```
query {
  posts(limit:10) {
    excerpt
    title
    url
    author {
      name
      url
      posts(limit:10) {
        title
        tags(limit:10) {
          slug
          url
          posts(limit:10) {
            title
            comments(limit:10) {
              content
              date
              author {
                name
                posts(limit:10) {
                  title
                  url
                  comments(limit:10) {
                    content
                    date
                    author {
                      name
                      username
                      url
                    }
                  }
                }
              }
            }
          }
        }
      }
    }
  }
}
```

è¦æ‰§è¡Œè¿™ä¸ªæŸ¥è¯¢å¹¶ä½¿ç”¨å®ƒï¼Œè¯·è½¬åˆ°[è¿™ä¸ª GraphiQL å®¢æˆ·ç«¯](https://newapi.getpop.org/graphiql/?query=query%20%7B%0A%20%20posts(limit%3A10)%20%7B%0A%20%20%20%20excerpt%0A%20%20%20%20title%0A%20%20%20%20url%0A%20%20%20%20author%20%7B%0A%20%20%20%20%20%20name%0A%20%20%20%20%20%20url%0A%20%20%20%20%20%20posts(limit%3A10)%20%7B%0A%20%20%20%20%20%20%20%20title%0A%20%20%20%20%20%20%20%20tags(limit%3A10)%20%7B%0A%20%20%20%20%20%20%20%20%20%20slug%0A%20%20%20%20%20%20%20%20%20%20url%0A%20%20%20%20%20%20%20%20%20%20posts(limit%3A10)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20title%0A%20%20%20%20%20%20%20%20%20%20%20%20comments(limit%3A10)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20content%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20date%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20author%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20name%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20posts(limit%3A10)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20title%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20url%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20comments(limit%3A10)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20content%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20date%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20author%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20name%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20username%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20url%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%0A%20%20%7D%0A%7D%0A)å¹¶ç‚¹å‡»â€œè¿è¡Œâ€æŒ‰é’®ã€‚ç„¶åï¼Œæ‚¨å¯ä»¥å‘ä¸‹æ»šåŠ¨ç»“æœï¼ŒæŸ¥çœ‹å“åº”æœ‰å¤šå¤§ï¼Œå®ƒæ¶‰åŠå¤šå°‘ä¸ªå®ä½“ï¼Œä»¥åŠå®ƒæ£€ç´¢äº†å¤šå°‘ä¸ªçº§åˆ«ã€‚

## å¿«é€Ÿå›é¡¾å’Œæ€»ç»“

N+1 é—®é¢˜æ˜¯ GraphQL çš„å¤§æ•Œï¼Œæ˜¯éœ€è¦ä¸æƒœä¸€åˆ‡ä»£ä»·é¿å…çš„ã€‚å½“æŸ¥è¯¢å¯ä»¥åˆå¹¶æˆä¸€ä¸ªå•ç‹¬çš„æŸ¥è¯¢æ—¶ï¼Œè¿™ä½¿å¾— GraphQL çš„æ•ˆç‡å¾ˆä½ï¼Œéšç€å›¾è¡¨æ·±åº¦çš„å¢åŠ ï¼Œé€Ÿåº¦ä¼šè¶Šæ¥è¶Šæ…¢ã€‚

è¿™ä¸ªé—®é¢˜æœ‰ä¸€ä¸ªè§£å†³æ–¹æ¡ˆï¼Œç”± [DataLoader](https://github.com/graphql/dataloader) å’Œå®ƒå½±å“çš„ä¸åŒè¯­è¨€çš„å„ç§ GraphQL æœåŠ¡å™¨çš„åº“æä¾›ã€‚ç„¶è€Œï¼Œæ‰€æœ‰è¿™äº›åº“éƒ½æœ‰ä¸€ä¸ªç¼ºç‚¹:å®ƒä»¬å­˜åœ¨ã€‚è¿™å°±è¦æ±‚å¼€å‘è€…æœ‰ä¸¤ç§é€‰æ‹©:

1.  ä¸ä½¿ç”¨å®ƒä»¬ï¼Œè¿™å¯èƒ½å¯¼è‡´éå¸¸ä½æ•ˆçš„ GraphQL å˜å¾—å‡ ä¹æ— ç”¨
2.  ä¸ºäº†ä½¿ç”¨å®ƒä»¬ï¼Œå¿…é¡»å­¦ä¹ /ç†è§£/å®ç°å®ƒä»¬çš„æŠ€æœ¯ç»†èŠ‚

å¦‚æœè§£å†³ N+1 é—®é¢˜çš„å»¶è¿Ÿæœºåˆ¶å·²ç»åµŒå…¥åˆ° GraphQL æœåŠ¡å™¨çš„æ ¸å¿ƒä¸­ï¼Œé»˜è®¤æ‰§è¡Œ(äº‹å®ä¸Šï¼Œé™¤äº†ä½¿ç”¨å®ƒåˆ«æ— é€‰æ‹©)ï¼Œå¹¶ä¸”å¼€å‘äººå‘˜ç”šè‡³ä¸éœ€è¦çŸ¥é“å®ƒçš„å­˜åœ¨ï¼Œé‚£å°±å¥½å¾—å¤šäº†ã€‚

è¿™ç§æ”¹è¿›å¯ä»¥é€šè¿‡ç®€å•åœ°é‡ç»„ GraphQL æœåŠ¡å™¨çš„æ¶æ„æ¥å®ç°:è®©ä¸€ä¸ª`FieldResolver`å°†å…³ç³»è§£æä¸º idï¼Œè€Œä¸æ˜¯å¯¹è±¡ï¼Œç„¶åè®©æ•°æ®åŠ è½½å¼•æ“åœ¨æ‰§è¡Œå…³ç³»çš„åµŒå¥—æŸ¥è¯¢ä¹‹å‰é€šè¿‡è°ƒç”¨ä¸€ä¸ª`TypeDataLoader`å¯¹è±¡æ¥æ£€ç´¢è¿™äº› id çš„ç›¸åº”å¯¹è±¡ã€‚

ä½œä¸ºä¸€ä¸ªå—æ¬¢è¿çš„å‰¯ä½œç”¨ï¼Œå®ç°æ–°æ–¹æ³•çš„ä»£ç æ›´åŠ ç®€æ´:å°†è§£æå™¨åˆ†æˆä¸¤ä¸ªä¸åŒçš„å®ä½“`FieldResolvers`å’Œ`TypeDataLoaders`å¢åŠ äº†å…³æ³¨ç‚¹çš„åˆ†ç¦»ï¼Œä½¿æ¯æ®µä»£ç æ›´åŠ åŸå­åŒ–å’Œæ˜“è¯»ï¼Œè§£æå™¨ä¸­çš„é€»è¾‘å˜å¾—æ›´åŠ ç®€å•ã€‚

## ç›‘æ§ç”Ÿäº§ä¸­å¤±è´¥å’Œç¼“æ…¢çš„ GraphQL è¯·æ±‚

è™½ç„¶ GraphQL æœ‰ä¸€äº›è°ƒè¯•è¯·æ±‚å’Œå“åº”çš„ç‰¹æ€§ï¼Œä½†ç¡®ä¿ GraphQL å¯é åœ°ä¸ºæ‚¨çš„ç”Ÿäº§åº”ç”¨ç¨‹åºæä¾›èµ„æºæ˜¯ä¸€ä»¶æ¯”è¾ƒå›°éš¾çš„äº‹æƒ…ã€‚å¦‚æœæ‚¨å¯¹ç¡®ä¿å¯¹åç«¯æˆ–ç¬¬ä¸‰æ–¹æœåŠ¡çš„ç½‘ç»œè¯·æ±‚æˆåŠŸæ„Ÿå…´è¶£ï¼Œ

[try LogRocket](https://lp.logrocket.com/blg/graphql-signup)

.

[![](img/432a3823c85b3fb72a206e6236a29f48.png)![LogRocket Dashboard Free Trial Banner](img/d6f5a5dd739296c1dd7aab3d5e77eeb9.png)](https://lp.logrocket.com/blg/graphql-signup)[https://logrocket.com/signup/](https://lp.logrocket.com/blg/graphql-signup)

LogRocket å°±åƒæ˜¯ç½‘ç»œå’Œç§»åŠ¨åº”ç”¨çš„ DVRï¼Œè®°å½•ä¸‹ä½ ç½‘ç«™ä¸Šå‘ç”Ÿçš„æ¯ä¸€ä»¶äº‹ã€‚æ‚¨å¯ä»¥æ±‡æ€»å¹¶æŠ¥å‘Šæœ‰é—®é¢˜çš„ GraphQL è¯·æ±‚ï¼Œä»¥å¿«é€Ÿäº†è§£æ ¹æœ¬åŸå› ï¼Œè€Œä¸æ˜¯çŒœæµ‹é—®é¢˜å‘ç”Ÿçš„åŸå› ã€‚æ­¤å¤–ï¼Œæ‚¨å¯ä»¥è·Ÿè¸ª Apollo å®¢æˆ·æœºçŠ¶æ€å¹¶æ£€æŸ¥ GraphQL æŸ¥è¯¢çš„é”®å€¼å¯¹ã€‚

LogRocket æ£€æµ‹æ‚¨çš„åº”ç”¨ç¨‹åºä»¥è®°å½•åŸºçº¿æ€§èƒ½è®¡æ—¶ï¼Œå¦‚é¡µé¢åŠ è½½æ—¶é—´ã€åˆ°è¾¾ç¬¬ä¸€ä¸ªå­—èŠ‚çš„æ—¶é—´ã€æ…¢é€Ÿç½‘ç»œè¯·æ±‚ï¼Œè¿˜è®°å½• Reduxã€NgRx å’Œ Vuex æ“ä½œ/çŠ¶æ€ã€‚

[Start monitoring for free](https://lp.logrocket.com/blg/graphql-signup)

.