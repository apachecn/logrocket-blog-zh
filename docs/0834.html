<html>
<head>
<title>Make your own online radio server in pure Node.js - LogRocket Blog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>åœ¨pure Node.js - LogRocketåšå®¢ä¸­åˆ¶ä½œè‡ªå·±çš„åœ¨çº¿ç”µå°æœåŠ¡å™¨</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://blog.logrocket.com/online-radio-server-pure-node-js/#0001-01-01">https://blog.logrocket.com/online-radio-server-pure-node-js/#0001-01-01</a></blockquote><div><article class="article-post">
<p>JavaScriptæ˜¯ä¸€ç§çœŸæ­£é€šç”¨ä¸”å¹³å°æ— å…³çš„è¯­è¨€ï¼ŒåŒ…æ‹¬Node.jsè¿è¡Œæ—¶ã€‚ä½ å¯ä»¥ç”¨å®ƒå»ºé€ ä»»ä½•ä½ æƒ³è¦çš„ä¸œè¥¿ã€‚è¯šç„¶ï¼Œæœ‰äº›äº‹æƒ…æ¯”å…¶ä»–äº‹æƒ…å®¹æ˜“ï¼Œä½†æˆ‘å–œæ¬¢å¯»æ‰¾ä¸€äº›éæ ‡å‡†çš„é¡¹ç›®ï¼Œæˆ‘å¯ä»¥ä¸ºäº†ä¹è¶£è€ŒæŠ•å…¥å…¶ä¸­ã€‚</p>
<p>ä¸ä¹…å‰ï¼Œæˆ‘ç»å¸¸æ”¶å¬æˆ‘å…³æ³¨çš„å‡ ä¸ªåœ¨çº¿ç”µå°ã€‚æœ‰æ—¶æˆ‘æƒ³çŸ¥é“å®ç°æˆ‘è‡ªå·±çš„æ— çº¿ç”µæœåŠ¡å™¨ä¼šæœ‰å¤šå›°éš¾ã€‚å¥½å§ï¼Œä¹Ÿè®¸ä½ å·²ç»çŒœåˆ°äº†ï¼Œä½†æˆ‘ä¸å†æ€€ç–‘ï¼Œå¹¶å†³å®šé‡‡å–ä¸€äº›è¡ŒåŠ¨ã€‚æˆ‘å°†ä¸ä½ åˆ†äº«æˆ‘çš„å†’é™©ã€‚</p>
<h2>æˆ‘ä»¬ä»Šå¤©åœ¨å»ºé€ ä»€ä¹ˆï¼Ÿ</h2>
<p>æˆ‘ä»¬çš„ç›®æ ‡æ˜¯å®ç°ä¸€ä¸ªNode.js HTTPæœåŠ¡å™¨ï¼Œå®ƒå°†æœ‰ä¸€ä¸ªç”¨äºæµå¼æ’­æ”¾æ­Œæ›²(å³éŸ³é¢‘æ•°æ®)çš„ç«¯ç‚¹ã€‚ç„¶åï¼Œå®¢æˆ·ç«¯å¯ä»¥é€šè¿‡å‘è¯¥ç«¯ç‚¹å‘å‡ºè¯·æ±‚æ¥å¼€å§‹æ¶ˆè´¹æ•°æ®ã€‚</p>
<p>æˆ‘ä»¬è¿˜éœ€è¦å®ç°æŸç§æ§åˆ¶é¢æ¿ï¼Œä»¥ä¾¿æˆ‘ä»¬å¯ä»¥ç®¡ç†ä¸‹ä¸€é¦–æ­Œæ›²å°†è¢«æµå¼ä¼ è¾“ã€‚æœ€é‡è¦çš„æ˜¯ï¼Œæˆ‘ä»¬å°†å®ç°ä¸€ä¸ªç®€å•çš„å¸¦æœ‰æ’­æ”¾æŒ‰é’®çš„ç½‘é¡µï¼Œç±»ä¼¼äºå¤§å¤šæ•°åœ¨çº¿æ”¶éŸ³æœºçš„å¤–è§‚ã€‚</p>
<p>æˆ‘ä»¬å°†æŠŠæ‰€æœ‰è¿™äº›éƒ½æ”¾åœ¨ä¸€ä¸ªåº”ç”¨ç¨‹åºä¸­ï¼Œè¿™å¯¹äºç°å®ä¸–ç•Œçš„è§£å†³æ–¹æ¡ˆæ¥è¯´å¹¶ä¸æ˜æ™ºï¼Œä½†æ˜¯ï¼Œå˜¿ï¼Œæˆ‘ä»¬åªæ˜¯ç©ç©è€Œå·²ã€‚æœ¬æ–‡çš„å®Œæ•´ä»£ç å¯ä»¥åœ¨æˆ‘çš„GitHub repo <a href="https://github.com/DarkMannn/node-radio-mini">è¿™é‡Œ</a>æ‰¾åˆ°ã€‚</p>
<p>æˆ‘ä»¬å¼€å§‹å§ï¼</p>
<h2>æ§åˆ¶é¢æ¿</h2>
<p>å› ä¸ºæˆ‘å–œæ¬¢ä½¿ç”¨ç»ˆç«¯ï¼ŒNode.jsæœ‰ä¸€ä¸ªå†…ç½®çš„CLIï¼Œæ‰€ä»¥æˆ‘ä»¬å°†ä»¥ç»ˆç«¯GUIçš„å½¢å¼å®ç°æ§åˆ¶é¢æ¿ã€‚ç»è¿‡ä¸€ç‚¹ç‚¹çš„ç ”ç©¶ï¼Œæˆ‘å‘ç°<a href="https://www.npmjs.com/package/neo-blessed"> neo-blessed </a>æ˜¯ä¸€ä¸ªä¸ºè¿™ä¸ªä»»åŠ¡è€Œè®¾è®¡çš„åº“ã€‚</p>
<p>æ–°ç¦æœ‰ä¸€ä¸ªç›’å­çš„æ¦‚å¿µã€‚è¿™äº›åŸºæœ¬ä¸Šæ˜¯ä½ å¯ä»¥åœ¨ç»ˆç«¯ä¸­åˆ›å»ºã€é£æ ¼åŒ–å’Œå®šä½çš„çª—å£ï¼Œå°±åƒæµè§ˆå™¨ä¸­ä½¿ç”¨HTMLå’ŒCSSçš„ç»„ä»¶ã€‚</p>
<p>è®©æˆ‘ä»¬é¦–å…ˆå®šä¹‰å°†åŒ…è£…æ‰€æœ‰å…¶ä»–å†…å®¹çš„ä¸»å±å¹•ã€‚æˆ‘ä»¬å°†æŠŠå®ƒæ”¾åœ¨<code>View</code>ç±»ä¸­:</p>
<pre>class View {
    constructor() {
        const screen = NeoBlessed.screen({ smartSCR: true });
        screen.title = 'Node Radio Mini';
        screen.key(['escape', 'C-c'], () =&gt; process.exit(0));   
        this._screen = screen;
    }
    appendBoxes(boxes) {
        for (const box of boxes) {
            this._screen.append(box);
        }
    }
    render() {
        this._screen.render();
    }
}</pre>
<p>è¿™é‡Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªè§†å›¾å±‚çš„ä¸»å±å¹•ï¼Œç”¨ä¸€ä¸ª<code>render</code>æ–¹æ³•ï¼Œæˆ‘ä»¬å°†å®šæœŸä½¿ç”¨å®ƒæ¥æ¸²æŸ“æ•´ä¸ªè§†å›¾ã€‚æˆ‘ä»¬é™„åŠ äº†ä¸€äº›é”®(Ctrl+Cï¼ŒEsc ),å¦‚æœæˆ‘ä»¬æ„¿æ„ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‰è¿™äº›é”®æ¥ç»ˆæ­¢åº”ç”¨ç¨‹åºã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦å®ç°è§†å›¾çš„ä¸åŒéƒ¨åˆ†ã€‚æ¯ä¸ªéƒ¨åˆ†å°†æ˜¯ä¸€ä¸ªæ–°çš„ç¥ç¦ç®±ï¼Œå¦‚å‰æ‰€è¿°ã€‚æˆ‘ä»¬å°†ä¸ºæ­¤å®ç°ä¸€ä¸ªåŸºæœ¬ç±»ï¼Œç¨åå°†ç”±å…¶ä»–ç±»æ‰©å±•:</p>
<pre>class TerminalBox {
    constructor(config) {
        this.box = NeoBlessed.box(config);
    }
}</pre>
<p>ä¸€ä¸ªç®€å•è€Œæ–¹ä¾¿çš„æ§åˆ¶é¢æ¿éœ€è¦å››ä¸ªä¸»è¦éƒ¨åˆ†(æˆ‘ç§°ä¹‹ä¸ºç›’å­)ã€‚è¿™äº›æ˜¯:</p>
<ol>
<li><code>Playlist</code>â€“æ‰€æœ‰å¯ç”¨æ­Œæ›²åˆ—è¡¨</li>
<li><code>Queue</code>â€“æ’é˜Ÿç­‰å¾…æ’­æ”¾çš„æ­Œæ›²åˆ—è¡¨</li>
<li><code>NowPlaying</code>â€“å½“å‰æ­£åœ¨æ’­æ”¾çš„æ­Œæ›²çš„åç§°</li>
<li><code>Controls</code>â€“é”®ç›˜æŒ‰é”®è¯´æ˜</li>
</ol>
<p>æˆ‘ä»¬å…ˆä»ç®€å•çš„å¼€å§‹å§ã€‚<code>Controls</code>æ¡†å°†åŒ…å«ä¸€ä¸ªç¡¬ç¼–ç çš„é”®ç›˜æŒ‰é”®åˆ—è¡¨ã€‚ä»£ç å¦‚ä¸‹:</p>
<pre>class Controls extends AbstractClasses.TerminalBox {
    constructor(config) {
        super(config);
        this.setPlaylistTips();
    }
    setPlaylistTips() {
        this.box.content = 
            `${keys.FOCUS_QUEUE} - focus queue | ${keys.SCROLL_UP} - go up\n` +
            `${keys.QUEUE_ADD} - enqueue song | ${keys.SCROLL_DOWN} - go down\n`;
    }
    setQueueTips() {
        this.box.content = 
            `${keys.MOVE_UP} - move song up | ${keys.SCROLL_UP}-go up\n` +
            `${keys.MOVE_DOWN} - move song down | ${keys.SCROLL_DOWN}-go down\n` +
            `${keys.FOCUS_PLAYLIST} - focus playlist | ${keys.QUEUE_REMOVE} - dequeue son`;
    }
}</pre>
<p>æ­£å¦‚æˆ‘æ‰€è¯´çš„ï¼Œè¿™äº›æ¡†å¯ä»¥æ ¹æ®æˆ‘ä»¬çš„éœ€è¦è¿›è¡Œé£æ ¼åŒ–ï¼Œè¿™æ˜¯é€šè¿‡ä¼ é€’<code>config</code>é€‰é¡¹(ç¬¬3è¡Œ)åœ¨è¿™ä¸ªç±»çš„å®ä¾‹åŒ–ä¸Šå®Œæˆçš„ã€‚ä»¥ä¸‹æ˜¯<code>Controls</code>æ¡†çš„é…ç½®é€‰é¡¹:</p>
<pre>{
    config: {
        label: 'Controls',
        border: { type: 'line' },
        top: '85%',
        left: '50%',
        width: '50%',
        height: 5,
        style: {
            fg: 'grey',
            bg: 'black',
            border: {
                fg: '#000000'
            }
        }
    }
}</pre>
<p>æ‰€æœ‰å…¶ä»–æ¡†éƒ½æœ‰ç±»ä¼¼çš„é…ç½®é€‰é¡¹ï¼Œæ‰€ä»¥æˆ‘ä¸ä¼šå…¨éƒ¨å±•ç¤ºã€‚é€šè¿‡ä¼ é€’çš„é…ç½®é€‰é¡¹ï¼Œè¯¥æ¡†å°†å¦‚ä¸‹æ‰€ç¤º:</p>
<p><img data-attachment-id="17830" data-permalink="https://blog.logrocket.com/online-radio-server-pure-node-js/controls-box/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/05/controls-box.png" data-orig-size="730,79" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="The Controls box" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/05/controls-box-300x32.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/05/controls-box.png" decoding="async" class="aligncenter size-full wp-image-17830 jetpack-lazy-image" src="../Images/83f680fcaa132a5bc0aa3c99a16350c0.png" alt="Our Controls Box" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/05/controls-box.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/05/controls-box-300x32.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/05/controls-box.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/05/controls-box.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="17830" data-permalink="https://blog.logrocket.com/online-radio-server-pure-node-js/controls-box/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/05/controls-box.png" data-orig-size="730,79" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="The Controls box" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/05/controls-box-300x32.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/05/controls-box.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-17830" src="../Images/83f680fcaa132a5bc0aa3c99a16350c0.png" alt="Our Controls Box" srcset="https://blog.logrocket.com/wp-content/uploads/2020/05/controls-box.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/05/controls-box-300x32.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/05/controls-box.png"/></noscript>
<p>å…¶ä»–ä¸‰ä¸ªæ¡†å°†åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªå­é¡¹ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºå¦ä¸€ä¸ªç±»ä¼¼äºç¬¬ä¸€ä¸ªç±»çš„å¯æ‰©å±•ç±»(å¦‚<code>TerminalBox</code>):</p>
<pre>class _FocusIndexer {
    constructor({ getIndexLimit }) {
        this._index = 1;
        this._getIndexLimit = getIndexLimit;
    }
    get() {
        return this._index;
    }
    incr() {
        if (this._index &lt; this._getIndexLimit()) {
            this._index++;
        }
    }
    decr() {
        if (this._index &gt; 1) {
            this._index--;
        }
    }
}

class TerminalItemBox extends TerminalBox {
    constructor({ config, childConfig, bgBlur, bgFocus }) {
        super(config);
        this._childConfig = childConfig;
        this._bgBlur = bgBlur;
        this._bgFocus = bgFocus;
        this._focusIndexer = new _FocusIndexer({
            getIndexLimit: this._getNavigationLimit.bind(this)
        });
    }
    _getHeight() {
        // neo-blessed box has two invisible items prepended, so we need '-2'
        return this.box.height - 2;
    }
    _getNavigationLimit() {
        return Math.min(this.box.children.length - 1, this._getHeight());
    }
    _setActiveChildColor(color) {
        const activeChild = this.box.children[this._focusIndexer.get()];
        if (activeChild) {
            activeChild.style.bg = color;
        }
    }
    focus() {
        this._setActiveChildColor(this._bgFocus);
        this.box.focus();
    }
    blur() {
        this._setActiveChildColor(this._bgBlur);
    }
    scroll(scrollKey) { 

        if (this.box.children.length === 1) {
            return;
        }
        const unfocusedIndex = this._focusIndexer.get();
        const unfocusedChild = this.box.children[unfocusedIndex];
        unfocusedChild.style.bg = this._bgBlur;
        if (scrollKey === keys.SCROLL_UP) {
            this._focusIndexer.decr();
        }
        else if (scrollKey === keys.SCROLL_DOWN) {
            this._focusIndexer.incr();
        }
        const focusedIndex = this._focusIndexer.get();
        const focusedChild = this.box.children[focusedIndex];
        focusedChild.style.bg = this._bgFocus;
    }
    _createBoxChild() {
        throw new Error('_createBoxChild() method not implemented');
    }
    createBoxChildAndAppend(content) {
        const boxChild = this._createBoxChild(content);
        this.box.append(boxChild);
    }
}</pre>
<p>è¿™é‡Œæœ€éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸ªç±»åŒ…å«å­ç‰©å“ï¼Œä¹Ÿæ˜¯æ–°ç¥ç¦çš„ç›’å­ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæ„é€ å‡½æ•°ä¸­åŒæ—¶ä¼ å…¥äº†<code>config</code>å’Œ<code>childConfig</code>ä¸¤ä¸ªé“å…·ã€‚</p>
<p>æ­¤å¤–ï¼Œè¿™ä¸ªç±»æœ‰ä¸€ä¸ª<code>scroll</code>æ–¹æ³•ï¼Œé€šè¿‡è¿™ä¸ªæ–¹æ³•ï¼Œä½ å¯ä»¥åœ¨æ¨¡ç³Šå’Œèšç„¦é¡¹ç›®çš„ä¸åŒé¢œè‰²çš„å¸®åŠ©ä¸‹å¯¼èˆªé¡¹ç›®ã€‚ä¸ºäº†å¸®åŠ©è·Ÿè¸ªç„¦ç‚¹å­é¡¹çš„ç´¢å¼•ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†ä¸€ä¸ªåä¸º<code>FocusIndexer</code>çš„åŠ©æ‰‹ç±»(åœ¨ç¬¬1è¡Œå®šä¹‰ï¼Œåœ¨ç¬¬27è¡Œå®ä¾‹åŒ–)ã€‚</p>
<p>æœ€åï¼Œè¿˜æœ‰ä¸€ä¸ªæ·»åŠ æ–°å­©å­çš„<code>createBoxChildAndAppend</code>æ–¹æ³•ã€‚è¿™ä¸æ˜¯ï¼Œä½†ä¸ºäº†èŠ‚çœæ—¶é—´ï¼Œæˆ‘å°±è®²åˆ°è¿™é‡Œã€‚</p>
<p><code>NowPlaying</code>æ¡†å°†åªæœ‰ä¸€ä¸ªé¡¹ç›®:å½“å‰æ’­æ”¾çš„æ­Œæ›²ã€‚æˆ‘ä»¬å°†è¿™æ ·å®æ–½å®ƒ:</p>
<pre>class NowPlaying extends AbstractClasses.TerminalItemBox {
    _createBoxChild(content) {
        return NeoBlessed.box({
            ...this._childConfig,
            top: 0,
            content: `&gt;&gt;&gt; ${content}`
        });
    }
}</pre>
<p>å½“ä¸€ä¸ªå®ä¾‹è¢«åˆ›å»ºå¹¶æ’å…¥åˆ°ä¸»è§†å›¾ä¸­æ—¶ï¼Œå®ƒå°†å¦‚ä¸‹æ‰€ç¤º:</p>
<p><img data-attachment-id="17831" data-permalink="https://blog.logrocket.com/online-radio-server-pure-node-js/nowplaying-box/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/05/nowplaying-box.png" data-orig-size="730,51" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="The NowPlaying box" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/05/nowplaying-box-300x21.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/05/nowplaying-box.png" decoding="async" class="aligncenter size-full wp-image-17831 jetpack-lazy-image" src="../Images/a8a76cfdfd72a7646bfe73d909d274f2.png" alt="Our NowPlaying Box" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/05/nowplaying-box.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/05/nowplaying-box-300x21.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/05/nowplaying-box.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/05/nowplaying-box.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="17831" data-permalink="https://blog.logrocket.com/online-radio-server-pure-node-js/nowplaying-box/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/05/nowplaying-box.png" data-orig-size="730,51" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="The NowPlaying box" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/05/nowplaying-box-300x21.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/05/nowplaying-box.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-17831" src="../Images/a8a76cfdfd72a7646bfe73d909d274f2.png" alt="Our NowPlaying Box" srcset="https://blog.logrocket.com/wp-content/uploads/2020/05/nowplaying-box.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/05/nowplaying-box-300x21.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/05/nowplaying-box.png"/></noscript>
<p><code>Playlist</code>æ¡†å°†ç”¨äºå­˜å‚¨åº”ç”¨ç¨‹åºè¿è¡Œç›®å½•ä¸­æ‰€æœ‰æ­Œæ›²çš„åˆ—è¡¨ã€‚å‡ ä¹æ‰€æœ‰çš„é‡è¦ç‰¹æ€§éƒ½å·²ç»åœ¨<code>TerminalItemBox</code>ç±»ä¸­å®ç°äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬å°†æ‰©å±•å®ƒ:</p>
<pre>class Playlist extends AbstractClasses.TerminalItemBox {
    /*
    .....
    .....
    */
    _circleChildrenUp() {
        const temp = this.box.children[this.box.children.length - 1].content;
        this.box.children.reduceRight((lowerChild, upperChild) =&gt; {
            lowerChild.content = upperChild.content;
            return upperChild;
        });
        this.box.children[1].content = temp;
    }
    _circleChildrenDown() {
        const temp = this.box.children[1].content;
        this.box.children.reduce((upperChild, lowerChild, index) =&gt; {
            if (index &gt; 1) {
                upperChild.content = lowerChild.content;
            }
            return lowerChild;
        });
        this.box.children[this.box.children.length - 1].content = temp;
    }
    _circleList(key) {
        if (this._focusIndexer.get() === 1 &amp;&amp; key === keys.SCROLL_UP) {
            this._circleChildrenUp();
        }
        else if (
          this._focusIndexer.get() === this._getHeight()
          &amp;&amp; key === keys.SCROLL_DOWN
        ) {
            this._circleChildrenDown();
        }
    }
    /*
    .....
    .....
    */
}</pre>
<p>è¿™é‡Œå€¼å¾—ä¸€æçš„ä¸€ä»¶é‡è¦äº‹æƒ…æ˜¯ï¼Œè¿™ä¸ªç±»å®ç°äº†<code>_circleList</code>æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ç”¨äºæ”¯æŒå¯¼èˆªå­é¡¹ï¼Œå³ä½¿å®ƒä»¬æº¢å‡ºäº†ç»ˆç«¯è§†å£ã€‚</p>
<p>è¿™æ˜¯æ’­æ”¾åˆ—è¡¨çš„å¤–è§‚:</p>
<p><img data-attachment-id="17833" data-permalink="https://blog.logrocket.com/online-radio-server-pure-node-js/playlist-box/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/05/playlist-box.png" data-orig-size="730,310" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="The Playlist box" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/05/playlist-box-300x127.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/05/playlist-box.png" decoding="async" class="aligncenter size-full wp-image-17833 jetpack-lazy-image" src="../Images/1469ad89e66a66530b82c5a36e372a91.png" alt="Our Playlist Box" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/05/playlist-box.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/05/playlist-box-300x127.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/05/playlist-box.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/05/playlist-box.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="17833" data-permalink="https://blog.logrocket.com/online-radio-server-pure-node-js/playlist-box/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/05/playlist-box.png" data-orig-size="730,310" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="The Playlist box" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/05/playlist-box-300x127.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/05/playlist-box.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-17833" src="../Images/1469ad89e66a66530b82c5a36e372a91.png" alt="Our Playlist Box" srcset="https://blog.logrocket.com/wp-content/uploads/2020/05/playlist-box.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/05/playlist-box-300x127.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/05/playlist-box.png"/></noscript>
<p><code>Queue</code>æ˜¯æˆ‘ä»¬éœ€è¦å®ç°çš„æœ€åä¸€ä¸ªç›’å­ã€‚ç±»ä¼¼äº<code>Playlist</code>ï¼Œå®ƒå°†æ‰©å±•<code>TerminalItemBox</code>ç±»ã€‚ä½†è¿™æ˜¯ç›¸ä¼¼ä¹‹å¤„çš„ç»ˆç‚¹ã€‚</p>
<p>è¿™ä¸ªç±»ä¸ä»…è´Ÿè´£è§†å›¾å±‚ï¼Œè¯¥å±‚ç›´è§‚åœ°è¡¨ç¤ºæ‰€æœ‰æ’é˜Ÿç­‰å¾…æµå¼ä¼ è¾“çš„æ­Œæ›²ï¼Œè€Œä¸”å®ƒè¿˜å°†åŒ…å«ç”¨äºæµå¼ä¼ è¾“å’Œå°†æ•°æ®ç®¡é“ä¼ è¾“ç»™æ‰€æœ‰æ¶ˆè´¹è€…(å³å®¢æˆ·ç«¯)çš„æ‰€æœ‰åŠŸèƒ½ã€‚æˆ‘ä»¬å°†åœ¨ä¸‹ä¸€èŠ‚è¯¦ç»†ä»‹ç»è¿™ä¸€ç‚¹ã€‚</p>
<p>ç°åœ¨ï¼Œè¿™é‡Œæ˜¯å®ç°ï¼Œè‡³å°‘æ˜¯è§†å›¾å±‚çš„ä¸€éƒ¨åˆ†:</p>
<pre>class Queue extends AbstractClasses.TerminalItemBox {
    /*
    .....
    .....
    */
    _changeOrderInBoxChildren(key) {
        const index1 = this._focusIndexer.get();
        const child1 = this.box.children[index1];
        child1.style.bg = this._bgBlur;

        if (key === keys.MOVE_UP) {
            this._focusIndexer.decr();
        }
        else if (key === keys.MOVE_DOWN) {
            this._focusIndexer.incr();
        }

        const index2 = this._focusIndexer.get();
        const child2 = this.box.children[index2];
        child2.style.bg = this._bgFocus;

        [
            child1.content,
            child2.content
        ] = [
            `${getFirstWord(child1.content)} ${discardFirstWord(child2.content)}`,
            `${getFirstWord(child2.content)} ${discardFirstWord(child1.content)}`,
        ];

        return { index1, index2 };
    }
}</pre>
<p>è¿™é‡Œå”¯ä¸€å€¼å¾—æ³¨æ„çš„æ˜¯<code>Queue</code> boxçš„<code>_changeOrderInBoxChildren</code>æ–¹æ³•ã€‚è¿™ç§æ–¹æ³•å…è®¸ç”¨æˆ·åœ¨é˜Ÿåˆ—ä¸­ä¸Šä¸‹ç§»åŠ¨æ­Œæ›²ã€‚</p>
<p>æœ€åï¼Œæˆ‘ä»¬å‡†å¤‡å¥½äº†æ•´ä¸ªè§†å›¾å±‚ã€‚ç»“æœå¦‚ä¸‹:</p>
<p><img data-attachment-id="17835" data-permalink="https://blog.logrocket.com/online-radio-server-pure-node-js/view-layer-all-boxes/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/05/view-layer-all-boxes.png" data-orig-size="730,373" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Full view layer" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/05/view-layer-all-boxes-300x153.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/05/view-layer-all-boxes.png" decoding="async" class="aligncenter size-full wp-image-17835 jetpack-lazy-image" src="../Images/753e01049615cad15597a2cb5d0ad252.png" alt="Full View Layer With All Boxes" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/05/view-layer-all-boxes.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/05/view-layer-all-boxes-300x153.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/05/view-layer-all-boxes.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/05/view-layer-all-boxes.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="17835" data-permalink="https://blog.logrocket.com/online-radio-server-pure-node-js/view-layer-all-boxes/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/05/view-layer-all-boxes.png" data-orig-size="730,373" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Full view layer" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/05/view-layer-all-boxes-300x153.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/05/view-layer-all-boxes.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-17835" src="../Images/753e01049615cad15597a2cb5d0ad252.png" alt="Full View Layer With All Boxes" srcset="https://blog.logrocket.com/wp-content/uploads/2020/05/view-layer-all-boxes.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/05/view-layer-all-boxes-300x153.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/05/view-layer-all-boxes.png"/></noscript>
<p>åœ¨æˆ‘ä»¬å®ä¾‹åŒ–äº†å››ä¸ªç±»çš„å®ä¾‹ä¹‹åâ€”â€”ä¹Ÿå°±æ˜¯æˆ‘ä»¬çš„ç›’å­ï¼Œå®ƒä»¬æ˜¯<code>playlist</code>ã€<code>queue</code>ã€<code>nowPlaying</code>å’Œ<code>controls</code>ï¼ŒåŠ ä¸Šå¼€å¤´æåˆ°çš„ä¸»<code>view</code>ç»„ä»¶â€”â€”æˆ‘ä»¬éœ€è¦ä¸ºé”®ç›˜æŒ‰é”®äº‹ä»¶é™„åŠ ç›‘å¬å™¨ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥è®©ç”¨æˆ·åœ¨æ§åˆ¶é¢æ¿ä¸Šæ‰§è¡Œæ“ä½œã€‚ä»¥ä¸‹æ˜¯ä»£ç çš„ä¸€éƒ¨åˆ†:</p>
<pre>const _addPlaylistAndQueueListeners = () =&gt; {

    const playlistOnScroll = (scrollKey) =&gt; {      
        playlist.scroll(scrollKey);
        view.render();
    };
    playlist.box.key(keys.SCROLL_UP, playlistOnScroll);
    playlist.box.key(keys.SCROLL_DOWN, playlistOnScroll);

    playlist.box.key(keys.QUEUE_ADD, () =&gt; {
        const focusedSong = playlist.getFocusedSong();
        const formattedSong = Utils.discardFirstWord(focusedSong);
        queue.createAndAppendToQueue(formattedSong);
        view.render();
    });
    playlist.box.key(keys.FOCUS_QUEUE, () =&gt; {
        playlist.blur();
        queue.focus();
        controls.setQueueTips();
        view.render();
    });
    /*
    ......
    ......
    */
};</pre>
<p>æ˜¯ç”±neo-blessedæä¾›çš„ä¸€ç§æ–¹æ³•ï¼Œå¯ä»¥è®©ä½ è®¾ç½®å…³é”®ç›‘å¬å™¨ï¼Œè¿™æ˜¯ä¸€ç§å¾ˆå¥½çš„æ–¹æ³•ã€‚</p>
<p>æˆ‘ä»¬å·²ç»å®Œæˆäº†æ§åˆ¶é¢æ¿çš„åˆ¶ä½œã€‚ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å®šä¹‰çš„é”®ç›˜å¿«æ·é”®æµè§ˆæ’­æ”¾åˆ—è¡¨ä¸­çš„æ­Œæ›²ï¼Œå¹¶å°†æˆ‘ä»¬å–œæ¬¢çš„æ­Œæ›²å‘é€åˆ°é˜Ÿåˆ—ä¸­ã€‚</p>
<h2>æºªæµé­”æ³•</h2>
<p>é˜Ÿåˆ—ä¸­çš„æ­Œæ›²åº”è¯¥å‘é€ç»™æ¯ä¸ªæ­£åœ¨æ”¶å¬çš„æ¶ˆè´¹è€…ã€‚è¿™æ˜¯æˆ‘ä»¬éœ€è¦å®ç°çš„ä¸‹ä¸€ä»¶äº‹ã€‚æ­£å¦‚æˆ‘å·²ç»æåˆ°çš„ï¼Œ<code>Queue</code>ç±»å°†è´Ÿè´£åœ¨GUIä¸­æ˜¾ç¤ºæ’é˜Ÿç­‰å€™çš„æ­Œæ›²ã€‚æœ€é‡è¦çš„æ˜¯ï¼Œè¿™ä¸ªç±»å°†åŒ…å«å‘å®¢æˆ·ç«¯å‘é€æ­Œæ›²çš„é€»è¾‘ã€‚</p>
<p>ç”±äºæˆ‘ä»¬å¸Œæœ›é€æ¸å‘å®¢æˆ·ç«¯å¹¿æ’­éŸ³é¢‘æ•°æ®ï¼Œå› æ­¤è¿™æ˜¾ç„¶éœ€è¦é€šè¿‡æµæ¥å®ç°ï¼Œæˆ–è€…åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œé€šè¿‡Node.jsæµAPIæ¥å®ç°ã€‚</p>
<p>è¿™é‡Œè¦æ³¨æ„çš„ç¬¬ä¸€ä»¶äº‹æ˜¯ï¼ŒStream APIä¸»è¦æ˜¯ä¸ºä»¥åŸºäºæ‹‰çš„æ–¹å¼ä¸€å¯¹ä¸€(å•æ’­)ä¼ è¾“åˆ†å—æ•°æ®è€Œå‘æ˜çš„ï¼Œè¿™æ„å‘³ç€æ¶ˆè´¹è€…æ ¹æ®å…¶å¤„ç†æ•°æ®çš„é€Ÿåº¦æ¥ç¡®å®šä¼ è¾“é€Ÿåº¦ã€‚</p>
<figure id="attachment_17836" aria-describedby="caption-attachment-17836" class="wp-caption aligncenter"><img data-attachment-id="17836" data-permalink="https://blog.logrocket.com/online-radio-server-pure-node-js/unicast-diagram/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/05/unicast-diagram.png" data-orig-size="730,487" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="A diagram of unicast transmission" data-image-description="" data-image-caption="&lt;p&gt;One-to-one (unicast) transmission.&lt;/p&gt;&#10;" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/05/unicast-diagram-300x200.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/05/unicast-diagram.png" decoding="async" class="size-full wp-image-17836 jetpack-lazy-image" src="../Images/eab29c5487fbbeca32faae2e948300dd.png" alt="Diagram Of Unicast Transmission" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/05/unicast-diagram.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/05/unicast-diagram-300x200.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/05/unicast-diagram.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/05/unicast-diagram.png"/><noscript><img data-lazy-fallback="1" data-attachment-id="17836" data-permalink="https://blog.logrocket.com/online-radio-server-pure-node-js/unicast-diagram/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/05/unicast-diagram.png" data-orig-size="730,487" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="A diagram of unicast transmission" data-image-description="" data-image-caption="&lt;p&gt;One-to-one (unicast) transmission.&lt;/p&gt;&#10;" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/05/unicast-diagram-300x200.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/05/unicast-diagram.png" decoding="async" loading="lazy" class="size-full wp-image-17836" src="../Images/eab29c5487fbbeca32faae2e948300dd.png" alt="Diagram Of Unicast Transmission" srcset="https://blog.logrocket.com/wp-content/uploads/2020/05/unicast-diagram.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/05/unicast-diagram-300x200.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/05/unicast-diagram.png"/></noscript><figcaption id="caption-attachment-17836" class="wp-caption-text">One-to-one (unicast) transmission.</figcaption></figure>
<figure id="attachment_17839" aria-describedby="caption-attachment-17839" class="wp-caption aligncenter"><img data-attachment-id="17839" data-permalink="https://blog.logrocket.com/online-radio-server-pure-node-js/broadcast-diagram/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/05/broadcast-diagram.png" data-orig-size="730,487" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="A diagram of broadcast transmission" data-image-description="" data-image-caption="&lt;p&gt;One-to-many (broadcast) transmission.&lt;/p&gt;&#10;" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/05/broadcast-diagram-300x200.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/05/broadcast-diagram.png" decoding="async" class="size-full wp-image-17839 jetpack-lazy-image" src="../Images/1b7f60d2bb4af772bbb89576a55aacc4.png" alt="Diagram Of Broadcast Transmission" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/05/broadcast-diagram.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/05/broadcast-diagram-300x200.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/05/broadcast-diagram.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/05/broadcast-diagram.png"/><noscript><img data-lazy-fallback="1" data-attachment-id="17839" data-permalink="https://blog.logrocket.com/online-radio-server-pure-node-js/broadcast-diagram/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/05/broadcast-diagram.png" data-orig-size="730,487" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="A diagram of broadcast transmission" data-image-description="" data-image-caption="&lt;p&gt;One-to-many (broadcast) transmission.&lt;/p&gt;&#10;" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/05/broadcast-diagram-300x200.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/05/broadcast-diagram.png" decoding="async" loading="lazy" class="size-full wp-image-17839" src="../Images/1b7f60d2bb4af772bbb89576a55aacc4.png" alt="Diagram Of Broadcast Transmission" srcset="https://blog.logrocket.com/wp-content/uploads/2020/05/broadcast-diagram.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/05/broadcast-diagram-300x200.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/05/broadcast-diagram.png"/></noscript><figcaption id="caption-attachment-17839" class="wp-caption-text">One-to-many (broadcast) transmission.</figcaption></figure>
<p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬éœ€è¦åšå®Œå…¨ç›¸åçš„äº‹æƒ…ã€‚æˆ‘ä»¬éœ€è¦ä¸€å¯¹å¤š(å¹¿æ’­)çš„æ•°æ®ä¼ è¾“ï¼Œæˆ‘ä»¬éœ€è¦ç”Ÿäº§è€…ä»¥åŸºäºæ¨é€çš„æ–¹å¼æ¥æ§åˆ¶ä¼ è¾“é€Ÿåº¦ã€‚è¿™æ ·åšçš„åŸå› å¾ˆæ˜æ˜¾:æˆ‘ä»¬å¸Œæœ›æ‰€æœ‰çš„æ¶ˆè´¹è€…åœ¨ä¸€ä¸ªæ—¶é—´ç‚¹æ¥æ”¶åˆ°ä¸€é¦–æ­Œçš„å‡ ä¹ç›¸åŒçš„éƒ¨åˆ†ã€‚</p>
<p>è¿™é‡Œåªæ˜¯æä¸€ä¸‹:åœ¨Nodeçš„æµAPIæœ¯è¯­ä¸­ï¼Œç”Ÿäº§è€…æ˜¯å¯è¯»çš„æµ(<code>stream.Readable</code>ç±»)ï¼Œæ¶ˆè´¹è€…æ˜¯å¯å†™çš„æµ(<code>stream.Writable class</code>)ã€‚å½“ç„¶ï¼Œä¸€ä¸ªå®ä½“å¯ä»¥åŒæ—¶æ˜¯å¯è¯»çš„å’Œå¯å†™çš„(<code>stream.Transform class</code>)ã€‚<br/>åœ¨ä¼—å¤šæ–¹æ³•ä¸­ï¼Œæ¶ˆè´¹å¯è¯»æµæœ€æµè¡Œçš„æ–¹æ³•æ˜¯ä½¿ç”¨<code>.pipe()</code>æ–¹æ³•:</p>
<pre>  /*
  producer.pipe(consumer);
  */ 
  readable.pipe(writable);</pre>
<p>ç»¼ä¸Šæ‰€è¿°ï¼Œè¿™ç§æ–¹æ³•å¹¶ä¸èƒ½æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚ï¼Œå› ä¸ºå®ƒæ„å‘³ç€ä¸€å¯¹ä¸€çš„ä¼ è¾“ï¼Œå¹¶ä¸”æµçš„é€Ÿåº¦æ˜¯ç”±å¯å†™çš„ã€‚æ‰€ä»¥æˆ‘ä»¬ä¸èƒ½åªæœ‰ä¸€ä¸ªå¯è¯»çš„æµï¼Œç„¶åé€šè¿‡ç®¡é“ä¼ è¾“å¤šæ¬¡ï¼Œå°±åƒè¿™æ ·:</p>
<pre>  // won't work
  readable.pipe(writable1);
  readable.pipe(writable2);
  readable.pipe(writable3);</pre>
<p>è¿™æ˜¯è¡Œä¸é€šçš„ï¼Œå› ä¸ºå¯è¯»æµåªèƒ½è¢«ä½¿ç”¨ä¸€æ¬¡ï¼Œè€Œä½¿ç”¨<code>.pipe()</code>æ–¹æ³•ï¼Œç¬¬ä¸€ä¸ªé™„åŠ çš„å¯å†™æµå°†è´Ÿè´£ä½¿ç”¨ã€‚</p>
<p>ç°åœ¨åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå…¶ä»–å¯å†™çš„å°†æ¥æ”¶ä¸€äº›ç”šè‡³æ‰€æœ‰çš„æµå—ï¼Œä½†æ˜¯è¿™ä¸ªAPIä¸ä¿è¯ã€‚å¦ä¸€ä¸ªç¼ºç‚¹æ˜¯ï¼Œé™¤éä½ æœ‰ä¸€ä¸ªå¯å†™çš„(ä¾‹å¦‚ï¼Œä¸€ä¸ªæ¶ˆè´¹è€…)å­˜åœ¨ï¼Œå¦åˆ™ä½ æ ¹æœ¬ä¸èƒ½æµï¼Œå› ä¸ºä½ å¿…é¡»æŠŠå¯è¯»çš„é€šè¿‡ç®¡é“ä¼ è¾“åˆ°æŸä¸ªåœ°æ–¹ã€‚</p>
<p>ä½†æ˜¯æ²¡é—®é¢˜ï¼Œè¿™é‡Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸åŒçš„ç­–ç•¥ã€‚å¦ä¸€ç§ä½¿ç”¨å¯è¯»æµçš„æ–¹æ³•æ˜¯ç›‘å¬<code>data</code>äº‹ä»¶ã€‚åœ¨è¯¥äº‹ä»¶çš„å¤„ç†ç¨‹åºä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨å°†æµæ•°æ®å—å†™å…¥æ‰€æœ‰å¯å†™æ•°æ®ï¼Œå¦‚ä¸‹æ‰€ç¤º:</p>
<pre>  const writables = [writable1, writable2, writable3];

  readable.on('data', (chunk) =&gt; {
    for (const writable of writables) {
      writable.write(chunk);
    }
  );</pre>
<p>è¿™æ ·å¥½å¤šäº†ã€‚ä¸€æ—¦ä¸€ä¸ªå¤„ç†ç¨‹åºè¢«é™„åŠ åˆ°<code>data</code>äº‹ä»¶ï¼Œreadableå°†è¿›å…¥æµåŠ¨æ¨¡å¼å¹¶å¼€å§‹ä¼ è¾“æ•°æ®ã€‚æˆ‘ä»¬ç°åœ¨æœ‰ä¸€ç§ä¼˜é›…çš„æ–¹å¼æ¥å®ç°ä¸€å¯¹å¤šä¼ è¾“ï¼Œå³å‘æ¯ä¸ªæ³¨å†Œçš„å¯å†™æ•°æ®å‘é€ç›¸åŒçš„æ•°æ®å—ã€‚æœ€é‡è¦çš„æ˜¯ï¼Œå¦‚æœä¸å­˜åœ¨å¯å†™çš„ï¼Œå¯è¯»çš„å°†ç»§ç»­ä¼ è¾“æ•°æ®ï¼Œè¿™æ˜¯æˆ‘ä»¬æ‰€éœ€è¦çš„ï¼Œå› ä¸ºå‡ ä¹æ¯ä¸ªç”µå°çš„æ­Œæ›²éƒ½å¿…é¡»ç»§ç»­æ’­æ”¾ï¼Œå³ä½¿æ²¡æœ‰äººåœ¨å¬ã€‚ğŸ™‚</p>
<p>å°½ç®¡å¦‚æ­¤ï¼Œæˆ‘ä»¬ä»ç„¶æ²¡æœ‰è§£å†³æ‰€æœ‰çš„é—®é¢˜ã€‚å¦‚æœæˆ‘ä»¬åªé™„åŠ å¤„ç†ç¨‹åºï¼Œå°±åƒåœ¨æœ€åä¸€æ®µä»£ç ä¸­ä¸€æ ·ï¼Œå¯è¯»çš„(ä¾‹å¦‚ï¼Œæ­Œæ›²)å°†åœ¨å‡ ç§’é’Ÿå†…è¢«æ¶ˆè€—æ‰ã€‚æˆ‘ä»¬ä¸å¸Œæœ›è¿™æ ·ï¼›æˆ‘ä»¬æƒ³æ…¢æ…¢åœ°ä¼ è¾“æ•°æ®ã€‚</p>
<p>è¿™å¯ä»¥é€šè¿‡ä½¿ç”¨æŸç§èŠ‚æµæœºåˆ¶æ¥å‡ç¼“å—çš„æµåŠ¨æ¥å®ç°ã€‚åœ¨Node.jsä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä¸€ä¸ªè½¬æ¢æµ(æ—¢å¯è¯»åˆå¯å†™ï¼Œæ­£å¦‚æˆ‘ä»¬å·²ç»æåˆ°çš„)å’Œä¸€ä¸ªå®šæ—¶å™¨å‡½æ•°æ¥å®ç°ã€‚æ­¤è½¬æ¢æµçš„ç›®æ ‡æ˜¯ä»å¯è¯»çš„æ¥æ”¶å—ï¼Œå¹¶ä»¥ç¡®å®šçš„é€Ÿç‡å°†å—è¾“å‡ºåˆ°å¯å†™çš„ï¼Œè¿™å°†ç”±è½¬æ¢æµæœ¬èº«å†…éƒ¨çš„è®¡æ—¶å™¨å‡½æ•°æ¥å¤„ç†ã€‚</p>
<p>å› ä¸ºå·²ç»æœ‰å‡ ä¸ªå‘å¸ƒçš„åŒ…è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨npmçš„ä¸€ä¸ªåä¸º<code>[throttle](<a href="https://www.npmjs.com/package/throttle" rel="nofollow">https://www.npmjs.com/package/throttle</a>)</code>çš„åŒ…ã€‚å®ƒæ˜¯ä¸€ä¸ªç±»ï¼Œæ‚¨å¯ä»¥é€šè¿‡ä¼ é€’ä¸€ä¸ªå‚æ•°æ¥å®ä¾‹åŒ–ä¸€ä¸ªæ–°çš„è½¬æ¢æµ:ä¸€ä¸ªæ•°å­—ï¼Œè¡¨ç¤ºæ¯ç§’çš„å­—èŠ‚æ•°ã€‚ç„¶åï¼Œè¿™ä¸ªè½¬æ¢æµä¼šå°†å—çš„æµé™åˆ¶ä¸ºä¸è¶…è¿‡æ‚¨æä¾›çš„æ¯ç§’å­—èŠ‚æ•°:</p>
<pre>  const Fs = require('fs');
  const Throttle = require('throttle');  

  const readable = fs.createReadStream('/location/of/a/song.mp3');
  const throttle = new Throttle(128000 / 8);
  const writables = [writable1, writable2, writable3];

  readable.pipe(throttle).on('data', (chunk) =&gt; {
    for (const writable of writables) {
      writable.write(chunk);
    }
  );</pre>
<p>æœ‰äº†å®ƒï¼Œå¯è¯»çš„å†…å®¹ä¸ä¼šåœ¨å‡ ç§’é’Ÿå†…è¢«æ¶ˆè€—æ‰ã€‚ç°åœ¨æµåª’ä½“çš„é€Ÿåº¦å°†æ›´æ¥è¿‘æ­Œæ›²çš„å®æ—¶æ’­æ”¾ã€‚ä½†æ˜¯å¦‚ä½•ç¡®å®šä»€ä¹ˆæ˜¯æ¥è¿‘å®æ—¶å‘¢ï¼Ÿå½“åˆ›å»ºä¸€ä¸ªæ–°çš„<code>Throttle</code>ç±»çš„å®ä¾‹æ—¶ï¼Œä¼ é€’çš„æ•°å­—æ˜¯ä»€ä¹ˆ(åœ¨ç¬¬5è¡Œ)ï¼Ÿ</p>
<p>è¿™å°±æ˜¯æˆ‘ä»¬æœ€åçš„é—®é¢˜ã€‚æ¯ä¸ªéŸ³é¢‘æ–‡ä»¶éƒ½æœ‰ä¸€ä¸ªæ¯”ç‰¹ç‡å±æ€§ï¼Œä»¥æ¯ç§’ä½æ•°(bps)è¡¨ç¤ºã€‚æˆ‘ä»¬éœ€è¦è¿™ä¸ªæ•°å­—æ¥å†³å®šä»¥ä»€ä¹ˆé€Ÿåº¦è¿›è¡Œæµå¼ä¼ è¾“ã€‚</p>
<p>åœ¨æœ€åä¸€æ®µä»£ç ä¸­ï¼Œæˆ‘é»˜è®¤ä¸º128ï¼Œ000bps (128Kbps)ï¼Œå› ä¸ºå¾ˆå¤šæ­Œæ›²éƒ½æœ‰è¿™ä¸ªæ¯”ç‰¹ç‡(åœ¨è¿™æ®µä»£ç ä¸­ï¼Œå®ƒè¢«é™¤ä»¥8ï¼Œå› ä¸º<code>Throttle</code>* *ç±»æ¥æ”¶çš„æ˜¯æ¯ç§’å­—èŠ‚æ•°ï¼Œè€Œä¸æ˜¯æ¯”ç‰¹æ•°)ã€‚ä½†æˆ‘ä»¬ä¸æƒ³é»˜è®¤æŸä¸ªå€¼ï¼Œå¸Œæœ›æœ€å¥½ï¼›æˆ‘ä»¬å¿…é¡»ä¸ºæˆ‘ä»¬æ’­æ”¾çš„æ¯é¦–æ­Œæ›²ç¡®å®šæ¯”ç‰¹ç‡ã€‚</p>
<p>å¹¸è¿çš„æ˜¯ï¼Œæˆ‘ä»¬æœ‰åŠæ³•åšåˆ°è¿™ä¸€ç‚¹ã€‚æˆ‘ä»¬å°†ä½¿ç”¨npmçš„<a href="https://www.npmjs.com/package/@dropb/ffprobe">@ dropb/ff probe</a>* *åŒ…(è¿™ä¸ªåŒ…éœ€è¦æ“ä½œç³»ç»Ÿä¸Šå®‰è£…çš„<code>ffmpeg</code>äºŒè¿›åˆ¶)ã€‚åœ¨è¿™ä¸ªè½¯ä»¶åŒ…çš„å¸®åŠ©ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥åƒè¿™æ ·ç¡®å®šæ¯”ç‰¹ç‡:</p>
<pre>  const Fs = require('fs');
  const Throttle = require('throttle');
  const { ffprobeSync } = require('@dropb/ffprobe');

  const bitRate = ffprobeSync('/location/of/a/song.mp3').format.bit_rate;
  const readable = fs.createReadStream('/location/of/a/song.mp3');
  const throttle = new Throttle(bitRate / 8);
  const writables = [writable1, writable2, writable3];

  readable.pipe(throttle).on('data', (chunk) =&gt; {
    for (const writable of writables) {
      writable.write(chunk);
    }
  );</pre>
<p>ç»ˆäºï¼å·¥ä½œæ­£å¸¸çš„è§£å†³æ–¹æ¡ˆï¼</p>
<p>å¦‚æœæˆ‘ä»¬åƒè¿™æ ·å®ç°æµé€»è¾‘ï¼Œæ­Œæ›²å°†ä»¥ä¸å…¶æ’­æ”¾é€Ÿåº¦éå¸¸åŒ¹é…çš„é€Ÿåº¦æµåŠ¨ã€‚å½“ç„¶ï¼Œæ— è®ºæˆ‘ä»¬åšä»€ä¹ˆï¼Œæˆ‘ä»¬éƒ½æ¯”ä¸ä¸ŠShoutcastå’ŒIcecastè¿™æ ·çš„ä¸“ä¸šæ— çº¿ç”µæœåŠ¡å™¨çš„ç²¾ç¡®åº¦ã€‚ä½†å¯¹æˆ‘æ¥è¯´å·²ç»è¶³å¤Ÿå¥½äº†ã€‚ğŸ™‚</p>
<p>è®©æˆ‘ä»¬æŠŠè¿™ä¸ªæµé€»è¾‘æ”¾åœ¨æˆ‘ä»¬çš„<code>Queue</code>ç±»ä¸­ï¼Œå°±åƒæœ¬èŠ‚å¼€å§‹æ—¶æåˆ°çš„:</p>
<pre>class Queue extends AbstractClasses.TerminalItemBox {
    constructor(params) {
        super(params);
        this._sinks = []; // list of active sinks/writables
        this._songs = []; // list of queued up songs
        this._currentSong = null;
        this.stream = new EventEmitter();
    }
    /*
    ......
    ......
    */
    makeResponseSink() {
        const responseSink = PassThrough();
        this._sinks.push(responseSink);
        return responseSink;
    }
    _broadcastToEverySink(chunk) {
        for (const sink of this._sinks) {
            sink.write(chunk);
        }
    }
    _getBitRate(song) {
        const bitRate = ffprobeSync(`${process.cwd()}/${song}`)).format.bit_rate;
        return parseInt(bitRate);
    }
    _playLoop() {
        this._currentSong = this._songs.length
            ? this.removeFromQueue({ fromTop: true })
            : this._currentSong;
        const bitRate = this._getBitRate(this._currentSong);

        const songReadable = Fs.createReadStream(this._currentSong);
        const throttleTransformable = new Throttle(bitRate / 8);
        throttleTransformable
          .on('data', (chunk) =&gt; this._broadcastToEverySink(chunk))
          .on('end', () =&gt; this._playLoop());

        songReadable.pipe(throttleTransformable);
    }
    startStreaming() {
        this._playLoop();
    }
    // .....
}</pre>
<p>æˆ‘ä»¬å°†æ’é˜Ÿçš„æ­Œæ›²å­˜å‚¨åœ¨<code>this._songs</code>æ•°ç»„ä¸­ã€‚å¯ä»¥é€šè¿‡åœ¨ç»ˆç«¯GUIä¸­å¯¼èˆªæ’­æ”¾åˆ—è¡¨å¹¶ä½¿ç”¨æˆ‘ä»¬åœ¨æœ¬æ–‡ç¬¬ä¸€éƒ¨åˆ†ä¸­å®šä¹‰çš„é”®ç›˜å¿«æ·é”®æ¥æ·»åŠ æ­Œæ›²ã€‚</p>
<p>åœ¨<code>this.makeResponseSink()</code>æ–¹æ³•çš„å¸®åŠ©ä¸‹ï¼Œæˆ‘ä»¬å¿…é¡»å‘å…¶ä¼ è¾“æ•°æ®çš„æ¶ˆè´¹è€…(å³å¯å†™å¯¹è±¡)å°†è¢«å­˜å‚¨åœ¨<code>this._sinks</code>æ•°ç»„ä¸­ã€‚æˆ‘å°†åœ¨ä¸‹ä¸€èŠ‚è¯¦ç»†ä»‹ç»å¦‚ä½•æ·»åŠ æ¶ˆè´¹è€…ã€‚</p>
<p>æ’é˜Ÿç­‰å€™çš„æ­Œæ›²å°†ä¸€é¦–æ¥ä¸€é¦–åœ°æ’­æ”¾ï¼Œæ­£å¦‚æˆ‘ä»¬åœ¨'<em>ä¸­çœ‹åˆ°çš„é‚£æ ·ã€‚_playLoop() </em>'ï¼Œå¦‚æœæ‰€æœ‰çš„æ­Œæ›²éƒ½ç»“æŸäº†ï¼Œæˆ‘ä»¬å°†é‡å¤æœ€åä¸€é¦–ã€‚è¿™æ ·æˆ‘ä»¬å¯ä»¥ç¡®ä¿æœåŠ¡å™¨æ°¸è¿œä¸ä¼šåœæ­¢æµå¼ä¼ è¾“ã€‚</p>
<h2 id="server">è®¡ç®—æœºç½‘ç»œæœåŠ¡å™¨</h2>
<p>ç°åœ¨ï¼Œæ—¢ç„¶æˆ‘ä»¬å®ç°äº†è§†å›¾å±‚å’Œæµé€»è¾‘ï¼Œæˆ‘ä»¬å”¯ä¸€éœ€è¦åšçš„å°±æ˜¯åˆ›å»ºä¸€ä¸ªHTTPæœåŠ¡å™¨ã€‚æˆ‘ä»¬å°†ä½¿ç”¨<a href="https://hapi.dev/"> Hapi.js </a>ï¼Œå°½ç®¡ä»»ä½•æœåŠ¡å™¨éƒ½å¯ä»¥ã€‚</p>
<p>æˆ‘ä»¬å°†å®ç°ä¸€ä¸ªHTTPç«¯ç‚¹ï¼Œå½“è¯·æ±‚åˆ°æ¥æ—¶ï¼Œå®ƒå°†åšä¸¤ä»¶äº‹:</p>
<ol>
<li>å°†å®¢æˆ·æœºæ³¨å†Œä¸ºæ¶ˆè´¹è€…ï¼Œå¹¶å°†å…¶æ·»åŠ åˆ°æˆ‘ä»¬é˜Ÿåˆ—çš„<code>this._sinks</code>æ˜ å°„ä¸­(ç¬¬6è¡Œ)</li>
<li>å¼€å§‹å°†æ•°æ®æµå›å®¢æˆ·ç«¯</li>
</ol>
<p>åœ¨Hapi.jsä¸­ï¼Œè·¯çº¿çœ‹èµ·æ¥åƒè¿™æ ·:</p>
<pre>      server.route({
          method: 'GET',
          path: '/stream',
          handler: (request, h) =&gt; {

              const responseSink = queue.makeResponseSink();
              return h.response(responseSink).type('audio/mpeg');
          }
      });</pre>
<p>æœåŠ¡å™¨è¿˜éœ€è¦èƒ½å¤Ÿæä¾›é™æ€æ–‡ä»¶ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æä¾›ä¸€ä¸ªæ–¹ä¾¿çš„ç½‘é¡µä¸ä¸€äº›æ— çº¿ç”µæ§åˆ¶ã€‚åœ¨Hapi.jsä¸­å®ç°è¿™ä¸€ç‚¹å¾ˆç®€å•ï¼Œæˆ‘ä¸ä¼šåœ¨è¿™é‡Œå±•ç¤ºã€‚ä½†è¿™æ˜¯å°†è¢«æä¾›çš„ç®€å•é¡µé¢:</p>
<pre>&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;Node.js Radio&lt;/title&gt;
    &lt;link rel="stylesheet" type="text/css" media="screen" href="/index.css" /&gt;
    &lt;script src="/index.js"&gt;&lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;div id='main'&gt;
        &lt;h1 id="title"&gt;Very Cool Radio&lt;/h1&gt;
        &lt;img id="logo" src="/nodejs-logo.png"&gt;
        &lt;div id='radio'&gt;
            &lt;audio id="audio" src="/stream" preload="none" controls autoplay&gt;&lt;/audio&gt;
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;</pre>
<p>å½“é¡µé¢åŠ è½½æ—¶ï¼Œ<code>audio</code>å…ƒç´ (ç¬¬13è¡Œ)å°†å‘<code>src="/stream"</code>(æµè§ˆå™¨å°†è‡ªåŠ¨å‘å…¶å‘å‡ºè¯·æ±‚çš„ç«¯ç‚¹)å‘å‡ºè¯·æ±‚ã€‚</p>
<p>è¿™æ˜¯æˆ‘ä»¬ç®€å•è€Œæ¼‚äº®çš„ç½‘é¡µ:</p>
<p><img data-attachment-id="17842" data-permalink="https://blog.logrocket.com/online-radio-server-pure-node-js/finished-webpage/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/05/finished-webpage.png" data-orig-size="730,445" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Finished webpage" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/05/finished-webpage-300x183.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/05/finished-webpage.png" decoding="async" class="aligncenter size-full wp-image-17842 jetpack-lazy-image" src="../Images/35a1ba44042ea3a7f1358db2a9a42a9a.png" alt="Finished Webpage For Our Online Radio" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/05/finished-webpage.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/05/finished-webpage-300x183.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/05/finished-webpage.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/05/finished-webpage.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="17842" data-permalink="https://blog.logrocket.com/online-radio-server-pure-node-js/finished-webpage/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/05/finished-webpage.png" data-orig-size="730,445" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Finished webpage" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/05/finished-webpage-300x183.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/05/finished-webpage.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-17842" src="../Images/35a1ba44042ea3a7f1358db2a9a42a9a.png" alt="Finished Webpage For Our Online Radio" srcset="https://blog.logrocket.com/wp-content/uploads/2020/05/finished-webpage.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/05/finished-webpage-300x183.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/05/finished-webpage.png"/></noscript>
<h2>åŒ…æ‰</h2>
<p>å”·ï¼Œè¿™ç¯‡æ–‡ç« æ¯”æˆ‘é¢„æœŸçš„è¦é•¿ã€‚ç»™ä½ çš„ã€‚çƒ­å¿ƒçš„è¯»è€…ä»¬ï¼Œä»¥ä¸‹æ˜¯æˆ‘ä»¬æ‰€åšçš„æ€»ç»“:</p>
<ul>
<li>æˆ‘ä»¬å®ç°äº†ä¸€ä¸ªHTTPæœåŠ¡å™¨ï¼Œå®ƒå°†éŸ³é¢‘æ•°æ®ä¼ è¾“åˆ°æ‰€æœ‰çš„å®¢æˆ·ç«¯</li>
<li>æˆ‘ä»¬ä»¥ç»ˆç«¯GUIçš„å½¢å¼å®ç°äº†ä¸€ä¸ªæ§åˆ¶é¢æ¿ï¼Œç®¡ç†æœåŠ¡å™¨çš„äººå¯ä»¥é€šè¿‡å®ƒæµè§ˆå¯ç”¨æ­Œæ›²çš„åˆ—è¡¨ï¼Œå¹¶å°†å®ƒä»¬æ’é˜Ÿç­‰å¾…ä¸‹ä¸€æ¬¡æ’­æ”¾</li>
<li>æˆ‘ä»¬å®ç°äº†ä¸€ä¸ªåŒ…å«éŸ³é¢‘å…ƒç´ çš„é™æ€ç½‘é¡µï¼Œå®ƒå°†ä»æœåŠ¡å™¨ç«¯ç‚¹å¼€å§‹ä½¿ç”¨éŸ³é¢‘æ•°æ®</li>
</ul>
<p>åŒæ ·ï¼Œæœ¬æ–‡çš„æ•´ä¸ªrepoä½äº<a href="https://github.com/DarkMannn/node-radio-mini">è¿™é‡Œ</a>ï¼Œå®ƒåŒ…å«ä¸€ä¸ªåŠŸèƒ½å®Œæ•´çš„åº”ç”¨ç¨‹åºï¼Œå…·æœ‰ä¸€äº›è¿™é‡Œæ²¡æœ‰æ˜¾ç¤ºçš„åŠŸèƒ½ã€‚</p>
<p>è¿™å¾ˆæœ‰è¶£ã€‚æˆ‘ç©å¾—å¾ˆå¼€å¿ƒï¼Œå¸Œæœ›ä½ ä¹Ÿä¸€æ ·ï¼</p><div class="code-block code-block-23">
<div class="blog-plug inline-plug node-plug"><h2>200åª<img src="../Images/61167b9d027ca73ed5aaf59a9ec31267.png" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2019/10/green-check.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" class=" jetpack-lazy-image" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/10/green-check.png"/> <noscript> <img data-lazy-fallback="1" src="../Images/61167b9d027ca73ed5aaf59a9ec31267.png" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/10/green-check.png"/> </noscript>æ˜¾ç¤ºå™¨å‡ºç°æ•…éšœï¼Œç”Ÿäº§ä¸­ç½‘ç»œè¯·æ±‚ç¼“æ…¢</h2><p>éƒ¨ç½²åŸºäºèŠ‚ç‚¹çš„webåº”ç”¨ç¨‹åºæˆ–ç½‘ç«™æ˜¯å®¹æ˜“çš„éƒ¨åˆ†ã€‚ç¡®ä¿æ‚¨çš„èŠ‚ç‚¹å®ä¾‹ç»§ç»­ä¸ºæ‚¨çš„åº”ç”¨ç¨‹åºæä¾›èµ„æºæ˜¯äº‹æƒ…å˜å¾—æ›´åŠ å›°éš¾çš„åœ°æ–¹ã€‚å¦‚æœæ‚¨å¯¹ç¡®ä¿å¯¹åç«¯æˆ–ç¬¬ä¸‰æ–¹æœåŠ¡çš„è¯·æ±‚æˆåŠŸæ„Ÿå…´è¶£ï¼Œ</p><a href="https://lp.logrocket.com/blg/node-signup" target="_blank">try LogRocket</a><p>. </p><a class="signup" href="https://lp.logrocket.com/blg/node-signup" target="_blank" rel="noopener noreferrer"><img src="../Images/cae72fd2a54c5f02a6398c4867894844.png" alt="LogRocket Network Request Monitoring" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2019/12/network-request-filter-2-1.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" class=" jetpack-lazy-image" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/12/network-request-filter-2-1.png"/><noscript><img data-lazy-fallback="1" src="../Images/cae72fd2a54c5f02a6398c4867894844.png" alt="LogRocket Network Request Monitoring" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/12/network-request-filter-2-1.png"/></noscript></a><a href="https://lp.logrocket.com/blg/node-signup" target="_blank" rel="noopener noreferrer">https://logrocket.com/signup/</a><p>LogRocket å°±åƒæ˜¯ç½‘ç»œå’Œç§»åŠ¨åº”ç”¨ç¨‹åºçš„DVRï¼Œè®°å½•ä¸‹ç”¨æˆ·ä¸ä½ çš„åº”ç”¨ç¨‹åºäº¤äº’æ—¶å‘ç”Ÿçš„ä¸€åˆ‡ã€‚æ‚¨å¯ä»¥æ±‡æ€»å¹¶æŠ¥å‘Šæœ‰é—®é¢˜çš„ç½‘ç»œè¯·æ±‚ï¼Œä»¥å¿«é€Ÿäº†è§£æ ¹æœ¬åŸå› ï¼Œè€Œä¸æ˜¯çŒœæµ‹é—®é¢˜å‘ç”Ÿçš„åŸå› ã€‚</p><p>LogRocketæ£€æµ‹æ‚¨çš„åº”ç”¨ç¨‹åºä»¥è®°å½•åŸºçº¿æ€§èƒ½è®¡æ—¶ï¼Œå¦‚é¡µé¢åŠ è½½æ—¶é—´ã€åˆ°è¾¾ç¬¬ä¸€ä¸ªå­—èŠ‚çš„æ—¶é—´ã€æ…¢é€Ÿç½‘ç»œè¯·æ±‚ï¼Œè¿˜è®°å½•Reduxã€NgRxå’ŒVuexæ“ä½œ/çŠ¶æ€ã€‚</p><a class="signup" href="https://lp.logrocket.com/blg/node-signup" target="_blank" rel="noopener noreferrer">Start monitoring for free</a><p>. </p></div>
</div>

<p class="clearfix"/>
<p class="clearfix"/>
</article>

</div>    
</body>
</html>