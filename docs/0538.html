<html>
<head>
<title>How is getSnapshotBeforeUpdate implemented with Hooks? - LogRocket Blog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>getSnapshotBeforeUpdateæ˜¯å¦‚ä½•ç”¨é’©å­å®ç°çš„ï¼Ÿ- LogRocketåšå®¢</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://blog.logrocket.com/how-is-getsnapshotbeforeupdate-implemented-with-hooks/#0001-01-01">https://blog.logrocket.com/how-is-getsnapshotbeforeupdate-implemented-with-hooks/#0001-01-01</a></blockquote><div><article class="article-post">
<p>TLï¼›DR:ç®€å•çš„å›ç­”æ˜¯<code>getSnapshotBeforeUpdate</code>ä¸èƒ½ç”¨é’©å­å®ç°ã€‚ç„¶è€Œï¼Œæ›´æœ‰è¶£çš„é—®é¢˜æ˜¯ä¸ºä»€ä¹ˆä¸å‘¢ï¼Ÿæˆ‘ä»¬èƒ½ä»è‡ªå·±çš„å®è·µä¸­å­¦åˆ°ä»€ä¹ˆï¼Ÿ</p>
<h2>ä»‹ç»</h2>
<p>è‡ªä»å¼•å…¥<a href="https://medium.com/free-code-camp/learn-the-basics-of-react-hooks-in-10-minutes-b2898287fe5d" target="_blank" rel="noopener noreferrer">é’©å­</a>å·²ç»ä¸€å¹´å¤šäº†ï¼Œæ¯«ä¸å¥‡æ€ªå®ƒä»¬å·²ç»è¢«Reactç¤¾åŒºå¹¿æ³›é‡‡ç”¨ã€‚Reacté’©å­çš„å¼•å…¥å¯å‘äº†å…¶ä»–åº“<a href="https://twitter.com/youyuxi/status/1137567675356291072?lang=en" target="_blank" rel="noopener noreferrer">ï¼Œæ¯”å¦‚Vue </a>ï¼Œä¹Ÿåˆ›å»ºäº†åŸºäºå‡½æ•°çš„ç»„ä»¶APIã€‚ä¸€å¹´åï¼Œå…¬å¹³åœ°è¯´ï¼Œå‰ç«¯ç¤¾åŒºåœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šæ¥å—äº†ç”±Hooksæ¨åŠ¨çš„æ„å»ºç»„ä»¶çš„åŠŸèƒ½æ–¹æ³•ã€‚</p>
<p>å‡ºäºå¥½å¥‡ï¼Œä½ ä¸€å®šæ›¾ç»é—®è¿‡é’©å­æ˜¯å¦è¦†ç›–äº†æ‰€æœ‰è¢«å¤„ç†çš„ç”¨ä¾‹Reactç±»ã€‚å—¯ï¼Œ<a href="https://reactjs.org/docs/hooks-faq.html#do-hooks-cover-all-use-cases-for-classes" target="_blank" rel="noopener noreferrer">ç­”æ¡ˆæ˜¯å¦å®šçš„</a>ã€‚å¯¹äº<code>getSnapshotBeforeUpdate</code>å’Œ<code>componentDidCatch</code>ç±»çš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ï¼Œæ²¡æœ‰å¯¹åº”çš„é’©å­ã€‚å…¬å¹³åœ°è¯´ï¼Œè¿™äº›æ–¹æ³•æ²¡æœ‰å…¶ä»–æ–¹æ³•ç”¨å¾—å¤šâ€”â€”ä¸ç®¡æ€æ ·ï¼Œå®ƒä»¬ä»ç„¶æ˜¯æœ‰ç”¨çš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ï¼ŒReactå›¢é˜Ÿå·²ç»æ‰¿è¯ºâ€œå¾ˆå¿«â€å‘å¸ƒè¿™ç§æ–¹æ³•ã€‚</p>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬èƒ½ä¸èƒ½è‡³å°‘è¯•ç€ç”¨é’©å­å®ç°<code>getSnapshotBeforeUpdate</code>ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ï¼Ÿå¦‚æœåœ¨æˆ‘ä»¬ç°åœ¨å¯ç”¨çš„é’©å­çš„èŒƒå›´å†…æ˜¯å¯èƒ½çš„ï¼Œæˆ‘ä»¬å®ç°å®ƒçš„æœ€å¥½æœºä¼šæ˜¯ä»€ä¹ˆï¼Ÿ</p>
<p>åœ¨æ¥ä¸‹æ¥çš„éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬å°†å°è¯•ä½¿ç”¨<code>useLayoutEffect</code>å’Œ<code>useEffect</code>æ¥å®ç°<code>getSnapshotBeforeUpdate</code>ã€‚</p>
<h2>æ¼”ç¤ºåº”ç”¨ç¨‹åº</h2>
<p>ä¸ºäº†å°½å¯èƒ½å®ç”¨ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ä¸‹é¢çš„<a href="https://github.com/ohansemmanuel/points" target="_blank" rel="noopener noreferrer">æ¼”ç¤ºåº”ç”¨ç¨‹åº</a>:</p>
<p><img data-attachment-id="10097" data-permalink="https://blog.logrocket.com/how-is-getsnapshotbeforeupdate-implemented-with-hooks/exampleappusesnapshot/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2019/11/exampleappusesnapshot.gif" data-orig-size="730,439" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="exampleappusesnapshot" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2019/11/exampleappusesnapshot-300x180.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2019/11/exampleappusesnapshot.gif" decoding="async" class="aligncenter wp-image-10097 size-full jetpack-lazy-image" src="../Images/0d3be789088610b834d958e8e4e79363.png" alt="example app " data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2019/11/exampleappusesnapshot.gif?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/11/exampleappusesnapshot.gif"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="10097" data-permalink="https://blog.logrocket.com/how-is-getsnapshotbeforeupdate-implemented-with-hooks/exampleappusesnapshot/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2019/11/exampleappusesnapshot.gif" data-orig-size="730,439" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="exampleappusesnapshot" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2019/11/exampleappusesnapshot-300x180.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2019/11/exampleappusesnapshot.gif" decoding="async" loading="lazy" class="aligncenter wp-image-10097 size-full" src="../Images/0d3be789088610b834d958e8e4e79363.png" alt="example app " data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/11/exampleappusesnapshot.gif"/></noscript>
<p>è¿™ä¸ªåº”ç”¨ç¨‹åºæœ‰ä¸€ä¸ªéå¸¸ç®€å•çš„è®¾ç½®ã€‚è¯¥åº”ç”¨ç¨‹åºåœ¨å·¦ä¾§å‘ˆç°ä¸€ä¸ªè¶³çƒå’Œå¾—åˆ†ï¼Œä½†æ›´é‡è¦çš„æ˜¯ï¼Œå®ƒè¿˜åœ¨å³ä¾§å‘ˆç°ä¸€ä¸ªèŠå¤©çª—æ ¼ã€‚è¯¥èŠå¤©çª—æ ¼çš„é‡è¦ä¹‹å¤„åœ¨äºï¼Œéšç€æ›´å¤šèŠå¤©æ¶ˆæ¯å‡ºç°åœ¨çª—æ ¼ä¸­(ç‚¹å‡»<em>æ·»åŠ èŠå¤©</em>æŒ‰é’®)ï¼Œçª—æ ¼ä¼šè‡ªåŠ¨å‘ä¸‹æ»šåŠ¨åˆ°æœ€æ–°æ¶ˆæ¯ï¼Œå³è‡ªåŠ¨æ»šåŠ¨ã€‚è¿™æ˜¯WhatsAppã€Skypeã€iMessageç­‰èŠå¤©åº”ç”¨çš„æ™®éè¦æ±‚ã€‚å½“æ‚¨å‘é€æ›´å¤šé‚®ä»¶æ—¶ï¼Œé¢æ¿ä¼šè‡ªåŠ¨æ»šåŠ¨ï¼Œå› æ­¤æ‚¨ä¸å¿…æ‰‹åŠ¨æ»šåŠ¨ã€‚</p>
<p>æˆ‘åœ¨ä¹‹å‰å…³äºç”Ÿå‘½å‘¨æœŸæ–¹æ³•çš„æ–‡ç« ä¸­è§£é‡Šäº†è¿™æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œä½†æ˜¯æˆ‘å¾ˆä¹æ„åšä¸€ä¸ªç®€å•çš„å›é¡¾ã€‚</p>
<h2>å›é¡¾:getSnapshotBeforeUpdateå¦‚ä½•ç”¨äºè‡ªåŠ¨æ»šåŠ¨</h2>
<p>ç®€è€Œè¨€ä¹‹ï¼Œæ‚¨æ£€æŸ¥æ˜¯å¦æœ‰æ–°çš„èŠå¤©æ¶ˆæ¯ï¼Œå¹¶è¿”å›åœ¨<code>getSnapshotBeforeUpdate</code>ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ä¸­æ»šåŠ¨çš„ç»´åº¦ï¼Œå¦‚ä¸‹æ‰€ç¤º:</p>
<pre>getSnapshotBeforeUpdate (prevProps, prevState) {
    if (this.state.chatList &gt; prevState.chatList) {
      const chatThreadRef = this.chatThreadRef.current
      return chatThreadRef.scrollHeight - chatThreadRef.scrollTop
    }
    return null
  }</pre>
<p>ä¸‹é¢æ˜¯ä¸Šé¢çš„ä»£ç ç‰‡æ®µçš„å·¥ä½œåŸç†ã€‚</p>
<p>é¦–å…ˆï¼Œè€ƒè™‘æ‰€æœ‰èŠå¤©æ¶ˆæ¯çš„æ•´ä½“é«˜åº¦ä¸è¶…è¿‡èŠå¤©çª—æ ¼é«˜åº¦çš„æƒ…å†µã€‚</p>
<p><img data-attachment-id="10109" data-permalink="https://blog.logrocket.com/how-is-getsnapshotbeforeupdate-implemented-with-hooks/chatmessages/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2019/11/chatmessages.png" data-orig-size="1104,708" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="chatmessages" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2019/11/chatmessages-300x192.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2019/11/chatmessages-1024x657.png" decoding="async" class="aligncenter wp-image-10109 size-full jetpack-lazy-image" src="../Images/d3ceab0c3e04b15069638b171bd2791c.png" alt="chat message scroll height" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2019/11/chatmessages.png 1104w, https://blog.logrocket.com/wp-content/uploads/2019/11/chatmessages-300x192.png 300w, https://blog.logrocket.com/wp-content/uploads/2019/11/chatmessages-1024x657.png 1024w, https://blog.logrocket.com/wp-content/uploads/2019/11/chatmessages-768x493.png 768w" data-lazy-sizes="(max-width: 1104px) 100vw, 1104px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2019/11/chatmessages.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/11/chatmessages.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="10109" data-permalink="https://blog.logrocket.com/how-is-getsnapshotbeforeupdate-implemented-with-hooks/chatmessages/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2019/11/chatmessages.png" data-orig-size="1104,708" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="chatmessages" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2019/11/chatmessages-300x192.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2019/11/chatmessages-1024x657.png" decoding="async" loading="lazy" class="aligncenter wp-image-10109 size-full" src="../Images/d3ceab0c3e04b15069638b171bd2791c.png" alt="chat message scroll height" srcset="https://blog.logrocket.com/wp-content/uploads/2019/11/chatmessages.png 1104w, https://blog.logrocket.com/wp-content/uploads/2019/11/chatmessages-300x192.png 300w, https://blog.logrocket.com/wp-content/uploads/2019/11/chatmessages-1024x657.png 1024w, https://blog.logrocket.com/wp-content/uploads/2019/11/chatmessages-768x493.png 768w" sizes="(max-width: 1104px) 100vw, 1104px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/11/chatmessages.png"/></noscript>
<p>è¿™é‡Œï¼Œè¡¨è¾¾å¼<code>chatThreadRef.scrollHeight - chatThreadRef.scrollTop</code>å°†ç­‰åŒäº<code>chatThreadRef.scrollHeight - 0</code>ã€‚</p>
<p>å½“è¿›è¡Œè¯„ä¼°æ—¶ï¼Œä»<code>getSnapshotBeforeUpdate</code>è¿”å›çš„å€¼å°†ç­‰äºèŠå¤©çª—æ ¼çš„<code>scrollHeight</code>â€”â€”å°±åœ¨æ–°æ¶ˆæ¯è¢«æ’å…¥DOMä¹‹å‰ã€‚</p>
<p>å¦‚æœæ‚¨è¿˜è®°å¾—<code>getSnapshotBeforeUpdate</code>æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œé‚£ä¹ˆä»<code>getSnapshotBeforeUpdate</code>æ–¹æ³•è¿”å›çš„å€¼å°†ä½œä¸ºç¬¬ä¸‰ä¸ªå‚æ•°ä¼ é€’ç»™<code>componentDidUpdate</code>æ–¹æ³•ã€‚</p>
<p>æˆ‘ä»¬ç§°è¿™ä¸ªå€¼ä¸º<code>snapshot</code>:</p>
<pre>componentDidUpdate(prevProps, prevState, snapshot) {

}</pre>
<p>è¿™é‡Œä¼ å…¥çš„å¿«ç…§å€¼â€”â€”æ­¤æ—¶ï¼Œæ˜¯DOMæ›´æ–°ä¹‹å‰çš„å‰ä¸€ä¸ª<code>scrollHeight</code>ã€‚</p>
<p>åœ¨<code>componentDidUpdate</code>ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ä¸­ï¼Œä¸‹é¢æ˜¯æ›´æ–°èŠå¤©çª—æ ¼æ»šåŠ¨ä½ç½®çš„ä»£ç :</p>
<pre>componentDidUpdate(prevProps, prevState, snapshot) {
    if (snapshot !== null) {
      const chatThreadRef = this.chatThreadRef.current;
      chatThreadRef.scrollTop = chatThreadRef.scrollHeight - snapshot;
    }
  }</pre>
<p>å®é™…ä¸Šï¼Œæˆ‘ä»¬æ˜¯ä»¥ç¼–ç¨‹æ–¹å¼ä»ä¸Šåˆ°ä¸‹å‚ç›´æ»šåŠ¨çª—æ ¼ï¼Œè·ç¦»ç­‰äº<code>chatThreadRef.scrollHeight - snapshot</code>ã€‚</p>
<p>ç”±äºå¿«ç…§æŒ‡çš„æ˜¯åœ¨æ›´æ–°ä¹‹å‰çš„<code>scrollHeight</code> <em>ï¼Œæ‰€ä»¥ä¸Šé¢çš„è¡¨è¾¾å¼è¿”å›æ–°èŠå¤©æ¶ˆæ¯çš„é«˜åº¦åŠ ä¸Šç”±äºæ›´æ–°å¯¼è‡´çš„ä»»ä½•å…¶ä»–ç›¸å…³é«˜åº¦ã€‚è¯·å‚è§ä¸‹å›¾:</em></p>
<p><img data-attachment-id="10125" data-permalink="https://blog.logrocket.com/how-is-getsnapshotbeforeupdate-implemented-with-hooks/scrollheightbeforeupdate/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2019/11/scrollHeightbeforeupdate.png" data-orig-size="1104,708" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="scrollHeightbeforeupdate" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2019/11/scrollHeightbeforeupdate-300x192.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2019/11/scrollHeightbeforeupdate-1024x657.png" decoding="async" class="aligncenter wp-image-10125 size-large jetpack-lazy-image" src="../Images/a2c3ee891f41bbae120292abf34655a6.png" alt="scroll height before update" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2019/11/scrollHeightbeforeupdate-1024x657.png 1024w, https://blog.logrocket.com/wp-content/uploads/2019/11/scrollHeightbeforeupdate-300x192.png 300w, https://blog.logrocket.com/wp-content/uploads/2019/11/scrollHeightbeforeupdate-768x493.png 768w, https://blog.logrocket.com/wp-content/uploads/2019/11/scrollHeightbeforeupdate.png 1104w" data-lazy-sizes="(max-width: 1024px) 100vw, 1024px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2019/11/scrollHeightbeforeupdate-1024x657.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/11/scrollHeightbeforeupdate-1024x657.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="10125" data-permalink="https://blog.logrocket.com/how-is-getsnapshotbeforeupdate-implemented-with-hooks/scrollheightbeforeupdate/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2019/11/scrollHeightbeforeupdate.png" data-orig-size="1104,708" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="scrollHeightbeforeupdate" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2019/11/scrollHeightbeforeupdate-300x192.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2019/11/scrollHeightbeforeupdate-1024x657.png" decoding="async" loading="lazy" class="aligncenter wp-image-10125 size-large" src="../Images/a2c3ee891f41bbae120292abf34655a6.png" alt="scroll height before update" srcset="https://blog.logrocket.com/wp-content/uploads/2019/11/scrollHeightbeforeupdate-1024x657.png 1024w, https://blog.logrocket.com/wp-content/uploads/2019/11/scrollHeightbeforeupdate-300x192.png 300w, https://blog.logrocket.com/wp-content/uploads/2019/11/scrollHeightbeforeupdate-768x493.png 768w, https://blog.logrocket.com/wp-content/uploads/2019/11/scrollHeightbeforeupdate.png 1104w" sizes="(max-width: 1024px) 100vw, 1024px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/11/scrollHeightbeforeupdate-1024x657.png"/></noscript>
<p>å½“æ•´ä¸ªèŠå¤©çª—æ ¼çš„é«˜åº¦è¢«æ¶ˆæ¯å æ®æ—¶(å¹¶ä¸”å·²ç»å‘ä¸Šæ»šåŠ¨äº†ä¸€ç‚¹)ï¼Œç”±<code>getSnapshotBeforeUpdate</code>æ–¹æ³•è¿”å›çš„å¿«ç…§å€¼å°†ç­‰äºèŠå¤©çª—æ ¼çš„å®é™…é«˜åº¦ã€‚</p>
<p><img data-attachment-id="10132" data-permalink="https://blog.logrocket.com/how-is-getsnapshotbeforeupdate-implemented-with-hooks/chatpaneheight/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2019/11/chatpaneheight.png" data-orig-size="1104,708" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="chatpaneheight" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2019/11/chatpaneheight-300x192.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2019/11/chatpaneheight-1024x657.png" decoding="async" class="aligncenter wp-image-10132 size-full jetpack-lazy-image" src="../Images/53e426aad694beb34d0338b8dc755b32.png" alt="chat pane height" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2019/11/chatpaneheight.png 1104w, https://blog.logrocket.com/wp-content/uploads/2019/11/chatpaneheight-300x192.png 300w, https://blog.logrocket.com/wp-content/uploads/2019/11/chatpaneheight-1024x657.png 1024w, https://blog.logrocket.com/wp-content/uploads/2019/11/chatpaneheight-768x493.png 768w" data-lazy-sizes="(max-width: 1104px) 100vw, 1104px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2019/11/chatpaneheight.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/11/chatpaneheight.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="10132" data-permalink="https://blog.logrocket.com/how-is-getsnapshotbeforeupdate-implemented-with-hooks/chatpaneheight/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2019/11/chatpaneheight.png" data-orig-size="1104,708" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="chatpaneheight" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2019/11/chatpaneheight-300x192.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2019/11/chatpaneheight-1024x657.png" decoding="async" loading="lazy" class="aligncenter wp-image-10132 size-full" src="../Images/53e426aad694beb34d0338b8dc755b32.png" alt="chat pane height" srcset="https://blog.logrocket.com/wp-content/uploads/2019/11/chatpaneheight.png 1104w, https://blog.logrocket.com/wp-content/uploads/2019/11/chatpaneheight-300x192.png 300w, https://blog.logrocket.com/wp-content/uploads/2019/11/chatpaneheight-1024x657.png 1024w, https://blog.logrocket.com/wp-content/uploads/2019/11/chatpaneheight-768x493.png 768w" sizes="(max-width: 1104px) 100vw, 1104px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/11/chatpaneheight.png"/></noscript>
<p>æ¥è‡ª<code>componentDidUpdate</code>çš„è®¡ç®—å°†æŠŠ<code>scrollTop</code>å€¼è®¾ç½®ä¸ºé¢å¤–æ¶ˆæ¯é«˜åº¦çš„æ€»å’Œâ€”â€”è¿™æ­£æ˜¯æˆ‘ä»¬æƒ³è¦çš„ã€‚</p>
<p>è€Œä¸”ï¼Œå°±æ˜¯è¿™æ ·ï¼</p>
<h2>æˆ‘ä»¬å¦‚ä½•ç”¨é’©å­å¤åˆ¶è¿™ä¸ªï¼Ÿ</h2>
<p>è¿™é‡Œçš„ç›®æ ‡æ˜¯å°½å¯èƒ½å¤šåœ°å°è¯•ä½¿ç”¨é’©å­é‡æ–°åˆ›å»ºä¸€ä¸ªç±»ä¼¼çš„APIã€‚è™½ç„¶è¿™ä¸å®Œå…¨å¯èƒ½ï¼Œä½†è®©æˆ‘ä»¬è¯•ä¸€è¯•å§ï¼</p>
<p>ä¸ºäº†ç”¨é’©å­å®ç°<code>getSnapshotBeforeUpdate</code>,æˆ‘ä»¬å°†ç¼–å†™ä¸€ä¸ªåä¸º<code>useGetSnapshotBeforeUpdate</code>çš„å®šåˆ¶é’©å­ï¼Œå¹¶æœŸæœ›ç”¨å¦‚ä¸‹çš„å‡½æ•°å‚æ•°è°ƒç”¨:</p>
<pre>useGetSnapshotBeforeUpdate(() =&gt; {

})</pre>
<p>ç”¨<code>prevProps</code>å’Œ<code>prevState</code>è°ƒç”¨ç±»ç”Ÿå‘½å‘¨æœŸæ–¹æ³•<code>getSnapshotBeforeUpdate</code>ã€‚æ‰€ä»¥æˆ‘ä»¬å¸Œæœ›ä¼ é€’ç»™<code>useGetSnapshotBeforeUpdate</code>çš„å‡½æ•°ç”¨ç›¸åŒçš„å‚æ•°è°ƒç”¨ã€‚</p>
<pre>useGetSnapshotBeforeUpdate((prevProps, prevState) =&gt; {

})</pre>
<p>é™¤äº†ç¼–å†™ä¸€ä¸ªå®šåˆ¶çš„è§£å†³æ–¹æ¡ˆï¼Œæ ¹æœ¬æ²¡æœ‰åŠæ³•è®¿é—®<code>prevProps</code>å’Œ<code>prevState</code>ã€‚ä¸€ç§æ–¹æ³•æ˜¯ç”¨æˆ·å°†å½“å‰çš„<code>props</code>å’Œ<code>state</code>ä¼ é€’ç»™è‡ªå®šä¹‰é’©å­<code>useGetSnapshotBeforeUpdate</code>ã€‚é’©å­å°†æ¥å—å¦å¤–ä¸¤ä¸ªå‚æ•°ï¼Œ<code>props</code>å’Œ<code>state</code>â€”â€”ä»è¿™äº›å‚æ•°ä¸­ï¼Œæˆ‘ä»¬å°†è·Ÿè¸ªé’©å­ä¸­çš„<code>prevProps</code>å’Œ<code>prevState</code>ã€‚</p>
<pre>useGetSnapshotBeforeUpdate((prevProps, prevState) =&gt; {

}, props, state)</pre>
<p>ç°åœ¨è®©æˆ‘ä»¬é€šè¿‡äº†è§£å‰é¢çš„<code>props</code>å’Œ<code>state</code>æ¥ç¼–å†™<code>useGetSnapshotBeforeUpdate</code>é’©å­çš„å†…éƒ¨ç»“æ„ã€‚</p><div class="code-block code-block-54">
<hr/>
<h3>æ›´å¤šæ¥è‡ªLogRocketçš„ç²¾å½©æ–‡ç« :</h3>

<hr/></div>
<pre>// custom Hook for getting previous props and state
// https://reactjs.org/docs/hooks-faq.html#how-to-get-the-previous-props-or-state
const usePrevPropsAndState = (props, state) =&gt; {
  const prevPropsAndStateRef = useRef({ props: null, state: null })
  const prevProps = prevPropsAndStateRef.current.props
  const prevState = prevPropsAndStateRef.current.state

  useEffect(() =&gt; {
    prevPropsAndStateRef.current = { props, state }
  })

  return { prevProps, prevState }
}

// actual hook implementation 
const useGetSnapshotBeforeUpdate = (cb, props, state) =&gt; {
  // get prev props and state
  const { prevProps, prevState } = usePrevPropsAndState(props, state)

}</pre>
<p>å¦‚ä¸Šæ‰€è¿°ï¼Œ<code>useGetSnapshotBeforeUpdate</code>é’©å­å°†ç”¨æˆ·å›è°ƒã€å±æ€§å’ŒçŠ¶æ€ä½œä¸ºå‚æ•°ï¼Œç„¶åè°ƒç”¨<code>usePrevPropsAndState</code>å®šåˆ¶é’©å­æ¥è·å–ä¹‹å‰çš„å±æ€§å’ŒçŠ¶æ€ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œç†è§£ç±»ç”Ÿå‘½å‘¨æœŸæ–¹æ³•<code>getSnapshotBeforeUpdate</code>æ°¸è¿œä¸ä¼šåœ¨æŒ‚è½½æ—¶è¢«è°ƒç”¨æ˜¯å¾ˆé‡è¦çš„ã€‚å®ƒä»…åœ¨ç»„ä»¶æ›´æ–°æ—¶è¢«è°ƒç”¨ã€‚ç„¶è€Œï¼Œé’©å­<code>useEffect</code>å’Œ<code>useLayoutEffect</code>æ˜¯é»˜è®¤çš„ï¼Œåœ¨æŒ‚è½½æ—¶æ€»æ˜¯è‡³å°‘è¢«è°ƒç”¨ä¸€æ¬¡ã€‚æˆ‘ä»¬éœ€è¦é˜²æ­¢è¿™ç§æƒ…å†µå‘ç”Ÿã€‚</p>
<p>æ–¹æ³•å¦‚ä¸‹:</p>
<pre>const useGetSnapshotBeforeUpdate = (cb, props, state) =&gt; {
  // get prev props and state
  const { prevProps, prevState } = usePrevPropsAndState(props, state)

        
// getSnapshotBeforeUpdate - not run on mount + run on every update
  const componentJustMounted = useRef(true)
  useLayoutEffect(() =&gt; {
    if (!componentJustMounted.current) {
      // do something
    }
    componentJustMounted.current = false
  })
}</pre>
<p>ä¸ºäº†é˜²æ­¢<code>useLayoutEffect</code>åœ¨mountä¸Šè¿è¡Œï¼Œæˆ‘ä»¬ä¿ç•™ä¸€ä¸ªrefå€¼<code>componentJustMounted</code>ï¼Œé»˜è®¤æƒ…å†µä¸‹è¯¥å€¼ä¸ºçœŸï¼Œåªæœ‰åœ¨<code>useLayoutEffect</code>è¢«è§¦å‘åæ‰è‡³å°‘è®¾ç½®ä¸€æ¬¡ä¸ºå‡ã€‚</p>
<p>å¦‚æœä½ æ³¨æ„çš„è¯ï¼Œä½ ä¼šæ³¨æ„åˆ°æˆ‘ç”¨çš„æ˜¯<code>useLayoutEffect</code>é’©è€Œä¸æ˜¯<code>useEffect</code>ã€‚è¿™é‡è¦å—ï¼Ÿ</p>
<p>æˆ‘è¿™ä¹ˆåšæ˜¯æœ‰åŸå› çš„ã€‚</p>
<p>ç±»ç”Ÿå‘½å‘¨æœŸæ–¹æ³•<code>getSnapshotBeforeUpdate</code>è¿”å›ä¼ é€’ç»™<code>componentDidUpdate</code>æ–¹æ³•çš„å¿«ç…§å€¼ã€‚ç„¶è€Œï¼Œè¿™ä¸ªå¿«ç…§é€šå¸¸æ˜¯åœ¨Reactæœ‰æœºä¼šå°†æ›´æ”¹æäº¤åˆ°DOMä¹‹å‰ä»DOMä¸­æ£€ç´¢çš„å€¼ã€‚</p>
<p>å› ä¸º<code>useLayoutEffect</code>æ€»æ˜¯åœ¨<code>useEffect</code>ä¹‹å‰è¢«è§¦å‘ï¼Œæ‰€ä»¥è¿™æ˜¯æˆ‘ä»¬åœ¨æµè§ˆå™¨æœ‰æœºä¼šå°†æ›´æ”¹ç»˜åˆ¶åˆ°å±å¹•ä¸Šä¹‹å‰ä»DOMä¸­è·å–çš„æœ€æ¥è¿‘çš„å€¼ã€‚</p>
<p>æ­¤å¤–ï¼Œè¯·æ³¨æ„ï¼Œ<code>useLayoutEffect</code>é’©å­æ²¡æœ‰ä½¿ç”¨ä»»ä½•æ•°ç»„ä¾èµ–æ¥è°ƒç”¨â€”â€”è¿™ç¡®ä¿äº†å®ƒåœ¨æ¯æ¬¡æ›´æ–°/é‡æ–°å‘ˆç°æ—¶è§¦å‘ã€‚</p>
<p>è®©æˆ‘ä»¬å»æ‹å¿«ç…§å§ã€‚è¯·æ³¨æ„ï¼Œè¿™æ˜¯è°ƒç”¨ç”¨æˆ·å›è°ƒæ—¶è¿”å›çš„å€¼ã€‚</p>
<pre>const useGetSnapshotBeforeUpdate = (cb, props, state) =&gt; {
  // get prev props and state
  const { prevProps, prevState } = usePrevPropsAndState(props, state)
  // ğŸ‘‡ look here
  const snapshot = useRef(null)


// getSnapshotBeforeUpdate - not run on mount + run on every update
  const componentJustMounted = useRef(true)
  useLayoutEffect(() =&gt; {
    if (!componentJustMounted.current) {
      // ğŸ‘‡ look here
           snapshot.current = cb(prevProps, prevState)  
    }
    componentJustMounted.current = false
  })
}</pre>
<p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œä¸€åˆ‡é¡ºåˆ©ã€‚</p>
<p>è¯¥è§£å†³æ–¹æ¡ˆçš„ç»“è®ºéƒ¨åˆ†åŒ…æ‹¬é€‚åº”<code>componentdidUpdate</code>ï¼Œå› ä¸ºå®ƒä¸<code>getSnapshotBeforeUpdate</code>ç´§å¯†ç›¸å…³ã€‚</p>
<p>è®°ä½ï¼Œ<code>componentdidUpdate</code>ç”Ÿå‘½å‘¨æœŸæ–¹æ³•æ˜¯ç”¨<code>prevProps</code>ã€<code>prevState</code>è°ƒç”¨çš„ï¼Œå¿«ç…§æ˜¯ä»<code>getSnapshotBeforeUpdate</code>è¿”å›çš„ã€‚</p>
<p>ä¸ºäº†æ¨¡ä»¿è¿™ä¸ªAPIï¼Œæˆ‘ä»¬å°†è®©ç”¨æˆ·è°ƒç”¨ä¸€ä¸ªå¸¦æœ‰å›è°ƒçš„è‡ªå®šä¹‰<code>useComponentDidUpdate</code>é’©å­:</p>
<pre>useComponentDidUpdate((prevProps, prevState, snapshot) =&gt; {

})</pre>
<p>æˆ‘ä»¬å¦‚ä½•åšåˆ°è¿™ä¸€ç‚¹ï¼Ÿä¸€ç§è§£å†³æ–¹æ¡ˆæ˜¯ä»å…ˆå‰æ„å»ºçš„<code>useGetSnapshotBeforeUpdate</code>é’©å­è¿”å›<code>useComponentDidUpdate</code>é’©å­ã€‚æ˜¯çš„ï¼Œè‡ªå®šä¹‰é’©å­å¯ä»¥è¿”å›å¦ä¸€ä¸ªé’©å­ï¼é€šè¿‡è¿™æ ·åšï¼Œæˆ‘ä»¬åˆ©ç”¨äº†JavaScript <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Closures" target="_blank" rel="noopener noreferrer">é—­åŒ…</a>ã€‚</p>
<p>ä¸‹é¢æ˜¯å®ƒçš„å®ç°:</p>
<pre>const useGetSnapshotBeforeUpdate = (cb, props, state) =&gt; {
  // get prev props and state
  const { prevProps, prevState } = usePrevPropsAndState(props, state)

  const snapshot = useRef(null)


// getSnapshotBeforeUpdate - not run on mount + run on every update
  const componentJustMounted = useRef(true)
  useLayoutEffect(() =&gt; {
    if (!componentJustMounted.current) {
           snapshot.current = cb(prevProps, prevState)  
    }
    componentJustMounted.current = false
  })

 // ğŸ‘‡ look here
 const useComponentDidUpdate = cb =&gt; {
    useEffect(() =&gt; {
      if (!componentJustMounted.current) {
        cb(prevProps, prevState, snapshot.current)
      }
    })
  }
  // ğŸ‘‡ look here
  return useComponentDidUpdate
}</pre>
<p>ä»ä¸Šé¢çš„ä»£ç å—ä¸­å¯ä»¥æ³¨æ„åˆ°ä¸€äº›äº‹æƒ…ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬è¿˜é˜²æ­¢åœ¨ç»„ä»¶åˆšåˆšæŒ‚è½½æ—¶è§¦å‘ç”¨æˆ·å›è°ƒâ€”â€”å› ä¸ºåœ¨æŒ‚è½½æ—¶ä¸ä¼šè°ƒç”¨<code>componentDidUpdate</code>ã€‚</p>
<p>æ­¤å¤–ï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œä½¿ç”¨äº†<code>useEffect</code>é’©å­ï¼Œè€Œä¸æ˜¯<code>useLayoutEffect</code>ã€‚</p>
<p>å°±æ˜¯è¿™æ ·ï¼æˆ‘ä»¬å·²ç»å°è¯•ä¸º<code>getSnapshotBeforeUpdate</code>å¤åˆ¶APIï¼Œä½†æ˜¯è¿™è¡Œå¾—é€šå—ï¼Ÿ</p>
<h2>æµ‹è¯•å®æ–½çš„è§£å†³æ–¹æ¡ˆ</h2>
<p>æˆ‘ä»¬ç°åœ¨å¯ä»¥ä»æ¼”ç¤ºä¸­é‡æ„Appç»„ä»¶ï¼Œä½¿ç”¨<a href="https://github.com/ohansemmanuel/points/blob/f9206c709f475d19b414fc689e357edb70c34696/src/App2.js" target="_blank" rel="noopener noreferrer">é’©å­</a>ã€‚è¿™åŒ…æ‹¬ä½¿ç”¨æˆ‘ä»¬åˆšåˆšæ„å»ºçš„è‡ªå®šä¹‰æŒ‚é’©ï¼Œå¦‚ä¸‹æ‰€ç¤º:</p>
<pre>const App = props =&gt; {
  // other stuff ...

  const useComponentDidUpdate = useGetSnapshotBeforeUpdate(
    (_, prevState) =&gt; {
      if (state.chatList &gt; prevState.chatList) {
        return (
          chatThreadRef.current.scrollHeight - chatThreadRef.current.scrollTop
        )
      }
      return null
    },
    props,
    state
  )

  useComponentDidUpdate((prevProps, prevState, snapshot) =&gt; {
    console.log({ snapshot }) // ğŸ‘ˆ look here
    if (snapshot !== null) {
      chatThreadRef.current.scrollTop =
        chatThreadRef.current.scrollHeight - snapshot
    }
  })
}</pre>
<p>è¿™äº›é’©å­ä¸­çš„å®ç°ä¸ç±»ç»„ä»¶æ˜¯ä¸€æ ·çš„ã€‚ä½†æ˜¯ï¼Œè¯·æ³¨æ„ï¼Œæˆ‘å·²ç»è®°å½•äº†ä»æˆ‘ä»¬çš„å®šåˆ¶å®ç°ä¸­æ”¶åˆ°çš„å¿«ç…§ã€‚</p>
<p>ä»ä½¿ç”¨ç±»ç”Ÿå‘½å‘¨æœŸæ–¹æ³•çš„å®ç°ä¸­ï¼Œæ‚¨ä¼šå¾—åˆ°ä»¥ä¸‹ç»“æœ:</p>
<p><img data-attachment-id="10162" data-permalink="https://blog.logrocket.com/how-is-getsnapshotbeforeupdate-implemented-with-hooks/scrolltoplog/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2019/11/scrollToplog.png" data-orig-size="730,376" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="scrollToplog" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2019/11/scrollToplog-300x155.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2019/11/scrollToplog.png" decoding="async" class="aligncenter wp-image-10162 size-full jetpack-lazy-image" src="../Images/3ec5ca103692939641f9808343f0829e.png" alt="scrollTop" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2019/11/scrollToplog.png 730w, https://blog.logrocket.com/wp-content/uploads/2019/11/scrollToplog-300x155.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2019/11/scrollToplog.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/11/scrollToplog.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="10162" data-permalink="https://blog.logrocket.com/how-is-getsnapshotbeforeupdate-implemented-with-hooks/scrolltoplog/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2019/11/scrollToplog.png" data-orig-size="730,376" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="scrollToplog" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2019/11/scrollToplog-300x155.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2019/11/scrollToplog.png" decoding="async" loading="lazy" class="aligncenter wp-image-10162 size-full" src="../Images/3ec5ca103692939641f9808343f0829e.png" alt="scrollTop" srcset="https://blog.logrocket.com/wp-content/uploads/2019/11/scrollToplog.png 730w, https://blog.logrocket.com/wp-content/uploads/2019/11/scrollToplog-300x155.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/11/scrollToplog.png"/></noscript>
<p>å¿«ç…§ç¡®å®æ˜¯åœ¨Reactå‘DOMæäº¤ä¹‹å‰æ”¶åˆ°çš„ã€‚æˆ‘ä»¬ä¹‹æ‰€ä»¥çŸ¥é“è¿™ä¸ªï¼Œæ˜¯å› ä¸ºå¿«ç…§æŒ‡çš„æ˜¯å®é™…æ›´æ–°å‰å’Œæˆªå›¾ä¸­çš„<code>scrollHeight</code>ï¼Œå’Œç°åœ¨çš„<code>scrollHeight</code>æ˜æ˜¾ä¸åŒã€‚</p>
<p>ç„¶è€Œï¼Œåœ¨æˆ‘ä»¬çš„é’©å­å®ç°ä¸­ï¼Œä¹‹å‰çš„<code>scrollHeight</code>å®é™…ä¸Šæ˜¯æˆ‘ä»¬å¯»æ‰¾çš„å¿«ç…§ï¼Œä¸å½“å‰çš„<code>scrollHeight</code>æ²¡æœ‰ä»€ä¹ˆä¸åŒã€‚</p>
<p><img data-attachment-id="10164" data-permalink="https://blog.logrocket.com/how-is-getsnapshotbeforeupdate-implemented-with-hooks/snapshotscrolltop/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2019/11/snapshotscrollTop.png" data-orig-size="730,378" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="snapshotscrollTop" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2019/11/snapshotscrollTop-300x155.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2019/11/snapshotscrollTop.png" decoding="async" class="aligncenter wp-image-10164 size-full jetpack-lazy-image" src="../Images/817434072cb455dff49cb3a708bee8c9.png" alt="snapshot and scrollTop" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2019/11/snapshotscrollTop.png 730w, https://blog.logrocket.com/wp-content/uploads/2019/11/snapshotscrollTop-300x155.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2019/11/snapshotscrollTop.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/11/snapshotscrollTop.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="10164" data-permalink="https://blog.logrocket.com/how-is-getsnapshotbeforeupdate-implemented-with-hooks/snapshotscrolltop/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2019/11/snapshotscrollTop.png" data-orig-size="730,378" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="snapshotscrollTop" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2019/11/snapshotscrollTop-300x155.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2019/11/snapshotscrollTop.png" decoding="async" loading="lazy" class="aligncenter wp-image-10164 size-full" src="../Images/817434072cb455dff49cb3a708bee8c9.png" alt="snapshot and scrollTop" srcset="https://blog.logrocket.com/wp-content/uploads/2019/11/snapshotscrollTop.png 730w, https://blog.logrocket.com/wp-content/uploads/2019/11/snapshotscrollTop-300x155.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/11/snapshotscrollTop.png"/></noscript>
<p>Â </p>
<p>å‡ºäºæŸç§åŸå› ï¼Œæˆ‘ä»¬æ— æ³•åœ¨DOMæ›´æ–°ä¹‹å‰æ•æ‰å¿«ç…§ã€‚ä¸ºä»€ä¹ˆä¼šè¿™æ ·å‘¢ï¼Ÿ</p>
<h2>ç»“è®º</h2>
<p>è™½ç„¶çœ‹èµ·æ¥æ— å…³ç´§è¦ï¼Œä½†è¿™ä¸ªç»ƒä¹ å¯¹äºè´¨ç–‘ä½ å¯¹é’©å­å’ŒæŸäº›ReactåŸºç¡€çŸ¥è¯†çš„ç†è§£æ˜¯éå¸¸æœ‰ç”¨çš„ã€‚ç®€è€Œè¨€ä¹‹ï¼Œæˆ‘ä»¬æ— æ³•åœ¨DOMæ›´æ–°ä¹‹å‰è·å¾—å¿«ç…§ï¼Œå› ä¸ºæ‰€æœ‰é’©å­éƒ½æ˜¯åœ¨Reactâ€œæäº¤é˜¶æ®µâ€è°ƒç”¨çš„â€”â€”åœ¨Reactå†…éƒ¨æ›´æ–°DOMå’Œrefsä¹‹åã€‚</p>
<figure id="attachment_10166" aria-describedby="caption-attachment-10166" class="wp-caption aligncenter"><img data-attachment-id="10166" data-permalink="https://blog.logrocket.com/how-is-getsnapshotbeforeupdate-implemented-with-hooks/commitphase/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2019/11/commitphase.png" data-orig-size="1221,678" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="commitphase" data-image-description="" data-image-caption="&lt;p&gt;http://projects.wojtekmaj.pl/react-lifecycle-methods-diagram/&lt;/p&gt;&#10;" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2019/11/commitphase-300x167.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2019/11/commitphase-1024x569.png" decoding="async" class="wp-image-10166 size-full jetpack-lazy-image" src="../Images/3de78f377f885f569b6a486f2f7358db.png" alt="lifecycle methods diagram" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2019/11/commitphase.png 1221w, https://blog.logrocket.com/wp-content/uploads/2019/11/commitphase-300x167.png 300w, https://blog.logrocket.com/wp-content/uploads/2019/11/commitphase-1024x569.png 1024w, https://blog.logrocket.com/wp-content/uploads/2019/11/commitphase-768x426.png 768w" data-lazy-sizes="(max-width: 1221px) 100vw, 1221px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2019/11/commitphase.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/11/commitphase.png"/><noscript><img data-lazy-fallback="1" data-attachment-id="10166" data-permalink="https://blog.logrocket.com/how-is-getsnapshotbeforeupdate-implemented-with-hooks/commitphase/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2019/11/commitphase.png" data-orig-size="1221,678" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="commitphase" data-image-description="" data-image-caption="&lt;p&gt;http://projects.wojtekmaj.pl/react-lifecycle-methods-diagram/&lt;/p&gt;&#10;" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2019/11/commitphase-300x167.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2019/11/commitphase-1024x569.png" decoding="async" loading="lazy" class="wp-image-10166 size-full" src="../Images/3de78f377f885f569b6a486f2f7358db.png" alt="lifecycle methods diagram" srcset="https://blog.logrocket.com/wp-content/uploads/2019/11/commitphase.png 1221w, https://blog.logrocket.com/wp-content/uploads/2019/11/commitphase-300x167.png 300w, https://blog.logrocket.com/wp-content/uploads/2019/11/commitphase-1024x569.png 1024w, https://blog.logrocket.com/wp-content/uploads/2019/11/commitphase-768x426.png 768w" sizes="(max-width: 1221px) 100vw, 1221px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/11/commitphase.png"/></noscript><figcaption id="caption-attachment-10166" class="wp-caption-text"><a href="http://projects.wojtekmaj.pl/react-lifecycle-methods-diagram/" rel="nofollow">http://projects.wojtekmaj.pl/react-lifecycle-methods-diagram/</a></figcaption></figure>
<p>ç”±äº<code>getSnapshotBeforeUpdate</code>åœ¨æäº¤é˜¶æ®µä¹‹å‰è¢«è°ƒç”¨ï¼Œè¿™ä½¿å¾—å®ƒä¸å¯èƒ½åœ¨é’©å­ã€<code>useEffect</code>å’Œ<code>useLayoutEffect</code>çš„èŒƒå›´å†…è¢«å¤åˆ¶ã€‚</p>
<p>æˆ‘å¸Œæœ›ä½ å–œæ¬¢è¿™æ¬¡æ¼”è®²ï¼Œå¹¶ä¸”å­¦åˆ°äº†ä¸€äº›æ–°çš„ä¸œè¥¿ã€‚åŠæ—¶äº†è§£æˆ‘çš„ä½œå“ã€‚</p><div class="code-block code-block-17">
<div class="blog-plug inline-plug react-plug" vwo-el-id="26283398190">
<h2 vwo-el-id="41600691720">ä½¿ç”¨LogRocketæ¶ˆé™¤ä¼ ç»Ÿååº”é”™è¯¯æŠ¥å‘Šçš„å™ªéŸ³</h2>
<a href="https://lp.logrocket.com/blg/react-signup-issue-free" target="_blank" vwo-el-id="19356441070">LogRocket
</a><p>æ˜¯ä¸€æ¬¾React analyticsè§£å†³æ–¹æ¡ˆï¼Œå¯ä¿æŠ¤æ‚¨å…å—æ•°ç™¾ä¸ªè¯¯æŠ¥é”™è¯¯è­¦æŠ¥çš„å½±å“ï¼Œåªé’ˆå¯¹å°‘æ•°çœŸæ­£é‡è¦çš„é¡¹ç›®ã€‚LogRocketå‘Šè¯‰æ‚¨Reactåº”ç”¨ç¨‹åºä¸­å®é™…å½±å“ç”¨æˆ·çš„æœ€å…·å½±å“åŠ›çš„bugå’ŒUXé—®é¢˜ã€‚</p><a class="signup" href="https://lp.logrocket.com/blg/react-signup-general" target="_blank" rel="noopener noreferrer" vwo-el-id="19356441380">
<img class="first-react-image alignnone size-full wp-image-46 jetpack-lazy-image jetpack-lazy-image--handled" src="../Images/f300c244a1a1cf916df8b4cb02bec6c6.png" vwo-el-id="18272717540" data-lazy-loaded="1" data-original-src="https://files.readme.io/27c94e7-Image_2017-06-05_at_9.46.04_PM.png"/>
</a>
<a class="signup" href="https://lp.logrocket.com/blg/react-signup-general" target="_blank" rel="noopener noreferrer" vwo-el-id="19356441690">
<img class="second-react-image alignnone size-full wp-image-46 jetpack-lazy-image jetpack-lazy-image--handled" src="../Images/d6f5a5dd739296c1dd7aab3d5e77eeb9.png" alt="LogRocket Dashboard Free Trial Banner" vwo-el-id="30720362350" data-lazy-loaded="1" data-original-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png"/>
</a>
<a href="https://lp.logrocket.com/blg/react-signup-issue-free" target="_blank" rel="noopener noreferrer" vwo-el-id="35866400580">LogRocket
</a><p>è‡ªåŠ¨èšåˆå®¢æˆ·ç«¯é”™è¯¯ã€ååº”é”™è¯¯è¾¹ç•Œã€è¿˜åŸçŠ¶æ€ã€ç¼“æ…¢çš„ç»„ä»¶åŠ è½½æ—¶é—´ã€JSå¼‚å¸¸ã€å‰ç«¯æ€§èƒ½æŒ‡æ ‡å’Œç”¨æˆ·äº¤äº’ã€‚ç„¶åï¼ŒLogRocketä½¿ç”¨æœºå™¨å­¦ä¹ æ¥é€šçŸ¥æ‚¨å½±å“å¤§å¤šæ•°ç”¨æˆ·çš„æœ€å…·å½±å“åŠ›çš„é—®é¢˜ï¼Œå¹¶æä¾›æ‚¨ä¿®å¤å®ƒæ‰€éœ€çš„ä¸Šä¸‹æ–‡ã€‚</p><p vwo-el-id="28675661060">å…³æ³¨é‡è¦çš„React bugâ€”<a class="signup" href="https://lp.logrocket.com/blg/react-signup-issue-free" target="_blank" rel="noopener noreferrer" vwo-el-id="40093418840">ä»Šå¤©å°±è¯•è¯•LogRocketã€‘ã€‚</a></p>
</div></div>

<p class="clearfix"/>
<p class="clearfix"/>
</article>

</div>    
</body>
</html>