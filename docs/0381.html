<html>
<head>
<title>Creating a scalable GraphQL API with MySQL, Node.js, and Apollo - LogRocket Blog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>ç”¨MySQLã€Node.jså’ŒApollo - LogRocketåšå®¢åˆ›å»ºå¯ä¼¸ç¼©çš„GraphQL API</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://blog.logrocket.com/creating-scalable-graphql-api-mysql-apollo-node/#0001-01-01">https://blog.logrocket.com/creating-scalable-graphql-api-mysql-apollo-node/#0001-01-01</a></blockquote><div><article class="article-post">
<p><em> <strong>ç¼–è€…æŒ‰:</strong>æœ¬å¸–äº2021å¹´8æœˆæ›´æ–°ç›¸å…³ä¿¡æ¯å’Œæ›´æ–°ä»£ç ã€‚</em></p>
<p>å‡†å¤‡å¥½è·³åˆ°ä¸€ä¸ª<a href="https://blog.logrocket.com/intro-to-graphql-with-prisma/" target="_blank" rel="noopener noreferrer"> GraphQL </a> APIäº†å—ï¼Ÿå¦‚æœæ‚¨å·²ç»æœ‰äº†ä¸€ä¸ªMySQLæ•°æ®åº“ï¼Œé‚£ä¹ˆæ‚¨å°±æœ‰äº†ä¸€ä¸ªåˆ›å»ºå¯ä¼¸ç¼©APIçš„ç»ä½³èµ·ç‚¹ã€‚åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†ä»‹ç»å¦‚ä½•åŸºäºæ•°æ®åº“åˆ›å»ºæ¨¡å‹ï¼Œåˆ›å»ºä»æ•°æ®åº“è¯»å–æ•°æ®çš„èŠ‚ç‚¹GraphQL APIï¼Œå¹¶å­¦ä¹ å¦‚ä½•åœ¨ä¸åŒçš„è¡¨ä¹‹é—´å»ºç«‹å…³ç³»ã€‚</p>
<h2>åˆ›å»ºGraphQLç«¯ç‚¹</h2>
<p>åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†ä¸ºç¥¨åŠ¡ç³»ç»Ÿæ„å»ºä¸€ä¸ªå°çš„GraphQLç«¯ç‚¹ã€‚æˆ‘ä»¬å¸Œæœ›åˆ›å»ºä¸€ä¸ªç«¯ç‚¹ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬å¯ä»¥è¯»å–ç¥¨æ®å¹¶è·å–å®ƒä»¬çš„ç›¸å…³æ•°æ®ï¼Œæ¯”å¦‚ç”¨æˆ·ã€çŠ¶æ€å’Œä¼˜å…ˆçº§ã€‚</p>
<p>æˆ‘ä»¬å°†ä½¿ç”¨çš„æ„é€ å—æœ‰:</p>
<ul>
<li>(ç°æœ‰çš„)MySQLæ•°æ®åº“</li>
<li><a href="https://nodejs.org/en/" target="_blank" rel="noopener noreferrer"> Node.js </a></li>
<li><a href="https://expressjs.com/" target="_blank" rel="noopener noreferrer">Express</a>(node . jsçš„webæ¡†æ¶)</li>
<li><a href="https://www.apollographql.com/" target="_blank" rel="noopener noreferrer"> Apollo </a>(åˆ›å»ºGraphQLç«¯ç‚¹çš„å·¥å…·)</li>
<li><a href="http://docs.sequelizejs.com/" target="_blank" rel="noopener noreferrer">åºåˆ—åŒ–</a>(å¯¹è±¡å…³ç³»æ˜ å°„åŒ…)</li>
<li><a href="https://webpack.js.org/" target="_blank" rel="noopener noreferrer"> Webpack </a>(æ‰“åŒ…åº”ç”¨ç¨‹åº)</li>
<li><a href="https://www.docker.com/" target="_blank" rel="noopener noreferrer"> Docker </a>(æ—‹è½¬æœ¬åœ°MySQLæ•°æ®åº“ï¼›åªè¦æ‚¨æœ‰MySQLå®ä¾‹ï¼Œå®ƒå°±æ˜¯å¯é€‰çš„)</li>
</ul>
<p>å¦‚æœä½ ä¸çŸ¥é“æˆ‘åˆšæ‰æåˆ°çš„æ¯ä¸€éƒ¨åˆ†ï¼Œä¸è¦æ‹…å¿ƒï¼Œæˆ‘ä¼šæè¿°è¿™ä¸€è¿‡ç¨‹ä¸­çš„æ¯ä¸€æ­¥ã€‚å¦‚æœæ‚¨æƒ³ç»§ç»­ç¼–ç ï¼Œæ‚¨å¯ä»¥ç­¾å‡º<a href="https://github.com/DirkWolthuis/graphql-express-migrating-mysql" target="_blank" rel="noopener noreferrer">è¿™ä¸ªå­˜å‚¨åº“</a>,å¹¶ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å…‹éš†æ•™ç¨‹å‘å¸ƒçš„å¼€å§‹:</p>
<pre>git clone &lt;https://github.com/DirkWolthuis/graphql-express-migrating-mysql&gt; --branch start</pre>
<h2>æ„å»ºæ•°æ®åº“å±‚</h2>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬å°†å‡è®¾æˆ‘ä»¬æ­£åœ¨ä½¿ç”¨ä¸€ä¸ªç°æœ‰çš„æ•°æ®åº“ã€‚æˆ‘åˆ›å»ºäº†ä¸€ä¸ªSQLæ–‡ä»¶ï¼Œæ‚¨å¯ä»¥å°†å…¶å¯¼å…¥MySQLæ•°æ®åº“ã€‚æˆ‘å–œæ¬¢åœ¨ä¸€ä¸ª<a href="https://blog.logrocket.com/docker-for-front-end-developers/" target="_blank" rel="noopener noreferrer"> Docker </a>å®¹å™¨ä¸­è¿è¡Œæˆ‘çš„MySQLæ•°æ®åº“ã€‚æ‚¨å¯ä»¥ä½¿ç”¨<code>docker-compose.yaml</code>æ–‡ä»¶(åœ¨å­˜å‚¨åº“ä¸­)æ¥å¯åŠ¨MySQLå®¹å™¨ã€‚</p>
<p>è¯¥æ•°æ®åº“æœ‰å››ä¸ªè¡¨:ç¥¨æ®ã€ä¼˜å…ˆçº§ã€çŠ¶æ€å’Œç”¨æˆ·ã€‚è¿™äº›è¡¨æ ¼å…·æœ‰ä»¥ä¸‹ç»“æ„:</p>
<p>ç¥¨</p>
<pre><code>| Field               | Type             | Null | Key | Default           | Extra          |
+---------------------+------------------+------+-----+-------------------+----------------+
| id                  | int(11) unsigned | NO   | PRI | NULL              | auto_increment |
| subject             | varchar(256)     | NO   |     | NULL              |                |
| priority_id         | int(11)          | NO   |     | NULL              |                |
| status_id           | tinyint(4)       | NO   |     | NULL              |                |
| user_id             | int(11)          | NO   |     | NULL              |                |
| assigned_to_user_id | int(11)          | YES  |     | NULL              |                |
+---------------------+------------------+------+-----+-------------------+----------------+</code></pre>
<p>ç”¨æˆ·</p>
<pre><code>| Field | Type             | Null | Key | Default | Extra          |
+-------+------------------+------+-----+---------+----------------+
| id    | int(10) unsigned | NO   | PRI | NULL    | auto_increment |
| name  | varchar(256)     | NO   |     | NULL    |                |
| email | varchar(256)     | NO   |     | NULL    |                |
+-------+------------------+------+-----+---------+----------------+</code></pre>
<p>ä¼˜å…ˆ</p>
<pre><code>| Field | Type             | Null | Key | Default | Extra          |
+-------+------------------+------+-----+---------+----------------+
| id    | int(10) unsigned | NO   | PRI | NULL    | auto_increment |
| slug  | varchar(64)      | NO   |     | NULL    |                |
| name  | varchar(256)     | NO   |     | NULL    |                |
+-------+------------------+------+-----+---------+----------------+</code></pre>
<p>çŠ¶æ€</p>
<pre><code>| Field | Type             | Null | Key | Default | Extra          |
+-------+------------------+------+-----+---------+----------------+
| id    | int(10) unsigned | NO   | PRI | NULL    | auto_increment |
| slug  | varchar(64)      | NO   |     | NULL    |                |
| name  | varchar(256)     | NO   |     | NULL    |                |
+-------+------------------+------+-----+---------+----------------+</code></pre>
<p>ä½¿ç”¨ä¸Šé¢çš„å›¾è¡¨åˆ›å»ºè‡ªå·±çš„æ•°æ®åº“ï¼Œæˆ–è€…å°†SQLæ–‡ä»¶å¯¼å…¥MySQLæ•°æ®åº“ã€‚æˆ‘ä»¬å‡†å¤‡å¼€å§‹ç¼–ç ã€‚æ‚¨å¯ä»¥åœ¨ç›®å½•<code>tutorial_assets</code>ä¸­çš„å­˜å‚¨åº“å†…æ‰¾åˆ°SQLæ–‡ä»¶ã€‚</p>
<h2>å¼•å¯¼åº”ç”¨ç¨‹åº</h2>
<p>å¯¹äºæœ¬æ•™ç¨‹ï¼Œ<a href="https://webpack.js.org/" target="_blank" rel="noopener noreferrer"> webpack </a>è¢«è®¾ç½®ä¸ºç¼–è¯‘<code>dist</code>ç›®å½•ä¸­çš„<code>app.js</code>æ–‡ä»¶ã€‚å®ƒæ˜¯ä¸€ä¸ªåŸºæœ¬çš„Express Hello Worldåº”ç”¨ç¨‹åºã€‚å…‹éš†é¡¹ç›®åï¼Œæ‚¨éœ€è¦è¿è¡Œ<code>npm install</code>æ¥å®‰è£…ä¾èµ–é¡¹ã€‚</p>
<p>å®‰è£…å®Œæ¯•ï¼Ÿå¯ä»¥è¿è¡Œ<code>npm run start</code>æ¥å¯åŠ¨appã€‚å®ƒå°†ä½œä¸º<code><a href="http://localhost:5000" rel="nofollow">http://localhost:5000</a></code>ä¸Šçš„ç«¯ç‚¹ã€‚</p>
<p>è®©æˆ‘ä»¬å¼€å§‹æ„å»ºæˆ‘ä»¬çš„GraphQL APIå§ï¼</p>
<h2 id="creating-database-models-mysql">åœ¨MySQLä¸­åˆ›å»ºæ•°æ®åº“æ¨¡å‹</h2>
<p>å‡ ä¹æ¯ä¸ªæ¡†æ¶éƒ½ä½¿ç”¨æ¨¡å‹ä¸æ•°æ®åº“è¿›è¡Œäº¤äº’ã€‚ä¸ºäº†ä¸æˆ‘ä»¬çš„MySQLæ•°æ®åº“è¿›è¡Œäº¤äº’ï¼Œæˆ‘ä»¬ä½¿ç”¨<a href="http://docs.sequelizejs.com/" target="_blank" rel="noopener noreferrer"> Sequelize </a>ä½œä¸ºORM(å¯¹è±¡å…³ç³»æ˜ å°„)åŒ…ã€‚è®©æˆ‘ä»¬ä»æ·»åŠ åŒ…å¼€å§‹(<code>mysql2</code>åŒ…æ˜¯è¿æ¥MySQLæ•°æ®åº“æ‰€å¿…éœ€çš„),ä½¿ç”¨npm:</p>
<pre>npm install sequelize mysql2</pre>
<p>æˆ–è€…ç”¨çº±çº¿:</p>
<pre>yarn add sequelize mysql2</pre>
<p>ç°åœ¨æˆ‘ä»¬å¯ä»¥åšä¸¤ä»¶äº‹æƒ…ä¸­çš„ä¸€ä»¶:æˆ‘ä»¬å¯ä»¥æ‰‹å·¥åˆ›å»ºæ•°æ®åº“æ¨¡å‹ï¼Œæˆ–è€…ç”¨ä¸€ä¸ªé¢å¤–çš„åŒ…è‡ªåŠ¨ç”Ÿæˆå®ƒä»¬ã€‚å¯¹äºæœ¬æ•™ç¨‹ï¼Œæ‰‹åŠ¨åˆ›å»ºæ¨¡å‹ä¸æˆé—®é¢˜ï¼Œå› ä¸ºæˆ‘ä»¬çš„æ•°æ®åº“ä¸­åªæœ‰å››ä¸ªå°è¡¨ã€‚ä½†æ˜¯å½“æ‚¨æ­£åœ¨è¿ç§»ä¸€ä¸ªæ›´å¤§çš„æ•°æ®åº“æ—¶ï¼Œæ‚¨å¯èƒ½æƒ³è¦æ›´åŠ è‡ªåŠ¨åŒ–çš„ä¸œè¥¿ã€‚å¹¸è¿çš„æ˜¯ï¼Œæœ‰ä¸€ä¸ªåŸºäºç°æœ‰æ•°æ®åº“ç”Ÿæˆåºåˆ—æ•°æ®åº“æ–‡ä»¶çš„åŒ…ã€‚è¿™ä¸ªåŒ…è¢«å‘½åä¸º<a href="https://github.com/sequelize/sequelize-auto"> Sequelize-Auto </a>ï¼Œå¯ä»¥åœ¨å…¨çƒèŒƒå›´å†…å®‰è£…npm:</p>
<pre>npm install -g sequelize-auto MySQL</pre>
<p>è¿™æ˜¯çº±çº¿çš„å®‰è£…:</p>
<pre>yarn global add sequelize-auto MySQL</pre>
<p>ä¸ºäº†ä»¥æ›´åŠ è‡ªåŠ¨åŒ–çš„æ–¹å¼è¿ç§»æ•°æ®åº“ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>sequelize-auto</code>å‘½ä»¤ã€‚æˆ‘ä»¬éœ€è¦åœ¨å‘½ä»¤ä¸­æ’å…¥MySQLæ•°æ®åº“å‡­è¯æ¥ç”Ÿæˆæ¨¡å‹ã€‚å¦‚æœæ‚¨æ­£åœ¨ä½¿ç”¨æ­¥éª¤1ä¸­æä¾›çš„MySQL dumpï¼Œæˆ‘å·²ç»åˆ›å»ºäº†ä¸€ä¸ªæ‚¨éœ€è¦ä½¿ç”¨çš„config JSONæ–‡ä»¶ã€‚</p>
<p><code>sequelize-auto-settings.json</code>ä½äº<code>tutorial_assets</code>ç›®å½•ä¸­ã€‚å¦‚æœä½ åœ¨æœ¬æ•™ç¨‹ä¸­ä½¿ç”¨ä½ è‡ªå·±çš„æ•°æ®åº“ï¼ŒæŸ¥çœ‹Sequelize APIæ–‡æ¡£ä¸­çš„<a href="https://sequelize.readthedocs.io/en/latest/api/sequelize/">è®¾ç½®é¡µé¢</a>ï¼Œæ‰¾åˆ°ä½ éœ€è¦çš„è®¾ç½®ã€‚</p>
<pre>sequelize-auto -h &lt;host&gt; -d &lt;database&gt; -u &lt;user&gt; -x [password] -p [port]  --dialect [dialect] -c [/path/to/config] -o [/path/to/models]</pre>
<p>æ‰€ä»¥ï¼Œå¯¹æˆ‘æ¥è¯´:</p>
<pre>sequelize-auto -h localhost -d graphql-mysql-tutorial -u graphql -x 123456 -p 8006  --dialect mysql -c /Users/wolthuis/Documents/websites/tutorials/graphql-migrating-mysql/tutorial_assets/sequelize-auto-settings.json -o /Users/wolthuis/Documents/websites/tutorials/graphql-migrating-mysql/app/models</pre>
<p>æˆ‘ä»¬èµ°å§ï¼å››ä¸ªæ–‡ä»¶å‡ºç°åœ¨<code>app/models</code>ç›®å½•ä¸­ã€‚åœ¨æˆ‘ä»¬çš„æ–‡ä»¶ä¸­ï¼Œè®©æˆ‘ä»¬ä»å¯¼å…¥Sequelizeå’Œè®¾ç½®ä¸€äº›å˜é‡å¼€å§‹ã€‚</p>
<h2>å®ç°æ•°æ®åº“æ¨¡å‹</h2>
<p>æˆ‘ä»¬ç°åœ¨éœ€è¦å®ç°æ•°æ®åº“æ¨¡å‹ã€‚åœ¨appç›®å½•ä¸‹ï¼Œåˆ›å»ºä¸€ä¸ª<code>database.js file</code>ã€‚åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬å¯¼å…¥å¹¶å¯¼å‡ºæ•°æ®åº“æ¨¡å‹ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åœ¨åº”ç”¨ç¨‹åºä¸­çš„ä»»ä½•åœ°æ–¹ä½¿ç”¨å®ƒä»¬ã€‚</p>
<pre>import Sequelize from 'sequelize';

var db = {}

const sequelize = new Sequelize(
    'DATABASE_NAME',
    'DATABASE_USER',
    'DATABASE_PASSWORD',
    {
        host: 'DATABASE_HOST',
        port: 'DATABASE_PORT',
        dialect: 'mysql',
        define: {
            freezeTableName: true,
        },
        pool: {
            max: 5,
            min: 0,
            acquire: 30000,
            idle: 10000,
        },
        // &lt;http://docs.sequelizejs.com/manual/tutorial/querying.html#operators&gt;
        operatorsAliases: false,
    },
)

let models = []

// Initialize models
models.forEach(model =&gt; {
    const seqModel = model(sequelize, Sequelize)
    db[seqModel.name] = seqModel
})

// Apply associations
Object.keys(db).forEach(key =&gt; {
    if ('associate' in db[key]) {
        db[key].associate(db)
    }
})

db.sequelize = sequelize
db.Sequelize = Sequelize

export default db;</pre>
<p>ç°åœ¨æˆ‘ä»¬éœ€è¦å¡«å†™MySQLæ•°æ®åº“å‡­è¯å¹¶å¯¼å…¥æ–°åˆ›å»ºçš„æ¨¡å‹ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œæ‚¨ä¼šä½¿ç”¨ç¯å¢ƒå˜é‡æ¥å®‰å…¨åœ°ä¼ é€’æ•æ„Ÿæ•°æ®ï¼Œä½†æ˜¯å‡ºäºæ•™ç¨‹çš„ç›®çš„ï¼Œæˆ‘å°†åœ¨<code>database.js</code>æ–‡ä»¶ä¸­ç¡¬ç¼–ç ä¸€äº›å€¼ã€‚</p>
<p>å¯¼å…¥ä¸­å¸¦æœ‰å‡­è¯çš„<code>database.js</code>æ–‡ä»¶å¦‚ä¸‹æ‰€ç¤º:</p>
<pre>import Sequelize from 'sequelize';

var db = {}

const sequelize = new Sequelize('graphql-mysql-tutorial', 'graphql', '123456', {
    host: 'localhost',
    port: '8006',
    dialect: 'mysql',
    define: {
        freezeTableName: true,
    },
    pool: {
        max: 5,
        min: 0,
        acquire: 30000,
        idle: 10000,
    },
    // &lt;http://docs.sequelizejs.com/manual/tutorial/querying.html#operators&gt;
    operatorsAliases: false,
})

let models = [
    require('./models/priorities.js'),
    require('./models/status.js'),
    require('./models/tickets.js'),
    require('./models/users.js'),
]

// Initialize models
models.forEach(model =&gt; {
    const seqModel = model(sequelize, Sequelize)
    db[seqModel.name] = seqModel
})

// Apply associations
Object.keys(db).forEach(key =&gt; {
    if ('associate' in db[key]) {
        db[key].associate(db)
    }
})

db.sequelize = sequelize
db.Sequelize = Sequelize

export default db;</pre>
<p>å¤ªå¥½äº†ï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥åœ¨åº”ç”¨ç¨‹åºçš„ä»»ä½•åœ°æ–¹å¯¼å…¥<code>db</code>å˜é‡ï¼Œå¹¶è®¿é—®æˆ‘ä»¬æ‰€æœ‰çš„æ¨¡å‹ã€‚åœ¨æ¥ä¸‹æ¥çš„æ­¥éª¤ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨è¯¥å˜é‡æ¥è®¿é—®æˆ‘ä»¬çš„æ•°æ®ã€‚</p>
<h2>è®¾ç½®é˜¿æ³¢ç½—æœåŠ¡å™¨</h2>
<p>Apolloæ˜¯ä¸€å®¶ä¸ºGraphQLç”Ÿæ€ç³»ç»Ÿæä¾›è®¸å¤šæœåŠ¡å’Œå¼€å‘å·¥å…·çš„å…¬å¸ã€‚å®ƒå¸®åŠ©å¼€å‘äººå‘˜ä½¿ç”¨è®¸å¤šåŒ…(å¦‚Apollo Federationã€Apollo Clientå’ŒApollo Server)æ„å»ºå¿«é€Ÿå¯é çš„GraphQLæœåŠ¡ã€‚</p>
<p>Apollo Serveræ˜¯ä¸€ä¸ªç¬¦åˆè§„èŒƒçš„ã€å¯ç”¨äºç”Ÿäº§çš„JavaScript GraphQLæœåŠ¡å™¨ï¼Œå®ƒæœ‰åŠ©äºä½¿ç”¨è®¸å¤šNode.jsæ¡†æ¶åˆ›å»ºGraphQL APIsã€‚è¿™æ˜¯ä¸€ä¸ªç®€å•ä½†åŠŸèƒ½å¼ºå¤§çš„åŒ…ï¼Œæ˜“äºå®ç°ï¼Œæ˜“äºä½¿ç”¨ï¼Œå¹¶ä¸”å¯ä»¥æŠ•å…¥ç”Ÿäº§ã€‚</p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦æ·»åŠ ä¸¤ä¸ªåŒ…:</p>
<pre>npm install apollo-server-express graphql</pre>
<p>æˆ–è€…ç”¨çº±çº¿:</p>
<pre>yarn add apollo-server-express graphql</pre>
<p>å®‰è£…åï¼Œæˆ‘ä»¬éœ€è¦åœ¨<code>app.js</code>å†…éƒ¨åšä¸€äº›è®¾ç½®æ¥è€¦åˆApolloå’ŒExpressã€‚æˆ‘ä»¬ä»å¯¼å…¥<code>ApolloServer</code>å¼€å§‹:</p>
<pre>import { ApolloServer } from 'apollo-server-express';</pre>
<p>ç„¶åï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–°çš„ApolloæœåŠ¡å™¨å®ä¾‹:</p>
<pre>const server = new ApolloServer({
        modules: []
})</pre>
<p>æœ€åä¸€æ­¥æ˜¯åœ¨ç°æœ‰çš„Expressåº”ç”¨ç¨‹åºä¸Šåº”ç”¨ApolloæœåŠ¡å™¨ä½œä¸ºä¸­é—´ä»¶:</p>
<pre>server.applyMiddleware({ app })</pre>
<p>æˆ‘ä»¬è¿˜ä¸èƒ½å¯åŠ¨æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºï¼Œå› ä¸ºæ²¡æœ‰ä»»ä½•æ¨¡å—ï¼Œé˜¿æ³¢ç½—æœåŠ¡å™¨å°†æŠ›å‡ºä¸€ä¸ªé”™è¯¯ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å°†æŠŠæˆ‘ä»¬çš„æ•°æ®åº“å®ä½“å®ç°åˆ°ä¸€ä¸ªGraphQLç«¯ç‚¹ä¸­ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ç”¨GraphQLæŸ¥è¯¢æ¥è®¿é—®å®ƒä»¬ã€‚</p>
<h2>åˆ›å»ºæˆ‘ä»¬çš„GraphQLç±»å‹å’Œè§£æå™¨</h2>
<p>åœ¨GraphQLä¸­ï¼Œéœ€è¦ç±»å‹å’Œè§£æå™¨ã€‚ç±»å‹æè¿°äº†å¯ä»¥é€šè¿‡GraphQLç«¯ç‚¹è·å–æˆ–å†™å…¥çš„æ•°æ®ã€‚è§£æå™¨æ˜¯è§£æç”¨æˆ·è¯·æ±‚çš„é€»è¾‘ã€‚</p>
<p>åœ¨GraphQLç›®å½•ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªæ–°æ–‡ä»¶<code>tickets.js</code>ã€‚åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬å°†åŒ…å«ä¸€ä¸ªæ¥è‡ª<code>apollo-server-express</code>åŒ…çš„å˜é‡ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨å®ƒæ¥åˆ›å»ºGraphQLç±»å‹å®šä¹‰ï¼ŒåŒ…æ‹¬æˆ‘ä»¬çš„<code>db</code>å˜é‡å’Œä¸¤ä¸ªç”¨äºç±»å‹GraphQLå®šä¹‰å’ŒGraphQLè§£æå™¨çš„ç©ºå¯¹è±¡ã€‚</p>
<pre>import { gql } from 'apollo-server-express'
import * as db from '../database'

export const typeDefs = gql`
   
`
export const resolvers = {
}</pre>
<h2>åˆ›å»ºGraphQLç±»å‹</h2>
<p>é¦–å…ˆæˆ‘ä»¬å¡«å……<code>typeDefs</code>å˜é‡ã€‚ä½ å¯ä»¥çœ‹åˆ°æˆ‘ä»¬æ­£åœ¨ä½¿ç”¨æ¥è‡ª<code>apollo-server-express</code>åŒ…çš„<code>gql</code>å˜é‡ã€‚<code>gql</code>å˜é‡è®©æˆ‘ä»¬ç¼–å†™åŒ…å¯è¯»çš„ç±»å‹å®šä¹‰ã€‚</p><div class="code-block code-block-54">
<hr/>
<h3>æ›´å¤šæ¥è‡ªLogRocketçš„ç²¾å½©æ–‡ç« :</h3>

<hr/></div>
<p>åœ¨<code>typeDefs</code>å˜é‡ä¸­ï¼Œæˆ‘ä»¬éœ€è¦æ‰©å±•æŸ¥è¯¢ç±»å‹å¹¶åˆ›å»ºä¸€ä¸ªåä¸º<code>Ticket</code>çš„æ–°ç±»å‹ã€‚æˆ‘ä»¬éœ€è¦æ‰©å±•<code>Query</code>ç±»å‹çš„åŸå› æ˜¯å› ä¸ºGraphQLæ€»æ˜¯ä½¿ç”¨åä¸º<code>Query</code>çš„é¡¶çº§ç±»å‹ã€‚åœ¨è¯¥ç±»å‹ä¸­åµŒå¥—äº†å…¶ä»–ç±»å‹ï¼Œè¿™å°±æ˜¯GraphQLå¦‚ä½•çŸ¥é“åœ¨æ‚¨çš„GraphQL APIä¸­å¯ç”¨çš„ç±»å‹ã€‚</p>
<p>è®©æˆ‘ä»¬æ‰©å±•ä¸€ä¸‹<code>Query</code>ç±»å‹:</p>
<pre>export const typeDefs = gql`
    extend type Query {
        tickets: [Ticket]
        ticket(id: ID!): Ticket
    }
    type Ticket {
       
    }
`</pre>
<p>æ­£å¦‚æ‚¨æ‰€çœ‹åˆ°çš„ï¼Œæˆ‘ä»¬è®©GraphQLçŸ¥é“æˆ‘ä»¬æƒ³è¦ç”¨ä¸¤ä¸ªæ–°å®ä½“æ¥æ‰©å±•<code>Query</code>:<code>ticket</code>å’Œ<code>tickets</code>ã€‚</p>
<p><code>Tickets</code>è¿”å›ä¸€ä¸ªæ•°ç»„<code>tickets</code>:</p>
<pre>tickets: [Ticket]</pre>
<p><code>Ticket</code>è¿”å›å•ç±»å‹çš„<code>Ticket</code>ã€‚ç¥¨ç±»å‹ä¼šæ”¶åˆ°ä¸€ä¸ªåä¸º<code>id</code>ã€<code>of type ID</code>çš„å‚æ•°ï¼Œå¹¶ä¸”ä¸èƒ½ä¸ºç©º(æ‰€ä»¥æ¢å¥è¯è¯´ï¼Œå‚æ•°æ˜¯å¿…éœ€çš„)ã€‚GraphQLç±»å‹ä¸­çš„æ„Ÿå¹å·è¡¨ç¤ºå€¼ä¸èƒ½ä¸ºç©º:</p>
<pre>ticket(id: ID!): Ticket</pre>
<p>ç°åœ¨æˆ‘ä»¬çš„<code>Ticket</code>ç±»å‹æ˜¯ç©ºçš„ï¼Œæ‰€ä»¥è®©æˆ‘ä»¬å¡«å……è¿™ä¸ªç±»å‹:</p>
<pre>export const typeDefs = gql`
    extend type Query {
        tickets: [Ticket]
        ticket(id: ID!): Ticket
    }
    type Ticket {
        id: ID!
        subject: String
        priority_id: Int
        status_id: Int
        user_id: Int
        assigned_to_user_id: Int
    }
`</pre>
<p>è¿™é‡Œï¼Œæˆ‘ä»¬æè¿°äº†ç¥¨è¯ç±»å‹ç”±å“ªäº›ç±»å‹ç»„æˆã€‚å®ƒä¸æˆ‘ä»¬çš„æ•°æ®åº“æ¨¡å‹100%åŒ¹é…ã€‚è¿™å¯¹äºç°åœ¨æ¥è¯´æ˜¯æ­£ç¡®çš„ï¼Œä½†æ˜¯å°†æ¥å½“æˆ‘ä»¬è¦åœ¨æˆ‘ä»¬çš„ç±»å‹/æ¨¡å‹ä¹‹é—´æ·»åŠ å…³ç³»æ—¶ï¼Œè¿™ç§æƒ…å†µå°†ä¼šæ”¹å˜ã€‚</p>
<h2>åˆ›å»ºGraphQLè§£æå™¨</h2>
<p>ç°åœ¨æˆ‘ä»¬å·²ç»åˆ›å»ºäº†æˆ‘ä»¬çš„<code>Ticket</code>å®ä½“ï¼Œè®©æˆ‘ä»¬åˆ›å»ºæˆ‘ä»¬çš„è§£æå™¨ã€‚è§£æå™¨éœ€è¦æˆ–å¤šæˆ–å°‘åœ°åæ˜ æˆ‘ä»¬çš„ç±»å‹ã€‚åœ¨resolverå¯¹è±¡å†…éƒ¨ï¼Œæˆ‘ä»¬ä¹Ÿä»ä¸€ä¸ªé¡¶çº§çš„<code>Query</code>å¯¹è±¡å¼€å§‹ã€‚</p>
<pre>export const resolvers = {
    Query: {},
}</pre>
<p>åœ¨<code>Query</code>ç±»å‹ä¸­ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸¤ç§ç¥¨ç±»å‹:<code>ticket</code>å’Œ<code>tickets</code>ã€‚æˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬çš„<code>db</code>(æ•°æ®åº“)å˜é‡æ¥è§£ææ•°æ®åº“ä¸­çš„æ•°æ®ã€‚</p>
<pre>export const resolvers = {
    Query: {
        tickets: async () =&gt; db.tickets.findAll(),
        ticket: async (obj, args, context, info) =&gt;
            db.tickets.findByPk(args.id),
    },
}</pre>
<p>è§£æå™¨æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å®ƒä»¬æ¥è§£æåˆ é™¤è¯·æ±‚ã€‚<code>obj</code>æ˜¯æ ¹å¯¹è±¡ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨è¿™ä¸ªæ ¹å¯¹è±¡æ¥å»ºç«‹å…³ç³»ã€‚<code>args</code>æ˜¯æˆ‘ä»¬åœ¨ç±»å‹ä¸­å®šä¹‰çš„å‡½æ•°å‚æ•°ã€‚</p>
<p>å¯¹äºæˆ‘ä»¬çš„<code>tickets</code>æŸ¥è¯¢ï¼Œæˆ‘ä»¬å°†æ¥æ”¶ä¸€ä¸ª<code>id</code>ä½œä¸ºå‚æ•°ï¼Œå¹¶å°†å…¶ä¼ é€’ç»™æˆ‘ä»¬çš„<code>findByPk</code>å‡½æ•°ä»¥è·å–ä¸€ä¸ªç‰¹å®šçš„<code>Ticket</code>ã€‚å¦‚æœä½ æƒ³äº†è§£æ›´å¤šå…³äº<code>obj</code>ã€<code>args</code>ã€<code>context</code>å’Œ<code>info</code>çš„ä¿¡æ¯ï¼Œè¯·æŸ¥é˜…<a href="https://www.apollographql.com/docs/graphql-tools/resolvers/" target="_blank" rel="noopener noreferrer">é˜¿æ³¢ç½—æ–‡æ¡£</a>ã€‚</p>
<h2>å°†ç¥¨åŠ¡æ¨¡å—æ·»åŠ åˆ°æˆ‘ä»¬çš„é˜¿æ³¢ç½—æœåŠ¡å™¨</h2>
<p>æˆ‘ä»¬å·²ç»åˆ›å»ºäº†ä¸€ä¸ªæ¨¡å—ï¼Œç°åœ¨æˆ‘ä»¬åªéœ€è¦å°†å®ƒå¯¼å…¥åˆ°æˆ‘ä»¬çš„åº”ç”¨ç¨‹åº<code>app.js</code>ä¸­ã€‚ä¸ºæ­¤ï¼Œè¯·æ·»åŠ æ¨¡å—:</p>
<pre>const server = new ApolloServer({
    modules: [require('./GraphQL/tickets')],
})</pre>
<p>ç°åœ¨å¯¹ä¼˜å…ˆçº§ã€ç”¨æˆ·å’ŒçŠ¶æ€è¿›è¡ŒåŒæ ·çš„æ“ä½œï¼Œå¹¶å¯¼å…¥è¿™äº›æ¨¡å—:</p>
<pre>const server = new ApolloServer({
    modules: [
        require('./GraphQL/tickets'),
        require('./GraphQL/status'),
        require('./GraphQL/users'),
        require('./GraphQL/priorities'),
    ],
})</pre>
<p>å†æ¬¡å¯åŠ¨åº”ç”¨ç¨‹åºåï¼Œè¿›å…¥<a href="http://localhost:5000/graphql" target="_blank" rel="noopener noreferrer"> localhost:5000/graphql </a>ï¼Œä½ å°†è¿›å…¥Apollo GraphQLæŸ¥è¯¢æ„å»ºå™¨ç¯å¢ƒã€‚åœ¨è¿™ä¸ªç¯å¢ƒä¸­ï¼Œæ‚¨å¯ä»¥æµ‹è¯•æ‚¨çš„APIå¹¶åˆ›å»ºæŸ¥è¯¢ï¼Œç¨åæ‚¨å°†åœ¨å…¶ä»–åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨è¿™äº›æŸ¥è¯¢ã€‚</p>
<p>æ­¤å¤–ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å³ä¾§çš„docsæŒ‰é’®æ¥æµè§ˆæ‚¨çš„APIã€‚å› ä¸ºGraphQLæ˜¯ç±»å‹åŒ–çš„ï¼Œæ‰€ä»¥æ‚¨è‡ªåŠ¨æ‹¥æœ‰APIæ–‡æ¡£ã€‚ç›¸å½“é…·ï¼</p>
<p><img data-attachment-id="4034" data-permalink="https://blog.logrocket.com/creating-scalable-graphql-api-mysql-apollo-node/scherma/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2019/07/scherma.png" data-orig-size="730,463" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="scherma" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2019/07/scherma-300x190.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2019/07/scherma.png" decoding="async" class="aligncenter wp-image-4034 size-full jetpack-lazy-image" src="../Images/1c610494ad01a5060b19e4b9bf7c7042.png" alt="" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2019/07/scherma.png 730w, https://blog.logrocket.com/wp-content/uploads/2019/07/scherma-300x190.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2019/07/scherma.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/07/scherma.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="4034" data-permalink="https://blog.logrocket.com/creating-scalable-graphql-api-mysql-apollo-node/scherma/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2019/07/scherma.png" data-orig-size="730,463" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="scherma" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2019/07/scherma-300x190.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2019/07/scherma.png" decoding="async" loading="lazy" class="aligncenter wp-image-4034 size-full" src="../Images/1c610494ad01a5060b19e4b9bf7c7042.png" alt="" srcset="https://blog.logrocket.com/wp-content/uploads/2019/07/scherma.png 730w, https://blog.logrocket.com/wp-content/uploads/2019/07/scherma-300x190.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/07/scherma.png"/></noscript>
<h2>åˆ›å»ºæ•°æ®ä¹‹é—´çš„å…³ç³»</h2>
<p>åœ¨è·å–ç‰¹å®šçš„<code>Ticket</code>æ—¶è‡ªåŠ¨è·å–ç”¨æˆ·åå°±å¥½äº†ã€‚å¯¹äºè¿™ä¸€æ­¥ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ª<code>Ticket</code>å’Œä¸€ä¸ªç”¨æˆ·ä¹‹é—´çš„å…³ç³»ã€‚</p>
<h2>åœ¨GraphQLä¸­çš„ç¥¨æ®ç±»å‹ä¸Šæ·»åŠ ç”¨æˆ·ç±»å‹</h2>
<p>å› æ­¤ï¼Œé¦–å…ˆè®©æˆ‘ä»¬ç¼–è¾‘ç¥¨è¯ç±»å‹ã€‚æˆ‘ä»¬éœ€è¦è®©GraphQLçŸ¥é“æˆ‘ä»¬æƒ³è¦è¯·æ±‚ä¸€ä¸ªuserç±»å‹çš„ç”¨æˆ·:</p>
<pre>export const typeDefs = gql`
    extend type Query {
        tickets: [Ticket]
        ticket(id: ID!): Ticket
    }
    type Ticket {
        id: ID!
        subject: String
        priority_id: Int
        status_id: Int
        user_id: Int
        user: User
        assigned_to_user_id: Int
    }
`</pre>
<h2>åœ¨GraphQLä¸­ä¸ºç”¨æˆ·æ·»åŠ é¢å¤–çš„è§£æå™¨</h2>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦æ·»åŠ ä¸€ä¸ªåµŒå¥—çš„è§£æå™¨æ¥è§£æç¥¨æ®ä¸­çš„ç”¨æˆ·ã€‚åœ¨resolverå¯¹è±¡ä¸­ï¼Œæˆ‘ä»¬å°†æ·»åŠ é”®<code>Ticket</code>ã€‚è¿™å°±æ˜¯å½“æˆ‘ä»¬åœ¨ä¸€ä¸ªç±»å‹ä¸­è¯·æ±‚å¦ä¸€ä¸ªç±»å‹æ—¶ï¼ŒGraphQLçŸ¥é“å¦‚ä½•è§£æåµŒå¥—æŸ¥è¯¢çš„åŸå› ã€‚</p>
<p>åœ¨æœ¬ä¾‹ä¸­ï¼Œè§£æå™¨æ˜¯ç¥¨æ®ç±»å‹ä¸­çš„<code>User</code>ç±»å‹:</p>
<pre>export const resolvers = {
    Query: {
        tickets: async () =&gt; db.tickets.findAll(),
        ticket: async (obj, args, context, info) =&gt;
            db.tickets.findByPk(args.id),
    },
    Ticket: {
        user: async (obj, args, context, info) =&gt; db.users.findByPk(obj.user_id),
    },
}</pre>
<p>æ‚¨å¯ä»¥çœ‹åˆ°æˆ‘ä»¬æ­£åœ¨ä½¿ç”¨<code>obj</code>æ¥è®¿é—®ç¥¨è¯æ•°æ®ã€‚åœ¨ç¥¨è¯æ•°æ®ä¸­è®¾ç½®äº†<code>user_id</code>,å› æ­¤æˆ‘ä»¬å¯ä»¥ä»æ•°æ®åº“ä¸­è·å¾—æ­£ç¡®çš„ç”¨æˆ·ã€‚</p>
<p>æ‰€ä»¥è®©æˆ‘ä»¬çœ‹çœ‹æˆ‘ä»¬çš„ä»£ç æ˜¯å¦æœ‰æ•ˆã€‚æˆ‘åˆ›å»ºäº†è¿™ä¸ªæŸ¥è¯¢ï¼Œçœ‹çœ‹èƒ½å¦è·å¾—åµŒå¥—çš„ç”¨æˆ·æ•°æ®ã€‚æ³¨æ„ï¼Œæ‚¨è¿˜éœ€è¦ä»ç”¨æˆ·ç±»å‹ä¸­æŒ‡å®šæ‚¨æƒ³è¦çš„å­—æ®µï¼Œåœ¨æˆ‘çš„ä¾‹å­ä¸­æ˜¯<code>id</code>ã€<code>name</code>å’Œ<code>email</code>å­—æ®µã€‚</p>
<pre>{
  ticket(id: 3){
    id
    subject
    user{
      id
      name
      email
    }
  }
}</pre>
<p>å¤ªå¥½äº†ï¼ŒæˆåŠŸäº†ï¼è¿™æ˜¯é˜¿æ³¢ç½—çš„å›æŠ¥:</p>
<p><img data-attachment-id="65011" data-permalink="https://blog.logrocket.com/creating-scalable-graphql-api-mysql-apollo-node/graphqlexample-2/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2019/07/graphqlexample-1.png" data-orig-size="730,463" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="graphql-mysql-apollo-api-endpoint" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2019/07/graphqlexample-1-300x190.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2019/07/graphqlexample-1.png" decoding="async" class="aligncenter wp-image-65011 size-full jetpack-lazy-image" src="../Images/522bfa87e5d22338d0ff590b4129568d.png" alt="" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2019/07/graphqlexample-1.png 730w, https://blog.logrocket.com/wp-content/uploads/2019/07/graphqlexample-1-300x190.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2019/07/graphqlexample-1.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/07/graphqlexample-1.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="65011" data-permalink="https://blog.logrocket.com/creating-scalable-graphql-api-mysql-apollo-node/graphqlexample-2/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2019/07/graphqlexample-1.png" data-orig-size="730,463" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="graphql-mysql-apollo-api-endpoint" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2019/07/graphqlexample-1-300x190.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2019/07/graphqlexample-1.png" decoding="async" loading="lazy" class="aligncenter wp-image-65011 size-full" src="../Images/522bfa87e5d22338d0ff590b4129568d.png" alt="" srcset="https://blog.logrocket.com/wp-content/uploads/2019/07/graphqlexample-1.png 730w, https://blog.logrocket.com/wp-content/uploads/2019/07/graphqlexample-1-300x190.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/07/graphqlexample-1.png"/></noscript>
<p>ç°åœ¨ä»¥åŒæ ·çš„æ–¹å¼æ·»åŠ å…¶ä»–å…³ç³»:<code>priority</code>ã€<code>status</code>å’Œ<code>assigned_to_user</code>ã€‚åœ¨æ·»åŠ å®Œå¦ä¸€ä¸ªåµŒå¥—è§£æå™¨ä¹‹åï¼Œæ‚¨çš„<code>tickets.js</code>æ–‡ä»¶çœ‹èµ·æ¥ä¼šåƒè¿™æ ·:</p>
<pre>import { gql } from 'apollo-server-express'
import * as db from '../database'
export const typeDefs = gql`
    extend type Query {
        tickets: [Ticket]
        ticket(id: ID!): Ticket
    }
    type Ticket {
        id: ID!
        subject: String
        priority_id: Int
        priority: Priority
        status_id: Int
        status: Status
        user_id: Int
        user: User
        assigned_to_user_id: Int
        assigned_to_user: User
    }
`
export const resolvers = {
    Query: {
        tickets: async () =&gt; db.tickets.findAll(),
        ticket: async (obj, args, context, info) =&gt;
            db.tickets.findByPk(args.id),
    },
    Ticket: {
        user: async (obj, args, context, info) =&gt;
            db.users.findByPk(obj.user_id),
        priority: async (obj, args, context, info) =&gt;
            db.priorities.findByPk(obj.priority_id),
        status: async (obj, args, context, info) =&gt;
            db.status.findByPk(obj.status_id),
        assigned_to_user: async (obj, args, context, info) =&gt;
            db.users.findByPk(obj.assigned_to_user_id),
    },
}</pre>
<p>è½¬åˆ°<code>localhost:5000/graphql</code>å¹¶æ„å»ºä¸€ä¸ªæŸ¥è¯¢ï¼Œè·å–æ‰€æœ‰ç¥¨æ®åŠå…¶çŠ¶æ€ã€ä¼˜å…ˆçº§å’Œç”¨æˆ·ã€‚ä½¿ç”¨æ­¤æŸ¥è¯¢:</p>
<pre>{
  tickets{
    subject
    status{
      slug
    }
    priority{
      slug
    }
    user{
      name
    }
    assigned_to_user{
      name
    }
  }
}</pre>
<p>æˆ‘è·å¾—äº†ä»¥ä¸‹ç¥¨è¯åŠå…¶å±æ€§:</p>
<pre>{
  "data": {
    "tickets": [
      {
        "subject": "My computer is on fireğŸ”¥ğŸ”¥",
        "status": {
          "slug": "open"
        },
        "priority": {
          "slug": "high"
        },
        "user": {
          "name": "Dirk Wolthuis"
        },
        "assigned_to_user": null
      },
      {
        "subject": "MS Word is not starting, can someone help?",
        "status": {
          "slug": "doing"
        },
        "priority": {
          "slug": "low"
        },
        "user": {
          "name": "Chris Vogt"
        },
        "assigned_to_user": {
          "name": "Dirk Wolthuis"
        }
      },
      {
        "subject": "There is a bug in the ğŸ›’ of the webshop, steps to reproduce are included",
        "status": {
          "slug": "doing"
        },
        "priority": {
          "slug": "high"
        },
        "user": {
          "name": "Andrew Clark"
        },
        "assigned_to_user": {
          "name": "Dirk Wolthuis"
        }
      },
      {
        "subject": "404 error: website not found - website down?ğŸ’€",
        "status": {
          "slug": "closed"
        },
        "priority": {
          "slug": "high"
        },
        "user": {
          "name": "Andrew Clark"
        },
        "assigned_to_user": {
          "name": "Dirk Wolthuis"
        }
      }
    ]
  }
}</pre>
<h2>ç»“è®º</h2>
<p>æˆ‘ä»¬å·²ç»åˆ›å»ºäº†ä¸€ä¸ªå¯ç”¨çš„GraphQL APIï¼Œæ‚¨å¯ä»¥æŒ‰ç…§è‡ªå·±æƒ³è¦çš„æ–¹å¼å®šåˆ¶å®ƒã€‚æ‚¨å¯ä»¥åœ¨å®ä½“ä¹‹é—´æ·»åŠ å¤šå±‚å…³ç³»ã€‚è€Œä¸”ï¼Œåœ¨åˆ›å»ºæ–°çš„æ•°æ®åº“è¡¨ä¹‹åï¼Œæ‚¨å¯ä»¥è½»æ¾åœ°ä¸ºæ‚¨çš„åº”ç”¨ç¨‹åºåˆ›å»ºæ‰€éœ€çš„åºåˆ—æ¨¡å‹ã€‚</p>
<p>å‡ºäºæœ¬æ•™ç¨‹çš„ç›®çš„ï¼Œæˆ‘ä»¬å·²ç»åˆ›å»ºäº†ä¸€ä¸ªåªè¯»æ•°æ®åº“ã€‚åªæ˜¯æƒ³çœ‹çœ‹ä»£ç ï¼Ÿä½ å¯ä»¥åœ¨è¿™ä¸ªåº“ä¸­æ‰¾åˆ°å®ƒã€‚å¦‚æœä½ æƒ³äº†è§£æ›´å¤šå…³äºå¦‚ä½•æ“ä½œæ•°æ®åº“ä¸­çš„æ•°æ®ï¼Œä½ å¯ä»¥æŸ¥çœ‹<a href="https://www.apollographql.com/docs/apollo-server/essentials/schema/#designing-mutations" target="_blank" rel="noopener noreferrer">è®¾è®¡çªå˜</a>æˆ–è€…é˜…è¯»<a href="https://www.howtographql.com/graphql-js/3-a-simple-mutation/" target="_blank" rel="noopener noreferrer">è¿™ç¯‡å…³äºçªå˜çš„æ–‡ç« </a>ã€‚æœåŠ¡å™¨çš„è®¾ç½®ç•¥æœ‰ä¸åŒï¼Œä½†é€»è¾‘æ˜¯ç›¸åŒçš„ã€‚</p><div class="code-block code-block-24">
<div class="blog-plug inline-plug graphql-plug"><h2>ç›‘æ§ç”Ÿäº§ä¸­å¤±è´¥å’Œç¼“æ…¢çš„GraphQLè¯·æ±‚</h2><p>è™½ç„¶GraphQLæœ‰ä¸€äº›è°ƒè¯•è¯·æ±‚å’Œå“åº”çš„ç‰¹æ€§ï¼Œä½†ç¡®ä¿GraphQLå¯é åœ°ä¸ºæ‚¨çš„ç”Ÿäº§åº”ç”¨ç¨‹åºæä¾›èµ„æºæ˜¯ä¸€ä»¶æ¯”è¾ƒå›°éš¾çš„äº‹æƒ…ã€‚å¦‚æœæ‚¨å¯¹ç¡®ä¿å¯¹åç«¯æˆ–ç¬¬ä¸‰æ–¹æœåŠ¡çš„ç½‘ç»œè¯·æ±‚æˆåŠŸæ„Ÿå…´è¶£ï¼Œ</p><a href="https://lp.logrocket.com/blg/graphql-signup" target="_blank">try LogRocket</a><p>.</p><a class="signup" href="https://lp.logrocket.com/blg/graphql-signup" target="_blank" rel="noopener noreferrer"><img src="../Images/432a3823c85b3fb72a206e6236a29f48.png" data-lazy-src="https://files.readme.io/69aa835-Image_2019-11-09_at_1.28.05_PM.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" class=" jetpack-lazy-image" data-original-src="https://files.readme.io/69aa835-Image_2019-11-09_at_1.28.05_PM.png"/><noscript><img data-lazy-fallback="1" src="../Images/432a3823c85b3fb72a206e6236a29f48.png" data-original-src="https://files.readme.io/69aa835-Image_2019-11-09_at_1.28.05_PM.png"/></noscript><img class="alignnone size-full wp-image-46 jetpack-lazy-image" src="../Images/d6f5a5dd739296c1dd7aab3d5e77eeb9.png" alt="LogRocket Dashboard Free Trial Banner" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png"/><noscript><img data-lazy-fallback="1" class="alignnone size-full wp-image-46" src="../Images/d6f5a5dd739296c1dd7aab3d5e77eeb9.png" alt="LogRocket Dashboard Free Trial Banner" data-original-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png"/></noscript></a><a href="https://lp.logrocket.com/blg/graphql-signup" target="_blank" rel="noopener noreferrer">https://logrocket.com/signup/</a><p>LogRocket å°±åƒæ˜¯ç½‘ç»œå’Œç§»åŠ¨åº”ç”¨çš„DVRï¼Œè®°å½•ä¸‹ä½ ç½‘ç«™ä¸Šå‘ç”Ÿçš„æ¯ä¸€ä»¶äº‹ã€‚æ‚¨å¯ä»¥æ±‡æ€»å¹¶æŠ¥å‘Šæœ‰é—®é¢˜çš„GraphQLè¯·æ±‚ï¼Œä»¥å¿«é€Ÿäº†è§£æ ¹æœ¬åŸå› ï¼Œè€Œä¸æ˜¯çŒœæµ‹é—®é¢˜å‘ç”Ÿçš„åŸå› ã€‚æ­¤å¤–ï¼Œæ‚¨å¯ä»¥è·Ÿè¸ªApolloå®¢æˆ·æœºçŠ¶æ€å¹¶æ£€æŸ¥GraphQLæŸ¥è¯¢çš„é”®å€¼å¯¹ã€‚</p><p>LogRocketæ£€æµ‹æ‚¨çš„åº”ç”¨ç¨‹åºä»¥è®°å½•åŸºçº¿æ€§èƒ½è®¡æ—¶ï¼Œå¦‚é¡µé¢åŠ è½½æ—¶é—´ã€åˆ°è¾¾ç¬¬ä¸€ä¸ªå­—èŠ‚çš„æ—¶é—´ã€æ…¢é€Ÿç½‘ç»œè¯·æ±‚ï¼Œè¿˜è®°å½•Reduxã€NgRxå’ŒVuexæ“ä½œ/çŠ¶æ€ã€‚</p><a class="signup" href="https://lp.logrocket.com/blg/graphql-signup" target="_blank" rel="noopener noreferrer">Start monitoring for free</a><p>.</p></div>


</div>

<p class="clearfix"/>
<p class="clearfix"/>
</article>

</div>    
</body>
</html>