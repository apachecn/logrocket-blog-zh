# ä½ è¿‡åº¦ä½¿ç”¨äº†ä½¿ç”¨å¤‡å¿˜å½•:é‡æ–°æ€è€ƒé’©å­çš„è®°å¿†åŒ–

> åŸæ–‡ï¼š<https://blog.logrocket.com/rethinking-hooks-memoization/>

æ ¹æ®æˆ‘çš„ç»éªŒï¼Œæˆ‘å‘ç°`useMemo`ä¸»è¦æœ‰ä¸¤ç±»æ˜¯ä¸ç›¸å…³çš„ã€è¢«è¿‡åº¦ä½¿ç”¨çš„ï¼Œå¹¶ä¸”å¯èƒ½å¯¹ä½ çš„åº”ç”¨ç¨‹åºçš„æ€§èƒ½æœ‰å®³ã€‚

ç¬¬ä¸€ç±»å¾ˆå®¹æ˜“æ¨ç†ï¼›ä½†æ˜¯ï¼Œç¬¬äºŒç±»ç›¸å½“å¾®å¦™ï¼Œå®¹æ˜“è¢«å¿½ç•¥ã€‚å¦‚æœä½ åœ¨ä»»ä½•ä¸¥è‚ƒçš„ç”Ÿäº§åº”ç”¨ä¸­ä½¿ç”¨è¿‡é’©å­ï¼Œé‚£ä¹ˆä½ å¾ˆå¯èƒ½ä¼šåœ¨è¿™ä¸¤ä¸ªç±»åˆ«ä¸­çš„ä¸€ä¸ªä¸­ä½¿ç”¨`useMemo` [é’©å­](https://blog.logrocket.com/popular-react-hook-libraries/)ã€‚

æˆ‘å°†å‘æ‚¨å±•ç¤ºä¸ºä»€ä¹ˆè¿™äº›ä¸é‡è¦å¹¶ä¸”å¯èƒ½æŸå®³æ‚¨çš„åº”ç”¨ç¨‹åºçš„æ€§èƒ½ï¼Œæ›´æœ‰è¶£çš„æ˜¯ï¼Œæˆ‘å°†å‘æ‚¨å±•ç¤ºæˆ‘å¯¹å¦‚ä½•åœ¨è¿™äº›ç”¨ä¾‹ä¸­*è€Œä¸æ˜¯*è¿‡åº¦ä½¿ç”¨`useMemo`çš„å»ºè®®ã€‚

æˆ‘ä»¬å¯ä»¥å¼€å§‹äº†å—ï¼Ÿ

## ä¸ä½¿ç”¨`useMemo`çš„åœ°æ–¹

å‡ºäºå­¦ä¹ çš„ç›®çš„ï¼Œè¿™äº›åˆ†ç±»å°†è¢«ç§°ä¸ºç‹®å­å’Œå˜è‰²é¾™ã€‚

![Category A And Category B: Lions And Chameleons](img/8142eb9585e35988997844094fbe6b83.png)

å¿½ç•¥é‚£äº›åˆ†æ•£æ³¨æ„åŠ›çš„åˆ†ç±»åç§°ï¼ŒåšæŒä½ï¼

å½“é¢å¯¹ç‹®å­æ—¶ï¼Œä½ çš„ç¬¬ä¸€ååº”æ˜¯é€ƒè·‘ï¼Œä¿æŠ¤ä½ çš„å¿ƒè„ä¸è¢«æ’•è£‚ï¼Œå¹¶æ´»ä¸‹æ¥ä»¥åå†è®²è¿°è¿™ä¸ªæ•…äº‹ã€‚æ²¡æ—¶é—´é—²èŠäº†ã€‚

è¿™æ˜¯ a ç±»ï¼Œä»–ä»¬æ˜¯ç‹®å­ï¼Œä½ çš„ååº”åº”è¯¥æ˜¯é€ƒç¦»è¿™äº›ã€‚

è®©æˆ‘ä»¬å…ˆä»è¿™äº›å¼€å§‹ï¼Œç„¶åå†çœ‹æ›´å¾®å¦™çš„å˜è‰²é¾™ã€‚

### 1.ç›¸åŒçš„å‚è€ƒå’Œå»‰ä»·çš„æ“ä½œ

è€ƒè™‘ä¸‹é¢çš„ç¤ºä¾‹ç»„ä»¶:

```
/** 
  @param {number} page 
  @param {string} type 
**/
const myComponent({page, type}) { 
  const resolvedValue = useMemo(() => {
     getResolvedValue(page, type)
  }, [page, type])

  return <ExpensiveComponent resolvedValue={resolvedValue}/> 
}
```

åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå¾ˆå®¹æ˜“è¯æ˜ä½œè€…ä½¿ç”¨äº†`useMemo`ã€‚ä»–ä»¬çš„æƒ³æ³•æ˜¯ï¼Œå½“å¯¹`resolvedValue`çš„å¼•ç”¨æ”¹å˜æ—¶ï¼Œä»–ä»¬ä¸å¸Œæœ›`ExpensiveComponent`è¢«é‡æ–°å‘ˆç°ã€‚

è™½ç„¶è¿™æ˜¯ä¸€ä¸ªåˆç†çš„æ‹…å¿§ï¼Œä½†åœ¨ä»»ä½•ç»™å®šçš„æ—¶é—´ï¼Œæœ‰ä¸¤ä¸ªé—®é¢˜å¯ä»¥ç”¨æ¥è¯æ˜ä½¿ç”¨`useMemo`çš„åˆç†æ€§ã€‚

ç¬¬ä¸€ï¼Œä¼ å…¥`useMemo`çš„å‡½æ•°æ˜¯ä¸æ˜¯å¾ˆè´µï¼Ÿåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ`getResolvedValue`è®¡ç®—æ˜¯ä¸æ˜¯å¾ˆæ˜‚è´µï¼Ÿ

JavaScript æ•°æ®ç±»å‹ä¸Šçš„å¤§å¤šæ•°æ–¹æ³•éƒ½ç»è¿‡äº†ä¼˜åŒ–ï¼Œæ¯”å¦‚`Array.map`ã€`Object.getOwnPropertyNames()`ç­‰ã€‚å¦‚æœä½ æ­£åœ¨æ‰§è¡Œä¸€ä¸ªä¸æ˜‚è´µçš„æ“ä½œ(æƒ³æƒ³å¤§ O ç¬¦å·)ï¼Œé‚£ä¹ˆä½ ä¸éœ€è¦è®°å¿†è¿”å›å€¼ã€‚ä½¿ç”¨`useMemo`T3 çš„æˆæœ¬å¯èƒ½ä¼šè¶…è¿‡é‡æ–°è¯„ä¼°å‡½æ•°çš„æˆæœ¬ã€‚

ç¬¬äºŒï¼Œç»™å®šç›¸åŒçš„è¾“å…¥å€¼ï¼Œå¯¹è®°å¿†å€¼çš„å¼•ç”¨ä¼šæ”¹å˜å—ï¼Ÿä¾‹å¦‚ï¼Œåœ¨ä¸Šé¢çš„ä»£ç å—ä¸­ï¼Œç»™å®š`page`ä¸º`2`ï¼Œç»™å®š`type`ä¸º`"GET"`ï¼Œé‚£ä¹ˆå¯¹`resolvedValue`çš„å¼•ç”¨ä¼šå‘ç”Ÿå˜åŒ–å—ï¼Ÿ

ç®€å•çš„ç­”æ¡ˆæ˜¯è€ƒè™‘`resolvedValue`å˜é‡çš„æ•°æ®ç±»å‹ã€‚å¦‚æœ`resolvedValue`æ˜¯ä¸€ä¸ª`primitive`(å³`string`ã€`number`ã€`boolean`ã€`null`ã€`undefined`æˆ–`symbol`)ï¼Œé‚£ä¹ˆå‚è€ƒæ°¸è¿œä¸ä¼šæ”¹å˜ã€‚è¨€ä¸‹ä¹‹æ„ï¼Œ`ExpensiveComponent`ä¸ä¼šè¢«é‡æ–°æ¸²æŸ“ã€‚

è€ƒè™‘ä¸‹é¢çš„ä¿®è®¢ä»£ç :

```
/** 
  @param {number} page 
  @param {string} type 
**/
const MyComponent({page, type}) {
  const resolvedValue = getResolvedValue(page, type)
  return <ExpensiveComponent resolvedValue={resolvedValue}/> 
}
```

æŒ‰ç…§ä¸Šé¢çš„è§£é‡Šï¼Œå¦‚æœ`resolvedValue`è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²æˆ–å…¶ä»–åŸå§‹å€¼ï¼Œå¹¶ä¸”`getResolvedValue`ä¸æ˜¯ä¸€ä¸ªæ˜‚è´µçš„æ“ä½œï¼Œé‚£ä¹ˆè¿™æ˜¯å®Œå…¨æ­£ç¡®å’Œé«˜æ€§èƒ½çš„ä»£ç ã€‚

åªè¦`page`å’Œ`type`ç›¸åŒâ€”â€”å³æ²¡æœ‰å±æ€§å˜åŒ–â€”â€”`resolvedValue`å°†æŒæœ‰ç›¸åŒçš„å¼•ç”¨ï¼Œé™¤éè¿”å›å€¼ä¸æ˜¯åŸè¯­(ä¾‹å¦‚ï¼Œå¯¹è±¡æˆ–æ•°ç»„)ã€‚

è®°ä½è¿™ä¸¤ä¸ªé—®é¢˜:è¢«è®°å¿†çš„å‡½æ•°æ˜¯ä¸€ä¸ªæ˜‚è´µçš„å‡½æ•°å—ï¼Ÿè¿”å›å€¼æ˜¯ä¸€ä¸ªåŸè¯­å—ï¼Ÿæœ‰äº†è¿™äº›é—®é¢˜ï¼Œä½ éšæ—¶å¯ä»¥è¯„ä¼°è‡ªå·±å¯¹`useMemo`çš„ä½¿ç”¨ã€‚

### 2.å‡ºäºå¤šç§åŸå› è®°å¿†é»˜è®¤çŠ¶æ€

è€ƒè™‘ä¸‹é¢çš„ä»£ç å—:

```
/** 
  @param {number} page 
  @param {string} type 
**/
const myComponent({page, type}) { 
  const defaultState = useMemo(() => ({
    fetched: someOperationValue(),
    type: type
  }), [type])

  const [state, setState] = useState(defaultState);
  return <ExpensiveComponent /> 
}
```

ä¸Šé¢çš„ä»£ç å¯¹ä¸€äº›äººæ¥è¯´ä¼¼ä¹æ— å®³ï¼Œä½†æ˜¯é‚£é‡Œçš„`useMemo`è°ƒç”¨ç»å¯¹ä¸é‡è¦ã€‚

ç¬¬ä¸€ï¼Œå‡ºäºåŒç†å¿ƒï¼Œç†è§£è¿™æ®µä»£ç èƒŒåçš„æ€ç»´ã€‚ä½œè€…çš„æ„å›¾å€¼å¾—ç§°èµã€‚å½“`type`é“å…·æ”¹å˜æ—¶ï¼Œä»–ä»¬æƒ³è¦ä¸€ä¸ªæ–°çš„`defaultState`å¯¹è±¡ï¼Œå¹¶ä¸”ä»–ä»¬ä¸å¸Œæœ›å¯¹`defaultState`å¯¹è±¡çš„å¼•ç”¨åœ¨æ¯æ¬¡é‡æ–°æ¸²æŸ“æ—¶æ— æ•ˆã€‚

* * *

### æ›´å¤šæ¥è‡ª LogRocket çš„ç²¾å½©æ–‡ç« :

* * *

è™½ç„¶è¿™äº›éƒ½æ˜¯åˆç†çš„è€ƒè™‘ï¼Œä½†æ˜¯è¿™ç§æ–¹æ³•æ˜¯é”™è¯¯çš„ï¼Œå¹¶ä¸”è¿åäº†ä¸€ä¸ªåŸºæœ¬åŸåˆ™:`useState`ä¸ä¼šåœ¨æ¯æ¬¡é‡æ–°æ¸²æŸ“æ—¶è¢«é‡æ–°åˆå§‹åŒ–ï¼Œåªæœ‰å½“ç»„ä»¶è¢«é‡æ–°è£…è½½æ—¶ã€‚

ä¼ é€’ç»™`useState`çš„å‚æ•°æœ€å¥½å«åš`INITIAL_STATE`ã€‚å®ƒåªåœ¨ç»„ä»¶æœ€åˆå®‰è£…æ—¶è®¡ç®—(æˆ–è§¦å‘)ä¸€æ¬¡ã€‚

```
useState(INITIAL_STATE)
```

å°½ç®¡ä½œè€…æ‹…å¿ƒå½“`useMemo`çš„`type`æ•°ç»„ä¾èµ–å…³ç³»æ”¹å˜æ—¶ä¼šå¾—åˆ°ä¸€ä¸ªæ–°çš„`defaultState`å€¼ï¼Œä½†è¿™æ˜¯ä¸€ä¸ªé”™è¯¯çš„åˆ¤æ–­ï¼Œå› ä¸º`useState`å¿½ç•¥äº†æ–°è®¡ç®—çš„`defaultState`å¯¹è±¡ã€‚

å¦‚ä¸‹æ‰€ç¤ºï¼Œè¿™ä¸å»¶è¿Ÿåˆå§‹åŒ–`useState`ç›¸åŒ:

```
/**
   @param {number} page 
   @param {string} type 
**/
const myComponent({page, type}) {
  // default state initializer 
  const defaultState = () => {
    console.log("default state computed")
    return {
       fetched: someOperationValue(),
       type: type
    }
  }

  const [state, setState] = useState(defaultState);
  return <ExpensiveComponent /> 
}
```

åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œ`defaultState` init å‡½æ•°åªè¢«è°ƒç”¨ä¸€æ¬¡â€”â€”åœ¨æŒ‚è½½æ—¶ã€‚å¹¶éæ¯æ¬¡é‡æ–°æ¸²æŸ“æ—¶éƒ½ä¼šè°ƒç”¨è¯¥å‡½æ•°ã€‚å› æ­¤ï¼Œé™¤éç»„ä»¶è¢«é‡æ–°è£…è½½ï¼Œå¦åˆ™æ—¥å¿—â€œé»˜è®¤çŠ¶æ€å·²è®¡ç®—â€å°†åªå‡ºç°ä¸€æ¬¡ã€‚

ä¸‹é¢æ˜¯ä¹‹å‰é‡å†™çš„ä»£ç :

```
/**
   @param {number} page 
   @param {string} type 
**/
const myComponent({page, type}) {
  const defaultState = () => ({
     fetched: someOperationValue(),
     type,
   })

  const [state, setState] = useState(defaultState);

  // if you really need to update state based on prop change, 
  // do so here
  // pseudo code - if(previousProp !== prop){setState(newStateValue)}

  return <ExpensiveComponent /> 
}
```

æˆ‘ä»¬ç°åœ¨å°†è€ƒè™‘æˆ‘è®¤ä¸ºä½ åº”è¯¥é¿å…çš„æ›´å¾®å¦™çš„åœºæ™¯ã€‚

### 3.ä½¿ç”¨`useMemo`ä½œä¸º ESLint åŠé’©è­¦å‘Šçš„å‡ºå£

![ESLint Hook Warnings](img/1ac2a3c89b8c67b5ecca73bfec115de6.png)

è™½ç„¶æˆ‘æ— æ³•è®©è‡ªå·±å»é˜…è¯»é‚£äº›æƒ³æ–¹è®¾æ³•å‹åˆ¶æ¥è‡ªå®˜æ–¹ [ESLint æ’ä»¶](https://www.npmjs.com/package/eslint-plugin-react-hooks) [é’©å­](https://www.npmjs.com/package/eslint-plugin-react-hooks)çš„ lint è­¦å‘Šçš„äººçš„æ‰€æœ‰è¯„è®ºï¼Œä½†æˆ‘ç¡®å®ç†è§£ä»–ä»¬çš„å›°å¢ƒã€‚

åœ¨è¿™ä¸€ç‚¹ä¸Šæˆ‘åŒæ„ä¸¹Â·é˜¿å¸ƒæ‹‰è«å¤«ã€‚æŠ‘åˆ¶æ’ä»¶ä¸­çš„`eslint-warnings`å¯èƒ½ä¼šåœ¨å°†æ¥çš„æŸä¸€å¤©åå™¬ä½ ã€‚

ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘è®¤ä¸ºåœ¨ç”Ÿäº§åº”ç”¨ä¸­æŠ‘åˆ¶è¿™äº›è­¦å‘Šæ˜¯ä¸€ä¸ªåä¸»æ„ï¼Œå› ä¸ºä½ å¢åŠ äº†åœ¨ä¸ä¹…çš„å°†æ¥å¼•å…¥å¾®å¦™é”™è¯¯çš„å¯èƒ½æ€§ã€‚

ä¹Ÿå°±æ˜¯è¯´ï¼Œä»ç„¶æœ‰ä¸€äº›æœ‰æ•ˆçš„æƒ…å†µéœ€è¦å–æ¶ˆè¿™äº› lint è­¦å‘Šã€‚ä¸‹é¢æ˜¯æˆ‘è‡ªå·±é‡åˆ°çš„ä¸€ä¸ªä¾‹å­ã€‚ä¸ºäº†æ›´å®¹æ˜“ç†è§£ï¼Œä»£ç è¿›è¡Œäº†ç®€åŒ–:

```
function Example ({ impressionTracker, propA, propB, propC }) {
  useEffect(() => {
    // ğŸ‘‡Track initial impression
    impressionTracker(propA, propB, propC)
  }, [])

  return <BeautifulComponent propA={propA} propB={propB} propC={propC} />                 
}
```

è¿™æ˜¯ä¸€ä¸ªç›¸å½“æ£˜æ‰‹çš„é—®é¢˜ã€‚

åœ¨è¿™ä¸ªå…·ä½“çš„ç”¨ä¾‹ä¸­ï¼Œä½ ä¸å…³å¿ƒé“å…·æœ‰æ²¡æœ‰å˜åŒ–ã€‚ä½ åªå¯¹è°ƒç”¨å¸¦æœ‰åˆå§‹*T2 é“å…·çš„`track`å‡½æ•°æ„Ÿå…´è¶£ã€‚è¿™å°±æ˜¯å°è±¡è¿½è¸ªçš„å·¥ä½œåŸç†ã€‚åªæœ‰åœ¨ç»„ä»¶æŒ‚è½½æ—¶æ‰è°ƒç”¨ impression track å‡½æ•°ã€‚è¿™é‡Œçš„åŒºåˆ«æ˜¯ä½ éœ€è¦ç”¨ä¸€äº›åˆå§‹çš„é“å…·æ¥è°ƒç”¨è¿™ä¸ªå‡½æ•°ã€‚*

è™½ç„¶æ‚¨å¯èƒ½è®¤ä¸ºç®€å•åœ°å°†`props`é‡å‘½åä¸ºç±»ä¼¼`initialProps`çš„åç§°å°±å¯ä»¥è§£å†³é—®é¢˜ï¼Œä½†è¿™æ˜¯è¡Œä¸é€šçš„ã€‚è¿™æ˜¯å› ä¸º`BeautifulComponent`ä¹Ÿä¾èµ–äºæ¥æ”¶æ›´æ–°çš„å±æ€§å€¼ã€‚

![Initial Props And Updated Props Example](img/63ea3913047f7cfa835af208905cccd8.png)

åœ¨æœ¬ä¾‹ä¸­ï¼Œæ‚¨å°†æ”¶åˆ° lint è­¦å‘Šæ¶ˆæ¯:`React Hook useEffect has missing dependencies: 'impressionTracker', 'propA', 'propB', and 'propC'. Either include them or remove the dependency array.`

è¿™æ˜¯ä¸€ä¸ªç›¸å½“é²è½çš„ä¿¡æ¯ï¼Œä½†çŸ­ç»’åªæ˜¯åšå¥½è‡ªå·±çš„å·¥ä½œã€‚ç®€å•çš„è§£å†³æ–¹æ¡ˆæ˜¯ä½¿ç”¨ä¸€ä¸ª`eslint-disable`æ³¨é‡Šï¼Œä½†æ˜¯è¿™å¹¶ä¸æ€»æ˜¯æœ€å¥½çš„è§£å†³æ–¹æ¡ˆï¼Œå› ä¸ºå°†æ¥æ‚¨å¯èƒ½ä¼šåœ¨åŒä¸€ä¸ª`useEffect`è°ƒç”¨ä¸­å¼•å…¥ bugã€‚

```
useEffect(() => {
  impressionTracker(propA, propB, propC)
  // eslint-disable-next-line react-hooks/exhaustive-deps
}, [])
```

æˆ‘å»ºè®®çš„è§£å†³æ–¹æ¡ˆæ˜¯ä½¿ç”¨`useRef`é’©å­æ¥ä¿å­˜å¯¹ä¸éœ€è¦æ›´æ–°çš„åˆå§‹å±æ€§å€¼çš„å¼•ç”¨ã€‚

```
function Example({impressionTracker, propA, propB, propC}) {
  // keep reference to the initial values         
  const initialTrackingValues = useRef({
      tracker: impressionTracker, 
      params: {
        propA, 
        propB, 
        propC, 
    }
  })

  // track impression 
  useEffect(() => {
    const { tracker, params } = initialTrackingValues.current;
    tracker(params)
  }, []) // you get NO eslint warnings for tracker or params

  return <BeautifulComponent propA={propA} propB={propB} propC={propC} />   
}
```

åœ¨æˆ‘æ‰€æœ‰çš„æµ‹è¯•ä¸­ï¼Œlinter åªè€ƒè™‘è¿™ç§æƒ…å†µä¸‹çš„`useRef`ã€‚æœ‰äº†`useRef`ï¼Œlinter çŸ¥é“å¼•ç”¨çš„å€¼ä¸ä¼šæ”¹å˜ï¼Œæ‰€ä»¥ä½ ä¸ä¼šå¾—åˆ°ä»»ä½•è­¦å‘Šï¼ç”šè‡³`useMemo`ä¹Ÿæ²¡æœ‰é˜»æ­¢è¿™äº›è­¦å‘Šã€‚

ä¾‹å¦‚:

```
function Example({impressionTracker, propA, propB, propC}) {

  // useMemo to memoize the value i.e so it doesn't change
  const initialTrackingValues = useMemo({
    tracker: impressionTracker, 
    params: {
       propA, 
       propB, 
       propC, 
    }
  }, []) // ğŸ‘ˆ you get a lint warning here

  // track impression 
  useEffect(() => {
    const { tracker, params} = initialTrackingValues
    tracker(params)
  }, [tracker, params]) // ğŸ‘ˆ you must put these dependencies here

  return <BeautifulComponent propA={propA} propB={propB} propC={propC} />
}
```

åœ¨ä¸Šé¢çš„é”™è¯¯è§£å†³æ–¹æ¡ˆä¸­ï¼Œå³ä½¿æˆ‘é€šè¿‡ç”¨`useMemo`è®°å¿†åˆå§‹å±æ€§å€¼æ¥è·Ÿè¸ªåˆå§‹å€¼ï¼Œlinter ä»ç„¶å¯¹æˆ‘å¤§å–Šå¤§å«ã€‚åœ¨`useEffect`è°ƒç”¨ä¸­ï¼Œè®°å¿†å€¼`tracker`å’Œ`params`ä¹Ÿå¿…é¡»ä½œä¸ºæ•°ç»„ä¾èµ–é¡¹è¾“å…¥ã€‚

æˆ‘è§è¿‡è¿™æ ·çš„äººã€‚è¿™æ˜¯ç³Ÿç³•çš„ä»£ç ï¼Œåº”è¯¥é¿å…ã€‚ä½¿ç”¨`useRef`æŒ‚é’©ï¼Œå¦‚åˆå§‹è§£å†³æ–¹æ¡ˆæ‰€ç¤ºã€‚

æ€»ä¹‹ï¼Œåœ¨å¤§å¤šæ•°æˆ‘çœŸçš„æƒ³è®© lint è­¦å‘Šé™éŸ³çš„æƒ…å†µä¸‹ï¼Œæˆ‘å‘ç°`useRef`æ˜¯ä¸€ä¸ªå®Œç¾çš„ç›Ÿå‹ã€‚æ‹¥æŠ±å®ƒã€‚

### 4.ä»…å°†`useMemo`ç”¨äºå‚è€ƒç­‰å¼

å¤§å¤šæ•°äººè¯´ä½¿ç”¨`useMemo`è¿›è¡Œæ˜‚è´µçš„è®¡ç®—å’Œä¿æŒå‚è€ƒç­‰å¼ã€‚æˆ‘åŒæ„ç¬¬ä¸€ä¸ªï¼Œä½† T2 ä¸åŒæ„ç¬¬äºŒä¸ªã€‚ä¸è¦ä»…ä»…ä¸ºäº†å¼•ç”¨ç­‰å¼è€Œä½¿ç”¨`useMemo`é’©å­ã€‚è¿™æ ·åšåªæœ‰ä¸€ä¸ªåŸå› â€”â€”æˆ‘ç¨åä¼šè®¨è®ºã€‚

ä¸ºä»€ä¹ˆä»…ä»…ç”¨`useMemo`æ¥è¡¨ç¤ºå‚ç…§ç­‰å¼æ˜¯ä¸€ä»¶åäº‹ï¼Ÿå…¶ä»–äººä¸éƒ½æ˜¯è¿™ä¹ˆå®£æ‰¬çš„å—ï¼Ÿ

è€ƒè™‘ä¸‹é¢è¿™ä¸ªè™šæ„çš„ä¾‹å­:

```
function Bla() {
  const baz = useMemo(() => [1, 2, 3], [])
  return <Foo baz={baz} />
}
```

åœ¨ç»„ä»¶`Bla`ä¸­ï¼Œå€¼`baz`è¢«è®°å¿†ï¼Œä¸æ˜¯å› ä¸ºæ•°ç»„`[1,2,3]`çš„æ±‚å€¼ä»£ä»·å¾ˆé«˜ï¼Œè€Œæ˜¯å› ä¸ºå¯¹`baz`å˜é‡çš„å¼•ç”¨åœ¨æ¯æ¬¡é‡æ–°æ¸²æŸ“æ—¶éƒ½ä¼šæ”¹å˜ã€‚

è™½ç„¶è¿™ä¼¼ä¹ä¸æ˜¯é—®é¢˜ï¼Œä½†æˆ‘ä¸è®¤ä¸º`useMemo`æ˜¯è¿™é‡Œä½¿ç”¨çš„æ­£ç¡®é’©å­ã€‚

ä¸€ï¼Œçœ‹æ•°ç»„ä¾èµ–ã€‚

```
useMemo(() => [1, 2, 3], [])
```

è¿™é‡Œï¼Œä¸€ä¸ªç©ºæ•°ç»„è¢«ä¼ é€’ç»™äº†`useMemo`é’©å­ã€‚è¿™æ„å‘³ç€ï¼Œå€¼`[1,2,3]`åªè®¡ç®—ä¸€æ¬¡â€”â€”å½“ç»„ä»¶å®‰è£…æ—¶ã€‚

å› æ­¤ï¼Œæˆ‘ä»¬çŸ¥é“ä¸¤ä»¶äº‹:è¢«è®°å¿†çš„å€¼ä¸æ˜¯ä¸€ä¸ªæ˜‚è´µçš„è®¡ç®—ï¼Œå®ƒåœ¨æŒ‚è½½åä¸ä¼šè¢«é‡æ–°è®¡ç®—ã€‚

å¦‚æœä½ å‘ç°è‡ªå·±å¤„äºè¿™ç§æƒ…å†µï¼Œæˆ‘è¦æ±‚ä½ é‡æ–°è€ƒè™‘ä½¿ç”¨`useMemo`é’©å­ã€‚æ‚¨æ­£åœ¨è®°å¿†ä¸€ä¸ªå€¼ï¼Œå®ƒä¸æ˜¯ä¸€ä¸ªæ˜‚è´µçš„è®¡ç®—ï¼Œä¹Ÿä¸ä¼šåœ¨ä»»ä½•æ—¶é—´ç‚¹é‡æ–°è®¡ç®—ã€‚è¿™ç»å¯¹ä¸ç¬¦åˆâ€œè®°å¿†åŒ–â€è¿™ä¸ªæœ¯è¯­çš„å®šä¹‰

è¿™æ˜¯å¯¹`useMemo`é’©å­çš„ç³Ÿç³•ä½¿ç”¨ã€‚è¿™åœ¨è¯­ä¹‰ä¸Šæ˜¯é”™è¯¯çš„ï¼Œå¹¶ä¸”åœ¨å†…å­˜åˆ†é…å’Œæ€§èƒ½æ–¹é¢å¯èƒ½ä¼šèŠ±è´¹æ›´å¤šã€‚

é‚£ä¹ˆï¼Œä½ åº”è¯¥æ€ä¹ˆåšå‘¢ï¼Ÿ

é¦–å…ˆï¼Œä½œè€…åˆ°åº•æƒ³è¾¾åˆ°ä»€ä¹ˆç›®çš„ï¼Ÿä»–ä»¬ä¸æ˜¯åœ¨è¯•å›¾è®°å¿†ä¸€ä¸ªä»·å€¼ï¼›ç›¸åï¼Œä»–ä»¬å¸Œæœ›åœ¨é‡æ–°æ¸²æŸ“æ—¶ä¿æŒ**å¼•ç”¨**çš„å€¼ä¸å˜ã€‚

åˆ«ç»™é‚£åªé»ç³Šç³Šçš„å˜è‰²é¾™æœºä¼šã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½¿ç”¨`useRef`é’©ã€‚

ä¾‹å¦‚ï¼Œå¦‚æœä½ çœŸçš„è®¨åŒä½¿ç”¨å½“å‰å±æ€§(åƒæˆ‘çš„è®¸å¤šåŒäº‹ä¸€æ ·)ï¼Œé‚£ä¹ˆç®€å•åœ°è§£æ„å¹¶é‡å‘½åï¼Œå¦‚ä¸‹æ‰€ç¤º:

```
function Bla() {
  const { current: baz } = useRef([1, 2, 3])
  return <Foo baz={baz} />
}
```

é—®é¢˜è§£å†³äº†ã€‚

äº‹å®ä¸Šï¼Œæ‚¨å¯ä»¥ä½¿ç”¨`useRef`æ¥ä¿æŒå¯¹æ˜‚è´µçš„å‡½æ•°æ±‚å€¼çš„å¼•ç”¨â€”â€”åªè¦å‡½æ•°ä¸éœ€è¦åœ¨ props æ”¹å˜æ—¶é‡æ–°è®¡ç®—ã€‚

å¯¹äºè¿™ç§æƒ…å†µï¼Œ`useRef`æ˜¯æ­£ç¡®çš„æŒ‚é’©ï¼Œè€Œä¸æ˜¯`useMemo`æŒ‚é’©ã€‚

èƒ½å¤Ÿä½¿ç”¨`useRef`é’©å­æ¨¡ä»¿[å®ä¾‹å˜é‡](https://reactjs.org/docs/hooks-faq.html#is-there-something-like-instance-variables)æ˜¯é’©å­å¸¦ç»™æˆ‘ä»¬çš„æœ€å°‘ä½¿ç”¨çš„è¶…èƒ½åŠ›ä¹‹ä¸€ã€‚`useRef`é’©å­å¯ä»¥åšçš„ä¸ä»…ä»…æ˜¯ä¿å­˜å¯¹ DOM èŠ‚ç‚¹çš„å¼•ç”¨ã€‚æ‹¥æŠ±å®ƒã€‚

è¯·è®°ä½ï¼Œè¿™é‡Œçš„æ¡ä»¶æ˜¯ï¼Œå¦‚æœä½ è®°å¿†ä¸€ä¸ªå€¼ï¼Œåªæ˜¯å› ä¸ºä½ éœ€è¦ä¿æŒå¯¹å®ƒçš„ä¸€è‡´å¼•ç”¨ã€‚å¦‚æœæ‚¨éœ€è¦æ ¹æ®å˜åŒ–çš„å±æ€§æˆ–å€¼é‡æ–°è®¡ç®—å€¼ï¼Œé‚£ä¹ˆè¯·éšæ„ä½¿ç”¨`useMemo`é’©å­ã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæ‚¨ä»ç„¶å¯ä»¥ä½¿ç”¨`useRef`â€”â€”ä½†æ˜¯è€ƒè™‘åˆ°æ•°ç»„ä¾èµ–åˆ—è¡¨ï¼Œ`useMemo`æœ€æ–¹ä¾¿ã€‚

## ç»“è®º

é€ƒç¦»ç‹®å­ï¼Œä½†ä¸è¦è®©å˜è‰²é¾™æ„šå¼„ä½ ã€‚å¦‚æœä½ å…è®¸å®ƒä»¬ï¼Œå˜è‰²é¾™ä¼šæ”¹å˜å®ƒä»¬çš„çš®è‚¤é¢œè‰²ï¼Œèå…¥ä½ çš„ä»£ç åº“ï¼Œæ±¡æŸ“ä½ çš„ä»£ç è´¨é‡ã€‚

åˆ«è®©ä»–ä»¬å¾—é€ã€‚

å¥½å¥‡æˆ‘å¯¹é«˜çº§é’©å­çš„ç«‹åœºæ˜¯ä»€ä¹ˆï¼Ÿæˆ‘æ­£åœ¨åšä¸€ä¸ªé«˜çº§é’©å­çš„è§†é¢‘è¯¾ç¨‹ã€‚æ³¨å†Œå§ï¼Œæˆ‘ä¼š[è®©ä½ çŸ¥é“](https://forms.gle/Qd6yZC1Lhcosnc2f8)ä»€ä¹ˆæ—¶å€™å‘å¸ƒï¼

## ä½¿ç”¨ LogRocket æ¶ˆé™¤ä¼ ç»Ÿååº”é”™è¯¯æŠ¥å‘Šçš„å™ªéŸ³

[LogRocket](https://lp.logrocket.com/blg/react-signup-issue-free)

æ˜¯ä¸€æ¬¾ React analytics è§£å†³æ–¹æ¡ˆï¼Œå¯ä¿æŠ¤æ‚¨å…å—æ•°ç™¾ä¸ªè¯¯æŠ¥é”™è¯¯è­¦æŠ¥çš„å½±å“ï¼Œåªé’ˆå¯¹å°‘æ•°çœŸæ­£é‡è¦çš„é¡¹ç›®ã€‚LogRocket å‘Šè¯‰æ‚¨ React åº”ç”¨ç¨‹åºä¸­å®é™…å½±å“ç”¨æˆ·çš„æœ€å…·å½±å“åŠ›çš„ bug å’Œ UX é—®é¢˜ã€‚

[![](img/f300c244a1a1cf916df8b4cb02bec6c6.png) ](https://lp.logrocket.com/blg/react-signup-general) [ ![LogRocket Dashboard Free Trial Banner](img/d6f5a5dd739296c1dd7aab3d5e77eeb9.png) ](https://lp.logrocket.com/blg/react-signup-general) [LogRocket](https://lp.logrocket.com/blg/react-signup-issue-free)

è‡ªåŠ¨èšåˆå®¢æˆ·ç«¯é”™è¯¯ã€ååº”é”™è¯¯è¾¹ç•Œã€è¿˜åŸçŠ¶æ€ã€ç¼“æ…¢çš„ç»„ä»¶åŠ è½½æ—¶é—´ã€JS å¼‚å¸¸ã€å‰ç«¯æ€§èƒ½æŒ‡æ ‡å’Œç”¨æˆ·äº¤äº’ã€‚ç„¶åï¼ŒLogRocket ä½¿ç”¨æœºå™¨å­¦ä¹ æ¥é€šçŸ¥æ‚¨å½±å“å¤§å¤šæ•°ç”¨æˆ·çš„æœ€å…·å½±å“åŠ›çš„é—®é¢˜ï¼Œå¹¶æä¾›æ‚¨ä¿®å¤å®ƒæ‰€éœ€çš„ä¸Šä¸‹æ–‡ã€‚

å…³æ³¨é‡è¦çš„ React bugâ€”[ä»Šå¤©å°±è¯•è¯• LogRocketã€‘ã€‚](https://lp.logrocket.com/blg/react-signup-issue-free)