<html>
<head>
<title>Demonstration on how to use GraphQL with Node and Vue inÂ bits - LogRocket Blog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>åœ¨bits - LogRocketåšå®¢ä¸­æ¼”ç¤ºå¦‚ä½•å°†GraphQLä¸Nodeå’ŒVueç»“åˆä½¿ç”¨</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://blog.logrocket.com/demonstration-on-how-to-use-graphql-with-node-and-vue-in-bits-8981f0d65f94/#0001-01-01">https://blog.logrocket.com/demonstration-on-how-to-use-graphql-with-node-and-vue-in-bits-8981f0d65f94/#0001-01-01</a></blockquote><div><article class="article-post">
<figure class="graf graf--figure"><img decoding="async" class="graf-image jetpack-lazy-image" src="../Images/52fde5ec2b39ee9081fe507956bf239f.png" data-image-id="1*uUXiDk5CNIwCgql8dh3pqQ.jpeg" data-width="1600" data-height="983" data-is-featured="true" data-lazy-src="https://storage.googleapis.com/blog-images-backup/1*uUXiDk5CNIwCgql8dh3pqQ.jpeg?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://storage.googleapis.com/blog-images-backup/1*uUXiDk5CNIwCgql8dh3pqQ.jpeg"/><noscript><img data-lazy-fallback="1" decoding="async" class="graf-image" src="../Images/52fde5ec2b39ee9081fe507956bf239f.png" data-image-id="1*uUXiDk5CNIwCgql8dh3pqQ.jpeg" data-width="1600" data-height="983" data-is-featured="true" data-original-src="https://storage.googleapis.com/blog-images-backup/1*uUXiDk5CNIwCgql8dh3pqQ.jpeg"/></noscript></figure>
<p class="graf graf--p">å½“æˆ‘åœ¨ç½‘ä¸Šå†²æµªæ—¶ï¼Œæˆ‘çœ‹åˆ°äº†è¿™æ¡å¾®åšã€‚å‰ç«¯å¼€å‘äººå‘˜ä¼¼ä¹åŒå€¦äº†æ—¶ä¸æ—¶åœ°è¯·æ±‚APIã€‚ğŸ˜„</p>

<p/>
<p class="graf graf--p">ç¬¬ä¸€æ¬¡å’ŒGraphQLäº’åŠ¨ï¼Œå°±çˆ±ä¸Šäº†å®ƒã€‚ä¸ºä»€ä¹ˆï¼ŸGraphQLä¸ºæ‚¨æä¾›äº†è½»æ¾æ„å»ºAPIçš„ç©ºé—´ï¼Œè®©æ‚¨ä¸å¿…é‡å¤åšåŒæ ·çš„äº‹æƒ…ã€‚æ€ä¹ˆä¼šï¼Ÿè®©æˆ‘ä»¬æ‰¾å‡ºç­”æ¡ˆã€‚</p>
<p class="graf graf--p">æˆ‘å‡è®¾æ‚¨å¯¹ä»¥ä¸‹å†…å®¹æœ‰åŸºæœ¬çš„äº†è§£:</p>
<ul class="postList">
<li class="graf graf--li">JavaScript(JavaScript)</li>
<li class="graf graf--li">Node.js(èŠ‚ç‚¹. js)</li>
<li class="graf graf--li">view . js-æ£€è§†. js</li>
</ul>
<p class="graf graf--p">æˆ‘ä»¬æ¥çœ‹çœ‹<code>GraphQL</code>å’Œ<code>REST</code>çš„å¯¹æ¯”ã€‚</p>
<p class="graf graf--p">ä¸ºäº†å…¨é¢äº†è§£æœ¬æ–‡ï¼Œæˆ‘å¸Œæœ›ä½ å…‹éš†è¿™ä¸ªé¡¹ç›®çš„<a class="markup--anchor markup--p-anchor" href="https://github.com/meshboy/recipe" target="_blank" rel="noopener noreferrer" data-href="https://github.com/meshboy/recipe">åº“</a>ï¼Œå®ƒåŒ…å«äº†<code>server</code>ç«¯å’Œ<code>client</code>ç«¯ã€‚</p>
<p class="graf graf--p">åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†å…³æ³¨ä»¥ä¸‹å‡ ç‚¹</p>
<ul class="postList">
<li class="graf graf--li">ä¸ºä»€ä¹ˆæ˜¯GraphQL</li>
<li class="graf graf--li">GraphQLçš„å…³é”®ç»„ä»¶</li>
<li class="graf graf--li">è¯æ˜</li>
<li class="graf graf--li">æ–‡ä»¶ä¸Šä¼ </li>
<li class="graf graf--li">å¸¦Vueçš„GraphQL</li>
</ul>
<figure class="graf graf--figure graf--layoutOutsetCenter"><a class="graf-imageAnchor" href="https://logrocket.com/signup/" target="_blank" rel="noopener noreferrer" data-href="https://logrocket.com/signup/" data-action="image-link" data-action-observe-only="true"><img decoding="async" class="graf-image jetpack-lazy-image" src="../Images/94b3e0f84b30cb0d321f60471481ab64.png" data-image-id="1*GPjaPKNNUYHU8EsA3Z0JGA.png" data-width="3212" data-height="750" data-lazy-src="https://storage.googleapis.com/blog-images-backup/1*GPjaPKNNUYHU8EsA3Z0JGA.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://storage.googleapis.com/blog-images-backup/1*GPjaPKNNUYHU8EsA3Z0JGA.png"/><noscript><img data-lazy-fallback="1" decoding="async" class="graf-image" src="../Images/94b3e0f84b30cb0d321f60471481ab64.png" data-image-id="1*GPjaPKNNUYHU8EsA3Z0JGA.png" data-width="3212" data-height="750" data-original-src="https://storage.googleapis.com/blog-images-backup/1*GPjaPKNNUYHU8EsA3Z0JGA.png"/></noscript></a></figure>
<h4 class="graf graf--h4">GraphQLæ˜¯ä»€ä¹ˆï¼Ÿ</h4>
<p class="graf graf--p">GraphQLæ˜¯ä¸€ç§æŸ¥è¯¢è¯­è¨€ï¼Œå®ƒæœ‰åŠ©äºå°†APIçš„<code>door</code>çš„å¯†é’¥äº¤ç»™è®¿é—®è€…(<code>client</code>)ï¼Œå½“ç„¶æ˜¯åœ¨ä½ å…è®¸çš„æƒ…å†µä¸‹ã€‚å—¯ï¼Œå¦‚æœç®¡ç†ä¸å½“ï¼Œä½ çš„è®¿å®¢å¯èƒ½ä¼šæŠŠäº‹æƒ…æç ¸ã€‚</p>
<p class="graf graf--p">æ— è®ºå¦‚ä½•ï¼Œæ‚¨çš„åº”ç”¨ç¨‹åºéƒ½å¿…é¡»ä¸å…¶ä»–åº”ç”¨ç¨‹åºè¿›è¡Œäº¤äº’ã€‚è¿™åªèƒ½é€šè¿‡å…¬å¼€éƒ¨åˆ†æˆ–å…¨éƒ¨APIæ¥å®ç°ã€‚å®ç°è¿™ä¸€ç‚¹çš„æ–¹æ³•ä¹‹ä¸€æ˜¯ä½¿ç”¨RESTæ„å»ºæ‚¨çš„åº”ç”¨ç¨‹åºã€‚åˆ°æœ¬æ–‡ç»“æŸæ—¶ï¼Œæˆ‘ä»¬éƒ½ä¼šæ˜ç™½ä¸ºä»€ä¹ˆåº”è¯¥åœ¨ä¸‹ä¸€ä¸ªåº”ç”¨ç¨‹åºä¸­ä½¿ç”¨GraphQLã€‚</p>
<blockquote class="graf graf--blockquote"><p>GraphQLæ˜¯ä¸€ç§APIæŸ¥è¯¢è¯­è¨€ï¼Œä¹Ÿæ˜¯ä¸€ç§ç”¨ç°æœ‰æ•°æ®å®Œæˆè¿™äº›æŸ¥è¯¢çš„è¿è¡Œæ—¶è¯­è¨€ã€‚GraphQLä¸ºAPIä¸­çš„æ•°æ®æä¾›äº†å®Œæ•´ä¸”æ˜“äºç†è§£çš„æè¿°ï¼Œä½¿å®¢æˆ·èƒ½å¤Ÿå‡†ç¡®åœ°è¦æ±‚ä»–ä»¬éœ€è¦çš„ä¸œè¥¿ï¼Œä½¿APIæ›´å®¹æ˜“éšæ—¶é—´å‘å±•ï¼Œå¹¶æ”¯æŒå¼ºå¤§çš„å¼€å‘å·¥å…·ã€‚</p></blockquote>
<p class="graf graf--p"><em class="markup--em markup--p-em"> REST Vs GraphQL </em></p>
<ul class="postList">
<li class="graf graf--li">GraphQLåªæœ‰ä¸€ä¸ª<code>route</code>è€ŒRESTæœ‰å¤šä¸ªè·¯ç”±ã€‚éšç€å®¢æˆ·ç«¯éœ€æ±‚çš„å¢åŠ ï¼ŒRESTç«¯ç‚¹ä¹Ÿåœ¨ä¸æ–­å¢åŠ ã€‚</li>
<li class="graf graf--li">é™¤äº†RESTæœ‰å¤šä¸ªç«¯ç‚¹ä¹‹å¤–ï¼Œå®ƒè¿˜é™„å¸¦äº†<code>HTTP</code>åŠ¨è¯(POSTã€PUTã€GETç­‰),ä½†æ˜¯GraphQLä¹Ÿæ¶µç›–äº†æˆ‘ä»¬ï¼Œå› ä¸ºå®ƒä¸éœ€è¦è¿™äº›ä¸œè¥¿ã€‚</li>
<li class="graf graf--li">æ¯ä¸ªAPIéƒ½åº”è¯¥æœ‰æ–‡æ¡£ï¼Œä½†æ˜¯GraphQLç»™äº†æˆ‘ä»¬ä¸€ä¸ªç°æˆçš„APIæ–‡æ¡£ã€‚</li>
<li class="graf graf--li">ä½ å¯ä»¥åœ¨GraphQLä¸­è½»æ¾åœ°<code>resolve</code>å°½å¯èƒ½è¿œçš„æ•°æ®ï¼Œä½†åœ¨RESTçš„æƒ…å†µä¸‹å°±ä¸è¡Œäº†ã€‚å®ƒè‚¯å®šä¼šæœ‰ä¸€ä¸ªæ–°çš„ç»ˆç‚¹ã€‚</li>
<li class="graf graf--li">GraphQLä¸ä¼šè®©ä½ æ‹…å¿ƒå¦‚ä½•<code>version</code>ä½ çš„APIï¼Œå› ä¸ºå•ä¸ªè·¯ç”±ä¸ä¼šæ”¹å˜ï¼Œä½†æ˜¯ä½ éœ€è¦å…³å¿ƒçš„æ˜¯å½“æ›´æ–°ä¸æ–­åˆ°æ¥æ—¶ï¼Œä½ åº”è¯¥å¦‚ä½•åœ¨ä½¿ç”¨RESTçš„åŒæ—¶ç‰ˆæœ¬åŒ–ä½ çš„APIã€‚</li>
</ul>
<p class="graf graf--p">è¯´æ•™åˆ°æ­¤ä¸ºæ­¢ï¼</p>
<p class="graf graf--p">è®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªå…¸å‹çš„GraphQLæ–‡æ¡£ã€‚éšæ„å¤åˆ¶å¹¶ç²˜è´´<a class="markup--anchor markup--p-anchor" href="https://www.apollographql.com/docs/apollo-server/getting-started.html" target="_blank" rel="noopener noreferrer" data-href="https://www.apollographql.com/docs/apollo-server/getting-started.html">ç‰‡æ®µ</a>ï¼Œåœ¨æ‚¨çš„æœºå™¨ä¸Šæ„Ÿå—ä¸€ä¸‹ã€‚</p>
<p><img decoding="async" class="graf-image jetpack-lazy-image" src="../Images/fb7c26108f2dbd3539658bd94aed78da.png" data-image-id="1*BsR8Q4yrpkPK6fR1IkyQ6Q.gif" data-lazy-src="https://storage.googleapis.com/blog-images-backup/1*BsR8Q4yrpkPK6fR1IkyQ6Q.gif?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://storage.googleapis.com/blog-images-backup/1*BsR8Q4yrpkPK6fR1IkyQ6Q.gif"/></p><noscript><img data-lazy-fallback="1" decoding="async" class="graf-image" src="../Images/fb7c26108f2dbd3539658bd94aed78da.png" data-image-id="1*BsR8Q4yrpkPK6fR1IkyQ6Q.gif" data-original-src="https://storage.googleapis.com/blog-images-backup/1*BsR8Q4yrpkPK6fR1IkyQ6Q.gif"/></noscript>
<p class="graf graf--p">åœ¨è¿™ä¸ªé¡¹ç›®çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨<code>Apollo</code>æ¥æ¢ç´¢GraphQLã€‚ApolloåŒæ—¶æ”¯æŒNodeJså’ŒVueJsã€‚ğŸ˜ƒ</p>
<p class="graf graf--p">è®©æˆ‘ä»¬æ¥çœ‹çœ‹æˆ‘ä»¬é¡¹ç›®çš„æ¼”ç¤ºæ˜¯ä»€ä¹ˆæ ·å­çš„ï¼Œè¿™åº”è¯¥ä¼šç»™ä½ ä¸€ä¸ªæœªæ¥çš„æƒ³æ³•ã€‚ä¹Ÿå¯ä»¥è®¾ç½®ä¸€ä¸‹ã€‚</p>
<p><img decoding="async" class="graf-image jetpack-lazy-image" src="../Images/45e0561db1a9ea1d322533c0e6472b1a.png" data-image-id="1*iC228AF0k17NXArEiFsLAQ.gif" data-lazy-src="https://storage.googleapis.com/blog-images-backup/1*iC228AF0k17NXArEiFsLAQ.gif?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://storage.googleapis.com/blog-images-backup/1*iC228AF0k17NXArEiFsLAQ.gif"/></p><noscript><img data-lazy-fallback="1" decoding="async" class="graf-image" src="../Images/45e0561db1a9ea1d322533c0e6472b1a.png" data-image-id="1*iC228AF0k17NXArEiFsLAQ.gif" data-original-src="https://storage.googleapis.com/blog-images-backup/1*iC228AF0k17NXArEiFsLAQ.gif"/></noscript><br/>
Recipe demo
<h4>GraphQLçš„å…³é”®ç»„ä»¶</h4>
<h4 class="graf graf--h4">æˆ‘ä»¬å°†é‡ç‚¹å…³æ³¨å››ä¸ªä¸»è¦éƒ¨åˆ†:</h4>
<p class="graf graf--p">ç±»å‹</p>
<ul class="postList">
<li class="graf graf--li">é—®é¢˜</li>
<li class="graf graf--li">å˜åŒ–</li>
<li class="graf graf--li">ä¸‹å†³å¿ƒè€…</li>
<li class="graf graf--li"><strong class="markup--strong markup--li-strong">ç±»å‹:</strong>åœ¨æ•°æ®åº“å±‚é¢ä¸Šï¼Œæˆ‘ä»¬ä¸ºæ¯ä¸ªæ¨¡å‹éƒ½å‡†å¤‡äº†ä¸€ä¸ª<code>schema</code>ã€‚åœ¨è¿™ä¸ªé¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬åªæœ‰ä¸¤ä¸ªæ¨¡å‹(é…æ–¹å’Œç”¨æˆ·)ã€‚</li>
</ul>
<ol class="postList">
<li class="graf graf--li"><em>æ•°æ®åº“çº§æ¨¡å¼</em></li>
</ol>
<pre><code>const recipeSchema = new mongoose.Schema({
    name: {
        type: String,
    },
    description: {
        type: String,
    },
    difficultyLevel: {
        type: Number,
    },
    fileUrl: {
        type: String
    },
    steps: [{
        type: String
    }],
    averageTimeForCompletion: {
        type: Number,
    },
userId: {
        type: mongoose.Schema.Types.ObjectId,
        ref: 'User'
    }
}, { timestamps: true });
export const Recipe = mongoose.model('Recipe', recipeSchema);</code></pre>
<p>æˆ‘ä»¬è¿˜æœ‰ä¸€ä¸ªAPIçº§åˆ«çš„æ¨¡å¼ï¼Œå®ƒå°†ç¬¦åˆä¸Šé¢çš„æ•°æ®åº“æ¨¡å¼ã€‚è¿™ä¸ªæ¨¡å¼ä¹Ÿåƒæ•°æ®åº“æ¨¡å¼ä¸Šçš„éªŒè¯å™¨ä¸€æ ·ã€‚å…·æœ‰GraphQLæ— æ³•è¯†åˆ«çš„ç±»å‹çš„æŸ¥è¯¢å°†è¢«é€€å›ã€‚</p>
<p class="graf graf--p"><em>APIçº§æ¨¡å¼</em></p>
<pre><code>type Recipe {
  id: ID!
  name: String!
  description: String!
  difficultyLevel: Int!
  image: String!
  steps: [String]!
  averageTimeForCompletion: Int!
  user: User!
}</code></pre>
<p>åœ¨ç¼–å†™æ¨¡å¼æ—¶ï¼ŒGraphQLæ”¯æŒä¸åŒçš„å¯¹è±¡<code>Types</code>:<code>Int</code>ï¼Œ<code>Float</code>ï¼Œ<code>String</code>ï¼Œ<code>Boolean</code>ï¼Œ<code>ID</code>ï¼Œå°±åƒMongoDBä¸­çš„_idä¸€æ ·ã€‚å®ƒè¿˜æ”¯æŒListï¼Œä»¥é˜²ä½ çš„æ•°æ®åº“æ¨¡å¼æœ‰ä¸€ä¸ªå¯¹è±¡åˆ—è¡¨å’Œæ›´å¤šçš„åˆ—è¡¨ã€‚</p>
<p class="graf graf--p">ç¬¦å·ç¡®ä¿å¯¹è±¡ä¸è¿”å›ç©ºå€¼ã€‚å½“ä½ å†æ¬¡ç¡®å®šæ—¶ï¼Œæ€»æ˜¯ä½¿ç”¨å®ƒï¼Œä¸€ä¸ªå€¼å°†è¢«è¿”å›ã€‚å¦‚æœå®ƒä¼¼ä¹è¢«ä½¿ç”¨ï¼Œå¹¶ä¸”å€¼ä¸ºnullï¼Œé‚£ä¹ˆå°†æŠ›å‡ºä¸€ä¸ª<code>error</code>ã€‚åœ¨ä¸Šé¢çš„ä»£ç ç‰‡æ®µä¸­ï¼Œæˆ‘ä»¬ä¸å¸Œæœ›ç±»å‹ä¸º<code>ID</code>çš„<code>id</code>ä¸ºç©ºã€‚</p>
<p class="graf graf--p">æˆ‘ä»¬ä¹Ÿå¯ä»¥æ‹¥æœ‰è‡ªå·±çš„<code>custom</code>ç±»å‹ï¼Œå°±åƒæˆ‘ä»¬æ‹¥æœ‰<code>File</code>ç±»å‹ä¸€æ ·ã€‚</p>
<p class="graf graf--p"><strong class="markup--strong markup--p-strong"> 2ã€‚æŸ¥è¯¢:</strong>åœ¨RESTä¸­ï¼Œè·å–æ•°æ®çš„æ ‡å‡†æ–¹å¼æ˜¯ä½¿ç”¨<code>GET.</code>åŒæ ·çš„æ¦‚å¿µä¹Ÿé€‚ç”¨äºGraphQLæŸ¥è¯¢ã€‚æˆ‘ä»¬åœ¨éœ€è¦è·å–æ•°æ®çš„åœ°æ–¹ä½¿ç”¨æŸ¥è¯¢ã€‚æŸ¥è¯¢åœ¨GraphQLä¸­åªèƒ½å®šä¹‰ä¸€æ¬¡ã€‚</p>
<pre><code>type File {
    id: ID!
    url: String!
}</code></pre>
<p class="graf graf--p">ä¸ºäº†æ›´å¥½åœ°ç†è§£ï¼Œæ¯ä¸ªGraphQLç»„ä»¶åœ¨é¡¹ç›®ä¸­éƒ½æœ‰è‡ªå·±çš„æ–‡ä»¶ã€‚åœ¨recipeé¡¹ç›®ä¸­ï¼Œå…³é”®å­—<code>Query</code>è¢«å¤šæ¬¡ä½¿ç”¨ã€‚</p>
<p class="graf graf--p">è®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•ç¼–å†™ä¸€ä¸ª<code>query</code>æ¥è·å–ä¼šè¯ä¸­ç”¨æˆ·çš„å±æ€§ã€‚</p>
<p class="graf graf--p">æ›´å¤šæ¥è‡ªLogRocketçš„ç²¾å½©æ–‡ç« :</p><div class="code-block code-block-54">
<hr/>
<h3><em>æŸ¥è¯¢ç”¨æˆ·</em></h3>

<hr/></div>
<pre><code>type User {
    id: ID!
    email: String!
    name: String!
    token: String
    createdAt: String!
    updatedAt: String!
}
type Query {
    getMe: User!
}</code></pre>
<p>æ—¢ç„¶æˆ‘ä»¬å·²ç»åœ¨ç”¨æˆ·èµ„æºä¸­å£°æ˜äº†<code>query</code>ï¼Œæˆ‘ä»¬è¿˜å¿…é¡»åœ¨é…æ–¹èµ„æºä¸­å£°æ˜æŸ¥è¯¢ã€‚ä½ åº”è¯¥çŸ¥é“å®ƒä¼šæŠ›å‡ºä¸€ä¸ªé”™è¯¯ã€‚å¥½å§ï¼Œæˆ‘ä»¬éƒ½å‡†å¤‡å¥½äº†ã€‚å¯¹äºå¤šæ¬¡ä½¿ç”¨çš„å…³é”®å­—æŸ¥è¯¢ï¼Œéœ€è¦ä½¿ç”¨å…³é”®å­—<code>extend</code>è¿›è¡Œæ‰©å±•ã€‚</p>
<p class="graf graf--p">ä¸ºäº†è·å–ç”¨æˆ·é£Ÿè°±ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªä¸è¯¥é£Ÿè°±ç›¸å…³è”çš„ç”¨æˆ·IDã€‚GraphQLæŸ¥è¯¢ä¹Ÿå¯ä»¥æ¥å—å‚æ•°ã€‚</p>
<p class="graf graf--p"><em>é…æ–¹</em></p>
<pre><code>extend type Query {
    Recipe(id: ID!): Recipe!
    Recipes: [Recipe]!
}</code></pre>
<p>ä¸Šé¢æœ‰ä¸¤ä¸ªä¸åŒçš„æŸ¥è¯¢ã€‚ç¬¬ä¸€ä¸ªå‡½æ•°ä½¿ç”¨ç±»å‹ä¸º<code>ID</code>çš„å‚æ•°<code>id</code>è·å¾—ä¸€ä¸ªé£Ÿè°±ï¼Œè¯¥å‚æ•°ä¸èƒ½ä¸ºç©ºï¼Œè€Œåè€…è¿”å›ç³»ç»Ÿä¸­çš„æ‰€æœ‰é£Ÿè°±ã€‚</p>
<p class="graf graf--p"><strong class="markup--strong markup--p-strong"> 3ã€‚çªå˜:</strong>ä¸€ä¸ªAPIä¸ä»…ä»…æ˜¯è·å–ï¼Œåœ¨æŸäº›æ—¶å€™ï¼Œæ•°æ®å¿…é¡»è¢«å­˜å‚¨ã€æ›´æ–°æˆ–åˆ é™¤ä»¥ä¿æŒæˆ‘ä»¬å¹³å°çš„æ´»åŠ›ã€‚è¦æ‰§è¡Œæ­¤æ“ä½œ(<code>POST</code>ã€<code>PUT</code>ã€<code>DELETE</code>ç­‰)ï¼Œæœ€å¥½åœ¨<code>mutation</code>ä¸‹å£°æ˜ã€‚</p>
<p class="graf graf--p"><em>åˆ›å»ºä¸€ä¸ªç”¨æˆ·(çªå˜)</em></p>
<pre><code>type Mutation {
    createUser(email: String!, name: String!, password: String)
}</code></pre>
<p>å˜å¼‚æœ¬å¯ä»¥å†™å¾—æ›´å¥½ï¼Œä½†æˆ‘æ›´å–œæ¬¢ä½¿ç”¨å˜é‡å£°æ˜é£æ ¼ã€‚æ˜¯çš„ï¼Œä½ ä¹Ÿå¯ä»¥ä¸ºä½ çš„çªå˜å£°æ˜ä¸€ä¸ªå˜é‡ã€‚</p>
<p class="graf graf--p">å¦‚æœæ‚¨éœ€è¦å®¢æˆ·æœºåœ¨å‘é€å“åº”ä¹‹å‰æä¾›è¾“å…¥ï¼Œå˜é‡å°†ä¼šæ´¾ä¸Šç”¨åœºã€‚</p>
<p class="graf graf--p"><em>ç”¨æˆ·ç™»å½•å’Œæ³¨å†Œ</em></p>
<pre><code>type Mutation {
  createUser(input: NewUser!): User!
  loginUser(input: LoginUser!): User!
}</code></pre>
<p>å˜é‡å¯ä»¥æœ‰ä»»ä½•å½¢å¼ã€‚åªè¦é€šè¿‡åˆ›å»ºæˆ–å£°æ˜æ‚¨çš„å˜é‡ç±»å‹æ¥é€šçŸ¥GraphQLï¼Œå°±ä¸ä¼šæœ‰è­¦æŠ¥ã€‚ğŸ˜‰</p>
<p class="graf graf--p">åœ¨ä¸Šé¢çš„å˜å¼‚ä¸­ï¼Œæˆ‘ä»¬æœ‰æ¥å—ç±»å‹ä¸º<code>NewUser</code>çš„<code>input</code>çš„<code>loginUser</code>å’Œ<code>createUser</code>ï¼Œåè€…å¿…é¡»è¿”å›ç±»å‹<code>User</code>å’Œç±»å‹<code>LoginUser</code>ï¼Œåè€…ä¹Ÿè¿”å›ç±»å‹<code>User</code>ã€‚æˆ‘ä»¬å·²ç»åœ¨ä¸Šé¢çœ‹åˆ°äº†ç”¨æˆ·çš„æ ·å­ã€‚</p>
<p class="graf graf--p"><code>input</code>æ˜¯å˜é‡çš„ä¸€ç§å½¢å¼ï¼Œä¸ºå£°æ˜ç±»å‹çš„å‚æ•°æä¾›æœåŠ¡ã€‚</p>
<blockquote class="graf graf--blockquote"><p>ç™»å½•å’Œæ³¨å†Œç±»å‹</p></blockquote>
<pre><code>input LoginUser {
  email: String!
  password: String!
}
input NewUser {
  email: String!
  name: String!
  password: String!
}</code></pre>
<p><em>é…æ–¹æ¨¡å¼</em></p>
<pre><code>type Recipe {
  id: ID!
  name: String!
  description: String!
  difficultyLevel: Int!
  image: String
  steps: [String]!
  averageTimeForCompletion: Int!
  user: User!
}
input NewRecipe {
  name: String!
  description: String!
  difficultyLevel: Int!
  image: Upload
  steps: [String]! 
  averageTimeForCompletion: Int!
}
input UpdateRecipe {
  id: ID!
  name: String
  description: String
  difficultyLevel: Int!
  image: String
  steps: [String]
  averageTimeForCompletion: Int!
}
input DeleteRecipe {
    id: ID!
}
# query is use when you want to get anything from 
#the server just like (GET) using REST
extend type Query {
    Recipe(id: ID!): Recipe!
    Recipes: [Recipe]!
}
# performing actions (that requires DELETE, PUT, POST) 
#just as in REST requires a mutation 
extend type Mutation {
    deleteRecipe(input: DeleteRecipe!): Recipe!
    updateRecipe(input: UpdateRecipe!): Recipe!
    newRecipe(input: NewRecipe!): Recipe!
}</code></pre>
<p>åœ¨ä¸Šé¢çš„ä»£ç ç‰‡æ®µä¸­ï¼Œç”¨æˆ·å¯ä»¥æ ¹æ®æˆ‘ä»¬åœ¨<code>Mutation</code>ä¸­çš„å£°æ˜å†³å®šåˆ é™¤é…æ–¹ã€æ›´æ–°é…æ–¹å’Œåˆ›å»ºæ–°é…æ–¹ã€‚</p>
<p class="graf graf--p">æœ‰æ²¡æœ‰æ³¨æ„åˆ°ä¸€ä¸ªæ²¡æœ‰å£°æ˜ä½†æ˜¯ä½¿ç”¨äº†<code>Upload</code>çš„ç±»å‹ï¼Ÿä½†æ˜¯GraphQLä¼¼ä¹å¯¹æ­¤å¹¶ä¸ä»‹æ„ã€‚æˆ‘ä»¬å°†åœ¨æ–‡ä»¶éƒ¨åˆ†è®¨è®ºè¿™ä¸ªé—®é¢˜ã€‚</p>
<p class="graf graf--p"><strong class="markup--strong markup--p-strong"> 4ã€‚</strong> <strong class="markup--strong markup--p-strong">è§£æå™¨:</strong>æ—¢ç„¶æˆ‘ä»¬å·²ç»å£°æ˜äº†ç±»å‹ã€çªå˜å’ŒæŸ¥è¯¢ã€‚è¿™ä¸å®¢æˆ·å¯¹æˆ‘ä»¬æ•°æ®åº“çš„è¦æ±‚æœ‰ä»€ä¹ˆè”ç³»ï¼Ÿ</p>
<p class="graf graf--p">è®©æˆ‘ä»¬æ¥çœ‹çœ‹è¿™ä¸ªæµç¨‹â€¦</p>
<p class="graf graf--p">æ‰€ä»¥åœ¨GraphQLä¸­ï¼Œæˆ‘ä»¬æœ‰æ ‡é‡ç±»å‹(<code>Strings</code>ã€<code>Integers</code>ã€<code>Booleans</code>ã€<code>Float</code>ã€<code>Enums</code>)ã€‚å¦‚æœæˆ‘ä»¬è¶³å¤Ÿå¹¸è¿åœ°å°†æˆ‘ä»¬çš„æ•°æ®åº“å¯¹è±¡ä¸æˆ‘ä»¬æ‹¥æœ‰çš„ç±»å‹ç›¸åŒ¹é…ï¼ŒGraphQLå°†ä¸ºæˆ‘ä»¬è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p>
<figure class="graf graf--figure"><img decoding="async" class="graf-image jetpack-lazy-image" src="../Images/340491add529eefce26ec24de0b6dc46.png" data-image-id="1*a6F8kPNU5PT6NPH8zEyq3g.png" data-width="741" data-height="771" data-lazy-src="https://storage.googleapis.com/blog-images-backup/1*a6F8kPNU5PT6NPH8zEyq3g.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://storage.googleapis.com/blog-images-backup/1*a6F8kPNU5PT6NPH8zEyq3g.png"/><noscript><img data-lazy-fallback="1" decoding="async" class="graf-image" src="../Images/340491add529eefce26ec24de0b6dc46.png" data-image-id="1*a6F8kPNU5PT6NPH8zEyq3g.png" data-width="741" data-height="771" data-original-src="https://storage.googleapis.com/blog-images-backup/1*a6F8kPNU5PT6NPH8zEyq3g.png"/></noscript><figcaption class="imageCaption">An overview of how GraphQL handlesÂ data</figcaption></figure>
<p class="graf graf--p">è®©æˆ‘ä»¬æ¥å¤„ç†æˆ‘ä»¬åœ¨çªå˜ä¸­å£°æ˜çš„åŠ¨ä½œã€‚è®°ä½æˆ‘ä»¬åœ¨çªå˜ä¸­å£°æ˜çš„è®ºç‚¹æ˜¯<code>input</code>ã€‚æ— è®ºæˆ‘ä»¬æœŸæœ›ä»å®¢æˆ·ç«¯å¾—åˆ°ä»€ä¹ˆï¼Œéƒ½å¯ä»¥åœ¨å˜é‡<code>input</code>ä¸­æ‰¾åˆ°ã€‚</p>
<p class="graf graf--p"><em>ç™»å½•ç”¨æˆ·</em></p>
<pre><code>import { User } from './user.model'; 
import { Recipe } from '../recipe/recipe.model'; 
import { signIn, verify } from '../../modules/auth';''
const loginUser = async(root, { input }) =&gt; {
    const { email, password } = input;
    const user = await User.findOne({ email }).exec();
    const errorMsg = 'Wrong credentials. Please try again';
    if(!user) {
        throw new Error (errorMsg);
    }
    if(user.comparePassword(password)) {
        user.token = signIn({ id: user._id, email: user.email });
        return user;
    }
    else{
        throw new Error (errorMsg);
    }
};</code></pre>
<p>è®©æˆ‘ä»¬èŠ±ç‚¹æ—¶é—´æ¥çœ‹çœ‹<code>Queries</code>å’Œ<code>Mutations</code>çš„è®ºç‚¹ã€‚ä»¥<code>loginUser</code>ä¸ºä¾‹ã€‚</p>
<p class="graf graf--p">æ¯ä¸ªè§£æå™¨ä¸­éƒ½æœ‰å››ä¸ªä¸»è¦çš„è‡ªå˜é‡(<code>rootValue</code>ã€<code>arguments</code>ã€<code>context </code>å’Œ<code>info</code>)ã€‚</p>
<p class="graf graf--p"><code>rootValue</code>:ä¸»è¦ç”¨äºå¤„ç†åµŒå¥—è§£æå™¨(ä¸»åˆ†æ”¯çš„å­åˆ†æ”¯)ã€‚</p>
<ul class="postList">
<li class="graf graf--li"><em>ç”¨æˆ·ç±»å‹</em></li>
</ul>
<pre><code>type User {
    id: ID!
    email: String!
    name: String!
    token: String
    recipes: [Recipe]!
    createdAt: String!
    updatedAt: String!
}</code></pre>
<p>çœ‹ä¸Šé¢çš„ç±»å‹ï¼Œåœ¨æˆ‘ä»¬çš„æ•°æ®åº“æ¨¡å‹ä¸­æœ‰ä¸€ä¸ªæˆ‘ä»¬æ²¡æœ‰å£°æ˜çš„å¯¹è±¡ã€‚è¿™æ„å‘³ç€GraphQLæœŸæœ›æˆ‘ä»¬è§£å†³(å¤„ç†å®ƒå¹¶èµ‹å€¼)ã€‚</p>
<p class="graf graf--p"><code>recipes</code>å°†è¢«è§†ä¸ºåµŒå¥—è§£æå™¨ã€‚æ ‘æä¸Šæ–¹çš„<code>rootValue</code>æ˜¯<code>User</code>ã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯<code>fetching recipes</code>ç”±ç”¨æˆ·åˆ›å»ºã€‚</p>
<p class="graf graf--p"><em>åµŒå¥—è§£æå™¨</em></p>
<pre><code>
    User: {
        recipes(user) {
           return Recipe.find({ userId: user.id }).exec()
        }
    }</code></pre>
<p><code>arguments</code>:ä¿å­˜ä»å®¢æˆ·ç«¯ä¼ æ¥çš„å‚æ•°ã€‚åœ¨æˆ‘ä»¬å®šä¹‰çš„çªå˜ä¸­ï¼Œæˆ‘ä»¬æœŸæœ›å®¢æˆ·ç«¯ä¼ å…¥ä¸€ä¸ª<code>input</code></p>
<ul class="postList">
<li class="graf graf--li"><code>context</code>:å®ƒä¿å­˜äº†æ‰€æœ‰éœ€è¦åœ¨è§£æå™¨ä¹‹é—´å…±äº«çš„æ•°æ®ã€‚åœ¨è¿™ä¸ªé¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬å°†ç»è¿‡éªŒè¯çš„ç”¨æˆ·ä¼ é€’ç»™ä¸Šä¸‹æ–‡</li>
<li class="graf graf--li">è¿™æ˜¯æˆ‘ä»¬å¯èƒ½æ°¸è¿œä¸ä¼šä½¿ç”¨çš„å”¯ä¸€è®ºæ®ã€‚è¿™æ˜¯åŸå§‹çš„GraphQLæŸ¥è¯¢</li>
<li class="graf graf--li">å¯¹äº<code>loginUser</code>ï¼Œç”¨æˆ·ä¼ é€’ä»å‚æ•°å¯¹è±¡ä¸­ææ„çš„ç”µå­é‚®ä»¶å’Œå¯†ç ï¼Œç„¶åè¿”å›ä¸€ä¸ªç”¨æˆ·ï¼Œå°±åƒæˆ‘ä»¬åœ¨å˜å¼‚ä¸­å£°æ˜çš„é‚£æ ·(userï¼)å¦‚æœå‡­è¯æ˜¯æ­£ç¡®çš„ï¼Œå¦åˆ™æˆ‘ä»¬æŠ›å‡ºä¸€ä¸ªé”™è¯¯ã€‚</li>
</ul>
<p class="graf graf--p">æˆ‘ä»¬åœ¨çªå˜ç±»å‹(<code>server/api/resources/user/<em class="markup--em markup--p-em">user.graphql file</em></code>)ä¸­çš„å£°æ˜ä¹Ÿå¿…é¡»ä¸ä¼ é€’ç»™è§£æå™¨çš„å£°æ˜ç›¸åŒã€‚</p>
<p class="graf graf--p"><em>ç”¨æˆ·è§£æå™¨</em></p>
<pre><code>export const userResolvers = {
    Query: {
        getMe
    },
    Mutation: {
        createUser, //createUser: createUser
        loginUser //loginUser: loginUser
    },
    User: {
        recipes(user) {
           return Recipe.find({ userId: user.id }).exec()
        }
    }
}</code></pre>
<p>è¯æ˜</p>
<h4 class="graf graf--h4">æœ‰å‡ ç§æ–¹æ³•å¯ä»¥éªŒè¯æˆ‘ä»¬çš„GraphQLåº”ç”¨ç¨‹åºï¼Œç‰¹åˆ«æ˜¯å½“æˆ‘ä»¬æƒ³è¦å…¬å¼€æŸ¥è¯¢æˆ–å˜å¼‚æ“ä½œæ—¶(<code>loginUser</code>å’Œ<code>createUser</code>)ã€‚</h4>
<p class="graf graf--p">æˆ‘ä»¬å¯ä»¥é€šè¿‡å¯¹å…¬å…±è·¯ç”±ä½¿ç”¨RESTå’Œå•ç‹¬ä¿æŠ¤å•ä¸€GraphQLè·¯ç”±æ¥ä¿æŠ¤å®ƒã€‚å°±ä¸ªäººè€Œè¨€ï¼Œæˆ‘æ€»æ˜¯é€‰æ‹©è¿™ä¸ªé€‰é¡¹ï¼Œå› ä¸ºå®ƒä¸ºæ‚¨çš„åº”ç”¨ç¨‹åºæä¾›äº†çµæ´»æ€§ã€‚</p>
<p class="graf graf--p">åœ¨è¿™ä¸ªé¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬åœ¨ä¸€ä¸ª<code>resolver level</code>ä¸Šè®¤è¯äº†GraphQLã€‚å½“ç”¨æˆ·æˆåŠŸç™»å½•æ—¶ï¼Œä½¿ç”¨<code>jwebtokens</code>ç”Ÿæˆçš„ä»¤ç‰Œè¢«è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œå¹¶è¢«ä¼ é€’ç»™å¤´éƒ¨ã€‚</p>
<p class="graf graf--p">ä¸­é—´ä»¶</p>
<pre><code>import { verify } from './api/modules/auth';
const setMiddleware = (app) =&gt; {
    app.use(async (req, res, next) =&gt; {
        try{
            const token = req.headers.authorization || '';
            const user = await verify(token);
            req.user = user;
        }
        catch(e) {
            console.log(e)
            req.user = null;
        }
        next();
    });
};
export default setMiddleware;</code></pre>
<h4>ä¸­é—´ä»¶äº¤å‰æ£€æŸ¥æ¯ä¸ªè¯·æ±‚ä¸­çš„æŠ¥å¤´ï¼Œè·å–ä»¤ç‰Œï¼ŒéªŒè¯å¹¶åœ¨æˆåŠŸçš„æƒ…å†µä¸‹ç»™å‡ºé€‚å½“çš„æœ‰æ•ˆè½½è·(ç”¨æˆ·)ã€‚ä¸­é—´ä»¶ç„¶åè¢«ä¼ é€’åˆ°ApolloæœåŠ¡å™¨ã€‚</h4>
<p class="graf graf--p">æ—¢ç„¶æˆ‘ä»¬ä½¿ç”¨expressï¼Œ<code>apollo-server-express</code>æ˜¯æˆ‘ä»¬æœ€å¥½çš„å·¥å…·ã€‚</p>
<p class="graf graf--p"><em>è®¤è¯</em></p>
<pre><code>setMiddleware(app);
const path = '/recipe'
graphQLRouter.applyMiddleware({ app, path});
</code><code>const secret = process.env.TOKEN_SECRET;
const expiresIn = process.env.EXPIRES_IN || '1 day';
export const signIn = payload =&gt; jsonwebtoken.sign(payload, secret, { expiresIn });
export const verify = token =&gt; {
    return new Promise((resolve, reject) =&gt; {
        jsonwebtoken.verify(token, secret, {}, (err, payload) =&gt; {
            if(err){
                return reject(err);
            }
            return resolve(payload);
        })
    })
}
export const throwErrorIfUserNotAuthenticated = user =&gt; 
        {if(!user) throw new Error('hey!. You are not authenticated')}</code></pre>
<p>è¿™æ˜¯å…³é”®ï¼Œæ¯ä¸ªçƒå‘˜éƒ½èµ°åˆ°äº†ä¸€èµ·ã€‚GraphQLæ ‡ç­¾(<code>gql</code>)ä½¿å¾—ç¼–å†™å’Œç»„åˆæ¨¡å¼æ›´åŠ å®¹æ˜“ã€‚</p>
<p class="graf graf--p">å¯¹äºæ¯ä¸ªè§£æå™¨ï¼Œæˆ‘ä»¬æ£€æŸ¥ç”¨æˆ·æ˜¯å¦ä¸ºç©ºï¼Œä¸€æ—¦ä¸ºç©ºï¼Œå®¢æˆ·ç«¯å°±è¢«é€€å›ã€‚ç³»ç»Ÿå‘Šè¯‰å®¢æˆ·ç«¯å¯¹è¯·æ±‚è¿›è¡Œèº«ä»½éªŒè¯ã€‚</p>
<pre><code>import { ApolloServer, gql } from 'apollo-server-express';
import merge from 'lodash.merge'
import { userType, userResolvers } from './resources/user';
import { recipeType, recipeResolvers } from './resources/recipe';
import { fileType } from './resources/file';
const typeDefs = gql`${userType}${recipeType}${fileType}`;
export const graphQLRouter = new ApolloServer(
    {
        typeDefs,
        resolvers: merge({}, userResolvers, recipeResolvers),
        context: ({req, res})=&gt; ({ user: req.user })
    }
);</code></pre>
<p class="graf graf--p">æ£€æŸ¥ç”¨æˆ·æ˜¯å¦æœ‰æƒè®¿é—®æ­¤è§£æç¨‹åº</p>
<pre><code>const getRecipe = (root, { id }, { user }) =&gt; {
    throwErrorIfUserNotAuthenticated(user); 
    return Recipe.findById(id).exec();
}; </code></pre>
<p>æ–‡ä»¶ä¸Šä¼ </p>
<h4 class="graf graf--h4">é™¤äº†å‘é€ç®€å•çš„æ•°æ®ï¼Œæˆ‘ä»¬è¿˜ä¼šä»¥æŸç§æ–¹å¼ä¸Šä¼ æ–‡ä»¶ã€‚Apollo server 2.0 ~é€šè¿‡å¼€ç®±å³ç”¨å¤„ç†æ–‡ä»¶ï¼Œè®©ç”Ÿæ´»å˜å¾—æ›´åŠ è½»æ¾ã€‚<code>Upload</code>graph QLè¯†åˆ«æ ‡é‡ã€‚å®ƒå¸®åŠ©å¤„ç†ä¸€ä¸ªå¯å˜æ–‡ä»¶å¯¹è±¡ã€‚å®ƒè¢«æ·»åŠ åˆ°<code>NewRecipe</code>è¾“å…¥ä¸­ï¼Œä»¥å¤„ç†è¯·æ±‚é™„å¸¦çš„æ–‡ä»¶ã€‚</h4>
<p class="graf graf--p">åˆ›å»ºæ–°é…æ–¹</p>
<pre><code>
const createRecipe = async (root, { input }, { user }) =&gt; {
  throwErrorIfUserNotAuthenticated(user);
  //    bring out the image from input for file processing
  const { image, ...recipeObject } = await input;
  let url = "";
  if (image) {
    const result = await uploadFile(image);
    url = result.url;
  }
  const recipe = await Recipe.findOne({ name: input.name.toLowerCase() });
  if (recipe) {
    throw new Error("Recipe already exists!");
  }
  Object.assign(recipeObject, { image: url, userId: user.id });
  return Recipe.create(recipeObject);
};</code></pre>
<p>æ–‡ä»¶æµæ­£åœ¨è¢«å¤„ç†ï¼Œå®Œæˆåï¼ŒURLå°†ä¸restè¾“å…¥å¯¹è±¡ä¸€èµ·ä¿å­˜ã€‚</p>
<p class="graf graf--p">è®©æˆ‘ä»¬çœ‹çœ‹åŒ»ç”Ÿã€‚å¦‚æœæ‚¨çš„ç«¯å£å·æ˜¯3000å¹¶ä¸”æ‚¨çš„MongoDBåœ¨æœ¬åœ°è¿è¡Œï¼Œé‚£ä¹ˆå¯ä»¥åœ¨<a class="markup--anchor markup--p-anchor" href="http://localhost:3000/recipe" target="_blank" rel="nofollow noopener noreferrer" data-href="http://localhost:3000/recipe">http://localhost:3000/recipe</a>ä¸Šè®¿é—®å®ƒã€‚ä¸€æ—¦ä½ èƒ½ä¸æ–‡æ¡£å¾ˆå¥½åœ°äº’åŠ¨ï¼Œå®¢æˆ·ç«¯å°±å˜å¾—éå¸¸å®¹æ˜“ã€‚</p>
<pre><code>import cloudinary from "cloudinary";
import streamToBuffer from "stream-to-buffer";
cloudinary.config({
  cloud_name: process.env.CLOUDINARY_CLOUD_NAME,
  api_key: process.env.CLOUDINARY_API_KEY,
  api_secret: process.env.CLOUDINARY_API_SECRET
});
export const uploadFile = async file =&gt; {
  const { mimetype, stream } = await file;
  // process image
  return new Promise((resolve, reject) =&gt; {
    if (!Object.is(mimetype, "image/jpeg")) {
      throw new Error("File type not supported");
    }
    streamToBuffer(stream, (err, buffer) =&gt; {
      cloudinary.v2.uploader
        .upload_stream({ resource_type: "raw" }, (err, result) =&gt; {
          if (err) {
            throw new Error("File not uploaded!");
          }
          return resolve({ url: result.url });
        })
        .end(buffer);
    });
  });
};</code></pre>
<p class="graf graf--p">äº¤ç»™å®¢æˆ·</p>
<h4 class="graf graf--h4">å¦‚æœä½ ç†Ÿæ‚‰ä»Vueå‘æœåŠ¡å™¨å‘é€æ•°æ®ï¼Œä½¿ç”¨<code>vue-apollo</code>æ²¡æœ‰å¤ªå¤§åŒºåˆ«ã€‚ä½ æ‰€éœ€è¦åšçš„å°±æ˜¯å†™å‡ºä½ çš„é—®é¢˜ã€‚Vue-apolloä¸ºæ‚¨å¤„ç†å…¶ä½™çš„äº‹æƒ…ã€‚</h4>
<p class="graf graf--p">é‚£ä¹ˆï¼Œè®©æˆ‘ä»¬è®¾ç½®æˆ‘ä»¬çš„Vue-apollo:</p>
<p class="graf graf--p"><code>setContext</code> from <code>apollo-link-context</code>è®©æˆ‘ä»¬èƒ½å¤Ÿåœ¨è¯·æ±‚ä¼ é€’åˆ°æœåŠ¡å™¨ä¹‹å‰æ‹¦æˆªå®ƒã€‚è®°ä½ï¼Œæˆ‘ä»¬éœ€è¦å°†ä¸€ä¸ªä»¤ç‰Œä¼ é€’ç»™å¤´éƒ¨ï¼Œä»¥ä¾¿è®¿é—®ç»è¿‡èº«ä»½éªŒè¯çš„èµ„æºã€‚</p>
<pre><code>import Vue from 'vue';
import VueApollo from "vue-apollo";
import apolloUploadClient from "apollo-upload-client"
import { InMemoryCache } from "apollo-cache-inmemory";
import { ApolloClient } from "apollo-client";
import { setContext } from "apollo-link-context";
Vue.use(VueApollo);
const baseUrl = "http://localhost:3000/recipe";
const uploadClientLink = apolloUploadClient.createUploadLink({
  uri: baseUrl
});
const interceptor = setContext((request, previousContext) =&gt; {
  const token = localStorage.getItem("token");
  if(token) {
    return {
        headers: {
          authorization: token
        }
      };
  }
});
const apolloClient = new ApolloClient({
  link: interceptor.concat(uploadClientLink),
  cache: new InMemoryCache(),
  connectToDevTools: true
});
const instance = new VueApollo({
  defaultClient: apolloClient
});
export default instance;
view raw</code></pre>
<p class="graf graf--p">æ¯ä¸ªå“åº”éƒ½è¢«ç¼“å­˜ã€‚<code>cache: new InMemoryCache()</code>ï¼Œä»ä¸Šé¢æ˜¾ç¤ºçš„æ¼”ç¤ºä¸­ï¼Œå½“ä¸€ä¸ªæ–°çš„é£Ÿè°±è¢«åˆ›å»ºæ—¶ï¼Œæˆ‘ä»¬æœŸæœ›å®ƒå’Œå…¶ä»–é£Ÿè°±ä¸€èµ·åæ˜ åœ¨<code>All recipes </code>é¡µé¢ä¸­ã€‚ä½†æ˜¯å“åº”å·²ç»è¢«ç¼“å­˜äº†ã€‚å®ƒè¿”å›ä»å†…å­˜ä¸­è·å–çš„å“åº”ã€‚è¿™æœ‰åˆ©æœ‰å¼Šã€‚</p>
<p class="graf graf--p"><code>this.$apollo</code>å…è®¸æˆ‘ä»¬è®¿é—®Vue apolloï¼Œåªè¦å®ƒå·²ç»æ·»åŠ (<code>Vue.use(VueApollo)</code>)åˆ°Vueã€‚</p>
<p class="graf graf--p">è®©æˆ‘ä»¬åˆ›å»ºæŸ¥è¯¢:</p>
<p class="graf graf--p">è¿™é‡Œçš„æŸ¥è¯¢ç»“æ„æ˜¯æˆ‘ä»¬åœ¨æœåŠ¡å™¨ç«¯æ‰€æœŸæœ›çš„ï¼ŒæŸ¥è¯¢çš„å“åº”æ˜¯åŸºäºé€‰æ‹©çš„ã€‚</p>
<pre><code>import gql from "graphql-tag";
// user object pointing to loginUser to make the return response pretty
export const LOGIN_QUERY = gql`
  mutation LoginUser($input: LoginUser!) {
    user: loginUser(input: $input) {
      token
    }
  }
`;
export const REGISTERATION_QUERY = gql`
  mutation RegisterUser($input: NewUser!) {
    user: createUser(input: $input) {
      token
    }
  }
`;
export const ALL_RECIPES_QUERY = gql`
  query {
    recipeList: Recipes {
      id
      name
      image
    }
  }
`;
export const GET_USER_QUERY = gql`
  query {
    user: getMe {
      name
      email
      recipes {
        id
        name
        image
      }
    }
  }
`;
export const CREATE_RECIPE_QUERY = gql`
  mutation createRecipe($input: NewRecipe!) {
    newRecipe(input: $input) {
      id
    }
  }
`;</code></pre>
<p class="graf graf--p"><code>GET_USER_QUERY</code>è·å–ä¼šè¯ä¸­ç”¨æˆ·çš„å§“åã€ç”µå­é‚®ä»¶ã€é£Ÿè°±(idã€å§“åå’Œå›¾åƒ)ã€‚</p>
<p class="graf graf--p">å°†<code>apollo</code>æ·»åŠ åˆ°ç»„ä»¶ä¸­ï¼Œä»¥è·å–ä¸å¯¹è±¡ç›¸å…³çš„ç‰¹å®šæŸ¥è¯¢ã€‚<code>getMe</code>æŸ¥è¯¢è¢«ç»‘å®šåˆ°ç”¨æˆ·å¯¹è±¡ã€‚</p>
<pre><code>apollo: {
    user: query.GET_USER_QUERY
  }</code></pre>
<p class="graf graf--p">åœ¨my-recipeé¡µé¢ä¸Šï¼Œæˆ‘ä»¬ä¸å¸Œæœ›å“åº”æ¥è‡ªç¼“å­˜å†…å­˜ã€‚</p>
<p class="graf graf--p"><code>refetch</code>ä½¿ç”¨ç›¸åº”çš„(ç”¨æˆ·)æŸ¥è¯¢ä»æœåŠ¡å™¨è·å–æœ€æ–°æ•°æ®ã€‚è¿™åº”è¯¥è°¨æ…ä½¿ç”¨ã€‚</p>
<pre class="graf graf--pre">this.$apollo.queries.user.refetch();</pre>
<p class="graf graf--p">ä»<code>apollo</code>å¯ä»¥è®¿é—®ä¸€äº›æœ‰è¶£çš„é€‰é¡¹ï¼Œæ¯”å¦‚åŠ è½½çŠ¶æ€ã€é”™è¯¯ã€æš‚åœæŸ¥è¯¢æµç­‰ç­‰ã€‚</p>
<p class="graf graf--p">æˆ‘ä»¬å¦‚ä½•å¤„ç†çªå˜ï¼Ÿ</p>
<p class="graf graf--p">è®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•åˆ›å»ºé£Ÿè°±:</p>
<p class="graf graf--p">å› ä¸ºæˆ‘ä»¬å¯¹å•ä¸ªæ–‡ä»¶æ„Ÿå…´è¶£ï¼Œæ‰€ä»¥fileå¯¹è±¡è¢«ç»‘å®šåˆ°image ( <code>part of the object going to the server</code>)ã€‚</p>
<p class="graf graf--p"><code>$this.apollo.mutate</code>æ¥å—çªå˜åŠå…¶å˜é‡ã€‚å› ä¸ºæœåŠ¡å™¨æ­£åœ¨è¯·æ±‚è¾“å…¥ã€‚ä¸€ä¸ª<code>input</code>å¯¹è±¡è¢«ä¼ é€’ç»™å˜é‡ã€‚</p>
<pre><code>onFileChange(e) {
      const files = e.target.files || e.dataTransfer.files;
      this.image = files[0];
    }</code></pre>
<p class="graf graf--p"><em>åˆ›å»ºé…æ–¹</em></p>
<pre><code>   async createRecipe() {
      const recipeObject = {
        name: this.recipeName,
        description: this.description,
        difficultyLevel: this.difficultyLevel
          ? parseInt(this.difficultyLevel)
          : 0,
        image: this.image,
        steps: this.stepsList,
        averageTimeForCompletion: this.averageTime
          ? parseInt(this.averageTime)
          : 0
      };
      await this.$apollo
        .mutate({
          mutation: query.CREATE_RECIPE_QUERY,
          variables: { input: recipeObject }
        })
        .then(({ data }) =&gt; {
            this.$router.push({ name: "my-recipes" });
        })
        .catch(err =&gt; {
          console.log(err);
          this.error =
            parseGraphqlError(err) || "Something went wrong. Try again...";
        });
    }</code></pre>
<p>ç»“è®º</p>
<h4 class="graf graf--h4">å°±åƒæˆ‘å‰é¢è¯´çš„ï¼Œç›¸æ¯”æˆ‘ä»¬ä¹ æƒ¯çš„(REST)ï¼ŒGraphQLæ›´å®¹æ˜“è®¾ç½®ã€æ›´æ–°å’Œé‡æ„ã€‚</h4>
<p class="graf graf--p">å¦‚æœæ‚¨çš„æ¨¡å¼è®¾è®¡å¾—ä¸å¥½ï¼Œæ‚¨çš„å®¢æˆ·ç«¯å¯ä»¥å¯¹æ‚¨çš„æ¨¡å¼è¿›è¡Œé€’å½’è°ƒç”¨ã€‚é¿å…ä¼šç»™å‡ºç›¸åŒç»“æœçš„æŸ¥è¯¢ã€‚å…³äºGraphQL with Apolloçš„æ›´å¤šä¿¡æ¯ï¼Œè¯·ç‚¹å‡»<a class="markup--anchor markup--p-anchor" href="https://www.apollographql.com/docs/" target="_blank" rel="noopener noreferrer" data-href="https://www.apollographql.com/docs/">è¿™é‡Œ</a>ã€‚å¦‚æœä½ æƒ³äº†è§£æ›´å¤šå…³äºVue Apolloçš„ä¿¡æ¯ï¼Œè¯·ç‚¹å‡»è¿™é‡Œçš„<a class="markup--anchor markup--p-anchor" href="https://akryum.github.io/vue-apollo/guide/" target="_blank" rel="noopener noreferrer" data-href="https://akryum.github.io/vue-apollo/guide/"/>ã€‚</p>
<p class="graf graf--p">åƒç”¨æˆ·ä¸€æ ·ä½“éªŒæ‚¨çš„Vueåº”ç”¨</p><div class="code-block code-block-20">
<div class="blog-plug inline-plug vue-inline"><h2>è°ƒè¯•Vue.jsåº”ç”¨ç¨‹åºå¯èƒ½ä¼šå¾ˆå›°éš¾ï¼Œå°¤å…¶æ˜¯å½“ç”¨æˆ·ä¼šè¯æœŸé—´æœ‰å‡ åä¸ª(å¦‚æœä¸æ˜¯å‡ ç™¾ä¸ª)çªå˜æ—¶ã€‚å¦‚æœæ‚¨å¯¹ç›‘è§†å’Œè·Ÿè¸ªç”Ÿäº§ä¸­æ‰€æœ‰ç”¨æˆ·çš„Vueçªå˜æ„Ÿå…´è¶£ï¼Œ</h2><p>. </p><a href="https://lp.logrocket.com/blg/vue-signup" target="_blank">try LogRocket</a><p>LogRocket å°±åƒæ˜¯ç½‘ç»œå’Œç§»åŠ¨åº”ç”¨ç¨‹åºçš„DVRï¼Œè®°å½•ä½ çš„Vueåº”ç”¨ç¨‹åºä¸­å‘ç”Ÿçš„ä¸€åˆ‡ï¼ŒåŒ…æ‹¬ç½‘ç»œè¯·æ±‚ã€JavaScripté”™è¯¯ã€æ€§èƒ½é—®é¢˜ç­‰ç­‰ã€‚æ‚¨å¯ä»¥æ±‡æ€»å¹¶æŠ¥å‘Šé—®é¢˜å‘ç”Ÿæ—¶åº”ç”¨ç¨‹åºçš„çŠ¶æ€ï¼Œè€Œä¸æ˜¯çŒœæµ‹é—®é¢˜å‘ç”Ÿçš„åŸå› ã€‚</p><a class="signup" href="https://lp.logrocket.com/blg/vue-signup" target="_blank" rel="noopener noreferrer"><img class="alignnone size-full wp-image-46 jetpack-lazy-image" src="../Images/0d269845910c723dd7df26adab9289cb.png" alt="LogRocket Dashboard Free Trial Banner" data-lazy-src="https://files.readme.io/00591d0-687474703a2f2f692e696d6775722e636f6d2f6a3049327856572e706e67.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://files.readme.io/00591d0-687474703a2f2f692e696d6775722e636f6d2f6a3049327856572e706e67.png"/><noscript><img data-lazy-fallback="1" class="alignnone size-full wp-image-46" src="../Images/0d269845910c723dd7df26adab9289cb.png" alt="LogRocket Dashboard Free Trial Banner" data-original-src="https://files.readme.io/00591d0-687474703a2f2f692e696d6775722e636f6d2f6a3049327856572e706e67.png"/></noscript></a><a href="https://lp.logrocket.com/blg/vue-signup" target="_blank" rel="noopener noreferrer">https://logrocket.com/signup/</a><p>LogRocket Vuexæ’ä»¶å°†Vuexçªå˜è®°å½•åˆ°LogRocketæ§åˆ¶å°ï¼Œä¸ºæ‚¨æä¾›å¯¼è‡´é”™è¯¯çš„ç¯å¢ƒï¼Œä»¥åŠå‡ºç°é—®é¢˜æ—¶åº”ç”¨ç¨‹åºçš„çŠ¶æ€ã€‚</p><p>ç°ä»£åŒ–æ‚¨è°ƒè¯•Vueåº”ç”¨çš„æ–¹å¼- <a class="signup" href="https://lp.logrocket.com/blg/vue-signup" target="_blank" rel="noopener noreferrer">å¼€å§‹å…è´¹ç›‘æ§</a>ã€‚</p><p>Modernize how you debug your Vue apps - <a class="signup" href="https://lp.logrocket.com/blg/vue-signup" target="_blank" rel="noopener noreferrer">Start monitoring for free</a>.</p></div>


</div>

<p class="clearfix"/>
<p class="clearfix"/>
</article>

</div>    
</body>
</html>