<html>
<head>
<title>Using Recompose to write clean higher-order components - LogRocket Blog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>ä½¿ç”¨é‡æ–°ç»„åˆæ¥ç¼–å†™å¹²å‡€çš„é«˜é˜¶ç»„ä»¶</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://blog.logrocket.com/using-recompose-to-write-clean-higher-order-components-3019a6daf44c/#0001-01-01">https://blog.logrocket.com/using-recompose-to-write-clean-higher-order-components-3019a6daf44c/#0001-01-01</a></blockquote><div><article class="article-post">
<p><em> <strong>ç¼–è€…æŒ‰</strong>:è‡ª2018å¹´10æœˆ25æ—¥èµ·<a href="https://github.com/acdlite/recompose/issues/756#issuecomment-438674573">åœæ­¢</a>å¯¹é‡ç»„åº“çš„ä¸»åŠ¨ç»´æŠ¤ã€‚ç¬”è€…æ¨èç”¨<a href="https://blog.logrocket.com/react-hooks-cheat-sheet-unlock-solutions-to-common-problems-af4caf699e70/" target="_blank" rel="noopener"> Reacté’©å­</a>ä»£æ›¿ã€‚</em></p>
<p>å¦‚æœæ‚¨å–œæ¬¢åœ¨Reactä¸­é€šè¿‡ä½¿ç”¨åŠŸèƒ½ç»„ä»¶è¯­æ³•åˆ›å»ºå°ç»„ä»¶ï¼Œç„¶åä½¿ç”¨å®ƒä»¬ä½œä¸ºç‰‡æ®µæ¥åˆ›å»ºæ›´å¤§çš„ç»„ä»¶ï¼Œé‚£ä¹ˆ<a class="markup--anchor markup--p-anchor" href="https://github.com/acdlite/recompose" target="_blank" rel="noopener noreferrer" data-href="https://github.com/acdlite/recompose"> Recompose </a>å¯ä»¥å¸®åŠ©æ‚¨å¯¹é«˜é˜¶ç»„ä»¶(hoc)åšåŒæ ·çš„äº‹æƒ…ã€‚</p>
<p>ä½¿ç”¨é‡ç»„ï¼Œå¯ä»¥æ›´å®¹æ˜“åœ°åˆ›å»ºå°çš„é«˜é˜¶ç»„ä»¶ï¼Œè¿™äº›ç»„ä»¶å¯ä»¥ç»„åˆæˆæ›´å¤æ‚çš„ç»„ä»¶ã€‚ä½¿ç”¨Recomposeé¼“åŠ±çš„æ–¹æ³•ï¼Œæ‚¨å°†ä¸å†éœ€è¦æ›´å¤šçš„<code>Class</code>è¯­æ³•æ¥åˆ›å»ºReactç»„ä»¶ã€‚</p>
<p>ä½†æ˜¯åœ¨è¿›å…¥ç»†èŠ‚ä¹‹å‰ï¼Œè®©æˆ‘ä»¬å¼€å§‹å›é¡¾ä¸€äº›æ¦‚å¿µâ€¦</p>
<h2>é«˜é˜¶å‡½æ•°</h2>
<p>åœ¨JavaScriptä¸­ï¼Œæˆ‘ä»¬æœ‰ä¸€ç§ç‰¹æ®Šç±»å‹çš„å‡½æ•°ï¼Œç§°ä¸ºé«˜é˜¶å‡½æ•°:</p>
<blockquote><p>ä¸€ä¸ª<a class="markup--anchor markup--pullquote-anchor" href="https://en.wikipedia.org/wiki/Higher-order_function" target="_blank" rel="noopener noreferrer" data-href="https://en.wikipedia.org/wiki/Higher-order_function">é«˜é˜¶å‡½æ•°</a>æ˜¯ä¸€ä¸ªå¤„ç†å…¶ä»–å‡½æ•°çš„å‡½æ•°ï¼Œè¦ä¹ˆæ˜¯å› ä¸ºå®ƒæ¥æ”¶å…¶ä»–å‡½æ•°ä½œä¸ºå‚æ•°(åœ¨å‡½æ•°ä½“çš„æŸä¸ªç‚¹æ‰§è¡Œå®ƒä»¬)ï¼Œè¦ä¹ˆæ˜¯å› ä¸ºå®ƒåœ¨è¢«è°ƒç”¨æ—¶è¿”å›ä¸€ä¸ªæ–°å‡½æ•°ï¼Œæˆ–è€…ä¸¤è€…éƒ½æœ‰ã€‚</p></blockquote>
<pre>const sum = (a, b) =&gt; a + b
const multiplication = (a, b) =&gt; a * b

// Our Higher-Order Function
const getResultOperation = op =&gt; (a, b) =&gt; `The ${op.name} of ${a} and ${b} is ${op(a, b)}`

const getSumResult = getResultOperation(sum)
const getMultiplicationResult = getResultOperation(multiplication)

console.log( getSumResult(2, 5) ) // The sum of 2 and 5 is 7 
console.log( getMultiplicationResult(2, 5) ) // The multiplication of 2 and 5 is 10</pre>
<p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œ<code>getResultOperation</code>æ¥æ”¶ä¸€ä¸ªå‡½æ•°å¹¶è¿”å›ä¸€ä¸ªæ–°å‡½æ•°ã€‚æ‰€ä»¥æ˜¯é«˜é˜¶å‡½æ•°ã€‚</p>
<blockquote><p>JavaScriptä¸­æœ€æµè¡Œçš„é«˜é˜¶å‡½æ•°æ˜¯æ•°ç»„æ–¹æ³•<code><a class="markup--anchor markup--blockquote-anchor" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/map" target="_blank" rel="noopener noreferrer" data-href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/map">map</a></code>ã€<code><a class="markup--anchor markup--blockquote-anchor" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/filter" target="_blank" rel="noopener noreferrer" data-href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/filter">filter</a></code>æˆ–<code><a class="markup--anchor markup--blockquote-anchor" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/Reduce" target="_blank" rel="noopener noreferrer" data-href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/Reduce">reduce</a></code>ã€‚å®ƒä»¬éƒ½å°†ä¸€äº›å‡½æ•°ä½œä¸ºå‚æ•°ä¼ é€’ç»™æ•°ç»„çš„å…ƒç´ ï¼Œä»¥è·å¾—ç»“æœã€‚</p></blockquote>
<h2>é«˜é˜¶ç»„ä»¶</h2>
<p>åœ¨Reactä¸­ï¼Œæˆ‘ä»¬æœ‰é«˜é˜¶å‡½æ•°çš„ç­‰ä»·ç‰©ï¼Œä½†æ˜¯å¯¹äºç»„ä»¶ï¼Œæ‰€è°“çš„é«˜é˜¶ç»„ä»¶ã€‚</p>
<blockquote><p>ä¸€ä¸ª<a class="markup--anchor markup--pullquote-anchor" href="https://reactjs.org/docs/higher-order-components.html" target="_blank" rel="noopener noreferrer" data-href="https://reactjs.org/docs/higher-order-components.html">é«˜é˜¶åˆ†é‡</a>æ˜¯å–ä¸€ä¸ªåˆ†é‡å¹¶è¿”å›ä¸€ä¸ªæ–°åˆ†é‡çš„å‡½æ•°ã€‚</p></blockquote>
<p>é«˜é˜¶åˆ†é‡ä»€ä¹ˆæ—¶å€™æœ‰ç”¨ï¼Ÿå—¯ï¼Œä¸»è¦æ˜¯ä¸ºäº†é‡ç”¨æ¶‰åŠè·¨ç»„ä»¶è¡Œä¸ºçš„é€»è¾‘ã€‚è®©æˆ‘ä»¬ç”¨ä¸‹é¢çš„åœºæ™¯æ¥è§£é‡Šä¸€ä¸‹ã€‚</p>
<p>å‡è®¾æˆ‘ä»¬å·²ç»æœ‰äº†ä¸€ä¸ªç»„ä»¶<code>Button</code>ã€‚</p>
<pre>const Button = ({ type = "primary", children, onClick }) =&gt; (
  &lt;button className={`btn btn-${type}`} onClick={onClick}&gt;
    {children}
  &lt;/button&gt;
);</pre>
<p>æˆ‘ä»¬æƒ³åœ¨è¿™ä¸ª<code>Button</code>çš„åŸºç¡€ä¸Šåˆ›å»ºå¦ä¸€ä¸ª<code>ButtonWithTrack</code>(åŒæ ·çš„é“å…·åœ¨<code>Button</code>ä¸Šä¹Ÿå¯ä»¥å·¥ä½œï¼ŒåŒæ ·çš„æ ·å¼ä¹Ÿå¯ä»¥åº”ç”¨)ï¼Œä½†æ˜¯è¡Œä¸ºæœ‰æ‰€æ”¹è¿›(æ¯”å¦‚è®°å½•å®ƒè¢«ç‚¹å‡»çš„æ¬¡æ•°ï¼Œå¹¶åœ¨æŒ‰é’®ä¸Šæ˜¾ç¤ºè¿™ä¸ªå€¼)ã€‚</p>
<p>ä¸ºæ­¤ï¼Œæˆ‘ä»¬å¯ä»¥åšâ€¦</p>
<pre>import Button from "./Button";

class ButtonWithTrack extends Component {
  constructor(props) {
    super(props);
    this.state = {
      times: 0
    };
  }
  handleClick = e =&gt; {
    let { times } = this.state;
    const { onClick } = this.props;
    this.setState({ times: ++times });
    onClick &amp;&amp; onClick();
  };
  render() {
    const { children } = this.props;
    const { times } = this.state;
    return (
      &lt;span onClick={this.handleClick}&gt;
        &lt;Button type={times &gt; 5 ? "danger" : "primary"}&gt;
          {children} &lt;small&gt;{times} times clicked&lt;/small&gt;
        &lt;/Button&gt;
      &lt;/span&gt;
    );
  }
}</pre>
<p>æˆ‘ä»¬é‡ç”¨äº†åŸæ¥çš„<code>Button</code>ï¼Œæ‰€ä»¥ç°åœ¨ä¸€åˆ‡æ­£å¸¸ã€‚</p>
<p>å†æ¥çœ‹å¦ä¸€ä¸ªç»„ä»¶ï¼Œ<code>Link</code>:</p>
<pre>const Link = ({ type = "primary", children, href, onClick }) =&gt; (
  &lt;a style={styles} className={`badge badge-${type}`} href={href} onClick={onClick}&gt;
    {children}
  &lt;/a&gt;
);</pre>
<p>æˆ‘ä»¬æƒ³è¦æ·»åŠ ä¸æˆ‘ä»¬æ·»åŠ åˆ°<code>Button</code>ä¸­çš„è¡Œä¸ºå®Œå…¨ç›¸åŒçš„è¡Œä¸ºã€‚</p>
<p>é‚£æ€ä¹ˆåŠå‘¢ï¼Ÿæˆ‘ä»¬åº”è¯¥åœ¨ä¸¤ä¸ªæ–‡ä»¶ä¸­é‡å¤90%çš„ä»£ç å—ï¼Ÿæˆ–è€…æœ‰æ²¡æœ‰ä¸€ç§æ–¹æ³•å¯ä»¥è®©æˆ‘ä»¬å»æ‰æ·»åŠ åˆ°<code>ButtonWithTrack</code>ä¸­çš„é€»è¾‘ï¼Œä½¿å…¶å¯ä»¥åº”ç”¨äº<code>Button</code>å’Œ<code>Link</code>ç»„ä»¶ï¼Ÿ</p>
<p>é«˜é˜¶ç»„ä»¶æ¥æ•‘æ´äº†ï¼ï¼</p>
<p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªæ›´é«˜é˜¶çš„ç»„ä»¶ï¼Œå³ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒæ¥å—ä¸€ä¸ªç»„ä»¶ï¼Œå¹¶è¿”å›è¯¥ç»„ä»¶çš„å¢å¼ºç‰ˆæœ¬ï¼Œè¯¥ç‰ˆæœ¬å…·æœ‰æˆ‘ä»¬æƒ³è¦çš„è¡Œä¸ºã€‚</p>
<p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·åš:</p>
<pre>const withClickTimesTrack = WrappedComponent =&gt;
  class extends Component {
    constructor(props) {
      super(props);
      this.state = {
        times: 0
      };
    }
    handleClick = e =&gt; {
      e.preventDefault();
      let { times } = this.state;
      const { onClick } = this.props;
      this.setState({ times: ++times });
      onClick &amp;&amp; onClick();
    };
    render() {
      const { children, onClick, ...props } = this.props;
      const { times } = this.state;
      return (
        &lt;span onClick={this.handleClick}&gt;
          &lt;WrappedComponent
            type={times &gt; 5 ? "danger" : "primary"}
            {...props}
          &gt;
            {children} &lt;small&gt;({times} times clicked)&lt;/small&gt;
          &lt;/WrappedComponent&gt;
        &lt;/span&gt;
      );
    }
  };</pre>
<p>å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥åƒè¿™æ ·ä½¿ç”¨<code>withClickTimesTrack</code> HOCæ¥ç®€åŒ–ä»<code>Button</code>åˆ›å»ºç»„ä»¶<code>ButtonWithTrack</code>çš„è¿‡ç¨‹:</p>
<pre>import withClickTimesTrack from "./hoc/withClickTimesTrack";

const Button = ({ type = "primary", children, onClick }) =&gt; (
  &lt;button className={`btn btn-${type}`} onClick={onClick}&gt;
    {children}
  &lt;/button&gt;
);

const ButtonWithTrack = withClickTimesTrack(Button);</pre>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥è½»æ¾åœ°å°†ç›¸åŒçš„å¢å¼ºåº”ç”¨åˆ°å…¶ä»–ç»„ä»¶ï¼Œå¦‚<code>Link</code>:</p>
<pre>import withClickTimesTrack from "./hoc/withClickTimesTrack";

const Link = ({ type = "primary", children, href, onClick }) =&gt; (
  &lt;a style={styles} className={`badge badge-${type}`} href={href} onClick={onClick}&gt;
    {children}
  &lt;/a&gt;
);
const LinkWithTrack = withClickTimesTrack(Link);</pre>
<p>å¾ˆé…·ï¼Œä¸æ˜¯å—ï¼Ÿ</p>
<p>ä½†æ˜¯æˆ‘ä»¬å¯ä»¥è®¤ä¸ºè¿™ä¸ªHOCåŒæ—¶æ·»åŠ äº†å¤ªå¤šçš„è¡Œä¸º(å¤„ç†ç¨‹åºã€çŠ¶æ€å’Œæ–°çš„UI)ã€‚</p>
<p>å¦‚æœæˆ‘ä»¬æŠŠHOCèƒŒåçš„é€»è¾‘åˆ†æˆæ›´å°çš„éƒ¨åˆ†ä¸æ˜¯æ›´å¥½å—ï¼Ÿ</p>
<h2>ä½œæ›²æŠ€å·§</h2>
<p>å¥½äº†ï¼Œå†³å®šäº†ï¼æˆ‘ä»¬å¸Œæœ›å°†HOCçš„è¿™ä¸‰ç§è¡Œä¸ºéš”ç¦»å¼€æ¥ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åœ¨å…¶ä»–ç»„ä»¶ä¸­ç‹¬ç«‹åœ°é‡ç”¨å®ƒä»¬:</p>
<ul>
<li>æ·»åŠ <code>times</code>çŠ¶æ€</li>
<li>æ·»åŠ è‡ªå®šä¹‰<code>handleClick</code></li>
<li>æ˜¾ç¤ºå…ƒç´ å†…éƒ¨çš„<code>times</code>çŠ¶æ€</li>
</ul>
<p>ä¸ºæ­¤ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸‰ä¸ªhocï¼Œæ¯ä¸ªhocå°†æ·»åŠ ä¸€ä¸ªç‰¹å®šçš„è¡Œä¸ºâ€¦</p><div class="code-block code-block-54">
<hr/>
<h3>æ›´å¤šæ¥è‡ªLogRocketçš„ç²¾å½©æ–‡ç« :</h3>

<hr/></div>
<p><code>withStateTimes.js</code>:</p>
<pre>const withStateTimes = WrappedComponent =&gt;
  class extends Component {
    constructor(props) {
      super(props);
      this.state = {
        times: 0
      };
    }
    setTimes = (times) =&gt; {
      this.setState({ times })
    }
    render() {
      const { times } = this.state
      const { setTimes } = this
      return (
        &lt;WrappedComponent times={times} setTimes={setTimes} { ...this.props } /&gt;
      );
    }
  };</pre>
<p><code>withHandlerClick.js</code>:</p>
<pre>const withHandlerClick = WrappedComponent =&gt; props =&gt; {

  let { times, setTimes, children, onClick, ..._props } = props;
    
  const handleClick = e =&gt; {
    e.preventDefault();
    setTimes( ++times );
    onClick &amp;&amp; onClick();
  };

  return (
    
      {children}
    
  );

}</pre>
<p><code>withDisplayTrack.js</code>:</p>
<pre>const withDisplayTrack = WrappedComponent =&gt; props =&gt; {
  const { children, onClick, handleClick, times, ..._props } = props;
  return (
    &lt;span onClick={handleClick}&gt;
      &lt;WrappedComponent
        type={times &gt; 5 ? "danger" : "primary"}
        {..._props}
      &gt;
        {children} &lt;small&gt;({times} times clicked)&lt;/small&gt;
      &lt;/WrappedComponent&gt;
    &lt;/span&gt;
  )
}</pre>
<p>æœ‰äº†è¿™ä¸‰ä¸ªhocï¼Œæˆ‘ä»¬å°±å¯ä»¥ä»¥è¿™ç§æ–¹å¼å°†å®ƒä»¬åº”ç”¨åˆ°æˆ‘ä»¬çš„å…ƒç´ ä¸­â€¦</p>
<pre>const ButtonWithTrack = withStateTimes(withHandlerClick(withDisplayTrack(Button)));</pre>
<p>è¿™æ˜¯æ€ä¹ˆå›äº‹ï¼Ÿå—¯ï¼Œ<code>withDisplayTrack(Button)</code>è¿”å›ä¸€ä¸ªåœ¨<code>withHandlerClick</code>è°ƒç”¨ä¸­ä½¿ç”¨çš„ç»„ä»¶ï¼Œè¯¥ç»„ä»¶ä¹Ÿå°†è¿”å›ä¸€ä¸ªåœ¨<code>withStateTimes</code>è°ƒç”¨ä¸­ä½¿ç”¨çš„ç»„ä»¶ï¼Œè¯¥ç»„ä»¶å°†è¿”å›æˆ‘ä»¬çš„æœ€ç»ˆç»„ä»¶(<code>ButtonWithTrack</code>)ã€‚</p>
<p>æ­£å¦‚ä½ æ‰€çœ‹åˆ°çš„ï¼Œè¿™ä¸ªæƒ³æ³•å¾ˆå¥½ï¼Œå› ä¸ºæˆ‘ä»¬å¯ä»¥ä»¥è¿™ç§æ–¹å¼é‡ç”¨æˆ‘ä»¬çš„ä»£ç ï¼Œä½†æ˜¯åˆ›å»ºè¿™äº›hocæœ‰ç‚¹å¤æ‚ï¼Œå¹¶ä¸”ä»¥è¿™ç§æ–¹å¼åº”ç”¨å®ƒä»¬ä¹Ÿæœ‰ç‚¹éš¾ä»¥ç†è§£ã€‚</p>
<p>è¿™æœ‰ä»€ä¹ˆæ”¹è¿›å—ï¼Ÿ</p>
<p>é‡ç»„æ•‘æ´ï¼ï¼ğŸ™‚</p>
<h2>é‡å†™</h2>
<p>ä»€ä¹ˆæ˜¯é‡ç»„ï¼Ÿç”¨ä»–ä»¬è‡ªå·±çš„è¯è¯´:</p>
<blockquote><p><a class="markup--anchor markup--pullquote-anchor" href="https://github.com/acdlite/recompose" target="_blank" rel="noopener noreferrer" data-href="https://github.com/acdlite/recompose">é‡ç»„</a>æ˜¯åŠŸèƒ½ç»„ä»¶å’Œé«˜é˜¶ç»„ä»¶çš„Reactå®ç”¨å¸¦ã€‚æŠŠå®ƒæƒ³è±¡æˆååº”çš„<a class="markup--anchor markup--pullquote-anchor" href="https://lodash.com/docs/4.17.10#lodash" target="_blank" rel="noopener noreferrer" data-href="https://lodash.com/docs/4.17.10#lodash">æ´›è¾¾ä»€</a>ã€‚</p></blockquote>
<p>å› æ­¤ï¼Œè¿™æ˜¯ä¸€å¥—æˆ‘ä»¬å¯ä»¥ç”¨æ¥æ”¹è¿›æˆ‘ä»¬çš„HOCçš„ç»„ç»‡ã€åˆ›å»ºå’Œåº”ç”¨çš„æ–¹æ³•ï¼Œé¼“åŠ±ä½¿ç”¨ä¸HOCçš„ç»„åˆç›¸ç»“åˆçš„åŠŸèƒ½æ€§æ— çŠ¶æ€ç»„ä»¶ã€‚</p>
<p>å…ˆè¯´æœ€å¸¸ç”¨çš„é‡æ–°æ„å›¾æ–¹æ³•:<code>compose</code>ã€‚</p>

<p>é€šè¿‡<code>compose</code>ï¼Œæˆ‘ä»¬å¯ä»¥<em>å°†å¤šä¸ªé«˜é˜¶åˆ†é‡ç»„åˆæˆä¸€ä¸ªé«˜é˜¶åˆ†é‡</em>ã€‚</p>
<p>åœ¨æˆ‘ä»¬çš„åœºæ™¯ä¸­ï¼Œä½¿ç”¨<code>compose</code>ï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥è¿™æ ·è¡¨è¾¾hocçš„åº”ç”¨:</p>
<pre>import { compose } from "recompose";

...

const ButtonWithTrack = compose(
  withStateTimes,
  withHandlerClick,
  withDisplayTrack
)(Button)</pre>
<p>æ›´æ¸…æ™°æ˜“è¯»ï¼Œå¯¹å—ï¼Ÿ</p>

<p>æˆ‘ä»¬åœºæ™¯ä¸­å¦ä¸€ä¸ªæœ‰ç”¨çš„é‡ç»„æ–¹æ³•æ˜¯<code>withState</code>ã€‚</p>
<p>è¯¥æ–¹æ³•åˆ›å»ºäº†ä¸€ä¸ªä¸æˆ‘ä»¬åœ¨<code>withStateTimes.js</code>ä¸­å®ç°çš„è¡Œä¸ºå‡ ä¹ç›¸åŒçš„ç‰¹è®¾</p>
<ul>
<li>å®ƒæ·»åŠ äº†ä¸€ä¸ªçŠ¶æ€å±æ€§</li>
<li>å®ƒåˆ›å»ºä¸€ä¸ª<em>å¤„ç†ç¨‹åº</em>æ¥è®¾ç½®è¿™ä¸ªçŠ¶æ€å±æ€§çš„å€¼</li>
<li>å®ƒå…è®¸æˆ‘ä»¬è®¾ç½®ä¸€ä¸ªåˆå§‹å€¼</li>
</ul>
<p>æ‰€ä»¥ï¼Œç”¨<em class="markup--em markup--p-em">é‡ç»„</em>ï¼Œç°åœ¨æˆ‘ä»¬å¯ä»¥è¿™æ ·è¡¨è¾¾åŒæ ·çš„é€»è¾‘â€¦</p>
<pre>...
import { withState } from "recompose";
const withStateTimes = withState('times', 'setTimes', 0)
...</pre>
<p>çœŸçš„å—ï¼Ÿæ˜¯çš„ï¼ŒçœŸçš„ğŸ™‚</p>
<p>é‡ç»„çš„æ•ˆç”¨å¼€å§‹å˜å¾—æœ‰æ„ä¹‰äº†ï¼Œå¯¹å—ï¼Ÿ</p>

<p>è®©æˆ‘ä»¬ç»§ç»­æ”¹è¿›æˆ‘ä»¬åœºæ™¯çš„ä»£ç ã€‚è®©æˆ‘ä»¬åç‰¹è®¾çš„<code>withHandlerClick</code>ã€‚ä¸ºäº†æ”¹è¿›è¿™ä¸ªç‰¹è®¾çš„åˆ›å»ºï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨Recomposeçš„<code>withHandlers</code>æ–¹æ³•ã€‚</p>
<pre>import { withHandlers } from "recompose";

const withHandlerClick = withHandlers({
  handleClick: props =&gt; e =&gt; {
    let { times, onClick, setTimes } = props;
    e.preventDefault()
    setTimes( ++times );
    onClick &amp;&amp; onClick();
  }
})</pre>
<p><code>withHandlers</code>æ–¹æ³•è·å–å¤„ç†ç¨‹åºåˆ›å»ºè€…çš„å¯¹è±¡æ˜ å°„ã€‚ä¼ é€’ç»™<code>withHandlers</code>çš„è¿™ä¸ªå¯¹è±¡çš„æ¯ä¸ªå±æ€§åº”è¯¥æ˜¯ä¸€ä¸ªé«˜é˜¶å‡½æ•°ï¼Œå®ƒæ¥å—ä¸€ç»„propså¹¶è¿”å›ä¸€ä¸ªå‡½æ•°å¤„ç†ç¨‹åºã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å¯ä»¥ç”Ÿæˆä¸€ä¸ªå¯ä»¥è®¿é—®ç»„ä»¶çš„<code>props</code>çš„å¤„ç†ç¨‹åºã€‚</p>

<p>åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œå¦‚æœæˆ‘ä»¬ç”¨<a class="markup--anchor markup--p-anchor" href="https://chrome.google.com/webstore/detail/react-developer-tools/fmkadmapgofadopljbjfkapdkoienihi" target="_blank" rel="noopener noreferrer" data-href="https://chrome.google.com/webstore/detail/react-developer-tools/fmkadmapgofadopljbjfkapdkoienihi"> Reactå¼€å‘å·¥å…·</a>è°ƒè¯•ä»£ç ï¼Œé‚£ä¹ˆ<code>withDisplayTrack</code>è¿”å›çš„ç»„ä»¶æ˜¾ç¤ºä¸º<code>Unknown</code>ã€‚</p>
<p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨Recomposeçš„<code>setDisplayName</code> to <code>export</code> a final HOCè¿”å›ä¸€ä¸ªåä¸º<code>ComponentWithDisplayTrack</code>çš„ç»„ä»¶ã€‚</p>
<pre>export default compose(
  setDisplayName('ComponentWithDisplayTrack'),
  withDisplayTrack
);</pre>

<p>ä½¿ç”¨æ–¹æ³•<code>lifecycle</code>,æˆ‘ä»¬å¯ä»¥å°†ç”Ÿå‘½å‘¨æœŸæ–¹æ³•æ·»åŠ åˆ°æˆ‘ä»¬çš„å‡½æ•°è¯­æ³•ç»„ä»¶ä¸­ã€‚</p>
<p>åœ¨æˆ‘ä»¬çš„åœºæ™¯ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æ·»åŠ ä¸€ä¸ªä¸åŒç‰ˆæœ¬çš„æŒ‰é’®æ¥æ˜¾ç¤ºå¾…å¤„ç†æ¶ˆæ¯çš„æ•°é‡ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸ª<code>messages</code> propsåˆ›å»ºä¸€ä¸ªHOCæ¥è¿”å›æŒ‰é’®çš„ä¸åŒè§†å›¾:</p>
<pre>import React from "react";
import { compose, setDisplayName } from "recompose";

const withDisplayMessages = WrappedComponent =&gt; props =&gt; {
  const { children, messages, loading, ..._props } = props;
  return (
    &lt;WrappedComponent {..._props}&gt;
      {children}
      {loading ? (
        &lt;span className="fas fa-spinner fa-pulse"&gt; &lt;/span&gt;
      ) : (
        &lt;span className="badge badge-light"&gt;{messages}&lt;/span&gt;
      )}
    &lt;/WrappedComponent&gt;
  );
};

export default compose(
  setDisplayName("withDisplayMessages"),
  withDisplayMessages
);</pre>
<p>æˆ‘ä»¬å¯ä»¥å‘æˆ‘ä»¬çš„ç»„ä»¶æ·»åŠ ä¸€ä¸ª<code>componentDidMount</code>ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ï¼Œå®ƒå°†æ·»åŠ :</p>
<ul>
<li>å½“æˆ‘ä»¬çš„å‡è¯·æ±‚å¼€å§‹æ—¶ï¼Œä¸€ä¸ª<code>loading</code>çŠ¶æ€è¢«è®¾ç½®ä¸º<code>true</code>,å½“å®ƒç»“æŸæ—¶ï¼Œè¢«è®¾ç½®ä¸º<code>false</code></li>
<li>ä¸€ä¸ª<code>messages</code>çŠ¶æ€ï¼Œè¿™ä¸ªå€¼å°†è¢«æˆ‘ä»¬çš„å‡è¯·æ±‚è¿”å›çš„éšæœºæ•°æ›´æ–°</li>
</ul>
<p>è¿™é‡Œç®¡ç†çš„<code>loading</code>å’Œ<code>messages</code>çŠ¶æ€éƒ½å°†å‘è¿”å›çš„ç»„ä»¶æ·»åŠ ä¸€ä¸ªæ–°çš„å±æ€§ï¼Œç”¨äºä¼ æ’­ç›¸åº”çš„å€¼:</p>
<pre>import { lifecycle } from "recompose";

const getPendingMessages = () =&gt; {
  const randomNumber = Math.ceil(Math.random() * 10);
  return new Promise(resolve =&gt; {
    setTimeout(() =&gt; resolve(randomNumber), randomNumber * 1000);
  });
};

const withDidMountStateMessages = lifecycle({
  componentDidMount() {
    this.setState({ loading: true });
    getPendingMessages().then(messages =&gt; {
      this.setState({ loading: false, messages });
    });
  }
});

export default withDidMountStateMessages;</pre>
<p>æœ‰äº†è¿™äº›æ–°çš„hocï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥å¿«é€Ÿåˆ›å»ºæˆ‘ä»¬çš„æ–°å‹<code>Button</code>:</p>
<pre>const ButtonWithMessages = compose(
  withDidMountStateMessages, 
  withDisplayMessages
)(Button)</pre>

<p>æœ‰äº†è¿™äº›hocï¼Œæˆ‘ä»¬å°±å¯ä»¥ç”¨å¾ˆå°‘çš„å‡ è¡ŒæŠŠè¿™äº›æ–°çš„è¡Œä¸ºè½¬æ¢æˆä¸€ä¸ªé“¾æ¥ã€‚æˆ‘ä»¬å¯ä»¥æ·»åŠ <code>defaultProps</code>æ¥æ”¹å˜é“¾æ¥çš„é»˜è®¤ç±»å‹ã€‚</p>
<pre>const LinkWithMessages = compose(
  defaultProps({ type: "info" }),
  withDidMountStateMessages,
  withDisplayMessages
)(Link);</pre>
<h2>ç»“è®º</h2>
<p>ä½¿ç”¨è¿™äº›æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è½»æ¾åœ°åˆ›å»ºå¦ä¸€ä¸ªç‰ˆæœ¬çš„<code>Button</code>(åªæ˜¯ä¸ºäº†æ˜¾ç¤ºè¿™ç§æ¨¡å¼çš„çµæ´»æ€§)æ¥å®Œæˆæˆ‘ä»¬çš„æ¼”ç¤ºï¼Œè¯¥ç‰ˆæœ¬è·Ÿè¸ªä»3åˆ°0çš„ç‚¹å‡»ï¼Œå¹¶æ·»åŠ å¦ä¸€ä¸ª<code>prop</code>ï¼Œä»¥ä¾¿æˆ‘ä»¬å¯ä»¥åœ¨å€’è®¡æ—¶åˆ°è¾¾0æ—¶æ›´æ”¹<code>type</code>ã€‚</p>
<pre>const ButtonWithTrackCountdown = compose(
  withState('times', 'setTimes', 3),
  withState('type', 'setType', 'primary'),
  withHandlers({
    handleClick: props =&gt; e =&gt; {
      let { times, onClick, setTimes, setType } = props;
      e.preventDefault()
      if ( times &lt;= 0 ) {  setType('secondary') }
      else { setTimes( --times ) }
      onClick &amp;&amp; onClick();
    }
  }),
  withDisplayTrack
)(Button)</pre>
<p>æ­£å¦‚æ‚¨æ‰€çœ‹åˆ°çš„ï¼Œä½¿ç”¨Recomposeå¯ä»¥æ›´å®¹æ˜“åœ°å°†é€»è¾‘å§”æ‰˜ç»™å°çš„é«˜é˜¶ç»„ä»¶ï¼Œç„¶å<em>å°†å®ƒä»¬ç»„åˆæˆæ›´å¤æ‚çš„HOCï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å®ƒæ¥åˆ›å»ºç»„ä»¶çš„ä¸åŒç‰ˆæœ¬ï¼Œé‡ç”¨æˆ‘ä»¬çš„å¤§éƒ¨åˆ†ä»£ç ã€‚</em></p>
<p>æ­¤å¤–ï¼Œé‡æ–°ç»„åˆä¸é¼“åŠ±ä½¿ç”¨<code>Class</code>è¯­æ³•æ¥åˆ›å»ºç»„ä»¶ï¼Œè€Œé¼“åŠ±ä½¿ç”¨åŠŸèƒ½æ€§æ— çŠ¶æ€ç»„ä»¶å’Œæ›´é«˜çº§çš„ç»„ä»¶ç›¸ç»“åˆã€‚</p>
<p>ä»…ä½¿ç”¨åŠŸèƒ½ç»„ä»¶çš„æœ€é‡è¦ä¼˜åŠ¿æ˜¯:</p>
<ul>
<li>ä»–ä»¬é¼“åŠ±ä»£ç æ›´åŠ å¯é‡ç”¨å’Œæ¨¡å—åŒ–</li>
<li>ä»–ä»¬ä¸é¼“åŠ±åºå¤§å¤æ‚çš„ç»„ä»¶åšå¤ªå¤šçš„äº‹æƒ…</li>
</ul>
<p>åŸºæœ¬ä¸Šï¼Œä¸€æ—¦æ‚¨äº†è§£äº†é‡ç»„æ–¹æ³•çš„å·¥ä½œæ–¹å¼ï¼Œå®ƒå°±ç®€åŒ–äº†Reactç»„ä»¶çš„å¼€å‘å’Œç»„ç»‡ã€‚</p>
<p>æœ‰æ›´å¤šçš„æ–¹æ³•å¯ä»¥ç”¨æ¥ä»¥æ›´ç®€å•çš„æ–¹å¼äº§ç”Ÿæ›´å¤šçš„é«˜é˜¶åˆ†é‡ã€‚</p>
<p>åœ¨<a class="markup--anchor markup--p-anchor" href="https://github.com/acdlite/recompose" target="_blank" rel="noopener noreferrer" data-href="https://github.com/acdlite/recompose">å®˜æ–¹å›è´­</a>ä¸­ï¼Œä½ å¯ä»¥æ‰¾åˆ°ä¸€äº›å¯¹ä½ çš„é¡¹ç›®æœ‰ç”¨çš„<a class="markup--anchor markup--p-anchor" href="https://github.com/acdlite/recompose/wiki/Recipes" target="_blank" rel="noopener noreferrer" data-href="https://github.com/acdlite/recompose/wiki/Recipes">é‡ç»„é£Ÿè°±</a>ã€‚</p>
<p>æ­¤å¤–ï¼Œè¿™é‡Œæœ‰è¿™ç¯‡æ–‡ç« ä¸­ä½¿ç”¨çš„ä»£ç å’Œç»“æœçš„ç°åœºæ¼”ç¤ºã€‚</p>
<p/>
<p>é‚£ä¹ˆï¼Œç°åœ¨ä½ å¯¹<em class="markup--em markup--p-em">é‡æ–°ä½œæ›²</em>æœ‰äº†æ›´å¤šçš„äº†è§£â€¦â€¦ä½ çš„ç¬¬ä¸€å°è±¡æ˜¯ä»€ä¹ˆï¼Ÿåœ¨åˆ›å»ºç»„ä»¶æ—¶ï¼Œä½ è®¤ä¸ºè¿™æ˜¯ä¸€ä¸ªå¥½æ–¹æ³•å—ï¼Ÿ</p>
<p>æˆ‘çš„çœ‹æ³•æ˜¯â€¦æˆ‘å–œæ¬¢ï¼æˆ‘çœŸçš„å¾ˆå–œæ¬¢Recomposeé¼“åŠ±çš„é¢å‘åˆ›å»ºå°è€Œç®€å•çš„ç‰‡æ®µ(ç»„ä»¶å’Œhoc)çš„æ¨¡å¼ï¼Œè¿™äº›ç‰‡æ®µå¯ä»¥ç”¨äºä»¥æ˜“è¯»çš„æ–¹å¼åˆ›å»ºæ›´å¤æ‚çš„ç‰‡æ®µï¼Œå¹¶ä¸”æ˜¯é¢å‘å‡½æ•°å¼ç¼–ç¨‹çš„ã€‚</p>
<p>å—¯ï¼Œé‚£æ˜¯æˆ‘çš„çœ‹æ³•ã€‚ä½ å‘¢ï¼Ÿ</p><div class="code-block code-block-17">
<div class="blog-plug inline-plug react-plug" vwo-el-id="26283398190">
<h2 vwo-el-id="41600691720">ä½¿ç”¨LogRocketæ¶ˆé™¤ä¼ ç»Ÿååº”é”™è¯¯æŠ¥å‘Šçš„å™ªéŸ³</h2>
<a href="https://lp.logrocket.com/blg/react-signup-issue-free" target="_blank" vwo-el-id="19356441070">LogRocket
</a><p>æ˜¯ä¸€æ¬¾React analyticsè§£å†³æ–¹æ¡ˆï¼Œå¯ä¿æŠ¤æ‚¨å…å—æ•°ç™¾ä¸ªè¯¯æŠ¥é”™è¯¯è­¦æŠ¥çš„å½±å“ï¼Œåªé’ˆå¯¹å°‘æ•°çœŸæ­£é‡è¦çš„é¡¹ç›®ã€‚LogRocketå‘Šè¯‰æ‚¨Reactåº”ç”¨ç¨‹åºä¸­å®é™…å½±å“ç”¨æˆ·çš„æœ€å…·å½±å“åŠ›çš„bugå’ŒUXé—®é¢˜ã€‚</p><a class="signup" href="https://lp.logrocket.com/blg/react-signup-general" target="_blank" rel="noopener noreferrer" vwo-el-id="19356441380">
<img class="first-react-image alignnone size-full wp-image-46 jetpack-lazy-image jetpack-lazy-image--handled" src="../Images/f300c244a1a1cf916df8b4cb02bec6c6.png" vwo-el-id="18272717540" data-lazy-loaded="1" data-original-src="https://files.readme.io/27c94e7-Image_2017-06-05_at_9.46.04_PM.png"/>
</a>
<a class="signup" href="https://lp.logrocket.com/blg/react-signup-general" target="_blank" rel="noopener noreferrer" vwo-el-id="19356441690">
<img class="second-react-image alignnone size-full wp-image-46 jetpack-lazy-image jetpack-lazy-image--handled" src="../Images/d6f5a5dd739296c1dd7aab3d5e77eeb9.png" alt="LogRocket Dashboard Free Trial Banner" vwo-el-id="30720362350" data-lazy-loaded="1" data-original-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png"/>
</a>
<a href="https://lp.logrocket.com/blg/react-signup-issue-free" target="_blank" rel="noopener noreferrer" vwo-el-id="35866400580">LogRocket
</a><p>è‡ªåŠ¨èšåˆå®¢æˆ·ç«¯é”™è¯¯ã€ååº”é”™è¯¯è¾¹ç•Œã€è¿˜åŸçŠ¶æ€ã€ç¼“æ…¢çš„ç»„ä»¶åŠ è½½æ—¶é—´ã€JSå¼‚å¸¸ã€å‰ç«¯æ€§èƒ½æŒ‡æ ‡å’Œç”¨æˆ·äº¤äº’ã€‚ç„¶åï¼ŒLogRocketä½¿ç”¨æœºå™¨å­¦ä¹ æ¥é€šçŸ¥æ‚¨å½±å“å¤§å¤šæ•°ç”¨æˆ·çš„æœ€å…·å½±å“åŠ›çš„é—®é¢˜ï¼Œå¹¶æä¾›æ‚¨ä¿®å¤å®ƒæ‰€éœ€çš„ä¸Šä¸‹æ–‡ã€‚</p><p vwo-el-id="28675661060">å…³æ³¨é‡è¦çš„React bugâ€”<a class="signup" href="https://lp.logrocket.com/blg/react-signup-issue-free" target="_blank" rel="noopener noreferrer" vwo-el-id="40093418840">ä»Šå¤©å°±è¯•è¯•LogRocketã€‘ã€‚</a></p>
</div></div>

<p class="clearfix"/>
<p class="clearfix"/>
</article>

</div>    
</body>
</html>