<html>
<head>
<title>A complete guide to permissions in a GraphQL API - LogRocket Blog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>GraphQL API - LogRocketåšå®¢ä¸­çš„æƒé™å®Œæ•´æŒ‡å—</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://blog.logrocket.com/a-complete-guide-to-permissions-in-a-graphql-api/#0001-01-01">https://blog.logrocket.com/a-complete-guide-to-permissions-in-a-graphql-api/#0001-01-01</a></blockquote><div><article class="article-post">
<h2>ä»‹ç»</h2>
<p>GraphQLå·²ç»æˆä¸ºå¼€å‘APIçš„æ–°å¸¸æ€ã€‚å®ƒæœ‰è‡ªå·±çš„ä¼˜åŠ¿å’Œçµæ´»æ€§ã€‚å…¶ä¸­ä¸€ä¸ªä¼˜ç‚¹æ˜¯ï¼Œå®ƒå…è®¸æ‚¨åœ¨APIä¸­å®ç°æƒé™å’Œç²’åº¦è®¿é—®æ§åˆ¶ã€‚</p>
<p>åœ¨å¤§å‹REST APIsä¸­ï¼Œè·å¾—ç²’åº¦è®¿é—®æ§åˆ¶æ˜¯ä¸€å¤§éš¾é¢˜ã€‚åœ¨GraphQLä¸­ï¼Œæ‚¨å¯ä»¥éå¸¸å®¹æ˜“åœ°å®ç°ç²’åº¦ã€‚</p>
<p>åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†çœ‹åˆ°åœ¨GraphQL APIä¸­å®ç°æƒé™çš„ä¸åŒæ¨¡å¼ã€‚</p>
<h3>è®¿é—®æ§åˆ¶å’Œæƒé™çš„åŸºç¡€çŸ¥è¯†</h3>
<p><strong>è®¿é—®æ§åˆ¶</strong>â€“æ£€æŸ¥ç”¨æˆ·æ˜¯å¦è¢«æˆæƒè®¿é—®APIã€‚</p>
<p>é€šå¸¸ï¼Œå¦‚æœä¸€ä¸ªç”¨æˆ·æ²¡æœ‰ç™»å½•ï¼Œä½†æ˜¯APIç«¯ç‚¹éœ€è¦ä¸€ä¸ªç™»å½•çš„ç”¨æˆ·ï¼ŒAPIä¼šæŠ›å‡ºä¸€ä¸ªèº«ä»½éªŒè¯é”™è¯¯ã€‚</p>
<p>å¦‚æœç”¨æˆ·å·²ç»ç™»å½•ï¼Œä½†æ˜¯æ²¡æœ‰è¶³å¤Ÿçš„æƒé™æ¥æ‰§è¡Œæ“ä½œï¼ŒAPIå°†æŠ›å‡ºä¸€ä¸ªç¦æ­¢çš„é”™è¯¯æˆ–ä¸€ä¸ªæœªæˆæƒçš„é”™è¯¯ã€‚</p>
<p><strong>Permissions</strong>â€“Permissionsæ˜¯ä¸€ç»„è§„åˆ™ï¼Œæœ‰åŠ©äºå†³å®šç”¨æˆ·æ˜¯å¦å¯ä»¥è®¿é—®ç‰¹å®šçš„APIã€‚</p>
<p>è®©æˆ‘ä»¬æ£€æŸ¥ä¸€äº›æƒé™çš„ç¤ºä¾‹ç”¨ä¾‹ã€‚</p>
<p>æƒ³æƒ³Twitteråº”ç”¨ç¨‹åº:</p>
<ul>
<li>ç”¨æˆ·å¯ä»¥å†™ä¸€æ¡æ¨æ–‡</li>
<li>å†™æ¨æ–‡çš„ä½œè€…å¯ä»¥åˆ é™¤</li>
<li>å…¶ä»–ç”¨æˆ·å¯ä»¥å–œæ¬¢ã€è½¬å‘æˆ–åˆ†äº«è¿™æ¡æ¨æ–‡</li>
<li>å…¶ä»–ç”¨æˆ·å¯ä»¥æŠ¥å‘Šæ¨æ–‡</li>
<li>æ¨æ–‡çš„ä½œè€…å’Œå…¶ä»–ç”¨æˆ·éƒ½å¯ä»¥å‚ä¸æ¨æ–‡ä¸Šçš„è¯„è®ºçº¿ç¨‹</li>
</ul>
<p>å¦‚æ‚¨æ‰€è§ï¼Œä½œè€…å’Œå…¶ä»–ç”¨æˆ·æ‹¥æœ‰ä¸åŒçº§åˆ«çš„æƒé™ï¼Œå°½ç®¡æˆæƒçº§åˆ«æ˜¯ç›¸åŒçš„ã€‚ä»–ä»¬éƒ½è¢«æˆæƒä¸ºç”¨æˆ·ï¼Œä½†æ ¹æ®æ´»åŠ¨ï¼Œä»–ä»¬æœ‰ä¸åŒçš„è®¿é—®æƒé™ã€‚</p>
<h2>GraphQLä¸­çš„æƒé™</h2>
<p>æ‚¨å¯ä»¥åœ¨GraphQL APIä¸­ä»¥ä¸åŒçš„æ–¹å¼å®ç°æƒé™ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥é€šè¿‡æ¨¡å¼ä¸­çš„GraphQLæŒ‡ä»¤æˆ–è€…é€šè¿‡æ£€æŸ¥GraphQLä¸­é—´ä»¶(å¦‚è§£æå™¨)ä¸­çš„æƒé™æ¥å®ç°æƒé™ã€‚</p>
<p><strong>æƒé™æ·±åº¦</strong></p>
<p>åœ¨GraphQLä¸­ï¼Œå¯ä»¥æ·±å…¥åˆ°ä»»ä½•æ·±åº¦æ¥å®ç°æƒé™ã€‚</p>
<p>æ‚¨å¯ä»¥æ‹¥æœ‰æŸ¥è¯¢çº§æƒé™ã€å¯¹è±¡çº§æƒé™å’Œå­—æ®µçº§æƒé™ã€‚</p>
<p><strong>åœ¨GraphQLä¸­å®ç°æƒé™çš„ä¸åŒæ–¹å¼</strong></p>
<p>å®ç°è¿™äº›æƒé™æœ‰ä¸åŒçš„æŠ€æœ¯:æŒ‡ä»¤ã€ä¸­é—´ä»¶è§£æå™¨å’ŒGraphQL shieldåº“ã€‚</p>
<p>æˆ‘ä»¬å°†åœ¨ç¤ºä¾‹ä¸­çœ‹åˆ°æ‰€æœ‰è¿™äº›æŠ€æœ¯ã€‚ç°åœ¨ï¼Œè®©æˆ‘ä»¬æ„å»ºä¸€ä¸ªç®€å•çš„GraphQLæœåŠ¡å™¨ç¤ºä¾‹ã€‚</p>
<h2>æ„å»ºç®€å•çš„GraphQL API</h2>
<p>é¦–å…ˆï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„npmé¡¹ç›®:</p>
<pre>npm init</pre>
<p>æ·»åŠ æ‚¨çš„<code>express</code>ã€<code>apollo-server-express</code>å’Œ<code>graphql</code>å¥—é¤ã€‚</p>
<pre>npm i express apollo-server-express</pre>
<p>æ¥ä¸‹æ¥ï¼Œä½¿ç”¨ç¤ºä¾‹GraphQLæœåŠ¡å™¨åˆ›å»ºä¸€ä¸ª<code>index.js</code>æ–‡ä»¶:</p>
<pre>const express = require('express');
const { ApolloServer, gql } = require('apollo-server-express');

// Construct a schema, using GraphQL schema language
const typeDefs = gql`
  type Query {
    hello: String
  }
`;

// Provide resolver functions for your schema fields
const resolvers = {
  Query: {
    hello: () =&gt; 'Hello world!',
  },
};

const server = new ApolloServer({ typeDefs, resolvers });
const app = express();
server.applyMiddleware({ app });

app.listen({ port: 4000 }, () =&gt;
  console.log(`ğŸš€ Server ready at http://localhost:4000${server.graphqlPath}`)
);</pre>
<p>è®©æˆ‘ä»¬æ·»åŠ nodemonæ¥æœ¬åœ°è¿è¡ŒæœåŠ¡å™¨ã€‚Nodemoné€šè¿‡åœ¨å¼€å‘è¿‡ç¨‹ä¸­è§‚å¯Ÿæ–‡ä»¶çš„å˜åŒ–æ¥å¸®åŠ©é‡æ–°åŠ è½½æœåŠ¡å™¨:</p>
<pre>npm i -D nodemon</pre>
<p>åœ¨<code>package.json</code>æ–‡ä»¶ä¸­æ·»åŠ è¿è¡ŒæœåŠ¡å™¨çš„è„šæœ¬:</p>
<pre>"scripts": {
    "start": "node index.js",
    "dev": "nodemon index.js"
},</pre>
<p>è®©æˆ‘ä»¬åœ¨ç»ˆç«¯ä¸­å¯åŠ¨æœåŠ¡å™¨:</p>
<pre>npm run dev</pre>
<p>æœåŠ¡å™¨å°†åœ¨ç«¯å£<code>4000</code>æ‰“å¼€ã€‚</p><div class="code-block code-block-54">
<hr/>
<h3>æ›´å¤šæ¥è‡ªLogRocketçš„ç²¾å½©æ–‡ç« :</h3>

<hr/></div>
<p>è®©æˆ‘ä»¬å†åˆ›å»ºå‡ ä¸ªæ–‡ä»¶å¹¶æ‹†åˆ†ä»£ç ã€‚æˆ‘ä»¬å°†ä½¿ç”¨ä¸€ä¸ª<code>schema.js</code>æ–‡ä»¶æ¥å®šä¹‰GraphQLç±»å‹:</p>
<pre>// schema.js

const { gql } = require("apollo-server-express");
// Construct a schema, using GraphQL schema language
module.exports = gql`
  type Query {
    hello: String
  }
`;</pre>
<p>å’Œ<code>resolver.js</code>æ–‡ä»¶ç”¨äºè§£æå™¨:</p>
<pre>// schema.js

const { gql } = require("apollo-server-express");
// Construct a schema, using GraphQL schema language
module.exports = gql`
  type Query {
    hello: String
  }
`;</pre>
<p>è®©æˆ‘ä»¬ä¸ºä¸€ä¸ªç®€å•çš„Tweetåº”ç”¨ç¨‹åºåˆ›å»ºä¸€äº›æ•°æ®å’Œç›¸åº”çš„æŸ¥è¯¢å’Œè§£æå™¨ã€‚</p>
<p><code>data.js</code>æ–‡ä»¶å°†æ˜¯:</p>
<pre>// data.js

module.exports = [
  {
    id: 0,
    content: "HTML is a programming language",
    author: "Param",
  },
  {
    id: 1,
    content: "JavaScript programmers are beginners",
    author: "Param",
  },
  {
    id: 2,
    content: "HTML and CSS pages are enough to build a bank project",
    author: "Joshua",
  },
  {
    id: 3,
    content: "React Js can prove earth as flat in 2025",
    author: "Joshua",
  },
];</pre>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬å°†åˆ›å»ºæŸ¥è¯¢å’Œè§£æå™¨æ¥æ˜¾ç¤ºè¿™æ¡Tweetæ•°æ®:</p>
<pre>// schema.js

const { gql } = require("apollo-server-express");
// Construct a schema, using GraphQL schema language
module.exports = gql`
  type Query {
    hello: String
    tweets: [Tweet]!
    tweet(id: Int!): Tweet!
  }

  type Tweet {
    id: Int!
    content: String!
    author: String!
  }
`;</pre>
<p><code>tweets</code>å’Œ<code>tweet</code>æŸ¥è¯¢çš„è§£æå™¨:</p>
<pre>// resolvers.js

const { ApolloError } = require("apollo-server-express");
const tweets = require("./data");

// Provide resolver functions for your schema fields
module.exports = {
  Query: {
    hello: () =&gt; "Hello world!",
    tweets: () =&gt; {
      return tweets;
    },
    tweet: (_, { id }) =&gt; {
      const tweetId = tweets.findIndex((tweet) =&gt; tweet.id === id);
      if (tweetId === -1) return new ApolloError("Tweet not found");
      return tweets[tweetId];
    },
  },
};</pre>
<p>æˆ‘ä»¬ç°åœ¨å·²ç»å‡†å¤‡å¥½äº†åŸºæœ¬çš„GraphQLæœåŠ¡å™¨ã€‚è®©æˆ‘ä»¬é€šè¿‡ä¾‹å­è¿›å…¥graphQLæƒé™ã€‚</p>
<h3>æŸ¥è¯¢çº§åˆ«æƒé™:åªæœ‰ç™»å½•çš„ç”¨æˆ·æ‰èƒ½è®¿é—®tweet</h3>
<blockquote><p>è¿™äº›ä¾‹å­æ˜¯å‡è®¾çš„ï¼Œä»…ä¾›å­¦ä¹ ä¹‹ç”¨ã€‚åœ¨çœŸå®çš„åº”ç”¨ç¨‹åºä¸­ï¼Œè¿™äº›åœºæ™¯ä¸­çš„å¤§å¤šæ•°éƒ½æ²¡æœ‰æ„ä¹‰ã€‚</p></blockquote>
<p>å¯¹äºè¿™ä¸ªä¾‹å­ï¼Œé¦–å…ˆæˆ‘ä»¬éœ€è¦ä»HTTPè¯·æ±‚ä¸­è·å–ç™»å½•ç”¨æˆ·çš„è¯¦ç»†ä¿¡æ¯ã€‚</p>
<p>è¿™ç§è®¸å¯å¯ä»¥ç”¨ä¸åŒçš„æ–¹å¼å®ç°ã€‚</p>
<p><strong>è§£æå™¨å†…éƒ¨çš„ç®€å•è§£å†³æ–¹æ¡ˆ</strong></p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬å°†ç”¨æˆ·æ·»åŠ åˆ°è¯·æ±‚ä¸Šä¸‹æ–‡ä¸­ã€‚ä¸ºäº†ç®€å•èµ·è§ï¼Œæˆ‘ä»¬åªå°†å¤´ç”¨æˆ·ä¼ é€’ç»™è¯·æ±‚ã€‚</p>
<pre>// index.js
...
const server = new ApolloServer({
  typeDefs,
  resolvers,
  context: ({ req }) =&gt; {
    return {
      user: req.headers.user || "",
    };
  },
});
...</pre>
<p>ç„¶åï¼Œæ·»åŠ é€»è¾‘ä»¥ç¡®ä¿åªæœ‰ç™»å½•çš„ç”¨æˆ·æ‰èƒ½çœ‹åˆ°TweetæŸ¥è¯¢:</p>
<pre>// resolvers.js
const { ApolloError, ForbiddenError } = require("apollo-server-express");

...
tweet: (_, { id }, { user }) =&gt; {
      // Check whether user is logged-in
      if (!user) return new ForbiddenError("Not Authorized");
      
      const tweetId = tweets.findIndex((tweet) =&gt; tweet.id === id);
      if (tweetId === -1) return new ApolloError("Tweet not found");
      return tweets[tweetId];
}
...</pre>
<p>å¦‚æœä½ åœ¨æ“åœºä¸Šç»è¿‡ç”¨æˆ·ï¼Œå®ƒä¼šæ˜¾ç¤ºæ¨æ–‡:</p>
<p><img data-attachment-id="26669" data-permalink="https://blog.logrocket.com/a-complete-guide-to-permissions-in-a-graphql-api/localhost/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/10/localhost.png" data-orig-size="730,400" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="localhost" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/10/localhost-300x164.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/10/localhost.png" decoding="async" class="aligncenter wp-image-26669 size-full jetpack-lazy-image" src="../Images/e46e961ad7f1ff097e06ca2673ab642f.png" alt="Our Tweet in a local GraphQL server." data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/10/localhost.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/10/localhost-300x164.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/10/localhost.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/10/localhost.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="26669" data-permalink="https://blog.logrocket.com/a-complete-guide-to-permissions-in-a-graphql-api/localhost/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/10/localhost.png" data-orig-size="730,400" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="localhost" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/10/localhost-300x164.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/10/localhost.png" decoding="async" loading="lazy" class="aligncenter wp-image-26669 size-full" src="../Images/e46e961ad7f1ff097e06ca2673ab642f.png" alt="Our Tweet in a local GraphQL server." srcset="https://blog.logrocket.com/wp-content/uploads/2020/10/localhost.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/10/localhost-300x164.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/10/localhost.png"/></noscript>
<p>å¦‚æœå¤´ä¸­æ²¡æœ‰ä¼ å…¥ç”¨æˆ·ï¼Œå°±ä¼šæŠ›å‡ºä¸€ä¸ª<code>ForbiddenError</code>:</p>
<p><img data-attachment-id="26670" data-permalink="https://blog.logrocket.com/a-complete-guide-to-permissions-in-a-graphql-api/tweet-errors/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/10/tweet-errors.png" data-orig-size="730,375" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="tweet-errors" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/10/tweet-errors-300x154.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/10/tweet-errors.png" decoding="async" class="aligncenter wp-image-26670 size-full jetpack-lazy-image" src="../Images/2aed1098a2ada0bec1015fd8484f2126.png" alt="A forbidden error in the GraphQL server." data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/10/tweet-errors.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/10/tweet-errors-300x154.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/10/tweet-errors.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/10/tweet-errors.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="26670" data-permalink="https://blog.logrocket.com/a-complete-guide-to-permissions-in-a-graphql-api/tweet-errors/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/10/tweet-errors.png" data-orig-size="730,375" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="tweet-errors" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/10/tweet-errors-300x154.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/10/tweet-errors.png" decoding="async" loading="lazy" class="aligncenter wp-image-26670 size-full" src="../Images/2aed1098a2ada0bec1015fd8484f2126.png" alt="A forbidden error in the GraphQL server." srcset="https://blog.logrocket.com/wp-content/uploads/2020/10/tweet-errors.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/10/tweet-errors-300x154.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/10/tweet-errors.png"/></noscript>
<p>è¿™ç§ä¿æŠ¤æ–¹å¼ä¸å…·æœ‰å¯æ‰©å±•æ€§å’Œå¯é‡ç”¨æ€§ã€‚ä½†æ˜¯å®ƒä»ç„¶é€‚ç”¨äºè¿™ä¸ªç”¨ä¾‹ã€‚</p>
<h3>ä½¿ç”¨GraphQLæŒ‡ä»¤</h3>
<p>è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªGraphQLæŒ‡ä»¤<code>isLoggedin</code>å¹¶å°†å…¶åº”ç”¨äº<code>tweet</code>æŸ¥è¯¢:</p>
<pre>// schema.js

const { gql } = require("apollo-server-express");

// Construct a schema, using GraphQL schema language
module.exports = gql`
  directive @isLoggedin on FIELD_DEFINITION
  type Query {
    hello: String
    tweets: [Tweet]!
    tweet(id: Int!): Tweet! @isLoggedin
  }
  ...
`;</pre>
<p>ç„¶åï¼Œåœ¨GraphQLæœåŠ¡å™¨ä¸Šæ·»åŠ è¯¥æŒ‡ä»¤çš„é€»è¾‘ã€‚åˆ›å»ºä¸€ä¸ª<code>directives.js</code>æ–‡ä»¶:</p>
<pre>// directives.js

const {
  ForbiddenError,
  SchemaDirectiveVisitor,
} = require("apollo-server-express");
const { defaultFieldResolver } = require("graphql");

class isLoggedinDirective extends SchemaDirectiveVisitor {
  visitFieldDefinition(field) {
    const originalResolve = field.resolve || defaultFieldResolver;
    field.resolve = async function (...args) {
      const context = args[2];
      const user = context.user || "";
      if (!user) {
        throw new ForbiddenError("Not Authorized");
      }
      const data = await originalResolve.apply(this, args);
      return data;
    };
  }
}

module.exports = { isLoggedinDirective };</pre>
<p>åˆ›å»ºæŒ‡ä»¤çš„è¯­æ³•æœ‰ç‚¹è’è°¬ã€‚ä½ å¯ä»¥åœ¨é˜¿æ³¢ç½—<a href="https://www.apollographql.com/docs/apollo-server/schema/creating-directives/" target="_blank" rel="noopener noreferrer">æ–‡æ¡£</a>ä¸­æ¢ç´¢æ›´å¤šã€‚æˆ‘ä»¬éœ€è¦é“¾æ¥æœåŠ¡å™¨ä¸Šçš„æŒ‡ä»¤:</p>
<pre>// index.js

const { isLoggedinDirective } = require("./directives");

...
const server = new ApolloServer({
  typeDefs,
  resolvers,
  schemaDirectives: {
    isLoggedin: isLoggedinDirective,
  },
  context: ({ req }) =&gt; {
    return {
      user: req.headers.user || "",
    };
  },
});
...</pre>
<p>è¿è¡ŒæœåŠ¡å™¨å¹¶æ£€æŸ¥GraphQL playgroundä¸­çš„<code>with</code>å’Œ<code>without user</code>å¤´ã€‚è¯¥æŒ‡ä»¤çš„å·¥ä½œæ–¹å¼ä¸æˆ‘ä»¬ç®€å•çš„è§£å†³æ–¹æ¡ˆå®Œå…¨ä¸€æ ·ï¼Œä½†æ˜¯ç”±äºé€»è¾‘æ˜¯è§£è€¦çš„ï¼Œæ‰€ä»¥å¾ˆå®¹æ˜“åœ¨å¤šä¸ªåœ°æ–¹é‡ç”¨ã€‚</p>
<h3>ä½¿ç”¨GraphQLä¸­é—´ä»¶</h3>
<p>ä¸­é—´ä»¶ä¹Ÿæ˜¯ä¸€ä¸ªè§£æå™¨ã€‚ä¸æ˜¯ç›´æ¥è§£ææŸ¥è¯¢ï¼Œè€Œæ˜¯é¦–å…ˆåœ¨ä¸­é—´ä»¶è§£æå™¨ä¸­è¿›è¡Œæ£€æŸ¥ï¼Œç„¶åä¼ é€’ç»™ä¸‹ä¸€ä¸ªè§£æå™¨ã€‚æ‚¨å¯ä»¥ä½¿ç”¨è¿™ç§æŠ€æœ¯ç»„åˆå¤šä¸ªè§£æå™¨ã€‚</p>
<p>ä¸ºæ­¤ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨åä¸º<code>graphql-resolvers</code>çš„åŒ…ã€‚</p>
<pre>npm i graphql-resolvers</pre>
<p>è®©æˆ‘ä»¬åœ¨<code>middlewares.js</code>æ–‡ä»¶ä¸­åˆ›å»ºæˆ‘ä»¬çš„<code>isLoggedin</code>ä¸­é—´ä»¶è§£æå™¨:</p>
<pre>// middlewares.js

const { ForbiddenError } = require("apollo-server-express");

// Middleware resolver
const isLoggedin = (parent, args, { user }, info) =&gt; {
  if (!user) throw new ForbiddenError("Not Authorized");
};

module.exports = { isLoggedin };</pre>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥å°†è¿™ä¸ªä¸­é—´ä»¶æ·»åŠ åˆ°<code>tweet</code>è§£æå™¨ä¸­:</p>
<pre>// resolvers.js
...
const { combineResolvers } = require("graphql-resolvers");
const { isLoggedin } = require("./middlewares");

...
tweet: combineResolvers(isLoggedin, (_, { id }) =&gt; {
      const tweetId = tweets.findIndex((tweet) =&gt; tweet.id === id);
      if (tweetId === -1) return new ApolloError("Tweet not found");
      return tweets[tweetId];
})
...</pre>
<p>ä½¿ç”¨<code>combineResolvers</code>ï¼Œæˆ‘ä»¬èƒ½å¤Ÿåœ¨è§£æå®é™…æŸ¥è¯¢ä¹‹å‰ç»„åˆå¤šä¸ªä¸­é—´ä»¶è§£æå™¨ã€‚</p>
<p>è¿™ä¸ªæ–¹æ³•ä¹Ÿæ˜¯å¯é‡ç”¨çš„ï¼Œå› ä¸ºæˆ‘ä»¬ä»çœŸæ­£çš„è§£æå™¨ä¸­æå–é€»è¾‘ã€‚</p>
<h2>å¯¹è±¡çº§æƒé™</h2>
<p>å¯¹äºåŒä¸€ä¸ªç¤ºä¾‹ï¼Œæˆ‘ä»¬å°†è¯¥æŒ‡ä»¤åº”ç”¨äºæ•´ä¸ªTweetç±»å‹ã€‚ç„¶åï¼Œæˆ‘ä»¬å°†å¯ç”¨å¯¹è±¡çº§æƒé™ã€‚æˆ‘ä»¬å¯ä»¥è·¨æ‰€æœ‰æŸ¥è¯¢ä¿æŠ¤æ•´ä¸ªå¯¹è±¡ï¼Œè€Œä¸æ˜¯åªä¿æŠ¤æŸ¥è¯¢ã€‚</p>
<p>è®©æˆ‘ä»¬æŠŠå®ƒçœ‹ä½œä¸€ä¸ªä¾‹å­ã€‚è¯¥ç¤ºä¾‹ç±»ä¼¼äºæˆ‘ä»¬çš„æ¨¡å¼æŒ‡ä»¤ç¤ºä¾‹:</p>
<pre>// schema.js

const { gql } = require("apollo-server-express");

// Construct a schema, using GraphQL schema language
module.exports = gql`
  directive @isLoggedin on OBJECT
  
  type Query {
    hello: String
    tweets: [Tweet]!
    tweet(id: Int!): Tweet!
  }
  
  type Tweet @isLoggedin {
    id: Int!
    content: String!
    author: String!
  }
`;</pre>
<p>æŒ‡ä»¤é™„åŠ åœ¨ç±»å‹<code>Tweet</code>ä¸Šã€‚å¦‚æœä½ æ³¨æ„åˆ°äº†ï¼Œæˆ‘ä»¬æ”¹å˜äº†<code>OBJECT</code>ä¸Šçš„æŒ‡ä»¤å£°æ˜ã€‚è¿™éœ€è¦å¯¹<code>directives.js</code>è¿›è¡Œä¸€äº›ä¿®æ”¹:</p>
<pre>// directives.js

const {
  ForbiddenError,
  SchemaDirectiveVisitor,
} = require("apollo-server-express");
const { defaultFieldResolver } = require("graphql");

class isLoggedinDirective extends SchemaDirectiveVisitor {
  visitObject(obj) {
    const fields = obj.getFields();
    Object.keys(fields).forEach((fieldName) =&gt; {
      const field = fields[fieldName];
      const originalResolve = field.resolve || defaultFieldResolver;
      field.resolve = async function (...args) {
        const context = args[2];
        const user = context.user || "";
        if (!user) {
          throw new ForbiddenError("Not Authorized");
        }
        const data = await originalResolve.apply(this, args);
        return data;
      };
    });
  }
}

module.exports = { isLoggedinDirective };</pre>
<p>å¦‚æœæ‚¨åœ¨æ²¡æœ‰ç™»å½•çš„æƒ…å†µä¸‹æ£€æŸ¥<code>tweets</code>æŸ¥è¯¢ï¼Œé‚£ä¹ˆå®ƒå°†æŠ›å‡ºä¸€ä¸ªé”™è¯¯ï¼Œå› ä¸º<code>tweets</code>æŸ¥è¯¢è¿”å›ä¸€ä¸ªTweetsæ•°ç»„ã€‚</p>
<p>æ ‡é¢˜ä¸­æ²¡æœ‰ç”¨æˆ·:</p>
<p><img data-attachment-id="26671" data-permalink="https://blog.logrocket.com/a-complete-guide-to-permissions-in-a-graphql-api/error-messages/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/10/error-messages.png" data-orig-size="730,400" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="error-messages" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/10/error-messages-300x164.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/10/error-messages.png" decoding="async" class="aligncenter wp-image-26671 size-full jetpack-lazy-image" src="../Images/a677dc19c1b786736ca121d0d9a555d6.png" alt="An error message shown because there is no user in the header." data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/10/error-messages.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/10/error-messages-300x164.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/10/error-messages.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/10/error-messages.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="26671" data-permalink="https://blog.logrocket.com/a-complete-guide-to-permissions-in-a-graphql-api/error-messages/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/10/error-messages.png" data-orig-size="730,400" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="error-messages" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/10/error-messages-300x164.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/10/error-messages.png" decoding="async" loading="lazy" class="aligncenter wp-image-26671 size-full" src="../Images/a677dc19c1b786736ca121d0d9a555d6.png" alt="An error message shown because there is no user in the header." srcset="https://blog.logrocket.com/wp-content/uploads/2020/10/error-messages.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/10/error-messages-300x164.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/10/error-messages.png"/></noscript>
<p>æ ‡é¢˜ä¸­åŒ…å«ç”¨æˆ·:</p>
<p><img data-attachment-id="26672" data-permalink="https://blog.logrocket.com/a-complete-guide-to-permissions-in-a-graphql-api/data/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/10/data.png" data-orig-size="730,375" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="data" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/10/data-300x154.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/10/data.png" decoding="async" class="aligncenter wp-image-26672 size-full jetpack-lazy-image" src="../Images/7c501ef49181e6811a2ee2ae64259348.png" alt="A successful tweet with a user in the header." data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/10/data.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/10/data-300x154.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/10/data.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/10/data.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="26672" data-permalink="https://blog.logrocket.com/a-complete-guide-to-permissions-in-a-graphql-api/data/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/10/data.png" data-orig-size="730,375" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="data" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/10/data-300x154.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/10/data.png" decoding="async" loading="lazy" class="aligncenter wp-image-26672 size-full" src="../Images/7c501ef49181e6811a2ee2ae64259348.png" alt="A successful tweet with a user in the header." srcset="https://blog.logrocket.com/wp-content/uploads/2020/10/data.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/10/data-300x154.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/10/data.png"/></noscript>
<h2>å­—æ®µçº§æƒé™</h2>
<p>æˆ‘ä»¬è¿˜å¯ä»¥å®ç°å­—æ®µçº§çš„ç²’åº¦æƒé™ã€‚ä¾‹å¦‚ï¼Œå…·æœ‰ç®¡ç†å‘˜è§’è‰²çš„ç”¨æˆ·å¯ä»¥æŸ¥çœ‹æŸäº›å­—æ®µã€‚åŒæ—¶ï¼Œå…·æœ‰æ™®é€šè®¿é—®æƒé™çš„ç”¨æˆ·ä¸ä¼šçœ‹åˆ°è¿™æ ·çš„å­—æ®µã€‚</p>
<p>è¿™ç§æƒ…å†µçš„å…¸å‹ä¾‹å­æ˜¯è®¡è´¹å’Œè®¢é˜…ä¿¡æ¯ã€‚åªæœ‰ç®¡ç†å‘˜å¯ä»¥çœ‹åˆ°è¿™äº›ä¿¡æ¯ï¼Œå…¶ä»–ç”¨æˆ·çœ‹ä¸åˆ°ã€‚æ‚¨å¯ä»¥åœ¨GraphQL APIä¸Šä»¥è¿™æ ·çš„ç²’åº¦æˆäºˆæƒé™ã€‚</p>
<p>å¯¹äºä¸Šä¸€ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†æŒ‡ä»¤ã€‚æˆ‘ä»¬å°†ä½¿ç”¨ä¸€ç§æ–°æŠ€æœ¯æ¥å®ç°æˆ‘ä»¬çš„å­—æ®µçº§æƒé™ã€‚æ­£å¦‚æˆ‘ä¹‹å‰æåˆ°çš„ï¼Œæ‚¨å¯ä»¥ç”¨è®¸å¤šä¸åŒçš„æ–¹å¼å®ç°æƒé™ã€‚ç”±ä½ é€‰æ‹©ä¸€ä¸ªï¼Œè¿™å–å†³äºé¡¹ç›®ã€‚</p>
<h3>ä½¿ç”¨GraphQLå±è”½åº“</h3>
<p>GraphQL shieldå¯ç”¨äºåœ¨GraphQL APIä¸­è¿›è¡Œéå¸¸å¹¿æ³›æˆ–è¯¦å°½çš„æƒé™è®¾ç½®ã€‚æˆ‘ä»¬å°†çœ‹åˆ°å¦‚ä½•ä½¿ç”¨<code>graphql-shield</code>æ¥å®ç°ç²’åº¦æƒé™ã€‚</p>
<p>è®©æˆ‘ä»¬å®‰è£…å®ƒ:</p>
<pre>npm i graphql-shield graphql-middleware @graphql-tools/schema</pre>
<p>æ¥ä¸‹æ¥ï¼Œåˆ›å»ºä¸€ä¸ª<code>permissions.js</code>æ–‡ä»¶ã€‚è®©æˆ‘ä»¬æ‹’ç»æ‰€æœ‰è¯·æ±‚ï¼Œåªå…è®¸ä¸€ä¸ª<code>hello</code>æŸ¥è¯¢:</p>
<pre>// permissions.js

const { allow, deny, shield } = require("graphql-shield");

const permissions = shield({
  Query: {
    "*": deny,
    hello: allow,
  },
});

module.exports = permissions;</pre>
<p>é€šé…ç¬¦å°†æ‹’ç»æ¯ä¸ªè¯·æ±‚ï¼Œç„¶åç²¾ç¡®åœ°å…è®¸<code>hello</code>æŸ¥è¯¢ã€‚ç°åœ¨ï¼Œåœ¨æœåŠ¡å™¨ä¸­åº”ç”¨æƒé™:</p>
<pre>// index.js

const express = require("express");
const { ApolloServer } = require("apollo-server-express");
const { applyMiddleware } = require("graphql-middleware");
const { makeExecutableSchema } = require("@graphql-tools/schema");

const typeDefs = require("./schema");
const resolvers = require("./resolvers");
const permissions = require("./permissions");

const schema = makeExecutableSchema({
  typeDefs,
  resolvers,
});

const server = new ApolloServer({
  schema: applyMiddleware(schema, permissions),
  resolvers,
  context: ({ req }) =&gt; {
    return {
      user: req.headers.user || "",
    };
  },
});

const app = express();
server.applyMiddleware({ app });

app.listen({ port: 4000 }, () =&gt;
  console.log(`ğŸš€ Server ready at http://localhost:4000${server.graphqlPath}`)
);</pre>
<p>å»æ£€æŸ¥<code>tweets</code>æˆ–<code>tweet</code>æŸ¥è¯¢ã€‚å®ƒä¼šæŠ›å‡ºä¸€ä¸ª<code>Not Authorized!</code>é”™è¯¯ã€‚åªæœ‰ä¸€ä¸ª<code>hello</code>æŸ¥è¯¢å¯ä»¥å·¥ä½œã€‚</p>
<p>ç°åœ¨è®©æˆ‘ä»¬å…è®¸æ¯ä¸ªæŸ¥è¯¢ï¼Œå¹¶ä¸”åªæ‹’ç»<code>Tweet</code>ç±»å‹ä¸­çš„å­—æ®µ<code>author</code>:</p>
<pre>// permissions.js

const { allow, shield, deny } = require("graphql-shield");

const permissions = shield({
  Query: {
    "*": allow,
  },
  Tweet: {
    author: deny,
  },
});

module.exports = permissions;</pre>
<p>å¦‚æœæ‚¨å‘é€ä¸€ä¸ªå¸¦æœ‰<code>author</code>å­—æ®µçš„æŸ¥è¯¢ï¼Œå®ƒå°†æ˜¾ç¤ºå¦‚ä¸‹é”™è¯¯:</p>
<p><img data-attachment-id="26675" data-permalink="https://blog.logrocket.com/a-complete-guide-to-permissions-in-a-graphql-api/not-authorized/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/10/not-authorized.png" data-orig-size="730,400" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="not-authorized" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/10/not-authorized-300x164.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/10/not-authorized.png" decoding="async" class="aligncenter wp-image-26675 size-full jetpack-lazy-image" src="../Images/d186be573cfc928dc3ec71f7ad044d03.png" alt="A failed query shown because the author field is shown." data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/10/not-authorized.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/10/not-authorized-300x164.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/10/not-authorized.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/10/not-authorized.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="26675" data-permalink="https://blog.logrocket.com/a-complete-guide-to-permissions-in-a-graphql-api/not-authorized/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/10/not-authorized.png" data-orig-size="730,400" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="not-authorized" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/10/not-authorized-300x164.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/10/not-authorized.png" decoding="async" loading="lazy" class="aligncenter wp-image-26675 size-full" src="../Images/d186be573cfc928dc3ec71f7ad044d03.png" alt="A failed query shown because the author field is shown." srcset="https://blog.logrocket.com/wp-content/uploads/2020/10/not-authorized.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/10/not-authorized-300x164.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/10/not-authorized.png"/></noscript>
<p>å¦‚æœæ‚¨å‘é€æ²¡æœ‰ä½œè€…çš„è¯·æ±‚ï¼Œé‚£ä¹ˆå®ƒå°†æ˜¾ç¤º<code>tweets</code>æ•°æ®:</p>
<p><img data-attachment-id="26673" data-permalink="https://blog.logrocket.com/a-complete-guide-to-permissions-in-a-graphql-api/data-tweets/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/10/data-tweets.png" data-orig-size="730,375" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="data-tweets" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/10/data-tweets-300x154.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/10/data-tweets.png" decoding="async" class="aligncenter wp-image-26673 size-full jetpack-lazy-image" src="../Images/77ed895eede923e263d14cf9830022ec.png" alt="A successful tweet because there is no author listed." data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/10/data-tweets.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/10/data-tweets-300x154.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/10/data-tweets.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/10/data-tweets.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="26673" data-permalink="https://blog.logrocket.com/a-complete-guide-to-permissions-in-a-graphql-api/data-tweets/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/10/data-tweets.png" data-orig-size="730,375" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="data-tweets" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/10/data-tweets-300x154.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/10/data-tweets.png" decoding="async" loading="lazy" class="aligncenter wp-image-26673 size-full" src="../Images/77ed895eede923e263d14cf9830022ec.png" alt="A successful tweet because there is no author listed." srcset="https://blog.logrocket.com/wp-content/uploads/2020/10/data-tweets.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/10/data-tweets-300x154.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/10/data-tweets.png"/></noscript>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬å°†æ·»åŠ ä¸€æ¡è§„åˆ™ï¼Œä»…åœ¨ç”¨æˆ·ç™»å½•æ—¶æ˜¾ç¤ºä½œè€…ï¼Œè€Œä¸æ˜¯å®Œå…¨æ‹’ç»ã€‚å¦åˆ™ï¼Œæˆ‘ä»¬å°†æ‹’ç»é‚£äº›æŸ¥è¯¢å­—æ®µ<code>author</code>çš„è¯·æ±‚ã€‚</p>
<p>GraphQL shieldåº“æœ‰å¤§é‡æ–¹æ³•æ¥åˆ›å»ºè§„åˆ™ã€‚wWå¯ä»¥åˆ›å»ºæˆ‘ä»¬çš„<code>isLoggedin</code>è§„åˆ™:</p>
<pre>// permissions.js

const { ForbiddenError } = require("apollo-server-express");
const { allow, shield, rule } = require("graphql-shield");

// Rule for shield
const isLoggedin = rule({ cache: "contextual" })(
  async (parent, args, { user }, info) =&gt; {
    if (user) return true;
    return new ForbiddenError("Not Authorized");
  }
);

const permissions = shield({
  Query: {
    "*": allow,
  },
  Tweet: {
    author: isLoggedin,
  },
});

module.exports = permissions;</pre>
<p>å¦‚æœå­—æ®µè¢«è¯·æ±‚ï¼Œé‚£ä¹ˆGraphQL shieldå°†ä¸ºç”¨æˆ·æ£€æŸ¥ã€‚å¦‚æœç”¨æˆ·å‡ºç°åœ¨æ ‡é¢˜ä¸­ï¼Œé‚£ä¹ˆå®ƒå…è®¸<code>tweet</code>ç»“æœã€‚å¦åˆ™ï¼Œå®ƒä¼šæ‹’ç»è¯·æ±‚ã€‚</p>
<p>æ ‡é¢˜ä¸­æ²¡æœ‰ç”¨æˆ·:</p>
<p><img data-attachment-id="26676" data-permalink="https://blog.logrocket.com/a-complete-guide-to-permissions-in-a-graphql-api/without-user/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/10/Without-user.png" data-orig-size="730,375" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Without user" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/10/Without-user-300x154.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/10/Without-user.png" decoding="async" class="aligncenter wp-image-26676 size-full jetpack-lazy-image" src="../Images/2d912b9ac61560061fb70d71b8527a96.png" alt="A denied request because there is no user in the header." data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/10/Without-user.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/10/Without-user-300x154.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/10/Without-user.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/10/Without-user.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="26676" data-permalink="https://blog.logrocket.com/a-complete-guide-to-permissions-in-a-graphql-api/without-user/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/10/Without-user.png" data-orig-size="730,375" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Without user" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/10/Without-user-300x154.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/10/Without-user.png" decoding="async" loading="lazy" class="aligncenter wp-image-26676 size-full" src="../Images/2d912b9ac61560061fb70d71b8527a96.png" alt="A denied request because there is no user in the header." srcset="https://blog.logrocket.com/wp-content/uploads/2020/10/Without-user.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/10/Without-user-300x154.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/10/Without-user.png"/></noscript>
<p>æ ‡é¢˜ä¸­æœ‰ç”¨æˆ·:</p>
<p><img data-attachment-id="26677" data-permalink="https://blog.logrocket.com/a-complete-guide-to-permissions-in-a-graphql-api/authorized-tweets/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/10/authorized-tweets..png" data-orig-size="730,400" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="authorized tweets." data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/10/authorized-tweets.-300x164.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/10/authorized-tweets..png" decoding="async" class="aligncenter wp-image-26677 size-full jetpack-lazy-image" src="../Images/76dec2821fc2af4f6eb81c522fd97728.png" alt="An authorized tweet because the author is included." data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/10/authorized-tweets..png 730w, https://blog.logrocket.com/wp-content/uploads/2020/10/authorized-tweets.-300x164.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/10/authorized-tweets..png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/10/authorized-tweets..png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="26677" data-permalink="https://blog.logrocket.com/a-complete-guide-to-permissions-in-a-graphql-api/authorized-tweets/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/10/authorized-tweets..png" data-orig-size="730,400" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="authorized tweets." data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/10/authorized-tweets.-300x164.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/10/authorized-tweets..png" decoding="async" loading="lazy" class="aligncenter wp-image-26677 size-full" src="../Images/76dec2821fc2af4f6eb81c522fd97728.png" alt="An authorized tweet because the author is included." srcset="https://blog.logrocket.com/wp-content/uploads/2020/10/authorized-tweets..png 730w, https://blog.logrocket.com/wp-content/uploads/2020/10/authorized-tweets.-300x164.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/10/authorized-tweets..png"/></noscript>
<h2>ç»“è®º</h2>
<p>æˆ‘ä»¬è®¨è®ºäº†åœ¨GraphQL APIä¸­å®ç°æƒé™ã€‚å¦‚æœæ‚¨è§‰å¾—è¿™ç¯‡æ–‡ç« å¯¹åœ¨GraphQL APIä¸­å®ç°æƒé™æœ‰ç”¨ï¼Œè¯·åœ¨è¯„è®ºä¸­å‘Šè¯‰æˆ‘ã€‚</p>
<p>ä½ å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°æºä»£ç <a href="https://github.com/learnwithparam/logrocket-grpahql-permissions" target="_blank" rel="noopener noreferrer">ã€‚æ‚¨éœ€è¦å¯»æ‰¾ä¸åŒçš„åˆ†æ”¯æ¥æŸ¥çœ‹æ¯ä¸ªç¤ºä¾‹ã€‚æ‰€æœ‰çš„éƒ½æœ‰ä¸€ä¸ªæ•°å­—å‰ç¼€ï¼Œä»¥ä¾¿äºå¯¼èˆªã€‚</a></p><div class="code-block code-block-24">
<div class="blog-plug inline-plug graphql-plug"><h2>ç›‘æ§ç”Ÿäº§ä¸­å¤±è´¥å’Œç¼“æ…¢çš„GraphQLè¯·æ±‚</h2><p>è™½ç„¶GraphQLæœ‰ä¸€äº›è°ƒè¯•è¯·æ±‚å’Œå“åº”çš„ç‰¹æ€§ï¼Œä½†ç¡®ä¿GraphQLå¯é åœ°ä¸ºæ‚¨çš„ç”Ÿäº§åº”ç”¨ç¨‹åºæä¾›èµ„æºæ˜¯ä¸€ä»¶æ¯”è¾ƒå›°éš¾çš„äº‹æƒ…ã€‚å¦‚æœæ‚¨å¯¹ç¡®ä¿å¯¹åç«¯æˆ–ç¬¬ä¸‰æ–¹æœåŠ¡çš„ç½‘ç»œè¯·æ±‚æˆåŠŸæ„Ÿå…´è¶£ï¼Œ</p><a href="https://lp.logrocket.com/blg/graphql-signup" target="_blank">try LogRocket</a><p>.</p><a class="signup" href="https://lp.logrocket.com/blg/graphql-signup" target="_blank" rel="noopener noreferrer"><img src="../Images/432a3823c85b3fb72a206e6236a29f48.png" data-lazy-src="https://files.readme.io/69aa835-Image_2019-11-09_at_1.28.05_PM.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" class=" jetpack-lazy-image" data-original-src="https://files.readme.io/69aa835-Image_2019-11-09_at_1.28.05_PM.png"/><noscript><img data-lazy-fallback="1" src="../Images/432a3823c85b3fb72a206e6236a29f48.png" data-original-src="https://files.readme.io/69aa835-Image_2019-11-09_at_1.28.05_PM.png"/></noscript><img class="alignnone size-full wp-image-46 jetpack-lazy-image" src="../Images/d6f5a5dd739296c1dd7aab3d5e77eeb9.png" alt="LogRocket Dashboard Free Trial Banner" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png"/><noscript><img data-lazy-fallback="1" class="alignnone size-full wp-image-46" src="../Images/d6f5a5dd739296c1dd7aab3d5e77eeb9.png" alt="LogRocket Dashboard Free Trial Banner" data-original-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png"/></noscript></a><a href="https://lp.logrocket.com/blg/graphql-signup" target="_blank" rel="noopener noreferrer">https://logrocket.com/signup/</a><p>LogRocket å°±åƒæ˜¯ç½‘ç»œå’Œç§»åŠ¨åº”ç”¨çš„DVRï¼Œè®°å½•ä¸‹ä½ ç½‘ç«™ä¸Šå‘ç”Ÿçš„æ¯ä¸€ä»¶äº‹ã€‚æ‚¨å¯ä»¥æ±‡æ€»å¹¶æŠ¥å‘Šæœ‰é—®é¢˜çš„GraphQLè¯·æ±‚ï¼Œä»¥å¿«é€Ÿäº†è§£æ ¹æœ¬åŸå› ï¼Œè€Œä¸æ˜¯çŒœæµ‹é—®é¢˜å‘ç”Ÿçš„åŸå› ã€‚æ­¤å¤–ï¼Œæ‚¨å¯ä»¥è·Ÿè¸ªApolloå®¢æˆ·æœºçŠ¶æ€å¹¶æ£€æŸ¥GraphQLæŸ¥è¯¢çš„é”®å€¼å¯¹ã€‚</p><p>LogRocketæ£€æµ‹æ‚¨çš„åº”ç”¨ç¨‹åºä»¥è®°å½•åŸºçº¿æ€§èƒ½è®¡æ—¶ï¼Œå¦‚é¡µé¢åŠ è½½æ—¶é—´ã€åˆ°è¾¾ç¬¬ä¸€ä¸ªå­—èŠ‚çš„æ—¶é—´ã€æ…¢é€Ÿç½‘ç»œè¯·æ±‚ï¼Œè¿˜è®°å½•Reduxã€NgRxå’ŒVuexæ“ä½œ/çŠ¶æ€ã€‚</p><a class="signup" href="https://lp.logrocket.com/blg/graphql-signup" target="_blank" rel="noopener noreferrer">Start monitoring for free</a><p>.</p></div>


</div>

<p class="clearfix"/>
<p class="clearfix"/>
</article>

</div>    
</body>
</html>