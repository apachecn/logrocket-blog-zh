<html>
<head>
<title>How to build a Telegram OCR bot - LogRocket Blog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>å¦‚ä½•å»ºç«‹ä¸€ä¸ªç”µæŠ¥OCRæœºå™¨äººæ—¥å¿—ç«ç®­åšå®¢</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://blog.logrocket.com/how-to-build-a-telegram-ocr-bot/#0001-01-01">https://blog.logrocket.com/how-to-build-a-telegram-ocr-bot/#0001-01-01</a></blockquote><div><article class="article-post">
<h2>ä»‹ç»</h2>
<p>åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†æ„å»ºä¸€ä¸ªèƒ½å¤Ÿæ‰§è¡Œå…‰å­¦å­—ç¬¦è¯†åˆ«(OCR)çš„<a href="https://telegram.org/" target="_blank" rel="noopener noreferrer">ç”µæŠ¥</a>èŠå¤©æœºå™¨äººã€‚Telegramæ˜¯ä¸€æ¬¾åŸºäºäº‘çš„ç§»åŠ¨å’Œæ¡Œé¢æ¶ˆæ¯åº”ç”¨ï¼Œä¸“æ³¨äºå®‰å…¨æ€§å’Œé€Ÿåº¦ã€‚<a href="https://en.wikipedia.org/wiki/Optical_character_recognition" target="_blank" rel="noopener noreferrer">å…‰å­¦å­—ç¬¦è¯†åˆ«(OCR) </a>æ˜¯ä»¥ç”µå­æ–¹å¼ä»å›¾åƒã€è§†é¢‘æˆ–ä»»ä½•ç±»å‹çš„æ–‡æ¡£ä¸­æå–æ–‡æœ¬çš„è¿‡ç¨‹ã€‚</p>
<p>ä¸ºäº†æ„å»ºè¿™ä¸ªç”µæŠ¥æœºå™¨äººï¼Œæˆ‘ä»¬å°†ä½¿ç”¨Node.jså’Œä»¥ä¸‹æ¨¡å—<a href="https://github.com/telegraf/telegraf" target="_blank" rel="noopener noreferrer"> telegraf </a>ã€<a href="https://github.com/zapolnoch/node-tesseract-ocr" target="_blank" rel="noopener noreferrer">node-tesserac-ocr</a>ã€<a href="https://github.com/damianociarla/node-ffmpeg" target="_blank" rel="noopener noreferrer"> node-ffmpeg </a>ã€<a href="https://github.com/motdotla/dotenv" target="_blank" rel="noopener noreferrer"> dotenv </a>å’Œ<a href="https://github.com/axios/axios" target="_blank" rel="noopener noreferrer"> Axios </a>ã€‚</p>
<ul>
<li>æ˜¯ä¸€ä¸ªç”µæŠ¥æœºå™¨äººæ¡†æ¶ï¼Œä½¿å¾—æœºå™¨äººçš„å¼€å‘å˜å¾—ç®€å•æ˜äº†</li>
<li><code>node-tesseract-ocr</code>æ˜¯<a href="https://github.com/tesseract-ocr/tesseract" target="_blank" rel="noopener noreferrer">å®‡å®™é­”æ–¹OCR </a> APIçš„Node.jsåŒ…è£…å™¨ã€‚<code>Tesseract</code>æ˜¯ä¸€ä¸ªOCRå¼•æ“ï¼Œèƒ½å¤Ÿä»å„ç§åª’ä½“æ ¼å¼ä¸­æå–æ–‡æœ¬ã€‚æˆ‘ä»¬å°†ä½¿ç”¨è¿™ä¸ªæ¨¡å—ä»å›¾åƒä¸­æå–æ–‡æœ¬</li>
<li><code>node-ffmpeg</code>æ˜¯èŠ‚ç‚¹çš„<a href="https://github.com/FFmpeg/FFmpeg" target="_blank" rel="noopener noreferrer"> FFmpeg </a>æ¨¡å—ã€‚è¿™ä¸ªåº“æä¾›äº†ä¸€ç»„å‡½æ•°å’Œå®ç”¨ç¨‹åºæ¥æŠ½è±¡FFmpegçš„å‘½ä»¤è¡Œç”¨æ³•ã€‚FFmpegæ˜¯å¤„ç†å¤šåª’ä½“å†…å®¹(å¦‚éŸ³é¢‘ã€è§†é¢‘ã€å­—å¹•å’Œç›¸å…³å…ƒæ•°æ®)çš„åº“å’Œå·¥å…·çš„é›†åˆã€‚æˆ‘ä»¬å°†ä½¿ç”¨è¿™ä¸ªæ¨¡å—ä»è§†é¢‘ä¸­æå–ä¸€å¸§ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨Tesseractä»è¯¥å¸§ä¸­æå–æ–‡æœ¬</li>
<li><code>dotenv</code>æ˜¯ä¸€ä¸ªNode.jsæ¨¡å—ï¼Œå°†ç¯å¢ƒå˜é‡ä»<code>.env</code>æ–‡ä»¶åŠ è½½åˆ°<code>process.env</code>ä¸­ã€‚æˆ‘ä»¬å°†ä½¿ç”¨è¿™ä¸ªæ¨¡å—æ¥å­˜å‚¨æˆ‘ä»¬çš„botå‡­è¯</li>
<li><code>axios</code>æ˜¯ä¸€ä¸ªä¸ºæµè§ˆå™¨å’ŒNode.jsæä¾›åŸºäºpromiseçš„HTTPå®¢æˆ·ç«¯çš„æ¨¡å—ã€‚æˆ‘ä»¬å°†ä½¿ç”¨è¯¥æ¨¡å—å°†å›¾åƒä¸‹è½½åˆ°ä½äºæˆ‘ä»¬æœåŠ¡å™¨çš„æ–‡ä»¶å¤¹ä¸­</li>
</ul>
<p>åœ¨æœ¬æ•™ç¨‹ç»“æŸæ—¶ï¼Œæ‚¨å°†æ‹¥æœ‰ä¸€ä¸ªèƒ½å¤Ÿä»å‘é€ç»™å®ƒçš„å›¾åƒå’Œè§†é¢‘ä¸­æå–æ–‡æœ¬çš„æœºå™¨äººã€‚</p>
<h2>å…ˆå†³æ¡ä»¶</h2>
<p>ä¸ºäº†å®Œæˆæœ¬æ•™ç¨‹ï¼Œæ‚¨éœ€è¦:</p>

<h2>ç†è§£æˆ‘ä»¬çš„æœºå™¨äººé€»è¾‘</h2>
<p>åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨<code>telegraf</code>æ¥æ„å»ºæˆ‘ä»¬çš„æœºå™¨äººï¼Œ<code>telegraf</code>å…è®¸æˆ‘ä»¬åˆ›å»ºä¸¤ç§ç±»å‹çš„æœºå™¨äºº:</p>
<ul>
<li><strong>èƒ½å¤Ÿå¤„ç†ç®€å•äº¤äº’çš„ç®€å•æœºå™¨äºº</strong>:è¿™ç±»æœºå™¨äººä¸»è¦å“åº”ç”¨æˆ·å‘½ä»¤ã€‚ä¾‹å¦‚ï¼Œæ¯å½“ç”¨æˆ·å‘é€ä¸€æ¡æ¶ˆæ¯è¯´<code>ping</code>æ—¶ï¼Œä¸€ä¸ªæœºå™¨äººå°±ä¼šå›å¤ä¸€æ¡æ¶ˆæ¯è¯´<code>pong</code></li>
<li>èƒ½å¤Ÿä¸ç”¨æˆ·è¿›è¡Œä¸åŒç±»å‹å¯¹è¯çš„å¤æ‚æœºå™¨äºº:ä¾‹å¦‚ï¼Œèƒ½å¤Ÿä¸ç”¨æˆ·å°±å¤©æ°”ã€è¶³çƒã€éŸ³ä¹ç­‰è¿›è¡Œå¯¹è¯çš„æœºå™¨äººã€‚</li>
</ul>
<p>æˆ‘ä»¬çš„OCRæœºå™¨äººå±äºå¤æ‚ç±»å‹ï¼Œä¸ºäº†æ„å»ºå®ƒï¼Œæˆ‘ä»¬å°†æŠŠæœºå™¨äººé€»è¾‘åˆ†æˆ<code>scenes</code>ã€‚ä½ å¯ä»¥è®¤ä¸º<code>scenes</code>æ˜¯æœºå™¨äººå’Œç”¨æˆ·ä¹‹é—´å¯èƒ½å‘ç”Ÿçš„ä¸åŒçš„ç‹¬ç«‹å¯¹è¯ï¼Œåœºæ™¯ä¸­çš„å‘½ä»¤åªæœ‰åœ¨ç”¨æˆ·è¿›å…¥ç‰¹å®šåœºæ™¯æ—¶æ‰å¯ç”¨ã€‚æˆ‘ä»¬å°†æŠŠæˆ‘ä»¬çš„æœºå™¨äººåˆ†æˆä¸¤ä¸ªç‹¬ç«‹çš„åœºæ™¯<code>imageScene</code>å’Œ<code>videoScene.</code></p>
<p><code>imageScene</code>å°†é©»ç•™åœ¨<code>imageScene.js</code>æ–‡ä»¶ä¸­ã€‚åœ¨è¿™ä¸ªåœºæ™¯ä¸­ï¼Œç”¨æˆ·å°†è¦æ±‚æœºå™¨äººä»å›¾åƒä¸­æå–æ–‡æœ¬ã€‚å·¥ä½œæµç¨‹å°†æ˜¯:</p>
<ul>
<li>æœºå™¨äººè¦æ±‚ç”¨æˆ·å‘é€å›¾åƒ</li>
<li>ç”¨æˆ·å‘é€å›¾åƒ</li>
<li>æœºå™¨äººä½¿ç”¨<code>tesseract</code>ä»æ¥æ”¶åˆ°çš„å›¾åƒä¸­æå–æ–‡æœ¬</li>
<li>æœºå™¨äººå°†æå–çš„æ–‡æœ¬è¿”å›ç»™ç”¨æˆ·</li>
</ul>
<p><code>videoScene</code>å°†é©»ç•™åœ¨<code>videoScene.js</code>æ–‡ä»¶ä¸­ï¼Œè¿™ä¸ªåœºæ™¯æ˜¯ç”¨æˆ·å°†è¦æ±‚æœºå™¨äººä»è§†é¢‘ä¸­çš„ä¸€å¸§æå–æ–‡æœ¬ï¼Œå·¥ä½œæµå°†æ˜¯:</p>
<ul>
<li>æœºå™¨äººè¦æ±‚ç”¨æˆ·å‘é€å¸§ä½ç½®</li>
<li>æœºå™¨äººä¿å­˜å¸§ä½ç½®ï¼Œç„¶åè¦æ±‚ç”¨æˆ·å‘é€è§†é¢‘</li>
<li>ç”¨æˆ·å‘é€è§†é¢‘</li>
<li>æœºå™¨äººä½¿ç”¨ä¿å­˜çš„å¸§ä½ç½®ï¼Œé€šè¿‡<code>ffmpeg</code>æå–å¹¶ä¿å­˜å¸§ï¼Œç„¶åæœºå™¨äººä½¿ç”¨<code>tesseract</code>ä»å›¾åƒä¸­æå–æ–‡æœ¬</li>
<li>æœºå™¨äººå°†æå–çš„æ–‡æœ¬è¿”å›ç»™ç”¨æˆ·</li>
</ul>
<p>å½“ç”¨æˆ·å‘Telegram botå‘é€æ–‡ä»¶æ—¶ï¼Œæ–‡ä»¶å­˜å‚¨åœ¨Telegramçš„æœåŠ¡å™¨ä¸­ï¼Œè€Œä¸æ˜¯æˆ‘ä»¬çš„æœåŠ¡å™¨ä¸­ï¼Œä¸ºäº†è·å¾—ç”¨æˆ·å‘é€çš„æ–‡ä»¶ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªåä¸º<code>fileManager.js</code>çš„è„šæœ¬ï¼Œè¯¥è„šæœ¬å°†è´Ÿè´£ä¸‹è½½å’Œåˆ é™¤ç”¨æˆ·å‘é€çš„æ–‡ä»¶ã€‚</p>
<p>æˆ‘ä»¬å°†æŠŠè´Ÿè´£æ‰§è¡ŒOCRçš„ä»£ç æ”¾åœ¨ä¸€ä¸ªåä¸º<code>ocr.js</code>çš„æ–‡ä»¶ä¸­ï¼Œè¿™ä¸ªæ–‡ä»¶å°†åŒ…å«æ‰§è¡ŒOCRçš„æ–¹æ³•ï¼Œä»¥åŠä»è§†é¢‘ä¸­æå–ç‰¹å®šå¸§çš„æ–¹æ³•ã€‚</p>
<p>å‡è®¾ç”¨æˆ·è¾“å…¥è¿›å…¥äº†<code>imageScene</code>æˆ–<code>videoScene</code>ï¼Œæˆ‘ä»¬å°†æœ‰ä¸€ä¸ªåä¸º<code>main.js</code>çš„æ–‡ä»¶è´Ÿè´£è¿è¡Œæˆ‘ä»¬çš„æœºå™¨äººã€‚</p>
<p>åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬è®¨è®ºäº†æˆ‘ä»¬çš„boté€»è¾‘ï¼Œåœ¨ä¸‹ä¸€æ­¥ä¸­ï¼Œæˆ‘ä»¬å°†åˆ›å»ºæˆ‘ä»¬çš„å·¥ä½œç›®å½•ã€‚</p>
<h2>åˆ›å»ºæˆ‘ä»¬çš„å·¥ä½œç›®å½•</h2>
<p>åœ¨è¿™ä¸€æ­¥ä¸­ï¼Œæˆ‘ä»¬å°†ä¸ºbotåˆ›å»ºä¸€ä¸ªå·¥ä½œç›®å½•ï¼Œå¹¶å®‰è£…å¿…è¦çš„åº“ã€‚</p>
<p>æ‰“å¼€ç»ˆç«¯çª—å£ï¼Œç¼–å†™ä»¥ä¸‹å‘½ä»¤:</p>
<pre>mkdir ocr-bot &amp;&amp; cd ocr-bot</pre>
<p>ä½¿ç”¨ä¸Šé¢çš„å‘½ä»¤ï¼Œæˆ‘ä»¬å·²ç»åˆ›å»ºäº†åä¸º<code>ocr-bot</code>çš„å·¥ä½œç›®å½•ï¼Œå¹¶å°†ç›®å½•æ›´æ”¹ä¸ºå®ƒã€‚</p>
<p>åœ¨ç»ˆç«¯ä¸­è¿è¡Œä»¥ä¸‹å‘½ä»¤:</p>
<pre>mkdir -p scenes tmp/{images,videos}</pre>
<p>ä½¿ç”¨ä¸Šé¢çš„å‘½ä»¤ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä»¥ä¸‹ç›®å½•:</p>
<ul>
<li>è¿™æ˜¯æˆ‘ä»¬å°†ä¸ºæˆ‘ä»¬çš„æœºå™¨äººå­˜å‚¨æ‰€æœ‰<code>scenes</code>çš„åœ°æ–¹</li>
<li><code>tmp</code>ï¼Œè¿™æ˜¯æˆ‘ä»¬ä¸´æ—¶å­˜å‚¨å‘é€åˆ°æœºå™¨äººçš„æ–‡ä»¶çš„åœ°æ–¹ï¼Œ<code>images</code>å­ç›®å½•æ˜¯å­˜å‚¨å›¾åƒçš„åœ°æ–¹ï¼Œ<code>videos</code>å­ç›®å½•æ˜¯å­˜å‚¨è§†é¢‘çš„åœ°æ–¹</li>
</ul>
<p>åœ¨ç»ˆç«¯ä¸­è¿è¡Œä»¥ä¸‹å‘½ä»¤:</p>
<pre>npm init -y</pre>
<p>ä½¿ç”¨ä¸Šé¢çš„å‘½ä»¤ï¼Œæˆ‘ä»¬å·²ç»åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„èŠ‚ç‚¹é¡¹ç›®ï¼Œç°åœ¨æ˜¯æ—¶å€™å®‰è£…å¿…è¦çš„ä¾èµ–é¡¹æ¥åˆ¶ä½œæˆ‘ä»¬çš„botäº†ã€‚</p>
<p>åœ¨ç»ˆç«¯ä¸­è¿è¡Œä»¥ä¸‹å‘½ä»¤:</p>
<pre>npm install telegraf node-tesseract-ocr ffmpeg dotenv axios --save</pre>
<p>åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å·²ç»åˆ›å»ºäº†å·¥ä½œç›®å½•ï¼Œåˆ›å»ºå¹¶æ¿€æ´»äº†èŠ‚ç‚¹é¡¹ç›®ï¼Œå¹¶å®‰è£…äº†å¿…è¦çš„åº“ã€‚ä¸‹ä¸€æ­¥ï¼Œæˆ‘ä»¬å°†æ³¨å†Œæˆ‘ä»¬çš„æœºå™¨äººã€‚</p>
<h2>æ³¨å†Œæˆ‘ä»¬çš„æœºå™¨äºº</h2>
<p>åœ¨è¿™ä¸€æ­¥ä¸­ï¼Œæˆ‘ä»¬å°†åœ¨<code>telegram</code>ä¸­æ³¨å†Œæˆ‘ä»¬çš„æœºå™¨äººï¼Œä¸ºäº†åšåˆ°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦è”ç³»<a href="https://telegram.me/BotFather" target="_blank" rel="noopener noreferrer">æœºå™¨äººçˆ¶äº²</a>ï¼Œè¿™æ˜¯ä¸€ä¸ªç”¨äºåˆ›å»ºæ–°çš„æœºå™¨äººå¸æˆ·å’Œç®¡ç†ç°æœ‰æœºå™¨äººçš„æœºå™¨äººã€‚</p>
<p>æ‰“å¼€ä½ å–œæ¬¢çš„<a href="https://telegram.org/" target="_blank" rel="noopener noreferrer">ç”µæŠ¥å®¢æˆ·ç«¯</a>ï¼Œæœç´¢<code>@BotFather</code>ï¼Œå¼€å§‹èŠå¤©ã€‚å‘é€<code>/newbot</code>å‘½ä»¤ï¼Œå¹¶éµå¾ªæœºå™¨äººçˆ¶äº²å‘é€çš„æŒ‡ä»¤:</p>
<p><img data-attachment-id="24988" data-permalink="https://blog.logrocket.com/how-to-build-a-telegram-ocr-bot/botfather/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/09/botfather.png" data-orig-size="189,336" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="botfather" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/09/botfather-169x300.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/09/botfather.png" decoding="async" class="aligncenter size-full wp-image-24988 jetpack-lazy-image" src="../Images/fee380a8e3757da234ff78814a77daa3.png" alt="message in chat bot botFather window" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/09/botfather.png 189w, https://blog.logrocket.com/wp-content/uploads/2020/09/botfather-169x300.png 169w" data-lazy-sizes="(max-width: 189px) 100vw, 189px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/09/botfather.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/09/botfather.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="24988" data-permalink="https://blog.logrocket.com/how-to-build-a-telegram-ocr-bot/botfather/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/09/botfather.png" data-orig-size="189,336" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="botfather" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/09/botfather-169x300.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/09/botfather.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-24988" src="../Images/fee380a8e3757da234ff78814a77daa3.png" alt="message in chat bot botFather window" srcset="https://blog.logrocket.com/wp-content/uploads/2020/09/botfather.png 189w, https://blog.logrocket.com/wp-content/uploads/2020/09/botfather-169x300.png 169w" sizes="(max-width: 189px) 100vw, 189px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/09/botfather.png"/></noscript>
<p>é€‰æ‹©æ‚¨çš„botåç§°å’Œç”¨æˆ·ååï¼Œæ‚¨å°†æ”¶åˆ°ä¸€æ¡åŒ…å«æ‚¨çš„è®¿é—®ä»¤ç‰Œçš„æ¶ˆæ¯:</p>
<p><img data-attachment-id="24989" data-permalink="https://blog.logrocket.com/how-to-build-a-telegram-ocr-bot/botfatherchat2/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/09/botfatherchat2.png" data-orig-size="189,336" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="botfatherchat2" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/09/botfatherchat2-169x300.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/09/botfatherchat2.png" decoding="async" class="aligncenter size-full wp-image-24989 jetpack-lazy-image" src="../Images/8ebb406cdd9021d56a745bec7ba05dd7.png" alt="chat bot message in botfather window the message contains a token for an HTTP API. The token is blacked out " data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/09/botfatherchat2.png 189w, https://blog.logrocket.com/wp-content/uploads/2020/09/botfatherchat2-169x300.png 169w" data-lazy-sizes="(max-width: 189px) 100vw, 189px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/09/botfatherchat2.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/09/botfatherchat2.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="24989" data-permalink="https://blog.logrocket.com/how-to-build-a-telegram-ocr-bot/botfatherchat2/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/09/botfatherchat2.png" data-orig-size="189,336" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="botfatherchat2" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/09/botfatherchat2-169x300.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/09/botfatherchat2.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-24989" src="../Images/8ebb406cdd9021d56a745bec7ba05dd7.png" alt="chat bot message in botfather window the message contains a token for an HTTP API. The token is blacked out " srcset="https://blog.logrocket.com/wp-content/uploads/2020/09/botfatherchat2.png 189w, https://blog.logrocket.com/wp-content/uploads/2020/09/botfatherchat2-169x300.png 169w" sizes="(max-width: 189px) 100vw, 189px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/09/botfatherchat2.png"/></noscript>
<p>åœ¨ç»ˆç«¯çª—å£ä¸­åˆ›å»ºä¸€ä¸ªåä¸º<code>.env</code>çš„æ–‡ä»¶:</p>
<pre>nano .env</pre>
<p>æˆ‘ä»¬å°†ä½¿ç”¨ä¸Šé¢åˆ›å»ºçš„<code>.env</code>æ–‡ä»¶æ¥å­˜å‚¨BotFatherå‘é€çš„è®¿é—®ä»¤ç‰Œå’Œæ‚¨ä¸ºboté€‰æ‹©çš„ç”¨æˆ·åã€‚</p>
<p>å°†ä»¥ä¸‹å†…å®¹æ·»åŠ åˆ°<code>.env</code>æ–‡ä»¶ä¸­:</p>
<pre>bot_token = "Your bot token"</pre>
<p>åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å·²ç»ä½¿ç”¨BotFatheræ³¨å†Œäº†æˆ‘ä»¬çš„botï¼Œå¹¶å°†æˆ‘ä»¬çš„botå‡­è¯ä¿å­˜åˆ°ä¸€ä¸ª<code>.env</code>æ–‡ä»¶ä¸­ã€‚ä¸‹ä¸€æ­¥ï¼Œæˆ‘ä»¬å°†åˆ›å»ºè´Ÿè´£è¿è¡Œbotçš„æ–‡ä»¶ã€‚</p>
<h2>åˆ›å»ºä¸»æ–‡ä»¶</h2>
<p>åœ¨è¿™ä¸€æ­¥ä¸­ï¼Œæˆ‘ä»¬å°†åˆ›å»ºæˆ‘ä»¬çš„ä¸»botæ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶å°†è¢«ç§°ä¸º<code>main.js</code>ã€‚åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬å°†å¯¼å…¥å¿…è¦çš„æ¨¡å—æ¥åˆ›å»ºå’Œç®¡ç†ä¸€ä¸ªæœºå™¨äººã€‚</p>
<p>åœ¨ç»ˆç«¯ä¸­è¿è¡Œä»¥ä¸‹å‘½ä»¤:</p>
<pre>nano main.js</pre>
<p>åœ¨<code>main.js</code>æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹ä»£ç :</p>
<pre>const Telegraf = require('telegraf')
const session = require('telegraf/session')
const Stage = require('telegraf/stage')
const Markup = require('telegraf/markup')
require('dotenv').config()</pre>
<p>åœ¨ä¸Šé¢çš„ä»£ç å—ä¸­ï¼Œæˆ‘ä»¬å·²ç»è¦æ±‚ä½¿ç”¨<code>telegraf</code>æ¨¡å—åŠå…¶ç±»æ¥åˆ›å»ºå’Œç®¡ç†æœºå™¨äººï¼Œæˆ‘ä»¬è¿˜è¦æ±‚ä½¿ç”¨<code>dotenv</code>æ¨¡å—æ¥å°†æˆ‘ä»¬çš„<code>BOT_TOKEN</code>å­˜å‚¨åœ¨<code>.env</code>æ–‡ä»¶ä¸­ã€‚</p>
<p>åœ¨<code>main.js</code>æ–‡ä»¶çš„åº•éƒ¨æ·»åŠ ä»¥ä¸‹ä»£ç :</p>
<pre>const imageScene = require('./scenes/imageScene').imageScene
const videoScene = require('./scenes/videoScene').videoScene

const bot = new Telegraf(process.env.BOT_TOKEN)
const stage = new Stage([imageScene, videoScene])
bot.use(session())
bot.use(stage.middleware())</pre>
<p>åœ¨ä¸Šé¢çš„ä»£ç å—ä¸­ï¼Œæˆ‘ä»¬éœ€è¦æˆ‘ä»¬çš„æœºå™¨äºº<code>scenes</code> ( <code>imageScene</code>å’Œ<code>videoScene</code>)ï¼Œç„¶åæˆ‘ä»¬ä½¿ç”¨æœºå™¨äººçˆ¶äº²å‘é€çš„<code>BOT_TOKEN</code>ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„<code>bot</code>å®ä¾‹ï¼Œå¹¶å°†å…¶åˆ†é…ç»™ä¸€ä¸ªåä¸º<code>bot</code>çš„å˜é‡ã€‚åœ¨åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„<code>bot</code>å®ä¾‹åï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„<code>Stage</code>å¯¹è±¡ï¼Œå¹¶å°†å…¶åˆ†é…ç»™ä¸€ä¸ªåä¸º<code>stage</code>çš„å˜é‡ã€‚åœ¨è¿™ä¸ªå¯¹è±¡ä¸­ï¼Œæˆ‘ä»¬ä¸ºæˆ‘ä»¬çš„æœºå™¨äººå­˜å‚¨äº†<code>scenes</code>ã€‚æœ€åï¼Œæˆ‘ä»¬å°†<code>session</code>å’Œ<code>stage</code>å¯¹è±¡ä¼ é€’ç»™äº†<code>bot</code>ã€‚</p>
<p>åœ¨<code>main.js</code>æ–‡ä»¶çš„åº•éƒ¨æ·»åŠ ä»¥ä¸‹ä»£ç :</p>
<pre>bot.start((ctx) =&gt; {
    let userFirstName = ctx.message.from.first_name
    let message = ` Hello master ${userFirstName}, i am OCR bot your humble servant. \n
    Where would you like to extract text from ?`

    let options = Markup.inlineKeyboard([
        Markup.callbackButton('Extract from ğŸ–¼ï¸', 'extractFromImage'),
        Markup.callbackButton('Extract from ğŸ¬', 'extractFromVideo'),
    ]).extra()
    ctx.reply(message, options)
})

bot.action('extractFromImage', Stage.enter('imageScene'))
bot.action('extractFromVideo', Stage.enter('videoScene'))

bot.launch()</pre>
<p>åœ¨ä¸Šé¢çš„ä»£ç å—ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†å½“ç”¨æˆ·å‘é€åŒ…å«å‘½ä»¤<code>/start</code>çš„æ¶ˆæ¯æ—¶è´Ÿè´£å“åº”ç”¨æˆ·çš„æ–¹æ³•ã€‚ä¸€æ—¦è¯¥å‘½ä»¤è¢«è§¦å‘ï¼Œä»£ç å°†æ£€ç´¢ç”¨æˆ·çš„åå­—ï¼Œå¹¶å°†å…¶å­˜å‚¨åœ¨ä¸€ä¸ªåä¸º<code>userFirstName</code>çš„å˜é‡ä¸­ã€‚</p>
<p>ä½¿ç”¨<code>userFirstName</code>ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€æ¡æ¶ˆæ¯ï¼Œé—®å€™å¹¶è¯¢é—®ç”¨æˆ·ä»–ä»¬æƒ³ä»å“ªé‡Œæå–æ–‡æœ¬ã€‚åœ¨è¿™ä¸ªæ¶ˆæ¯ä¸­ï¼Œæˆ‘ä»¬ä¼ é€’ç”¨æˆ·å¯ä»¥é€‰æ‹©çš„å¯ç”¨é€‰é¡¹ï¼Œè¿™äº›é€‰é¡¹å°†é©»ç•™åœ¨ä¸€ä¸ª<code>inlineKeyboard</code>ä¸­(è¿™å°±æ˜¯æˆ‘ä»¬å¦‚ä½•ä½¿ç”¨<code>telegraf</code>åœ¨åŒä¸€è¡Œä¸­åˆ›å»ºæŒ‰é’®)ã€‚</p><div class="code-block code-block-54">
<hr/>
<h3>æ›´å¤šæ¥è‡ªLogRocketçš„ç²¾å½©æ–‡ç« :</h3>

<hr/></div>
<p>å¯ç”¨é€‰é¡¹æœ‰ä»å›¾åƒä¸­æå–æ–‡æœ¬æˆ–ä»è§†é¢‘ä¸­æå–æ–‡æœ¬ï¼›å¦‚æœç”¨æˆ·é€‰æ‹©è¿™äº›é€‰é¡¹ä¸­çš„ä¸€ä¸ªï¼Œå°±ä¼šè§¦å‘ä¸€ä¸ª<code>bot.action</code>ã€‚å¦‚æœç”¨æˆ·é€‰æ‹©<code>Extract from ğŸ–¼ï¸</code>é€‰é¡¹ï¼Œæœºå™¨äººå°†è¿›å…¥<code>imageScene</code>ï¼Œå¦‚æœç”¨æˆ·é€‰æ‹©<code>Extract from ğŸ¬</code>ï¼Œæœºå™¨äººå°†è¿›å…¥<code>videoScene</code>ã€‚</p>
<p>æœ€åï¼Œæˆ‘ä»¬é€šè¿‡è°ƒç”¨<code>bot.launch()</code>æ–¹æ³•æ¥å¯åŠ¨æˆ‘ä»¬çš„æœºå™¨äººã€‚<code>main.js</code>ç°åœ¨åº”è¯¥å¦‚ä¸‹æ‰€ç¤º:</p>
<pre>const Telegraf = require('telegraf')
const session = require('telegraf/session')
const Stage = require('telegraf/stage')
const Markup = require('telegraf/markup')
require('dotenv').config()

const imageScene = require('./scenes/imageScene').imageScene
const videoScene = require('./scenes/videoScene').videoScene

const bot = new Telegraf(process.env.BOT_TOKEN)
const stage = new Stage([imageScene, videoScene])
bot.use(session())
bot.use(stage.middleware())

bot.start((ctx) =&gt; {
    let userFirstName = ctx.message.from.first_name
    let message = ` Hello master ${userFirstName}, i am OCR bot your humble servant. \n
    Where would you like to extract text from ?`

    let options = Markup.inlineKeyboard([
        Markup.callbackButton('Extract from ğŸ–¼ï¸', 'extractFromImage'),
        Markup.callbackButton('Extract from ğŸ¬', 'extractFromVideo'),
    ]).extra()
    ctx.reply(message, options)
})

bot.action('extractFromImage', Stage.enter('imageScene'))
bot.action('extractFromVideo', Stage.enter('videoScene'))

bot.launch()</pre>
<p>åœ¨è¿™ä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬å·²ç»åˆ›å»ºäº†æˆ‘ä»¬çš„botï¼Œä¸º<code>/start</code>å‘½ä»¤æ·»åŠ äº†ä¸€ä¸ªç›‘å¬å™¨ï¼Œå®ƒå°†ä¸ºç”¨æˆ·æä¾›è¾“å…¥<code>scene</code>çš„é€‰æ‹©ï¼Œç„¶åæˆ‘ä»¬å¯åŠ¨äº†æˆ‘ä»¬çš„botã€‚ä¸‹ä¸€æ­¥ï¼Œæˆ‘ä»¬å°†åˆ›å»ºè´Ÿè´£ç®¡ç†<code>imageScene</code>çš„æ–‡ä»¶ã€‚</p>
<h2>åˆ›å»º<code>imageScene</code></h2>
<p>åœ¨è¿™ä¸€æ­¥ä¸­ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªåœºæ™¯ï¼Œå½“ç”¨æˆ·æƒ³è¦ä»å›¾åƒä¸­æå–æ–‡æœ¬æ—¶ï¼Œè¯¥åœºæ™¯è´Ÿè´£ç®¡ç†ä¸ç”¨æˆ·çš„äº¤äº’ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬å¿…é¡»åˆ›å»ºä¸€ä¸ªåä¸º<code>imageScene.js</code>çš„æ–‡ä»¶ã€‚</p>
<p>åœ¨ç»ˆç«¯ä¸­è¿è¡Œä»¥ä¸‹å‘½ä»¤å¯¼èˆªåˆ°<code>scenes</code>ç›®å½•:</p>
<pre>cd scenes</pre>
<p>ç°åœ¨è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥åˆ›å»º<code>imageScene.js</code>æ–‡ä»¶:</p>
<pre>nano imageScene.js</pre>
<p>åœ¨<code>imageScene.js</code>æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹ä»£ç :</p>
<pre>const WizardScene = require('telegraf/scenes/wizard')
const Composer = require('telegraf/composer')

const fileManager = require('../fileManager')
const OCR = require('../ocr')</pre>
<p>åœ¨ä¸Šé¢çš„ä»£ç å—ä¸­ï¼Œæˆ‘ä»¬éœ€è¦æ¥è‡ª<code>telegraf</code>çš„<code>WizardScene</code>å’Œ<code>Composer</code>ã€‚æˆ‘ä»¬å°†ä½¿ç”¨<code>WizardScene</code>åˆ›å»ºä¸€ä¸ª<code>scene</code>å¯¹è±¡ï¼Œä½¿ç”¨<code>Composer</code>ä¸º<code>scene</code>åˆ›å»º<code>steps</code>ã€‚ä½¿ç”¨<code>WizardScene</code>æ—¶ï¼Œæˆ‘ä»¬å°†<code>scene</code>çš„ä»£ç é€»è¾‘åˆ†ä¸º<code>steps</code>ã€‚</p>
<p>æœ€åï¼Œæˆ‘ä»¬éœ€è¦<code>fileManager.js</code>å’Œ<code>ocr.js</code>æ–‡ä»¶ï¼Œå¹¶å°†å®ƒä»¬åˆ†é…ç»™<code>fileManager</code>å’Œ<code>ocr</code>å¯¹è±¡ã€‚è¯·æ³¨æ„ï¼Œæˆ‘ä»¬è¿˜æ²¡æœ‰åˆ›å»ºè¿™äº›æ–‡ä»¶ï¼Œä½†æ˜¯æˆ‘ä»¬å°†åœ¨æœ¬æ•™ç¨‹çš„åé¢åˆ›å»ºå®ƒä»¬ã€‚</p>
<p>å°†ä»¥ä¸‹ä»£ç æ·»åŠ åˆ°<code>imageScene.js</code>æ–‡ä»¶çš„åº•éƒ¨:</p>
<pre>const step1 = (ctx) =&gt; {
    ctx.reply('Send me the image')
    return ctx.wizard.next()
}</pre>
<p>åœ¨ä¸Šé¢çš„ä»£ç å—ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†<code>step1</code>ï¼Œå½“æœºå™¨äººè¿›å…¥<code>imageScene</code>æ—¶ï¼Œè¿™ä¸€æ­¥å°†é¦–å…ˆè¿è¡Œï¼Œåœ¨è¿™ä¸€æ­¥ä¸­ï¼Œæœºå™¨äººè¦æ±‚ç”¨æˆ·å‘é€åŒ…å«ç”¨æˆ·æƒ³è¦æå–çš„æ–‡æœ¬çš„å›¾åƒï¼Œç„¶åé€šè¿‡è°ƒç”¨<code>ctx.wizard.next()</code>è¿›å…¥ä¸‹ä¸€æ­¥ã€‚</p>
<p>å°†ä»¥ä¸‹ä»£ç æ·»åŠ åˆ°<code>imageScene.js</code>æ–‡ä»¶çš„åº•éƒ¨:</p>
<pre>const step2 = new Composer()

step2.on('photo', async (ctx) =&gt; {
    ctx.reply('I have received the image please wait while i extract the text')
    let photos = ctx.update.message.photo
    const { file_id: fileId } = photos[photos.length - 1]
    const { file_unique_id: fileUniqueId } = photos[photos.length - 1]
    const fileUrl = await ctx.telegram.getFileLink(fileId);
    let imagePath = await fileManager.downloadFile(fileUrl, fileUniqueId, 'Image')
});</pre>
<p>åœ¨ä¸Šé¢çš„ä»£ç å—ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†<code>step2</code>ï¼Œå¹¶ä¸ºå…¶æ·»åŠ äº†ä¸€ä¸ªç›‘å¬å™¨ï¼Œè¯¥ç›‘å¬å™¨å°†ç›‘å¬ä»»ä½•åŒ…å«ç”¨æˆ·ä½¿ç”¨<code>on('photo',...)</code>å‘é€çš„å›¾åƒçš„ä¼ å…¥æ¶ˆæ¯ã€‚</p>
<p>å½“æœºå™¨äººæ¥æ”¶åˆ°åŒ…å«å›¾åƒçš„æ¶ˆæ¯æ—¶ï¼Œæœºå™¨äººå‘ç”¨æˆ·å‘é€æ¶ˆæ¯è¯´å›¾åƒå·²è¢«æ¥æ”¶ï¼Œæœºå™¨äººå°†ä»æ¶ˆæ¯ä¸­æå–å›¾åƒçš„<code>fileId</code>å’Œ<code>fileUniqueId</code>å€¼ã€‚æˆ‘ä»¬ä½¿ç”¨<code>fileId</code>æ¥è·å–å­˜å‚¨åœ¨ç”µæŠ¥æœåŠ¡å™¨ä¸­çš„å›¾åƒé“¾æ¥ï¼Œç„¶åæˆ‘ä»¬å°†å›¾åƒé“¾æ¥å­˜å‚¨åœ¨ä¸€ä¸ªåä¸º<code>fileUrl</code>çš„å˜é‡ä¸­ã€‚</p>
<p>æˆ‘ä»¬å°†<code>fileUrl</code>å’Œ<code>fileUniqueId</code>ä¼ é€’ç»™<code>fileManager</code>ä¸­çš„<code>downloadFile()</code>æ–¹æ³•ã€‚è¯¥æ–¹æ³•å°†ä¸‹è½½å›¾åƒï¼Œç„¶åè¿”å›å›¾åƒåœ¨æœ¬åœ°å­˜å‚¨çš„è·¯å¾„ã€‚åœ¨<code>downloadFile()</code>æ–¹æ³•è¿”å›åï¼Œæˆ‘ä»¬å°†å›¾åƒçš„è·¯å¾„å­˜å‚¨åœ¨ä¸€ä¸ªåä¸º<code>imagePath</code>çš„å˜é‡ä¸­ã€‚</p>
<p>å°†ä»¥ä¸‹ä»£ç æ·»åŠ åˆ°<code>step2.on('photo',â€¦)</code>çš„åº•éƒ¨:</p>
<pre>step2.on('photo', async (ctx) =&gt; {
    . . .

    let text = await OCR.extractText(imagePath)
    fileManager.deleteFile(imagePath)
    if (text != 'Empty') {
        ctx.replyWithHTML(`The extracted text is: \n &lt;b&gt;${text}&lt;/b&gt;`)
    } else {
        ctx.reply(`Sorry we couldn't extract any text from the image`)
    }
    ctx.reply('Lets try this again , please send me another image')
    const currentStepIndex = ctx.wizard.cursor
    return ctx.wizard.selectStep(currentStepIndex)
});</pre>
<p>åœ¨ä¸Šé¢çš„ä»£ç å—ä¸­ï¼Œæˆ‘ä»¬å°†<code>imagePath</code>ä¼ é€’ç»™äº†<code>OCR</code>ä¸­çš„<code>extractText()</code>æ–¹æ³•ã€‚<code>extractText()</code>å°†ä»ä½äº<code>imagePath</code>çš„å›¾åƒä¸­æå–æ–‡æœ¬ï¼Œç„¶åè¿”å›æå–çš„æ–‡æœ¬ã€‚</p>
<p>åœ¨<code>extractText()</code>æ–¹æ³•è¿”å›åï¼Œæˆ‘ä»¬å°†æå–çš„æ–‡æœ¬å­˜å‚¨åœ¨ä¸€ä¸ªåä¸º<code>text</code>çš„å˜é‡ä¸­ã€‚æˆ‘ä»¬é€šè¿‡å°†<code>imagePath</code>ä¼ é€’ç»™<code>fileManager</code>ä¸­çš„<code>deleteFile()</code>æ–¹æ³•æ¥åˆ é™¤å­˜å‚¨çš„å›¾åƒã€‚</p>
<p>åˆ é™¤å›¾åƒåï¼Œæˆ‘ä»¬æ£€æŸ¥<code>text</code>æ˜¯å¦ä¸ç­‰äº<code>Empty</code>ã€‚å¦‚æœæ˜¯è¿™ç§æƒ…å†µï¼Œæœºå™¨äººä¼šå‘ç”¨æˆ·å‘é€ä¸€ä¸ªå›å¤ï¼Œå…¶ä¸­åŒ…å«ç²—ä½“æ ¼å¼çš„æå–æ–‡æœ¬(<code>telegraf</code>å…è®¸æˆ‘ä»¬ä½¿ç”¨<code>.replyWithHTML()</code>æ–¹æ³•å°†HTMLå‘é€å›ç”¨æˆ·ã€‚)å¦‚æœä¸æ˜¯è¿™æ ·ï¼Œæœºå™¨äººä¼šè¦æ±‚ç”¨æˆ·å‘é€å¦ä¸€å¼ å›¾åƒã€‚</p>
<p>æœ€åï¼Œæˆ‘ä»¬æ£€ç´¢å½“å‰æ­¥éª¤ï¼Œå°†å…¶å­˜å‚¨åœ¨ä¸€ä¸ªåä¸º<code>currentStepIndex</code>çš„å˜é‡ä¸­ï¼Œå¹¶é€šè¿‡ä½¿ç”¨<code>wizard.selectStep()</code>ä½¿æœºå™¨äººä¿æŒåœ¨åŒä¸€æ­¥éª¤ä¸­ã€‚è¿™æ ·ï¼Œç”¨æˆ·å¯ä»¥å‘é€å¦ä¸€ä¸ªå›¾åƒï¼Œè€Œä¸å¿…æ¸²æŸ“è¿™ä¸ªåœºæ™¯ã€‚</p>
<p>å°†ä»¥ä¸‹ä»£ç æ·»åŠ åˆ°<code>imageScene.js</code>æ–‡ä»¶çš„åº•éƒ¨:</p>
<pre>step2.command('cancel', (ctx) =&gt; {
    ctx.reply('Bye bye')
    return ctx.scene.leave()
})

const imageScene = new WizardScene('imageScene',
    (ctx) =&gt; step1(ctx),
    step2,
)

module.exports = { imageScene }</pre>
<p>åœ¨ä¸Šé¢çš„ä»£ç å—ä¸­ï¼Œæˆ‘ä»¬åœ¨<code>step2</code>ä¸­æ·»åŠ äº†ä¸€ä¸ªå‘½ä»¤<code>/cancel</code>çš„ç›‘å¬å™¨ï¼Œå®ƒå°†å‘é€ä¸€ä¸ªå›å¤è¯´<code>Bye</code>ï¼Œç„¶åç¦»å¼€<code>imageScene</code>ã€‚æˆ‘ä»¬åˆ›å»ºäº†<code>imageScene</code>å¯¹è±¡ï¼Œå¹¶æ·»åŠ äº†ä¹‹å‰åˆ›å»ºçš„æ‰€æœ‰æ­¥éª¤ã€‚æœ€åï¼Œæˆ‘ä»¬å¯¼å‡ºäº†<code>imageScene</code>ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åœ¨<code>main.js</code>æ–‡ä»¶ä¸­ä½¿ç”¨å®ƒã€‚</p>
<p><code>imageScene.js</code>åº”è¯¥å¦‚ä¸‹æ‰€ç¤º:</p>
<pre>const WizardScene = require('telegraf/scenes/wizard')
const Composer = require('telegraf/composer')

const fileManager = require('../fileManager')
const OCR = require('../ocr')

const step1 = (ctx) =&gt; {
    ctx.reply('Send me the image')
    return ctx.wizard.next()
}

const step2 = new Composer()


step2.on('photo', async (ctx) =&gt; {
    ctx.reply('I have received the image please wait while i extract the text')
    let photos = ctx.update.message.photo
    const { file_id: fileId } = photos[photos.length - 1]
    const { file_unique_id: fileUniqueId } = photos[photos.length - 1]
    const fileUrl = await ctx.telegram.getFileLink(fileId);
    let imagePath = await fileManager.downloadFile(fileUrl, fileUniqueId, 'Image')

    let text = await OCR.extractText(imagePath)
    fileManager.deleteFile(imagePath)
    if (text != 'Empty') {
        ctx.replyWithHTML(`The extracted text is: \n &lt;b&gt;${text}&lt;/b&gt;`)
    } else {
        ctx.reply(`Sorry we couldn't extract any text from the image`)
    }
    ctx.reply('Lets try this again , please send me another image')
    const currentStepIndex = ctx.wizard.cursor
    return ctx.wizard.selectStep(currentStepIndex)
});

step2.command('cancel', (ctx) =&gt; {
    ctx.reply('Bye bye')
    return ctx.scene.leave()
})

const imageScene = new WizardScene('imageScene',
    (ctx) =&gt; step1(ctx),
    step2,
)

module.exports = { imageScene }</pre>
<p>åœ¨è¿™ä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬å·²ç»åˆ›å»ºäº†<code>imageScene</code>å’Œå½“ç”¨æˆ·æƒ³è¦ä»å›¾åƒä¸­æå–æ–‡æœ¬æ—¶ç®¡ç†ä¸ç”¨æˆ·äº¤äº’æ‰€éœ€çš„æ‰€æœ‰æ–¹æ³•ã€‚ä¸‹ä¸€æ­¥ï¼Œæˆ‘ä»¬å°†åˆ›å»º<code>videoScene</code>ã€‚</p>
<h2>åˆ›å»º<code>videoScene</code></h2>
<p>åœ¨è¿™ä¸€æ­¥ä¸­ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªåœºæ™¯ï¼Œå½“ç”¨æˆ·æƒ³è¦ä»è§†é¢‘ä¸­æå–æ–‡æœ¬æ—¶ï¼Œè¯¥åœºæ™¯è´Ÿè´£ç®¡ç†ä¸ç”¨æˆ·çš„äº¤äº’ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬å¿…é¡»åˆ›å»ºä¸€ä¸ªåä¸º<code>videoScene.js</code>çš„æ–‡ä»¶ã€‚</p>
<p>ä»ç„¶åœ¨<code>scenes</code>ç›®å½•ä¸­ï¼Œé€šè¿‡è¿è¡Œä»¥ä¸‹å‘½ä»¤åˆ›å»ºä¸€ä¸ªåä¸º<code>videoScene.js</code>çš„æ–°æ–‡ä»¶:</p>
<pre>nano videoScene.js</pre>
<p>åœ¨<code>videoScene.js</code>æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹ä»£ç :</p>
<pre>const Composer = require('telegraf/composer')
const WizardScene = require('telegraf/scenes/wizard')

const fileManager = require('../fileManager')
const OCR = require('../ocr')</pre>
<p>åœ¨ä¸Šé¢çš„ä»£ç å—ä¸­ï¼Œæˆ‘ä»¬éœ€è¦æ¥è‡ª<code>telegraf</code>çš„<code>WizardScene</code>å’Œ<code>Composer</code>ã€‚æˆ‘ä»¬è¿˜éœ€è¦<code>fileManager.js</code>å’Œ<code>ocr.js</code>æ–‡ä»¶ï¼Œå°±åƒåˆ›å»º<code>imageScene</code>æ—¶ä¸€æ ·ã€‚è¯·æ³¨æ„ï¼Œæˆ‘ä»¬å°†åœ¨æœ¬æ•™ç¨‹çš„åé¢åˆ›å»ºè¿™ä¸¤ä¸ªæ–‡ä»¶ã€‚</p>
<p>å°†ä»¥ä¸‹ä»£ç æ·»åŠ åˆ°<code>videoScene.js</code>æ–‡ä»¶çš„åº•éƒ¨:</p>
<pre>const step1 = (ctx)=&gt;{
    ctx.replyWithHTML('Send me the exact frame where you want to extract the text in the format &lt;code&gt;hh:mm:ss&lt;/code&gt;. Example: &lt;code&gt;00:00:50&lt;/code&gt; \n If you want to extract text from multiple frames use &lt;code&gt;,&lt;/code&gt; to separate them. Example: &lt;code&gt;00:00:30,00:00:34&lt;/code&gt; ')
    return ctx.wizard.next()
}</pre>
<p>åœ¨ä¸Šé¢çš„ä»£ç å—ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†<code>videoScene</code>çš„<code>step1</code>ã€‚å½“æœºå™¨äººè¿›å…¥è¿™ä¸ªåœºæ™¯æ—¶ï¼Œè¿™ä¸ªæ­¥éª¤å°†é¦–å…ˆè¿è¡Œã€‚é¦–å…ˆï¼Œæœºå™¨äººè¦æ±‚ç”¨æˆ·å‘é€ä¸€æ¡æ¶ˆæ¯ï¼ŒåŒ…å«è§†é¢‘ä¸­ä»–ä»¬æƒ³è¦ä»ä¸­æå–æ–‡æœ¬çš„å¸§ä½ç½®ã€‚ç”¨æˆ·å‘é€çš„æ¶ˆæ¯åº”è¯¥æ˜¯ä¸‹é¢çš„æ ¼å¼<code>hh:mm:ss</code>ï¼Œå…¶ä¸­<code>hh</code>ä»£è¡¨è§†é¢‘ä¸­çš„å°æ—¶ï¼Œ<code>mm</code>ä»£è¡¨è§†é¢‘ä¸­çš„åˆ†é’Ÿï¼Œ<code>ss</code>ä»£è¡¨è§†é¢‘ä¸­çš„<code>seconds</code>ã€‚ä¾‹å¦‚ï¼Œå¦‚æœç”¨æˆ·å¸Œæœ›åœ¨è§†é¢‘åˆ°è¾¾30ç§’æ ‡è®°æ—¶ä»è§†é¢‘ä¸­çš„ä¸€å¸§ä¸­æå–æ–‡æœ¬ï¼Œä»–ä»¬åº”è¯¥å‘é€åŒ…å«ä»¥ä¸‹æ–‡æœ¬çš„æ¶ˆæ¯:<code>00:00:30</code>ã€‚</p>
<p>å¦‚æœç”¨æˆ·æƒ³è¦ä»å¤šä¸ªæ¡†æ¶ä¸­æå–æ–‡æœ¬ï¼Œä»–ä»¬å¯ä»¥é€šè¿‡ä½¿ç”¨<code>,</code>æ¥åˆ†éš”æ¡†æ¶çš„ä½ç½®ã€‚ä¾‹å¦‚ï¼Œå¦‚æœç”¨æˆ·æƒ³åœ¨30ç§’å’Œ34ç§’çš„æ—¶å€™ä»è§†é¢‘ä¸­æå–æ–‡æœ¬ï¼Œä»–ä»¬åº”è¯¥å‘é€ä¸‹é¢çš„æ–‡æœ¬<code>00:00:30,00:00:34</code>ã€‚</p>
<p>æœ€åï¼Œæœºå™¨äººé€šè¿‡è°ƒç”¨<code>ctx.wizard.next()</code>è¿›å…¥ä¸‹ä¸€æ­¥ã€‚</p>
<p>å°†ä»¥ä¸‹ä»£ç æ·»åŠ åˆ°<code>videoScene.js</code>æ–‡ä»¶çš„åº•éƒ¨:</p>
<pre>const step2 = new Composer()
step2.on('text',(ctx)=&gt;{
    let message = ctx.update.message.text.toLowerCase()
    if(message.includes(':')){
        let frames = message.includes(',') ?  message.split(',') : [message]
        ctx.scene.session.state.frames = frames
        ctx.reply('I know where to look for the images , now please send me the video')
        return ctx.wizard.next()
    }else if (message.includes('cancel')){
        leaveScene(ctx)
    }else{
        const currentStepIndex = ctx.wizard.cursor
        ctx.replyWithHTML('sorry but i am waiting for a message in the following format &lt;code&gt;hh:mm:ss&lt;/code&gt;')
        return ctx.wizard.selectStep(currentStepIndex)
    }
})

step2.command('cancel',(ctx) =&gt; leaveScene(ctx))</pre>
<p>åœ¨ä¸Šé¢çš„ä»£ç å—ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†<code>step2</code>å¹¶æ·»åŠ äº†ä¸€ä¸ª<code>text</code>ä¾¦å¬å™¨ï¼Œè¿™ä¸ªä¾¦å¬å™¨å°†é€šè¿‡è°ƒç”¨<code>on('text',...)</code>æ¥ä¾¦å¬ä»»ä½•åŒ…å«æ–‡æœ¬çš„ä¼ å…¥æ¶ˆæ¯ã€‚å½“æ”¶åˆ°åŒ…å«æ–‡æœ¬çš„æ¶ˆæ¯æ—¶ï¼Œæˆ‘ä»¬æ£€æŸ¥è¯¥æ¶ˆæ¯æ˜¯å¦æ˜¯<code>step1</code>ä¸­æè¿°çš„æ ¼å¼ã€‚å¦‚æœæ˜¯è¿™æ ·ï¼Œæˆ‘ä»¬å°†å›¾åƒæˆ–å›¾åƒåœ¨è§†é¢‘ä¸­çš„ä½ç½®ä¿å­˜åœ¨ä¸€ä¸ªåä¸º<code>scene.session.state</code>å¯¹è±¡ä¸­çš„<code>frames</code>çš„å˜é‡ä¸­ã€‚å¦‚æœæ¶ˆæ¯åŒ…å«<code>/cancel</code>å‘½ä»¤ï¼Œé‚£ä¹ˆæˆ‘ä»¬ç¦»å¼€<code>videoScene</code>ã€‚å¦‚æœæ¶ˆæ¯æ—¢ä¸åŒ…å«<code>step1</code>ä¸­æè¿°çš„æ ¼å¼ï¼Œä¹Ÿä¸åŒ…å«<code>/cancel</code>å‘½ä»¤ï¼Œé‚£ä¹ˆæˆ‘ä»¬è¦æ±‚ç”¨æˆ·ä»¥æ­£ç¡®çš„æ ¼å¼å‘é€æ¶ˆæ¯ï¼Œå¹¶é€šè¿‡ä½¿ç”¨<code>wizard.selectStep()</code>ä¿æŒåœ¨ç›¸åŒçš„æ­¥éª¤ä¸­ã€‚æœ€åï¼Œæˆ‘ä»¬ä¸º<code>/cancel</code>å‘½ä»¤æ·»åŠ äº†ä¸€ä¸ªç›‘å¬å™¨ï¼Œå®ƒå°†é€šè¿‡è°ƒç”¨<code>leaveScene()</code>æ–¹æ³•é€€å‡ºå½“å‰åœºæ™¯ã€‚</p>
<p>å°†ä»¥ä¸‹ä»£ç æ·»åŠ åˆ°<code>videoScene.js</code>æ–‡ä»¶çš„åº•éƒ¨:</p>
<pre>const step3 = new Composer()
step3.on('video', async (ctx) =&gt; {
    ctx.reply('I have received the video please wait while i extract the text')
    let video = ctx.update.message.video
    const currentStepIndex = ctx.wizard.cursor
    const { file_id: fileId } = video
    const { file_unique_id: fileUniqueId } = video
    const fileUrl = await ctx.telegram.getFileLink(fileId);
    let videoPath = await fileManager.downloadFile(fileUrl, fileUniqueId, 'Video')
})
</pre>
<p>åœ¨ä¸Šé¢çš„ä»£ç å—ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†<code>step3</code>å¹¶æ·»åŠ äº†ä¸€ä¸ªç›‘å¬å™¨ï¼Œå®ƒå°†é€šè¿‡ä½¿ç”¨<code>.on('video')</code>ç›‘å¬ä»»ä½•åŒ…å«è§†é¢‘çš„ä¼ å…¥æ¶ˆæ¯ã€‚å°±åƒæˆ‘ä»¬åœ¨<code>imageScene</code>ä¸­æ‰€åšçš„ä¸€æ ·ï¼Œé¦–å…ˆï¼Œæœºå™¨äººå‘ç”¨æˆ·å‘é€ä¸€æ¡æ¶ˆæ¯ï¼Œå‘Šè¯‰ç”¨æˆ·è§†é¢‘å·²è¢«æ¥æ”¶ã€‚ç„¶åï¼Œæˆ‘ä»¬æå–ä¸‹è½½TelegramæœåŠ¡å™¨ä¸­å­˜å‚¨çš„è§†é¢‘æ‰€éœ€çš„å€¼ï¼Œå¹¶å°†å…¶ä¼ é€’ç»™<code>fileManager</code>ä¸­çš„<code>downloadFile()</code>æ–¹æ³•ã€‚ä¸€æ—¦è§†é¢‘è¢«ä¸‹è½½ï¼Œè§†é¢‘çš„è·¯å¾„å°†è¢«å­˜å‚¨åœ¨ä¸€ä¸ªåä¸º<code>videoPath</code>çš„å˜é‡ä¸­ã€‚</p>
<p>å°†ä»¥ä¸‹ä»£ç æ·»åŠ åˆ°<code>step3.on('video',â€¦)</code>çš„åº•éƒ¨:</p>
<pre>step3.on('video', async (ctx) =&gt; {
    . . .

    let frames = ctx.scene.session.state.frames
    let promises = []
    for(let i=0; i&lt;frames.length;i++){
        promises.push(OCR.videoOCR(videoPath,fileUniqueId,frames[i]))
    }
    const data = await Promise.all(promises)
    data.forEach(item =&gt;{
        let text = item.text
        let frame = item.frame
        if (text != 'Empty') {
            ctx.replyWithHTML(`The text extracted from the frame at the video length &lt;b&gt;${frame}&lt;/b&gt; is : \n &lt;b&gt;${text}&lt;/b&gt;`)
        } else {
            ctx.replyWithHTML(`Sorry we couldn't extract any text from the frame at the video length &lt;b&gt;${frame}&lt;/b&gt;`)
        }
    })
})</pre>
<p>åœ¨ä¸Šé¢çš„ä»£ç å—ä¸­ï¼Œæˆ‘ä»¬ä»<code>ctx.scene.session.state</code>ä¸­æ£€ç´¢æˆ‘ä»¬æƒ³è¦ä»ä¸­æå–æ–‡æœ¬çš„å¸§çš„ä½ç½®ï¼Œå¹¶å°†å…¶å­˜å‚¨åœ¨ä¸€ä¸ªåä¸º<code>frames</code>çš„å˜é‡ä¸­ã€‚æˆ‘ä»¬éå†å­˜å‚¨åœ¨<code>frames</code>ä¸­çš„å€¼ï¼Œå¯¹äºå…¶ä¸­çš„æ¯ä¸ªå€¼ï¼Œæˆ‘ä»¬è·å–è¯¥å€¼å¹¶å°†å…¶ä¸<code>videoPath</code>å’Œ<code>fileUniqueId</code>ä¸€èµ·ä¼ é€’ç»™<code>ocr</code>ä¸­çš„<code>videoOCR()</code>æ–¹æ³•ã€‚<code>videoOCR()</code>æ–¹æ³•å°†è¿”å›ä¸€ä¸ªåŒ…å«ä»ç»™å®šå¸§ä¸­æå–çš„<code>text</code>å’Œæå–æ–‡æœ¬çš„<code>frame</code>çš„å¯¹è±¡æ•°ç»„ã€‚ä¸€æ—¦<code>videoOCR()</code>æ–¹æ³•è¿”å›ï¼Œæˆ‘ä»¬å°†è¿”å›å€¼å­˜å‚¨åœ¨ä¸€ä¸ªåä¸º<code>data</code>çš„å˜é‡ä¸­ã€‚æœ€åï¼Œæˆ‘ä»¬éå†<code>data</code>ä¸­çš„å¯¹è±¡ï¼Œå¯¹äºæ‰¾åˆ°çš„æ¯ä¸ªå¯¹è±¡ï¼Œæˆ‘ä»¬å°†<code>text</code>å’Œ<code>frame</code>å‘é€ç»™ç”¨æˆ·ã€‚</p>
<p>å°†ä»¥ä¸‹ä»£ç æ·»åŠ åˆ°<code>step3.on('video',â€¦)</code>çš„åº•éƒ¨:</p>
<pre>step3.on('video', async (ctx) =&gt; {
    . . .

    fileManager.deleteFile(videoPath)
    ctx.reply('Lets try this again, send me the frames')
    return ctx.wizard.selectStep(1)
})</pre>
<p>åœ¨ä¸Šé¢çš„ä»£ç å—ä¸­ï¼Œæˆ‘ä»¬åˆ é™¤äº†ä¸‹è½½çš„è§†é¢‘ï¼Œç„¶åæˆ‘ä»¬è¦æ±‚ç”¨æˆ·å‘é€å¸§ï¼Œä»¥ä¾¿ä»å¦ä¸€ä¸ªè§†é¢‘ä¸­æå–æ–‡æœ¬ï¼Œå¹¶ä½¿ç”¨<code>ctx.wizard.selectStep()</code>æ–¹æ³•è¿”å›åˆ°<code>step2</code>ã€‚</p>
<p>å°†ä»¥ä¸‹ä»£ç æ·»åŠ åˆ°<code>videoScene.js</code>æ–‡ä»¶çš„åº•éƒ¨:</p>
<pre>step3.on('text', async (ctx) =&gt; {
    let message = ctx.update.message.text.toLowerCase()
    if(message.includes('cancel')){
        leaveScene()
    }else{
        console.log(Object.keys(ctx.update.message))
        const currentStepIndex = ctx.wizard.cursor
        ctx.reply('sorry but i am waiting for a video')
        return ctx.wizard.selectStep(currentStepIndex)
    }
});</pre>
<p>åœ¨ä¸Šé¢çš„ä»£ç å—ä¸­ï¼Œæˆ‘ä»¬å‘<code>step3</code>æ·»åŠ äº†ä¸€ä¸ªç›‘å¬å™¨ï¼Œå®ƒå°†é€šè¿‡ä½¿ç”¨<code>.on('text',...)</code>ç›‘å¬ä»»ä½•åŒ…å«æ–‡æœ¬çš„æ¶ˆæ¯ã€‚å¦‚æœæ¶ˆæ¯åŒ…å«å­—ç¬¦ä¸²<code>cancel</code>ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°†é€€å‡ºåœºæ™¯ã€‚å¦‚æœæ¶ˆæ¯åŒ…å«å…¶ä»–æ–‡æœ¬ï¼Œæœºå™¨äººå°†å‘Šè¯‰ç”¨æˆ·æœºå™¨äººæ­£åœ¨ç­‰å¾…è§†é¢‘ï¼Œç„¶åç•™åœ¨å½“å‰åœºæ™¯ä¸­ã€‚</p>
<p>å°†ä»¥ä¸‹ä»£ç æ·»åŠ åˆ°<code>videoScene.js</code>æ–‡ä»¶çš„åº•éƒ¨:</p>
<pre>const leaveScene = (ctx) =&gt;{
    ctx.reply('Bye !!!')
    return ctx.scene.leave()
}

const videoScene = new WizardScene('videoScene',
    (ctx) =&gt; step1(ctx),
    step2,
    step3
)

module.exports = { videoScene }</pre>
<p>åœ¨ä¸Šé¢çš„ä»£ç å—ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†<code>leaveScene()</code>æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å°†å‘ç”¨æˆ·å‘é€æ¶ˆæ¯è¯´<code>Bye</code>å¹¶é€€å‡ºå½“å‰åœºæ™¯ã€‚åœ¨åˆ›å»ºäº†<code>leaveScene()</code>æ–¹æ³•ä¹‹åï¼Œæˆ‘ä»¬åˆ›å»ºäº†<code>videoScene</code>å¯¹è±¡å¹¶æ·»åŠ äº†ä¹‹å‰åˆ›å»ºçš„æ‰€æœ‰æ­¥éª¤ã€‚æœ€åï¼Œæˆ‘ä»¬å¯¼å‡ºäº†<code>videoScene</code>ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åœ¨<code>main.js</code>æ–‡ä»¶ä¸­ä½¿ç”¨å®ƒã€‚</p>
<p><code>videoScene.js</code>åº”è¯¥å¦‚ä¸‹æ‰€ç¤º:</p>
<pre>const Composer = require('telegraf/composer')
const WizardScene = require('telegraf/scenes/wizard')
const fileManager = require('../fileManager')
const OCR = require('../ocr')

const step1 = (ctx)=&gt;{
    ctx.replyWithHTML('Send me the exact frame where you want to extract the text in the format &lt;code&gt;hh:mm:ss&lt;/code&gt;. Example: &lt;code&gt;00:00:50&lt;/code&gt; \n If you want to extract text from multiple frames use &lt;code&gt;,&lt;/code&gt; to separate them. Example: &lt;code&gt;00:00:30,00:00:34&lt;/code&gt; ')
    return ctx.wizard.next()
}

const step2 = new Composer()
step2.on('text',(ctx)=&gt;{
    let message = ctx.update.message.text.toLowerCase()
    if(message.includes(':')){
        let frames = message.includes(',') ?  message.split(',') : [message]
        ctx.scene.session.state.frames = frames
        ctx.reply('I know where to look for the images , now please send me the video')
        return ctx.wizard.next()
    }else if (message.includes('cancel')){
        leaveScene(ctx)
    }else{
        const currentStepIndex = ctx.wizard.cursor
        ctx.replyWithHTML('sorry but i am waiting for a message in the following format &lt;code&gt;hh:mm:ss&lt;/code&gt;')
        return ctx.wizard.selectStep(currentStepIndex)
    }
})

step2.command('cancel',(ctx) =&gt; leaveScene(ctx))

const step3 = new Composer()
step3.on('video', async (ctx) =&gt; {
    ctx.reply('I have received the video please wait while i extract the text')
    let video = ctx.update.message.video
    const currentStepIndex = ctx.wizard.cursor
    const { file_id: fileId } = video
    const { file_unique_id: fileUniqueId } = video
    const fileUrl = await ctx.telegram.getFileLink(fileId);
    let videoPath = await fileManager.downloadFile(fileUrl, fileUniqueId, 'Video')
    let frames = ctx.scene.session.state.frames
    let promises = []
    for(let i=0; i&lt;frames.length;i++){
        promises.push(OCR.videoOCR(videoPath,fileUniqueId,frames[i]))
    }
    const data = await Promise.all(promises)
    data.forEach(item =&gt;{
        let text = item.text
        let frame = item.frame
        if (text != 'Empty') {
            ctx.replyWithHTML(`The text extracted from the frame at the video length &lt;b&gt;${frame}&lt;/b&gt; is : \n &lt;b&gt;${text}&lt;/b&gt;`)
        } else {
            ctx.replyWithHTML(`Sorry we couldn't extract any text from the frame at the video length &lt;b&gt;${frame}&lt;/b&gt;`)
        }
    })

    fileManager.deleteFile(videoPath)
    ctx.reply('Lets try this again, send me the frames')
    return ctx.wizard.selectStep(1)
})
step3.on('text', async (ctx) =&gt; {
    let message = ctx.update.message.text.toLowerCase()
    if(message.includes('cancel')){
        leaveScene()
    }else{
        const currentStepIndex = ctx.wizard.cursor
        ctx.reply('sorry but i am waiting for a video')
        return ctx.wizard.selectStep(currentStepIndex)
    }
});

const leaveScene = (ctx) =&gt;{
    ctx.reply('Bye !!!')
    return ctx.scene.leave()
}
const videoScene = new WizardScene('videoScene',
    (ctx) =&gt; step1(ctx),
    step2,
    step3
)
module.exports = { videoScene }</pre>
<p>åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†<code>videoScene</code>ï¼Œå½“ç”¨æˆ·æƒ³è¦ä»è§†é¢‘ä¸­æå–æ–‡æœ¬æ—¶ï¼Œå®ƒè´Ÿè´£ç®¡ç†ä¸ç”¨æˆ·çš„äº¤äº’ã€‚ä¸‹ä¸€æ­¥ï¼Œæˆ‘ä»¬å°†åˆ›å»º<code>fileManager.js</code>æ–‡ä»¶ã€‚</p>
<h2>åˆ›å»ºæ–‡ä»¶ç®¡ç†å™¨</h2>
<p>åœ¨è¿™ä¸€æ­¥ï¼Œæˆ‘ä»¬å°†åˆ›å»º<code>fileManager.js</code>ï¼Œè¿™ä¸ªæ–‡ä»¶å°†åŒ…å«ç®¡ç†ç”¨æˆ·å‘é€çš„æ–‡ä»¶æ‰€éœ€çš„æ–¹æ³•ã€‚</p>
<p>åœ¨ç»ˆç«¯ä¸­è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œè¿”å›åˆ°æˆ‘ä»¬é¡¹ç›®çš„æ ¹ç›®å½•å¹¶åˆ›å»º<code>fileManager.js</code>:</p>
<pre>cd .. &amp;&amp; nano fileManager.js</pre>
<p>åœ¨<code>fileManager.js</code>æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹ä»£ç :</p>
<pre>const fs = require('fs')
const path = require('path')
const axios = require('axios')</pre>
<p>åœ¨ä¸Šé¢çš„ä»£ç å—ä¸­ï¼Œæˆ‘ä»¬éœ€è¦ä¸‹è½½ç”¨æˆ·å‘é€çš„æ–‡ä»¶æ‰€éœ€çš„æ¨¡å—ï¼Œç„¶åå°†å®ƒä»¬ä¿å­˜åœ¨<code>tmp</code>ç›®å½•ä¸­ã€‚</p>
<p>å°†ä»¥ä¸‹ä»£ç æ·»åŠ åˆ°<code>fileManager.js</code>æ–‡ä»¶çš„åº•éƒ¨:</p>
<pre>const downloadFile = async (fileUrl, fileUniqueId, type) =&gt; {
  const fileDir = type === 'Image' ? 'images' : 'videos'
  const splitFileUrl = fileUrl.split('.')
  const fileFormat = splitFileUrl[splitFileUrl.length - 1]
  const fileName = `${fileUniqueId}.${fileFormat}`
  const filePath = path.resolve(__dirname, `tmp/${fileDir}`, fileName)
  const writer = fs.createWriteStream(filePath)

  return axios({
    method: 'get',
    url: fileUrl,
    responseType: 'stream',
  }).then(response =&gt; {

    return new Promise((resolve, reject) =&gt; {
      response.data.pipe(writer);
      let error = null;
      writer.on('error', err =&gt; {
        error = err;
        writer.close();
        reject(err);
      });
      writer.on('close', () =&gt; {
        if (!error) {
          resolve(writer.path);
        }
      });
    });
  });
}</pre>
<p>åœ¨ä¸Šé¢çš„ä»£ç å—ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†<code>downloadFile()</code>æ–¹æ³•ï¼Œå®ƒå°†è´Ÿè´£ä»Telegramçš„æœåŠ¡å™¨ä¸‹è½½æ–‡ä»¶ï¼Œå¹¶æ ¹æ®æ–‡ä»¶ç±»å‹å°†å®ƒä»¬å­˜å‚¨åœ¨<code>tmp/images</code>æˆ–<code>tmp/videos</code>ç›®å½•ä¸­ã€‚</p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬åšä¸€ä¸ªå­—ç¬¦ä¸²æ¯”è¾ƒï¼Œçœ‹çœ‹æ–‡ä»¶<code>type</code>æ˜¯å¦ç­‰äº<code>Image</code>ï¼Œä»¥ç¡®å®šæ–‡ä»¶å°†ä¿å­˜åœ¨å“ªä¸ª<code>tmp</code>å­ç›®å½•ä¸­ã€‚ç„¶åï¼Œæˆ‘ä»¬å°†è¯¥å€¼å­˜å‚¨åœ¨<code>fileDir</code>å˜é‡ä¸­ã€‚</p>
<p>æˆ‘ä»¬æ‹†åˆ†<code>fileUrl</code>æ¥ç¡®å®šæ–‡ä»¶æ ¼å¼ï¼Œå¹¶å°†å…¶å­˜å‚¨åœ¨<code>fileFormat</code>å˜é‡ä¸­ã€‚æˆ‘ä»¬å°†<code>fileUniqueId</code>å’Œ<code>fileFormat</code>è¿æ¥åœ¨ä¸€èµ·ï¼Œåˆ›å»ºäº†<code>fileName</code>ã€‚æˆ‘ä»¬ä½¿ç”¨å¸¦æœ‰<code>fileDir</code>å’Œ<code>fileFormat</code>å˜é‡çš„<code>path</code>æ¨¡å—æ¥åˆ›å»º<code>filePath</code>ã€‚æˆ‘ä»¬ä½¿ç”¨<code>fs</code>æ¨¡å—åˆ›å»ºä¸€ä¸ªæ–‡ä»¶<code>writer</code>ã€‚</p>
<p>å°†ä»¥ä¸‹ä»£ç æ·»åŠ åˆ°<code>downloadFile()</code>æ–¹æ³•çš„åº•éƒ¨:</p>
<pre>const downloadFile = async (fileUrl, fileUniqueId, type) =&gt; {
  . . .

  return axios({
    method: 'get',
    url: fileUrl,
    responseType: 'stream',
  }).then(response =&gt; {
    return new Promise((resolve, reject) =&gt; {
      response.data.pipe(writer);
      let error = null;
      writer.on('error', err =&gt; {
        error = err;
        writer.close();
        reject(err);
      });
      writer.on('close', () =&gt; {
        if (!error) {
          resolve(writer.path);
        }
      });
    });
  });
}</pre>
<p>åœ¨ä¸Šé¢çš„ä»£ç å—ä¸­ï¼Œé¦–å…ˆï¼Œæˆ‘ä»¬ä½¿ç”¨æ¨¡å—<code>axios</code>ä¸‹è½½æ–‡ä»¶ï¼Œç„¶åæˆ‘ä»¬ä½¿ç”¨<code>writer</code>å°†æ–‡ä»¶ä¿å­˜åœ¨<code>filePath</code>ä¸­ã€‚æœ€åï¼Œå½“<code>writer</code>å®Œæˆä¿å­˜æ–‡ä»¶æ—¶ï¼Œæˆ‘ä»¬å°†<code>filePath</code>è¿”å›ç»™è°ƒç”¨<code>downloadFile()</code>æ–¹æ³•çš„æ–¹æ³•ã€‚</p>
<p>å°†ä»¥ä¸‹ä»£ç æ·»åŠ åˆ°<code>fileManager.js</code>æ–‡ä»¶çš„åº•éƒ¨:</p>
<pre>const deleteFile = (filePath) =&gt; {
  fs.unlink(filePath, (err) =&gt; {
    if (err) {
      return
    }
    console.log('file deleted')
  })
}

module.exports = { downloadFile, deleteFile }</pre>
<p>åœ¨ä¸Šé¢çš„ä»£ç å—ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†<code>deleteFile()</code>æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•å°†è´Ÿè´£åˆ é™¤ä¸‹è½½çš„æ–‡ä»¶ï¼Œç„¶åæˆ‘ä»¬å¯¼å‡ºäº†<code>downloadFile()</code>å’Œ<code>deleteFile()</code>æ–¹æ³•ã€‚</p>
<p><code>fileManager.js</code>æ–‡ä»¶åº”è¯¥æ˜¯è¿™æ ·çš„:</p>
<pre>const fs = require('fs')
const path = require('path')
const axios = require('axios')

const downloadFile = async (fileUrl, fileUniqueId, type) =&gt; {
  const fileDir = type === 'Image' ? 'images' : 'videos'
  const splitFileUrl = fileUrl.split('.')
  const fileFormat = splitFileUrl[splitFileUrl.length - 1]
  const fileName = `${fileUniqueId}.${fileFormat}`
  const filePath = path.resolve(__dirname, `tmp/${fileDir}`, fileName)
  const writer = fs.createWriteStream(filePath)

  return axios({
    method: 'get',
    url: fileUrl,
    responseType: 'stream',
  }).then(response =&gt; {

    return new Promise((resolve, reject) =&gt; {
      response.data.pipe(writer);
      let error = null;
      writer.on('error', err =&gt; {
        error = err;
        writer.close();
        reject(err);
      });
      writer.on('close', () =&gt; {
        if (!error) {
          resolve(writer.path);
        }
      });
    });
  });
}


const deleteFile = (filePath) =&gt; {
  fs.unlink(filePath, (err) =&gt; {
    if (err) {
      return
    }
    console.log('file deleted')
  })
}

module.exports = { downloadFile, deleteFile }</pre>
<p>åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬åœ¨<code>fileManager.js</code>æ–‡ä»¶ä¸­åˆ›å»ºäº†è´Ÿè´£ç®¡ç†ç”¨æˆ·å‘é€çš„æ–‡ä»¶çš„æ–¹æ³•ï¼Œåœ¨ä¸‹ä¸€æ­¥ä¸­ï¼Œæˆ‘ä»¬å°†åˆ›å»ºè´Ÿè´£æ‰§è¡ŒOCRçš„æ–‡ä»¶ã€‚</p>
<h2>åˆ›å»ºOCRæ–‡ä»¶</h2>
<p>åœ¨è¿™ä¸€æ­¥ä¸­ï¼Œæˆ‘ä»¬å°†åˆ›å»ºè´Ÿè´£åœ¨å›¾åƒå’Œè§†é¢‘ä¸­æ‰§è¡ŒOCRçš„æ–‡ä»¶ã€‚</p>
<p>ä»ç„¶åœ¨æˆ‘ä»¬é¡¹ç›®çš„æ ¹ç›®å½•ä¸­ï¼Œé€šè¿‡è¿è¡Œä»¥ä¸‹å‘½ä»¤åˆ›å»ºä¸€ä¸ªåä¸º<code>ocr.js</code>çš„æ–‡ä»¶:</p>
<pre>nano ocr.js</pre>
<p>åœ¨<code>ocr.js</code>æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹ä»£ç :</p>
<pre>const tesseract = require("node-tesseract-ocr")
const ffmpeg = require('ffmpeg')
const path = require('path')
const fileManager = require('./fileManager')</pre>
<p>åœ¨ä¸Šé¢çš„ä»£ç å—ä¸­ï¼Œæˆ‘ä»¬éœ€è¦åº“æ¥ç®¡ç†ç”¨æˆ·å‘é€çš„æ–‡ä»¶ï¼Œä»è§†é¢‘ä¸­æå–å¸§ï¼Œä»å›¾åƒä¸­æå–æ–‡æœ¬ã€‚</p>
<p>å°†ä»¥ä¸‹ä»£ç æ·»åŠ åˆ°<code>ocr.js</code>æ–‡ä»¶çš„åº•éƒ¨:</p>
<pre>let extractText = async (imagePath) =&gt; {
    let extractedText = 'Empty'
    const config = {
        lang: "eng",
        oem: 1,
        psm: 3,
    }

    await tesseract.recognize(imagePath, config)
        .then(text =&gt; {
            console.log("Text :", text)
            extractedText = text
        })
        .catch(err =&gt; {
            console.log("Error:", err.message)
        })

    return extractedText
}</pre>
<p>åœ¨ä¸Šé¢çš„ä»£ç å—ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªåä¸º<code>extractText</code>çš„æ–¹æ³•ï¼Œå®ƒå°†è´Ÿè´£æå–ä½äº<code>imagePath</code>ä¸­çš„å›¾åƒä¸­çš„æ–‡æœ¬ã€‚</p>
<p>æˆ‘ä»¬é€šè¿‡åˆ›å»ºä¸€ä¸ªåä¸º<code>extractedText</code>çš„å˜é‡æ¥å¼€å§‹è¿™ä¸ªæ–¹æ³•ï¼Œè¿™ä¸ªå˜é‡å°†å­˜å‚¨ä»å›¾åƒä¸­æå–çš„æ–‡æœ¬ï¼Œç„¶åæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªåä¸º<code>config</code>çš„å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡å°†ä¿å­˜æˆ‘ä»¬åœ¨è¯•å›¾è¯†åˆ«å›¾åƒä¸­çš„æ–‡æœ¬æ—¶å°†ä¼ é€’ç»™<code>tesseract</code>çš„é€‰é¡¹ã€‚</p>
<p>æˆ‘ä»¬å‘<code>config</code>å¯¹è±¡æ·»åŠ ä»¥ä¸‹å±æ€§:</p>
<ul>
<li><code>lang</code>å‘Šè¯‰å®‡å®™é­”æ–¹å›¾åƒä¸­çš„æ–‡æœ¬æ˜¯å“ªç§è¯­è¨€</li>
<li><code>oem</code>å‘Šè¯‰å®‡å®™é­”æ–¹å®ƒåº”è¯¥ä½¿ç”¨çš„ç®—æ³•ç±»å‹</li>
<li><code>psm</code>æ§åˆ¶è‡ªåŠ¨é¡µé¢åˆ†å‰²æ¨¡å¼(é¡µé¢åˆ†å‰²æ˜¯å°†æ‰«æçš„é¡µé¢åˆ†æˆåˆ—å’Œå—ï¼Œç„¶ååˆ†ç±»ä¸ºåŠè‰²è°ƒã€å›¾å½¢æˆ–æ–‡æœ¬çš„è¿‡ç¨‹)</li>
</ul>
<p>åœ¨åˆ›å»ºäº†<code>config</code>å¯¹è±¡åï¼Œæˆ‘ä»¬å°†å®ƒå’Œ<code>imagePath</code>ä¸€èµ·ä¼ é€’ç»™<code>tesseract.recognize()</code>æ–¹æ³•ï¼Œä»¥ä¾¿è¯†åˆ«å›¾åƒä¸­çš„æ–‡æœ¬ï¼Œç„¶åæˆ‘ä»¬å°†æ–‡æœ¬å­˜å‚¨åœ¨<code>extractedText</code>å˜é‡ä¸­ï¼Œç„¶åæˆ‘ä»¬å°†<code>extractedText</code>è¿”å›ç»™è°ƒç”¨<code>extractText()</code>çš„æ–¹æ³•ã€‚</p>
<p>å°†ä»¥ä¸‹ä»£ç æ·»åŠ åˆ°<code>ocr.js</code>æ–‡ä»¶çš„åº•éƒ¨:</p>
<pre>let videoOCR = async (videoPath, fileUniqueID, frame) =&gt; {
  let extractedText = 'Empty'
  let data = {text : extractedText, frame: frame}
  const imageName = `${fileUniqueID}.jpg`
  const imagePath = path.resolve(__dirname, 'tmp/images', imageName)
}</pre>
<p>åœ¨ä¸Šé¢çš„ä»£ç å—ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªåä¸º<code>videoOCR</code>çš„æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å°†è´Ÿè´£æå–è§†é¢‘ä¸­çš„ä¸€å¸§ï¼Œå°†è¯¥å¸§ä¿å­˜ä¸ºå›¾åƒï¼Œç„¶åè°ƒç”¨<code>extractText()</code>æ–¹æ³•å¹¶å°†å›¾åƒè·¯å¾„ä¼ é€’ç»™å®ƒï¼Œç„¶åç”±<code>extractText()</code>æå–æ–‡æœ¬å¹¶å°†å…¶è¿”å›ç»™<code>videoOCR()</code>ã€‚</p>
<p>æˆ‘ä»¬é€šè¿‡åˆ›å»ºä¸€ä¸ªåä¸º<code>extractedText</code>çš„å˜é‡å’Œä¸€ä¸ªåä¸º<code>data</code>çš„å¯¹è±¡æ¥å¼€å§‹è¿™ä¸ªæ–¹æ³•ï¼Œå˜é‡å°†å­˜å‚¨ä»å›¾åƒä¸­æå–çš„æ–‡æœ¬ï¼Œå¯¹è±¡å°†å­˜å‚¨<code>extractedText</code>å’Œ<code>frame</code>ã€‚æˆ‘ä»¬ä½¿ç”¨ä¼ é€’ç»™è¿™ä¸ªæ–¹æ³•çš„<code>fileUniqueID</code>å¹¶åˆ›å»º<code>imageName</code>ã€‚æˆ‘ä»¬ä½¿ç”¨<code>path</code>æ¨¡å—å’Œ<code>imageName</code>æ¥åˆ›å»º<code>imagePath</code>ã€‚</p>
<p>å°†ä»¥ä¸‹ä»£ç æ·»åŠ åˆ°<code>videoOCR()</code>æ–¹æ³•çš„åº•éƒ¨:</p>
<pre>let videoOCR = async (videoPath, fileUniqueID, frame) =&gt; {
  . . .

  try {
    let process = new ffmpeg(videoPath);
    return await process.then(video =&gt; {
      return new Promise((resolve, reject) =&gt; {
        video.addCommand('-ss', frame)
        video.addCommand('-vframes', '1')
        video.save(imagePath, async (err, file) =&gt; {
          if (!err) {
            extractedText = await extractText(imagePath)
            fileManager.deleteFile(imagePath)
            data.text = extractedText
            resolve(data);
          } else {
            console.log('Error: ' + err)
            reject(data);
          }
        })
      });
    })
  } catch (err) {
    console.log(err.code)
    console.log(err.msg)
    return data
  }
}</pre>
<p>åœ¨ä¸Šé¢çš„ä»£ç å—ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨<code>ffmpeg</code>æ¨¡å—æ¥æ£€ç´¢ä½äº<code>videoPath</code>ä¸­çš„è§†é¢‘ä¸­çš„ä¸€å¸§ã€‚æˆ‘ä»¬é€šè¿‡ä¼ é€’<code>frame</code>å˜é‡æ¥æå–å¸§ï¼Œè¿™ä¸ªå˜é‡å’Œ<code>-ss</code>æ ‡å¿—ä¸€èµ·ä¼ é€’ç»™è¿™ä¸ªæ–¹æ³•ï¼Œå’Œ<code>-vframes</code>æ ‡å¿—ä¸€èµ·çš„<code>'1'</code>ä¼ é€’ç»™<code>addCommand()</code>æ–¹æ³•ã€‚</p>
<p><code>-ss</code>æ ‡å¿—ä»£è¡¨è§†é¢‘ä¸­æˆ‘ä»¬æƒ³è¦å¯»æ‰¾çš„ä½ç½®ï¼Œ<code>-vframes</code>æ ‡å¿—ä»£è¡¨æˆ‘ä»¬æƒ³è¦çš„å¸§æ•°ã€‚å¾—åˆ°å¸§åï¼Œæˆ‘ä»¬ä½¿ç”¨<code>video.save()</code>æ–¹æ³•å°†å¸§ä¿å­˜ä¸ºå›¾åƒä¿å­˜åœ¨<code>imagePath</code>ä¸­ã€‚</p>
<p>ä¸€æ—¦è¯¥å¸§è¢«ä¿å­˜ä¸ºå›¾åƒï¼Œæˆ‘ä»¬è·å–<code>imagePath</code>å¹¶å°†å…¶ä¼ é€’ç»™<code>extractText()</code>æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å°†ä»<code>imagePath</code>ä¸­çš„å›¾åƒä¸­æå–æ–‡æœ¬ï¼Œç„¶åå°†å…¶è¿”å›ã€‚åœ¨<code>extractText()</code>æ–¹æ³•è¿”å›åï¼Œæˆ‘ä»¬å°†è¿”å›çš„æ–‡æœ¬å­˜å‚¨åœ¨<code>extractedText</code>å˜é‡ä¸­ï¼Œç„¶åæ›´æ–°<code>extractedText</code>å€¼å’Œ<code>data</code>å¯¹è±¡ã€‚</p>
<p>æœ€åï¼Œæˆ‘ä»¬å°†<code>data</code>å¯¹è±¡è¿”å›ç»™è°ƒç”¨<code>videoOCR()</code>çš„æ–¹æ³•ã€‚<code>ocr.js</code>æ–‡ä»¶åº”è¯¥æ˜¯è¿™æ ·çš„:</p>
<pre>const tesseract = require("node-tesseract-ocr")
const ffmpeg = require('ffmpeg')
const path = require('path')
const fileManager = require('./fileManager')
let extractText = async (imagePath) =&gt; {
    let extractedText = 'Empty'
    const config = {
        lang: "eng",
        oem: 1,
        psm: 3,
    }
    await tesseract.recognize(imagePath, config)
        .then(text =&gt; {
            extractedText = text
        })
        .catch(err =&gt; {
            console.log("Error:", err.message)
        })
    return extractedText
}

let videoOCR = async (videoPath, fileUniqueID, frame) =&gt; {
  let extractedText = 'Empty'
  let data = {text : extractedText, frame: frame}
  const imageName = `${fileUniqueID}.jpg`
  const imagePath = path.resolve(__dirname, 'tmp/images', imageName)

  try {
    let process = new ffmpeg(videoPath);
    return await process.then(video =&gt; {
      return new Promise((resolve, reject) =&gt; {
        video.addCommand('-ss', frame)
        video.addCommand('-vframes', '1')
        video.save(imagePath, async (err, file) =&gt; {
          if (!err) {
            extractedText = await extractText(imagePath)
            fileManager.deleteFile(imagePath)
            data.text = extractedText
            resolve(data);
          } else {
            console.log('Error: ' + err)
            reject(data);
          }
        })
      });
    })
  } catch (err) {
    console.log(err.code)
    console.log(err.msg)
    return data
  }
}

module.exports = { extractText, videoOCR }</pre>
<p>æˆ‘ä»¬ç°åœ¨å·²ç»å®Œæˆäº†æœºå™¨äººçš„åˆ›å»ºã€‚åœ¨ä¸‹ä¸€éƒ¨åˆ†ï¼Œæˆ‘ä»¬å°†ä¸å®ƒäº’åŠ¨ã€‚</p>
<h2>è¿è¡Œæˆ‘ä»¬çš„æœºå™¨äºº</h2>
<p>åœ¨è¿™ä¸€æ­¥ï¼Œæˆ‘ä»¬å°†è¿è¡Œæˆ‘ä»¬çš„æœºå™¨äººï¼Œå¹¶é€šè¿‡ç”µæŠ¥ä¸å®ƒå¯¹è¯ã€‚é€šè¿‡åœ¨ç»ˆç«¯è¿è¡Œä»¥ä¸‹å‘½ä»¤å¯åŠ¨æˆ‘ä»¬çš„æœºå™¨äºº:</p>
<pre>node main.js</pre>
<p>ç°åœ¨æˆ‘ä»¬çš„botæ­£åœ¨è¿è¡Œï¼Œæ‰“å¼€æ‚¨çš„Telegramå®¢æˆ·ç«¯ï¼Œæ·»åŠ æ‚¨é€šè¿‡æ·»åŠ <code>@your_bot_username</code>åˆ›å»ºçš„botã€‚ç„¶åé€šè¿‡å‘é€<code>/start</code>æˆ–ç‚¹å‡»<code>start</code>æŒ‰é’®(å¦‚æœæœ‰çš„è¯)ä¸å®ƒå¼€å§‹å¯¹è¯ã€‚</p>
<p>ç‚¹å‡»<code>Extract from ğŸ–¼ï¸</code>æŒ‰é’®ï¼Œæˆ‘ä»¬å°†è¿›å…¥<code>imageScene</code>ã€‚</p>
<p>è¿™æ˜¯æˆ‘ä»¬å‘é€ç»™æœºå™¨äººçš„ç¬¬ä¸€å¼ å›¾ç‰‡:</p>
<p><img data-attachment-id="25035" data-permalink="https://blog.logrocket.com/how-to-build-a-telegram-ocr-bot/imagesenttobot/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/09/imagesenttobot.jpg" data-orig-size="267,189" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="imagesenttobot" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/09/imagesenttobot.jpg" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/09/imagesenttobot.jpg" decoding="async" class="aligncenter size-full wp-image-25035 jetpack-lazy-image" src="../Images/c4459fa624afa59ebc5b6d4d7b294954.png" alt="image with &quot;Patience is the key which solves all problems&quot; quote on it " data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/09/imagesenttobot.jpg?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/09/imagesenttobot.jpg"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="25035" data-permalink="https://blog.logrocket.com/how-to-build-a-telegram-ocr-bot/imagesenttobot/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/09/imagesenttobot.jpg" data-orig-size="267,189" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="imagesenttobot" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/09/imagesenttobot.jpg" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/09/imagesenttobot.jpg" decoding="async" loading="lazy" class="aligncenter size-full wp-image-25035" src="../Images/c4459fa624afa59ebc5b6d4d7b294954.png" alt="image with &quot;Patience is the key which solves all problems&quot; quote on it " data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/09/imagesenttobot.jpg"/></noscript>
<p>è¿™æ˜¯è¾“å‡ºç»“æœ:</p>
<pre>"Patience is the key
which solves all
problems.â€

~Sudanese proverb</pre>
<p>è¿™æ˜¯æˆ‘ä»¬å‘é€ç»™æœºå™¨äººçš„ç¬¬äºŒå¼ å›¾ç‰‡:<br/> <img data-attachment-id="25037" data-permalink="https://blog.logrocket.com/how-to-build-a-telegram-ocr-bot/patienceimage2/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/09/patienceimage2.jpg" data-orig-size="189,267" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="patienceimage2" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/09/patienceimage2.jpg" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/09/patienceimage2.jpg" decoding="async" class="aligncenter size-full wp-image-25037 jetpack-lazy-image" src="../Images/d1f5cc4d49d7eef8f2742b8d80b744b0.png" alt="Image with words &quot;Patience is the cal acceptance that things can happen in a different order than the one you have in your mind&quot;" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/09/patienceimage2.jpg?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/09/patienceimage2.jpg"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="25037" data-permalink="https://blog.logrocket.com/how-to-build-a-telegram-ocr-bot/patienceimage2/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/09/patienceimage2.jpg" data-orig-size="189,267" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="patienceimage2" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/09/patienceimage2.jpg" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/09/patienceimage2.jpg" decoding="async" loading="lazy" class="aligncenter size-full wp-image-25037" src="../Images/d1f5cc4d49d7eef8f2742b8d80b744b0.png" alt="Image with words &quot;Patience is the cal acceptance that things can happen in a different order than the one you have in your mind&quot;" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/09/patienceimage2.jpg"/></noscript>
<p>è¿™æ˜¯è¾“å‡ºç»“æœ:</p>
<pre>Patience

mats
(e-\naeeraecyelel ites
that things can
happen ina

Co lhicirnime) felis
than the one
you have in
your mind</pre>
<p>è¿™æ˜¯æˆ‘ä»¬å‘é€ç»™æœºå™¨äººçš„ç¬¬ä¸‰å¼ å›¾ç‰‡:</p>
<p><img data-attachment-id="25039" data-permalink="https://blog.logrocket.com/how-to-build-a-telegram-ocr-bot/patientimage3/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/09/patientimage3.jpg" data-orig-size="192,262" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="patientimage3" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/09/patientimage3.jpg" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/09/patientimage3.jpg" decoding="async" class="aligncenter size-full wp-image-25039 jetpack-lazy-image" src="../Images/c7725e5c745104ec6ffc43dbf0aff62b.png" alt="image with words &quot;Be patient. Some things take time.&quot;" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/09/patientimage3.jpg?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/09/patientimage3.jpg"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="25039" data-permalink="https://blog.logrocket.com/how-to-build-a-telegram-ocr-bot/patientimage3/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/09/patientimage3.jpg" data-orig-size="192,262" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="patientimage3" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/09/patientimage3.jpg" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/09/patientimage3.jpg" decoding="async" loading="lazy" class="aligncenter size-full wp-image-25039" src="../Images/c7725e5c745104ec6ffc43dbf0aff62b.png" alt="image with words &quot;Be patient. Some things take time.&quot;" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/09/patientimage3.jpg"/></noscript>
<p>è¿™æ˜¯è¾“å‡ºç»“æœ:</p>
<pre>Be patient.

Some things
take time.</pre>
<p>æ­£å¦‚ä½ åœ¨ä¸Šé¢çš„è¾“å‡ºä¸­çœ‹åˆ°çš„ï¼Œæˆ‘ä»¬çš„æœºå™¨äººèƒ½å¤Ÿä»æˆ‘ä»¬å‘é€ç»™å®ƒçš„ä¸‰å¼ å›¾ç‰‡ä¸­çš„ä¸¤å¼ ä¸­æå–æ–‡æœ¬ã€‚è¿™æ˜¯å› ä¸ºæˆ‘ä»¬åœ¨è¯•å›¾ä»ä¸­æå–æ–‡æœ¬ä¹‹å‰æ²¡æœ‰å¯¹ä»»ä½•å›¾åƒè¿›è¡Œå¤„ç†ã€‚å¦‚æœæ˜¯è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬å°†ä»æ‰€æœ‰ä¸‰ä¸ªå›¾åƒä¸­æå–æ–‡æœ¬ï¼Œä½†è¿™è¶…å‡ºäº†æœ¬æ•™ç¨‹çš„èŒƒå›´ã€‚</p>
<p>ä»å›¾åƒä¸­æå–æ–‡æœ¬åï¼Œæˆ‘ä»¬å‘é€äº†<code>/cancel</code>å‘½ä»¤æ¥é€€å‡º<code>imageScene</code>ã€‚ç„¶åï¼Œæˆ‘ä»¬å‘é€<code>/start</code>å‘½ä»¤æ¥æ˜¾ç¤ºå¯ç”¨é€‰é¡¹ï¼Œå¹¶é€‰æ‹©<code>Extract from ğŸ¬</code>é€‰é¡¹ï¼Œä»è€Œè¿›å…¥<code>videoScene</code>ã€‚</p>
<p>ç„¶åï¼Œæˆ‘ä»¬å‘é€äº†ä»¥ä¸‹æ¶ˆæ¯ï¼Œå…¶ä¸­åŒ…å«äº†æˆ‘ä»¬è¦ä»ä¸­æå–æ–‡æœ¬çš„è§†é¢‘å¸§çš„ä½ç½®:<code>00:00:50,00:01:42,00:02:34</code>ã€‚</p>
<p>åœ¨å‘é€äº†å¸§çš„ä½ç½®åï¼Œæˆ‘ä»¬å°†è¿™ä¸ªè§†é¢‘å‘é€ç»™æœºå™¨äººã€‚æˆ‘ä»¬å‘é€çš„è§†é¢‘å–è‡ªYouTubeä¸Šçš„<a href="https://www.youtube.com/channel/UC7CyQGwsqZC2_jXEGVECEdg" target="_blank" rel="noopener noreferrer">è°œè¯­é¢‘é“</a>é¢‘é“ã€‚</p>
<p>ä»¥ä¸‹æ˜¯æˆ‘ä»¬åœ¨<code>00:00:50</code>ä¸­æå–çš„æ–‡æœ¬:</p>
<pre>Riddle 1

Voiceless it cries,
Wingless flutters,
Toothless bites,
Mouthless mutters.

What am |?</pre>
<p>ä»¥ä¸‹æ˜¯æˆ‘ä»¬åœ¨<code>00:01:42</code>ä¸­æå–çš„æ–‡æœ¬:</p>
<pre>Riddle 2

This thing all things devours;
Birds, beasts, trees, flowers;
Gnaws iron, bites steel;
Grinds hard stones to meal;
Slays king, ruins town,
And beats mountain down.

What am |?</pre>
<p>ä»¥ä¸‹æ˜¯æˆ‘ä»¬åœ¨<code>00:02:34</code>ä¸­æå–çš„æ–‡æœ¬:</p>
<pre>Riddle 3

What walks on four feet in the morning,
Two in the afternoon,

And three at night?</pre>
<p>ä½ å¯ä»¥åœ¨è§†é¢‘<a href="https://www.youtube.com/watch?v=DF8sJeRgtug&amp;t=4s" target="_blank" rel="noopener noreferrer">ä¸­ç‚¹å‡»</a>è§‚çœ‹æœºå™¨äººçš„åŠ¨ä½œã€‚</p>
<p>æˆ‘ä»¬èƒ½å¤ŸæˆåŠŸæå–è§†é¢‘ä¸­æ‰€æœ‰3ä¸ªé€‰å®šå¸§çš„æ–‡æœ¬ã€‚</p>
<h2>ç»“è®º</h2>
<p>åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å­¦ä¹ äº†å¦‚ä½•ä½¿ç”¨<code>telegraf</code>æ¨¡å—åˆ›å»ºä¸€ä¸ªèƒ½å¤Ÿä»å›¾åƒå’Œè§†é¢‘ä¸­æå–æ–‡æœ¬çš„ç”µæŠ¥æœºå™¨äººã€‚è¿™ä¸ªæ¨¡å—å…è®¸æˆ‘ä»¬æ„å»ºä¸€ä¸ªå¤æ‚çš„æœºå™¨äººï¼Œè€Œä¸å¿…èŠ±å¤ªå¤šæ—¶é—´å­¦ä¹ æ•´ä¸ªTelegram APIã€‚</p>
<p>ä¸ºäº†ä»å›¾åƒä¸­æå–æ–‡æœ¬ï¼Œæˆ‘ä»¬å·²ç»å­¦ä¹ äº†å¦‚ä½•ä½¿ç”¨<code>node-tesseract-ocr</code>æ¨¡å—ï¼Œä½†æ˜¯ç”±äºæˆ‘ä»¬è¿˜éœ€è¦ä»è§†é¢‘ä¸­çš„å¸§ä¸­æå–æ–‡æœ¬ï¼Œæˆ‘ä»¬å­¦ä¹ äº†å¦‚ä½•ä½¿ç”¨<code>node-ffmpeg</code>æ¨¡å—ï¼Œè¯¥æ¨¡å—å…è®¸æˆ‘ä»¬ä»è§†é¢‘ä¸­æå–å¸§ï¼Œç„¶åå°†å®ƒä»¬ä¿å­˜ä¸ºå›¾åƒã€‚</p><div class="code-block code-block-2">
<div class="blog-plug base-cta"><h2>ä½¿ç”¨<a class="signup" href="https://lp.logrocket.com/blg/signup" target="_blank" rel="noopener noreferrer"> LogRocket </a>æ¶ˆé™¤ä¼ ç»Ÿé”™è¯¯æŠ¥å‘Šçš„å¹²æ‰°</h2>
<a href="https://lp.logrocket.com/blg/signup" class="signup" target="_blank" rel="noopener noreferrer"><img class="alignnone size-full wp-image-46 jetpack-lazy-image" src="../Images/d6f5a5dd739296c1dd7aab3d5e77eeb9.png" alt="LogRocket Dashboard Free Trial Banner" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png"/><noscript><img data-lazy-fallback="1" class="alignnone size-full wp-image-46" src="../Images/d6f5a5dd739296c1dd7aab3d5e77eeb9.png" alt="LogRocket Dashboard Free Trial Banner" data-original-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png"/></noscript></a>
<p><a href="https://lp.logrocket.com/blg/signup" target="_blank" rel="noopener noreferrer"> LogRocket </a>æ˜¯ä¸€ä¸ªæ•°å­—ä½“éªŒåˆ†æè§£å†³æ–¹æ¡ˆï¼Œå®ƒå¯ä»¥ä¿æŠ¤æ‚¨å…å—æ•°ç™¾ä¸ªå‡é˜³æ€§é”™è¯¯è­¦æŠ¥çš„å½±å“ï¼Œåªé’ˆå¯¹å‡ ä¸ªçœŸæ­£é‡è¦çš„é¡¹ç›®ã€‚LogRocketä¼šå‘Šè¯‰æ‚¨åº”ç”¨ç¨‹åºä¸­å®é™…å½±å“ç”¨æˆ·çš„æœ€å…·å½±å“åŠ›çš„bugå’ŒUXé—®é¢˜ã€‚</p>
<p>ç„¶åï¼Œä½¿ç”¨å…·æœ‰æ·±å±‚æŠ€æœ¯é¥æµ‹çš„ä¼šè¯é‡æ”¾æ¥ç¡®åˆ‡åœ°æŸ¥çœ‹ç”¨æˆ·çœ‹åˆ°äº†ä»€ä¹ˆä»¥åŠæ˜¯ä»€ä¹ˆå¯¼è‡´äº†é—®é¢˜ï¼Œå°±åƒä½ åœ¨ä»–ä»¬èº«åçœ‹ä¸€æ ·ã€‚</p>
<p>LogRocketè‡ªåŠ¨èšåˆå®¢æˆ·ç«¯é”™è¯¯ã€JSå¼‚å¸¸ã€å‰ç«¯æ€§èƒ½æŒ‡æ ‡å’Œç”¨æˆ·äº¤äº’ã€‚ç„¶åLogRocketä½¿ç”¨æœºå™¨å­¦ä¹ æ¥å‘Šè¯‰ä½ å“ªäº›é—®é¢˜æ­£åœ¨å½±å“å¤§å¤šæ•°ç”¨æˆ·ï¼Œå¹¶æä¾›ä½ éœ€è¦ä¿®å¤å®ƒçš„ä¸Šä¸‹æ–‡ã€‚</p>
<p>å…³æ³¨é‡è¦çš„bugâ€”<a class="signup" href="https://lp.logrocket.com/blg/signup-issue-free" target="_blank" rel="noopener noreferrer">ä»Šå¤©å°±è¯•è¯•LogRocketã€‘ã€‚</a></p></div></div>

<p class="clearfix"/>
<p class="clearfix"/>
</article>

</div>    
</body>
</html>