<html>
<head>
<title>Building a responsive camera component with React Hooks - LogRocket Blog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>ç”¨Reacté’©å­æ„å»ºä¸€ä¸ªå“åº”å¼ç›¸æœºç»„ä»¶</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://blog.logrocket.com/responsive-camera-component-react-hooks/#0001-01-01">https://blog.logrocket.com/responsive-camera-component-react-hooks/#0001-01-01</a></blockquote><div><article class="article-post">
<h2>ä»‹ç»</h2>
<p>æˆ‘æœ€è¿‘çš„ä»»åŠ¡æ˜¯æ„å»ºä¸€ä¸ªå‰ç«¯ç›¸æœºç»„ä»¶ï¼Œå…è®¸ç”¨æˆ·å°†ä»–ä»¬çš„èº«ä»½è¯å›¾åƒä¸Šä¼ åˆ°åç«¯æœåŠ¡ã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘å°†é€šè¿‡è§£é‡Šå¦‚ä½•é…ç½®å®æ—¶åª’ä½“æµã€å¦‚ä½•ç”¨Reacté’©å­æ•è·å¿«ç…§ä»¥åŠå¦‚ä½•ä½¿ç”¨æ ·å¼åŒ–ç»„ä»¶è®¾ç½®å…ƒç´ çš„æ ·å¼å’Œä½ç½®æ¥æ¼”ç¤ºæˆ‘æ˜¯å¦‚ä½•åˆ›å»ºè¯¥ç»„ä»¶çš„ã€‚</p>
<p>å› æ­¤ï¼Œæœ¬æ–‡å‡è®¾æ‚¨å¯¹React 16.xä¸­çš„åŠŸèƒ½ç»„ä»¶å’Œæ ·å¼ç»„ä»¶åº“æœ‰ä¸€å®šçš„äº†è§£ã€‚ä¸‹é¢ï¼Œä½ å¯ä»¥çœ‹åˆ°ä¸€ä¸ªè¿è¡Œä¸­çš„ç»„ä»¶çš„æ¼”ç¤ºï¼Œå¹¶ä¸”åœ¨ä½ é˜…è¯»çš„æ—¶å€™ï¼Œå¯ä»¥éšæ„åœ°åœ¨æˆ‘çš„<a href="https://codesandbox.io/s/react-camera-component-with-hooks-mf1i2"> CodeSandbox </a>ä¸Šç©å®Œæ•´çš„è§£å†³æ–¹æ¡ˆã€‚å°½æƒ…äº«å—å§ï¼</p>
<p><img data-attachment-id="9410" data-permalink="https://blog.logrocket.com/responsive-camera-component-react-hooks/camera-component-final-app/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2019/11/camera-component-final-app.gif" data-orig-size="500,1083" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Preview of our final app" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2019/11/camera-component-final-app-139x300.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2019/11/camera-component-final-app-473x1024.gif" decoding="async" class="aligncenter size-full wp-image-9410 jetpack-lazy-image" src="../Images/728c6cd150846022eeed94f439b4104f.png" alt="Preview Of Our Final App" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2019/11/camera-component-final-app.gif?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/11/camera-component-final-app.gif"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="9410" data-permalink="https://blog.logrocket.com/responsive-camera-component-react-hooks/camera-component-final-app/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2019/11/camera-component-final-app.gif" data-orig-size="500,1083" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Preview of our final app" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2019/11/camera-component-final-app-139x300.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2019/11/camera-component-final-app-473x1024.gif" decoding="async" loading="lazy" class="aligncenter size-full wp-image-9410" src="../Images/728c6cd150846022eeed94f439b4104f.png" alt="Preview Of Our Final App" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/11/camera-component-final-app.gif"/></noscript>
<h2>é…ç½®</h2>
<p>è®©æˆ‘ä»¬ä»è®¿é—®æµè§ˆå™¨å¯¼èˆªå™¨å¹¶è°ƒç”¨<code><a href="https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/getUserMedia" target="_blank" rel="noopener noreferrer">getUserMedia()</a></code>æ–¹æ³•æ¥æ˜¾ç¤ºæ¥è‡ªç”¨æˆ·æ‘„åƒæœºçš„å®æ—¶è§†é¢‘æè¦å¼€å§‹ã€‚</p>
<p>ç”±äºè¯¥ç»„ä»¶æ˜¯ä¸ºæ‹æ‘„èº«ä»½è¯ç…§ç‰‡è€Œè®¾è®¡çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä¼ é€’ä¸€ä¸ªä¸éœ€è¦éŸ³é¢‘çš„é…ç½®å¯¹è±¡ï¼Œé»˜è®¤ä¸ºç§»åŠ¨è®¾å¤‡ä¸Šçš„åç½®æ‘„åƒå¤´ã€‚é€šè¿‡å‘videoå±æ€§ä¼ é€’ä¸€ä¸ªoptionså¯¹è±¡ï¼Œvideoè¢«å‡å®šä¸º<code>true</code>ã€‚</p>
<pre>const CAPTURE_OPTIONS = {
    audio: false,
    video: { facingMode: "environment" },
};</pre>
<p><code>getUserMedia()</code>æ–¹æ³•è¯·æ±‚ç”¨æˆ·å…è®¸è®¿é—®é…ç½®ä¸­å®šä¹‰çš„åª’ä½“ã€‚ç„¶åå®ƒè¿”å›ä¸€ä¸ªæ‰¿è¯ºï¼Œè¦ä¹ˆè§£æå¹¶è¿”å›ä¸€ä¸ªå¯ä»¥å­˜å‚¨åœ¨æœ¬åœ°çŠ¶æ€çš„<code><a href="https://developer.mozilla.org/en-US/docs/Web/API/MediaStream" target="_blank" rel="noopener noreferrer">MediaStream</a></code>å¯¹è±¡ï¼Œè¦ä¹ˆæ‹’ç»å¹¶è¿”å›ä¸€ä¸ªé”™è¯¯ã€‚</p>
<p>ä½¿ç”¨Reactçš„ä¸€ä¸ª<code><a href="https://reactjs.org/docs/hooks-effect.html" target="_blank" rel="noopener noreferrer">useEffect()</a></code>é’©å­ï¼Œæˆ‘ä»¬åˆ›å»ºå¹¶å­˜å‚¨æ‰€è¯·æ±‚çš„æµ(å¦‚æœä¸å­˜åœ¨çš„è¯)(ä¾‹å¦‚ï¼Œæˆ‘ä»¬çš„æœ¬åœ°çŠ¶æ€ä¸ºç©º),æˆ–è€…è¿”å›ä¸€ä¸ªæ¸…ç†å‡½æ•°ï¼Œä»¥é˜²æ­¢ç»„ä»¶å¸è½½æ—¶ä»»ä½•æ½œåœ¨çš„å†…å­˜æ³„æ¼ã€‚æ¸…ç†é€šè¿‡<code><a href="https://developer.mozilla.org/en-US/docs/Web/API/MediaStream/getTracks" target="_blank" rel="noopener noreferrer">getTracks()</a></code>æ–¹æ³•å¾ªç¯å¹¶åœæ­¢å­˜å‚¨åœ¨æœ¬åœ°çŠ¶æ€çš„æ¯ä¸ªåª’ä½“è½¨é“ã€‚</p>
<p>å½“æµå­˜å‚¨åœ¨æœ¬åœ°çŠ¶æ€ä¸­æ—¶ï¼Œå®ƒå¯ä»¥è¢«ç»‘å®šåˆ°ä¸€ä¸ª<code>&lt;video /&gt;</code>å…ƒç´ ã€‚ç”±äºReact <a href="https://github.com/facebook/react/pull/9146#issuecomment-355584767">ä¸æ”¯æŒ<code>srcObject</code>å±æ€§</a>ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªrefæ¥å®šä½è§†é¢‘å¹¶å°†æµåˆ†é…ç»™<code><a href="https://developer.mozilla.org/en-US/docs/Web/API/HTMLMediaElement/srcObject">srcObject</a></code>å±æ€§ã€‚æœ‰äº†æœ‰æ•ˆçš„æ¥æºï¼Œè§†é¢‘å°†è§¦å‘ä¸€ä¸ª<code><a href="https://developer.mozilla.org/en-US/docs/Web/API/HTMLMediaElement/canplay_event" target="_blank" rel="noopener noreferrer">onCanPlay()</a></code>äº‹ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥å¼€å§‹è§†é¢‘å›æ”¾ã€‚</p>
<p>è¿™ä¸ªå®ç°æ˜¯å¿…è¦çš„ï¼Œå› ä¸ºvideo <code>autoPlay</code>å±æ€§ä¸èƒ½åœ¨æ‰€æœ‰å¹³å°ä¸Šä¸€è‡´åœ°å·¥ä½œã€‚æˆ‘ä»¬å¯ä»¥å°†æ‰€æœ‰è¿™äº›é€»è¾‘æŠ½è±¡åˆ°ä¸€ä¸ªè‡ªå®šä¹‰é’©å­ä¸­ï¼Œè¯¥é’©å­å°†é…ç½®å¯¹è±¡ä½œä¸ºå‚æ•°ï¼Œåˆ›å»ºæ¸…ç†å‡½æ•°ï¼Œå¹¶å°†æµè¿”å›ç»™cameraç»„ä»¶ã€‚</p>
<pre>import { useState, useEffect } from "react";

export function useUserMedia(requestedMedia) {
  const [mediaStream, setMediaStream] = useState(null);

  useEffect(() =&gt; {
    async function enableStream() {
      try {
        const stream = await navigator.mediaDevices.getUserMedia(requestedMedia);
        setMediaStream(stream);
      } catch(err) {
        // Removed for brevity
      }
    }

    if (!mediaStream) {
      enableStream();
    } else {
      return function cleanup() {
        mediaStream.getTracks().forEach(track =&gt; {
          track.stop();
        });
      }
    }
  }, [mediaStream, requestedMedia]);

  return mediaStream;
}</pre>
<pre>import React, { useRef, useState } from 'react';
import { useUserMedia } from './useUserMedia';

const CAPTURE_OPTIONS = {
    audio: false,
    video: { facingMode: "environment" },
};

function Camera() {
  const videoRef = useRef();
  const mediaStream = useUserMedia(CAPTURE_OPTIONS);

  if (mediaStream &amp;&amp; videoRef.current &amp;&amp; !videoRef.current.srcObject) {
    videoRef.current.srcObject = mediaStream;
  }

  function handleCanPlay() {
    videoRef.current.play();
  }

  return (
    &lt;video ref={videoRef} onCanPlay={handleCanPlay} autoPlay playsInline muted /&gt;
  );
}</pre>
<h2>é…ç½®</h2>
<p>é…ç½®å¥½åª’ä½“æµåï¼Œæˆ‘ä»¬å¯ä»¥å¼€å§‹åœ¨ç»„ä»¶ä¸­å®šä½è§†é¢‘ã€‚ä¸ºäº†å¢å¼ºç”¨æˆ·ä½“éªŒï¼Œæ‘„åƒå¤´é¦ˆé€åº”è¯¥ç±»ä¼¼äºèº«ä»½è¯ã€‚è¿™è¦æ±‚é¢„è§ˆå®¹å™¨ä¿æŒä¸€ä¸ªæ¨ªå‘æ¯”ä¾‹ï¼Œè€Œä¸ç®¡ç›¸æœºçš„åŸç”Ÿåˆ†è¾¨ç‡(æ¡Œé¢ç›¸æœºé€šå¸¸å…·æœ‰æ–¹å½¢æˆ–æ¨ªå‘æ¯”ä¾‹ï¼Œå¹¶ä¸”æˆ‘ä»¬å‡è®¾ç§»åŠ¨è®¾å¤‡å°†çºµå‘æ•è·å›¾åƒ)ã€‚</p>
<p>è¿™æ˜¯é€šè¿‡æ€»æ˜¯é™¤ä»¥æœ€å¤§å°ºå¯¸æ¥è®¡ç®—â‰¥ 1çš„æ¯”ç‡æ¥å®ç°çš„ã€‚ä¸€æ—¦è§†é¢‘å¯ç”¨äºå›æ”¾(å³ï¼Œå½“è°ƒç”¨<code><a href="https://developer.mozilla.org/en-US/docs/Web/API/HTMLMediaElement/canplay_event" target="_blank" rel="noopener noreferrer">onCanPlay()</a></code>äº‹ä»¶æ—¶)ï¼Œæˆ‘ä»¬å¯ä»¥è¯„ä¼°æ‘„åƒæœºçš„æœ¬åœ°åˆ†è¾¨ç‡ï¼Œå¹¶ä½¿ç”¨å®ƒæ¥è®¡ç®—çˆ¶å®¹å™¨çš„æœŸæœ›çºµæ¨ªæ¯”ã€‚</p>
<p>ä¸ºäº†ä½¿ç»„ä»¶èƒ½å¤Ÿå“åº”ï¼Œæ¯å½“çˆ¶å®¹å™¨çš„å®½åº¦å‘ç”Ÿå˜åŒ–æ—¶ï¼Œéƒ½éœ€è¦é€šçŸ¥å®ƒï¼Œä»¥ä¾¿é‡æ–°è®¡ç®—é«˜åº¦ã€‚<code><a href="%22https://www.npmjs.com/package/react-measure">react-measure</a></code>å¯¼å‡ºä¸€ä¸ª<code><a href="https://www.npmjs.com/package/react-measure#measure-component">&lt;Measure /&gt;</a></code>ç»„ä»¶ï¼Œè¯¥ç»„ä»¶æä¾›è¢«å¼•ç”¨å…ƒç´ çš„è¾¹ç•Œä½œä¸ºä¸€ä¸ª<code><a href="https://www.npmjs.com/package/react-measure#onresize--proptypesfunc">onResize()</a></code>å›è°ƒä¸­çš„å‚æ•°ã€‚æ¯å½“å®¹å™¨è£…è½½æˆ–è°ƒæ•´å¤§å°æ—¶ï¼Œå‚æ•°çš„<code>contentRect.bounds.width</code>å±æ€§é€šè¿‡é™¤ä»¥è®¡ç®—çš„æ¯”ç‡æ¥ç¡®å®šå®¹å™¨çš„é«˜åº¦ã€‚</p>
<p>ä¸ä¹‹å‰ç±»ä¼¼ï¼Œæ¯”ç‡è®¡ç®—è¢«æŠ½è±¡åˆ°ä¸€ä¸ªè‡ªå®šä¹‰é’©å­ä¸­ï¼Œå¹¶è¿”å›è®¡ç®—å‡ºçš„æ¯”ç‡å’Œsetterå‡½æ•°ã€‚ç”±äºæ¯”ç‡å°†ä¿æŒä¸å˜ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨Reactçš„<code><a href="https://reactjs.org/docs/hooks-reference.html#usecallback">useCallback()</a></code>é’©å­æ¥é˜²æ­¢ä»»ä½•ä¸å¿…è¦çš„é‡æ–°è®¡ç®—ã€‚</p>
<pre>import { useState, useCallback } from "react";

export function useCardRatio(initialRatio) {
  const [aspectRatio, setAspectRatio] = useState(initialRatio);

  const calculateRatio = useCallback((height, width) =&gt; {
    if (height &amp;&amp; width) {
      const isLandscape = height &lt;= width;
      const ratio = isLandscape ? width / height : height / width;

      setAspectRatio(ratio);
    }
  }, []);

  return [aspectRatio, calculateRatio];
}</pre>
<pre>import React, { useRef, useState } from 'react';
import { Measure } from 'react-measure';
import { useUserMedia } from './useUserMedia';
import { useCardRatio } from './useCardRatio';

const CAPTURE_OPTIONS = {
    audio: false,
    video: { facingMode: "environment" },
};

function Camera() {
  const videoRef = useRef();
  const mediaStream = useUserMedia(CAPTURE_OPTIONS);
  const [container, setContainer] = useState({ height: 0 });
  const [aspectRatio, setAspectRatio] = useCardRatio(1.586); // default card ratio

  if (mediaStream &amp;&amp; videoRef.current &amp;&amp; !videoRef.current.srcObject) {
    videoRef.current.srcObject = mediaStream;
  }

  function handleCanPlay() {
    calculateRatio(videoRef.current.videoHeight, videoRef.current.videoWidth);
    videoRef.current.play();
  }

  function handleResize(contentRect) {
    setContainer({
      height: Math.round(contentRect.bounds.width / aspectRatio)
    });
  }

  function handleCanPlay() {
    setAspectRatio(videoRef.current.videoHeight, videoRef.current.videoWidth);
    videoRef.current.play();
  }

  return (
    &lt;Measure bounds onResize={handleResize}&gt;
      {({ measureRef }) =&gt; (
        &lt;div ref={measureRef} style={{ height: `${container.height}px` }}&gt;
          &lt;video ref={videoRef} onCanPlay={handleCanPlay} autoPlay playsInline muted /&gt;
        &lt;/div&gt;
      )}
    &lt;/Measure&gt;
  );
</pre>
<p>å¦‚æœè§†é¢‘å…ƒç´ å°äºçˆ¶å®¹å™¨ï¼Œå½“å‰çš„è§£å†³æ–¹æ¡ˆå¯ä»¥å¾ˆå¥½åœ°å·¥ä½œï¼Œä½†æ˜¯å¦‚æœæœ¬åœ°åˆ†è¾¨ç‡è¾ƒå¤§ï¼Œå®ƒå°†æº¢å‡ºå¹¶å¯¼è‡´å¸ƒå±€é—®é¢˜ã€‚å°†<code>overflow: hidden</code>å’Œ<code>position: relative</code>æ·»åŠ åˆ°çˆ¶è§†é¢‘ä¸­ï¼Œå°†<code>position : absolute</code>æ·»åŠ åˆ°è§†é¢‘ä¸­ï¼Œè¿™æ ·å¯ä»¥é˜²æ­¢å¸ƒå±€ä¸­æ–­ï¼Œä½†æ˜¯è§†é¢‘å¯¹ç”¨æˆ·æ¥è¯´ä¼šåç¦»ä¸­å¿ƒã€‚</p>
<p>ä¸ºäº†å¼¥è¡¥è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬é€šè¿‡è®¡ç®—è½´åç§»é‡æ¥ä½¿æè¦å±…ä¸­ï¼Œè¯¥åç§»é‡ä»çˆ¶å®¹å™¨ä¸­å‡å»è§†é¢‘å…ƒç´ çš„å°ºå¯¸ï¼Œå¹¶å°†ç»“æœå€¼å‡åŠã€‚</p>
<pre>const offsetX = Math.round((videoWidth - containerWidth) / 2);
const offsetY = Math.round((videoHeight - containerHeight) / 2);</pre>
<p>æˆ‘ä»¬åªæƒ³åœ¨è§†é¢‘(<code>v</code>)å¤§äºçˆ¶å®¹å™¨(<code>c</code>)çš„æƒ…å†µä¸‹åº”ç”¨åç§»é‡ã€‚æˆ‘ä»¬å¯ä»¥åˆ›å»ºå¦ä¸€ä¸ªè‡ªå®šä¹‰æŒ‚é’©ï¼Œå®ƒä½¿ç”¨ä¸€ä¸ªæ•ˆæœæ¥è¯„ä¼°æ˜¯å¦éœ€è¦ä¸€ä¸ªåç§»é‡ï¼Œå¹¶åœ¨ä»»ä½•å€¼å‘ç”Ÿå˜åŒ–æ—¶è¿”å›æ›´æ–°åçš„ç»“æœã€‚</p>
<pre>import { useState, useEffect } from "react";

export function useOffsets(vWidth, vHeight, cWidth, cHeight) {
  const [offsets, setOffsets] = useState({ x: 0, y: 0 });

  useEffect(() =&gt; {
    if (vWidth &amp;&amp; vHeight &amp;&amp; cWidth &amp;&amp; cHeight) {
      const x = vWidth &gt; cWidth
        ? Math.round((vWidth - cWidth) / 2)
        : 0;

      const y = vHeight &gt; cHeight
        ? Math.round((vHeight - cHeight) / 2)
        : 0;

      setOffsets({ x, y });
    }
  }, [vWidth, vHeight, cWidth, cHeight]);

  return offsets;
}
</pre>
<pre>import React, { useRef, useState } from 'react';
import { Measure } fropm 'react-measure';
import { useUserMedia } from './useUserMedia ';
import { useCardRatio } from './useCardRatio';
import { useOffsets } from './useOffsets';

const CAPTURE_OPTIONS = {
    audio: false,
    video: { facingMode: "environment" },
};

function Camera() {
  const videoRef = useRef();
  const mediaStream = useUserMedia(CAPTURE_OPTIONS);
  const [container, setContainer] = useState({ height: 0, width: 0 });
  const [aspectRatio, calculateRatio] = useCardRatio(1.586);
  const offsets = useOffsets(
    videoRef.current &amp;&amp; videoRef.current.videoWidth,
    videoRef.current &amp;&amp; videoRef.current.videoHeight,
    container.width,
    container.height
  );

  if (mediaStream &amp;&amp; videoRef.current &amp;&amp; !videoRef.current.srcObject) {
    videoRef.current.srcObject = mediaStream;
  }

  function handleResize(contentRect) {
    setContainer({
      height: Math.round(contentRect.bounds.width / aspectRatio),
      width: contentRect.bounds.width
    });
  }

  function handleCanPlay() {
    calculateRatio(videoRef.current.videoHeight, videoRef.current.videoWidth);
    videoRef.current.play();
  }

  return (
    &lt;Measure bounds onResize={handleResize}&gt;
      {({ measureRef }) =&gt; (
        &lt;div ref={measureRef} style={{ height: `${container.height}px` }}&gt;
          &lt;video 
            ref={videoRef}
            onCanPlay={handleCanPlay}
            style={{ top: `-${offsets.y}px`, left: `-${offsets.x}px` }}
            autoPlay 
            playsInline 
            muted
          /&gt;
        &lt;/div&gt;
      )}
    &lt;/Measure&gt;
  );
};</pre>
<h2>æ•è·/æ¸…é™¤</h2>
<p>ä¸ºäº†æ¨¡æ‹Ÿç›¸æœºå¿«ç…§ï¼Œä¸€ä¸ª<code>&lt;canvas/&gt;</code>å…ƒç´ è¢«æ”¾ç½®åœ¨è§†é¢‘çš„é¡¶éƒ¨ï¼Œå…·æœ‰åŒ¹é…çš„å°ºå¯¸ã€‚æ¯å½“ç”¨æˆ·å¼€å§‹æ•è·æ—¶ï¼Œæè¦ä¸­çš„å½“å‰å¸§å°†è¢«ç»˜åˆ¶åˆ°ç”»å¸ƒä¸Šï¼Œå¹¶å¯¼è‡´è§†é¢‘æš‚æ—¶éšè—ã€‚</p>
<p>è¿™æ˜¯é€šè¿‡åœ¨ç”»å¸ƒä¸Šåˆ›å»ºäºŒç»´æ¸²æŸ“ä¸Šä¸‹æ–‡ï¼Œå°†è§†é¢‘çš„å½“å‰å¸§ç»˜åˆ¶ä¸ºå›¾åƒï¼Œç„¶åå°†ç»“æœ<code>Blob</code>å¯¼å‡ºä¸º<code>handleCapture()</code>å›è°ƒä¸­çš„å‚æ•°æ¥å®ç°çš„ã€‚</p>
<pre>function handleCapture() {
  const context = canvasRef.current.getContext("2d");
  context.drawImage(image, sx, sy, sWidth, sHeight, dx, dy, dWidth, dHeight);
  canvasRef.current.toBlob(blob =&gt; onCapture(blob), "image/jpeg", 1);
}</pre>
<p>æä¾›ç»™<code><a href="https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/drawImage">drawImage()</a></code>æ–¹æ³•çš„å‚æ•°å¤§è‡´åˆ†ä¸ºä¸‰ç»„:æºå›¾åƒã€æºå›¾åƒå‚æ•°<em> (s) </em>ï¼Œä»¥åŠç›®æ ‡ç”»å¸ƒå‚æ•°<em> (d) </em>ã€‚åœ¨ç»˜åˆ¶ç”»å¸ƒæ—¶ï¼Œæˆ‘ä»¬éœ€è¦è€ƒè™‘æ½œåœ¨çš„è½´åç§»ï¼Œå› ä¸ºæˆ‘ä»¬åªæƒ³æ‹æ‘„çˆ¶å®¹å™¨ä¸­å¯è§çš„è§†é¢‘æè¦éƒ¨åˆ†ã€‚</p>
<p>æˆ‘ä»¬å°†å‘æºå›¾åƒçš„èµ·å§‹è½´åæ ‡æ·»åŠ åç§»é‡ï¼Œå¹¶ä½¿ç”¨çˆ¶å®¹å™¨çš„å®½åº¦å’Œé«˜åº¦ä½œä¸ºæºå’Œç›®æ ‡è¾¹ç•Œã€‚å› ä¸ºæˆ‘ä»¬æƒ³è¦åœ¨æ•´ä¸ªç”»å¸ƒä¸Šç»˜åˆ¶å¿«ç…§ï¼Œæ‰€ä»¥ä¸éœ€è¦ç›®æ ‡åç§»ã€‚</p>
<pre>context.drawImage(
  videoRef.current, // source
  offsets.x,        // sx  
  offsets.y,        // sy
  container.width,  // sWidth
  container.height, // sHeight
  0,                // dx
  0,                // dy
  container.width,  // dWidth
  container.height  // dHeight
);</pre>
<p>ä¸ºäº†ä¸¢å¼ƒå›¾åƒï¼Œç”»å¸ƒé€šè¿‡ä¸€ä¸ª<code>handleClear()</code>å›è°ƒå‡½æ•°æ¢å¤åˆ°åˆå§‹çŠ¶æ€ã€‚è°ƒç”¨<code>handleClear()</code>å°†æ£€ç´¢ä¹‹å‰åœ¨<code>handleCapture()</code>å‡½æ•°ä¸­è¿”å›çš„ç›¸åŒç»˜å›¾ä¸Šä¸‹æ–‡å®ä¾‹ã€‚</p>
<p>ç„¶åï¼Œæˆ‘ä»¬å°†ç”»å¸ƒçš„å®½åº¦å’Œé«˜åº¦ä¼ é€’ç»™context <code><a href="https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/clearRect">clearRect()</a></code>å‡½æ•°ï¼Œå°†è¯·æ±‚çš„åƒç´ è½¬æ¢ä¸ºé€æ˜çš„ï¼Œå¹¶ç»§ç»­æ˜¾ç¤ºè§†é¢‘æè¦ã€‚</p>
<pre>function handleClear() {
  const context = canvasRef.current.getContext("2d");
  context.clearRect(0, 0, canvasRef.current.width, canvasRef.current.height);
  onClear();
}</pre>
<pre>import React, { useRef, useState } from 'react';
import { Measure } fropm 'react-measure';
import { useUserMedia } from './useUserMedia ';
import { useCardRatio } from './useCardRatio';
import { useOffsets } from './useOffsets';

const CAPTURE_OPTIONS = {
    audio: false,
    video: { facingMode: "environment" },
};

function Camera() {
  const videoRef = useRef();
  const mediaStream = useUserMedia(CAPTURE_OPTIONS);
  const [container, setContainer] = useState({ height: 0, width: 0 });
  const [aspectRatio, calculateRatio] = useCardRatio(1.586);
  const [isCanvasEmpty, setIsCanvasEmpty] = useState(true);
  const offsets = useOffsets(
    videoRef.current &amp;&amp; videoRef.current.videoWidth,
    videoRef.current &amp;&amp; videoRef.current.videoHeight,
    container.width,
    container.height
  );

  if (mediaStream &amp;&amp; videoRef.current &amp;&amp; !videoRef.current.srcObject) {
    videoRef.current.srcObject = mediaStream;
  }

  function handleResize(contentRect) {
    setContainer({
      height: Math.round(contentRect.bounds.width / aspectRatio),
      width: contentRect.bounds.width
    });
  }

  function handleCanPlay() {
    calculateRatio(videoRef.current.videoHeight, videoRef.current.videoWidth);
    videoRef.current.play();
  }

  function handleCapture() {
    const context = canvasRef.current.getContext("2d");

    context.drawImage(
      videoRef.current,
      offsets.x,
      offsets.y,
      container.width,
      container.height,
      0,
      0,
      container.width,
      container.height
    );

    canvasRef.current.toBlob(blob =&gt; onCapture(blob), "image/jpeg", 1);
    setIsCanvasEmpty(false);
  }

  function handleClear() {
    const context = canvasRef.current.getContext("2d");
    context.clearRect(0, 0, canvasRef.current.width, canvasRef.current.height);
    onClear();
    setIsCanvasEmpty(true);
  }

  return (
    &lt;Measure bounds onResize={handleResize}&gt;
      {({ measureRef }) =&gt; (
        &lt;div&gt;
            &lt;div ref={measureRef} style={{ height: `${container.height}px` }}&gt;
              &lt;video 
                ref={videoRef}
                onCanPlay={handleCanPlay}
                style={{ top: `-${offsets.y}px`, left: `-${offsets.x}px` }} 
                autoPlay 
                playsInline 
                muted
              /&gt;
            &lt;/div&gt;

          &lt;button onClick={isCanvasEmpty ? handleCapture : handleClear}&gt;
            {isCanvasEmpty ? "Take a picture" : "Take another picture"}
          &lt;/button&gt;
        &lt;/div&gt;
      )}
    &lt;/Measure&gt;
  );</pre>
<h2>å¼æ ·</h2>
<p>æœ‰äº†æ•æ‰å›¾åƒçš„èƒ½åŠ›ï¼Œå‰©ä¸‹çš„å·¥ä½œå°±æ˜¯å®ç°å¡ç‰‡è¾…åŠ©è¦†ç›–ã€æ•æ‰æ—¶çš„flashåŠ¨ç”»ï¼Œå¹¶ä½¿ç”¨<a href="https://www.styled-components.com/"> styled-components </a>å¯¹å…ƒç´ è¿›è¡Œæ ·å¼åŒ–ã€‚</p>
<p>è¦†ç›–ç»„ä»¶æ˜¯ä¸€ä¸ªç™½è‰²çš„åœ†å½¢è¾¹æ¡†ï¼Œè¦†ç›–åœ¨è§†é¢‘çš„é¡¶éƒ¨ï¼Œä»¥é¼“åŠ±ç”¨æˆ·å°†ä»–ä»¬çš„èº«ä»½è¯æ”¾åœ¨è¾¹æ¡†å†…ï¼Œå¤–éƒ¨çš„æ–¹æ¡†é˜´å½±åŒºåŸŸä½œä¸ºå®‰å…¨åŒºï¼Œä»¥é˜²æ­¢å‰ªåˆ‡ã€‚</p>
<p>flashç»„ä»¶æœ‰ä¸€ä¸ªçº¯ç™½çš„èƒŒæ™¯ï¼Œä¹Ÿåˆ†å±‚åœ¨è§†é¢‘ä¹‹ä¸Šï¼Œä½†ç”±äºé»˜è®¤çš„ä¸é€æ˜åº¦ä¸ºé›¶ï¼Œå®ƒæœ€åˆçœ‹èµ·æ¥æ˜¯éšè—çš„ã€‚</p>
<p>æ¯å½“ç”¨æˆ·æ•æ‰å›¾åƒæ—¶ï¼Œå®ƒçš„å…³é”®å¸§åŠ¨ç”»å°±ä¼šè§¦å‘ï¼Œå®ƒä¼šå°†ä¸é€æ˜åº¦çŸ­æš‚åœ°è®¾ç½®ä¸º0.75ï¼Œç„¶åå¿«é€Ÿå°†å…¶é™ä½ä¸ºé›¶ä»¥æ¨¡æ‹Ÿé—ªå…‰æ•ˆæœã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥å°†ç›¸æœºçš„åˆ†è¾¨ç‡ä½œä¸ºé“å…·ä¼ é€’ç»™çˆ¶å®¹å™¨ï¼Œä»¥ç¡®å®šå…¶æœ€å¤§å®½åº¦å’Œé«˜åº¦ï¼Œæ·»åŠ ä¸€ä¸ªæœ¬åœ°çŠ¶æ€å˜é‡â€” <code>isVideoPlaying</code> â€”ä»¥éšè—è§†é¢‘å’Œè¦†ç›–å…ƒç´ ï¼Œç›´åˆ°ç›¸æœºå¼€å§‹æµå¼ä¼ è¾“ï¼Œæœ€åå°†<code>display: none</code>æ·»åŠ åˆ°<code>-webkit-media-controls-play-button</code>ä»¥éšè—è§†é¢‘åœ¨iOSè®¾å¤‡ä¸Šçš„æ’­æ”¾ç¬¦å·ã€‚ğŸ’¥</p>
<pre>import styled, { css, keyframes } from 'styled-components';

const flashAnimation = keyframes`
  from {
    opacity: 0.75;
  }

  to {
    opacity: 0;
  }
`;

export const Wrapper = styled.div`
  display: flex;
  flex-flow: column;
  align-items: center;
  width: 100%;
`;

export const Container = styled.div`
  position: relative;
  overflow: hidden;
  width: 100%;
  max-width: ${({ maxWidth }) =&gt; maxWidth &amp;&amp; `${maxWidth}px`};
  max-height: ${({ maxHeight }) =&gt; maxHeight &amp;&amp; `${maxHeight}px`};
`;

export const Canvas = styled.canvas`
  position: absolute;
  top: 0;
  left: 0;
`;

export const Video = styled.video`
  position: absolute;

  &amp;::-webkit-media-controls-play-button {
    display: none !important;
    -webkit-appearance: none;
  }
`;

export const Overlay = styled.div`
  position: absolute;
  top: 20px;
  right: 20px;
  bottom: 20px;
  left: 20px;
  box-shadow: 0px 0px 20px 56px rgba(0, 0, 0, 0.6);
  border: 1px solid #ffffff;
  border-radius: 10px;
`;

export const Flash = styled.div`
  position: absolute;
  top: 0;
  right: 0;
  bottom: 0;
  left: 0;
  opacity: 0;
  background-color: #ffffff;

  ${({ flash }) =&gt; {
    if (flash) {
      return css`
        animation: ${flashAnimation} 750ms ease-out;
      `;
    }
  }}
`;

export const Button = styled.button`
  width: 75%;
  min-width: 100px;
  max-width: 250px;
  margin-top: 24px;
  padding: 12px 24px;
  background: silver;
`;</pre>
<pre>import React, { useState, useRef } from "react";
import Measure from "react-measure";
import { useUserMedia } from "../hooks/use-user-media";
import { useCardRatio } from "../hooks/use-card-ratio";
import { useOffsets } from "../hooks/use-offsets";
import {
  Video,
  Canvas,
  Wrapper,
  Container,
  Flash,
  Overlay,
  Button
} from "./styles";

const CAPTURE_OPTIONS = {
  audio: false,
  video: { facingMode: "environment" }
};

export function Camera({ onCapture, onClear }) {
  const canvasRef = useRef();
  const videoRef = useRef();

  const [container, setContainer] = useState({ width: 0, height: 0 });
  const [isVideoPlaying, setIsVideoPlaying] = useState(false);
  const [isCanvasEmpty, setIsCanvasEmpty] = useState(true);
  const [isFlashing, setIsFlashing] = useState(false);

  const mediaStream = useUserMedia(CAPTURE_OPTIONS);
  const [aspectRatio, calculateRatio] = useCardRatio(1.586);
  const offsets = useOffsets(
    videoRef.current &amp;&amp; videoRef.current.videoWidth,
    videoRef.current &amp;&amp; videoRef.current.videoHeight,
    container.width,
    container.height
  );

  if (mediaStream &amp;&amp; videoRef.current &amp;&amp; !videoRef.current.srcObject) {
    videoRef.current.srcObject = mediaStream;
  }

  function handleResize(contentRect) {
    setContainer({
      width: contentRect.bounds.width,
      height: Math.round(contentRect.bounds.width / aspectRatio)
    });
  }

  function handleCanPlay() {
    calculateRatio(videoRef.current.videoHeight, videoRef.current.videoWidth);
    setIsVideoPlaying(true);
    videoRef.current.play();
  }

  function handleCapture() {
    const context = canvasRef.current.getContext("2d");

    context.drawImage(
      videoRef.current,
      offsets.x,
      offsets.y,
      container.width,
      container.height,
      0,
      0,
      container.width,
      container.height
    );

    canvasRef.current.toBlob(blob =&gt; onCapture(blob), "image/jpeg", 1);
    setIsCanvasEmpty(false);
    setIsFlashing(true);
  }

  function handleClear() {
    const context = canvasRef.current.getContext("2d");
    context.clearRect(0, 0, canvasRef.current.width, canvasRef.current.height);
    setIsCanvasEmpty(true);
    onClear();
  }

  if (!mediaStream) {
    return null;
  }

  return (
    &lt;Measure bounds onResize={handleResize}&gt;
      {({ measureRef }) =&gt; (
        &lt;Wrapper&gt;
          &lt;Container
            ref={measureRef}
            maxHeight={videoRef.current &amp;&amp; videoRef.current.videoHeight}
            maxWidth={videoRef.current &amp;&amp; videoRef.current.videoWidth}
            style={{
              height: `${container.height}px`
            }}
          &gt;
            &lt;Video
              ref={videoRef}
              hidden={!isVideoPlaying}
              onCanPlay={handleCanPlay}
              autoPlay
              playsInline
              muted
              style={{
                top: `-${offsets.y}px`,
                left: `-${offsets.x}px`
              }}
            /&gt;

            &lt;Overlay hidden={!isVideoPlaying} /&gt;

            &lt;Canvas
              ref={canvasRef}
              width={container.width}
              height={container.height}
            /&gt;

            &lt;Flash
              flash={isFlashing}
              onAnimationEnd={() =&gt; setIsFlashing(false)}
            /&gt;
          &lt;/Container&gt;

          {isVideoPlaying &amp;&amp; (
            &lt;Button onClick={isCanvasEmpty ? handleCapture : handleClear}&gt;
              {isCanvasEmpty ? "Take a picture" : "Take another picture"}
            &lt;/Button&gt;
          )}
        &lt;/Wrapper&gt;
      )}
    &lt;/Measure&gt;
  );
}</pre>
<h2>ç»“è®º</h2>
<p>ç›®å‰ï¼Œè¯¥ç»„ä»¶ç”¨äºæä¾›å›¾åƒä½œä¸ºçœŸå®æ€§çš„è¯æ˜ï¼Œå¹¶ä¸ç”¨æˆ·æ‰‹åŠ¨è¾“å…¥èº«ä»½è¯å­—æ®µä¿¡æ¯çš„è¡¨å•ä¸€èµ·ä½¿ç”¨ã€‚æˆ‘å¸Œæœ›åœ¨è¿™ç¯‡æ–‡ç« ä¹‹åï¼Œä¸OCRæŠ€æœ¯æ•´åˆï¼Œä»å›¾åƒä¸­å»é™¤å­—æ®µï¼Œå¹¶å®Œå…¨æ¶ˆé™¤å¯¹è¡¨å•çš„éœ€æ±‚ã€‚</p>
<p>æ„Ÿè°¢æ‚¨çš„é˜…è¯»ï¼Œç‰¹åˆ«æ„Ÿè°¢<a href="https://twitter.com/petecorreia"> Pete Correia </a>èŠ±æ—¶é—´æŸ¥çœ‹ç»„ä»¶ä»£ç ã€‚å–œæ¬¢è¿™ç¯‡æ–‡ç« å—ï¼Ÿ<a href="https://twitter.com/phunkren">åœ¨æ¨ç‰¹ä¸Šè¯´è°¢è°¢</a>ğŸ¦</p><div class="code-block code-block-17">
<div class="blog-plug inline-plug react-plug" vwo-el-id="26283398190">
<h2 vwo-el-id="41600691720">ä½¿ç”¨LogRocketæ¶ˆé™¤ä¼ ç»Ÿååº”é”™è¯¯æŠ¥å‘Šçš„å™ªéŸ³</h2>
<a href="https://lp.logrocket.com/blg/react-signup-issue-free" target="_blank" vwo-el-id="19356441070">LogRocket
</a><p>æ˜¯ä¸€æ¬¾React analyticsè§£å†³æ–¹æ¡ˆï¼Œå¯ä¿æŠ¤æ‚¨å…å—æ•°ç™¾ä¸ªè¯¯æŠ¥é”™è¯¯è­¦æŠ¥çš„å½±å“ï¼Œåªé’ˆå¯¹å°‘æ•°çœŸæ­£é‡è¦çš„é¡¹ç›®ã€‚LogRocketå‘Šè¯‰æ‚¨Reactåº”ç”¨ç¨‹åºä¸­å®é™…å½±å“ç”¨æˆ·çš„æœ€å…·å½±å“åŠ›çš„bugå’ŒUXé—®é¢˜ã€‚</p><a class="signup" href="https://lp.logrocket.com/blg/react-signup-general" target="_blank" rel="noopener noreferrer" vwo-el-id="19356441380">
<img class="first-react-image alignnone size-full wp-image-46 jetpack-lazy-image jetpack-lazy-image--handled" src="../Images/f300c244a1a1cf916df8b4cb02bec6c6.png" vwo-el-id="18272717540" data-lazy-loaded="1" data-original-src="https://files.readme.io/27c94e7-Image_2017-06-05_at_9.46.04_PM.png"/>
</a>
<a class="signup" href="https://lp.logrocket.com/blg/react-signup-general" target="_blank" rel="noopener noreferrer" vwo-el-id="19356441690">
<img class="second-react-image alignnone size-full wp-image-46 jetpack-lazy-image jetpack-lazy-image--handled" src="../Images/d6f5a5dd739296c1dd7aab3d5e77eeb9.png" alt="LogRocket Dashboard Free Trial Banner" vwo-el-id="30720362350" data-lazy-loaded="1" data-original-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png"/>
</a>
<a href="https://lp.logrocket.com/blg/react-signup-issue-free" target="_blank" rel="noopener noreferrer" vwo-el-id="35866400580">LogRocket
</a><p>è‡ªåŠ¨èšåˆå®¢æˆ·ç«¯é”™è¯¯ã€ååº”é”™è¯¯è¾¹ç•Œã€è¿˜åŸçŠ¶æ€ã€ç¼“æ…¢çš„ç»„ä»¶åŠ è½½æ—¶é—´ã€JSå¼‚å¸¸ã€å‰ç«¯æ€§èƒ½æŒ‡æ ‡å’Œç”¨æˆ·äº¤äº’ã€‚ç„¶åï¼ŒLogRocketä½¿ç”¨æœºå™¨å­¦ä¹ æ¥é€šçŸ¥æ‚¨å½±å“å¤§å¤šæ•°ç”¨æˆ·çš„æœ€å…·å½±å“åŠ›çš„é—®é¢˜ï¼Œå¹¶æä¾›æ‚¨ä¿®å¤å®ƒæ‰€éœ€çš„ä¸Šä¸‹æ–‡ã€‚</p><p vwo-el-id="28675661060">å…³æ³¨é‡è¦çš„React bugâ€”<a class="signup" href="https://lp.logrocket.com/blg/react-signup-issue-free" target="_blank" rel="noopener noreferrer" vwo-el-id="40093418840">ä»Šå¤©å°±è¯•è¯•LogRocketã€‘ã€‚</a></p>
</div></div>

<p class="clearfix"/>
<p class="clearfix"/>
</article>

</div>    
</body>
</html>