<html>
<head>
<title>Building a Node.js web API with Sails.js - LogRocket Blog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>ä½¿ç”¨Sails.js - LogRocketåšå®¢æ„å»ºNode.js web API</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://blog.logrocket.com/building-a-node-js-web-api-with-sails-js/#0001-01-01">https://blog.logrocket.com/building-a-node-js-web-api-with-sails-js/#0001-01-01</a></blockquote><div><article class="article-post">
<p>èƒ½å¤Ÿåœ¨æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ç¼–å†™JavaScriptå¯¹äºå°å‹å’Œå¤§å‹å›¢é˜Ÿæ¥è¯´éƒ½æ˜¯å¾ˆå¥½çš„æ æ†ã€‚ç„¶è€Œï¼Œå¯¹äºæ™®é€šå¼€å‘äººå‘˜æ¥è¯´ï¼Œæ„å»ºä¸€ä¸ªç”Ÿäº§å°±ç»ªçš„Node.js Web APIæ¥æ”¯æŒå·²ç»åˆ›å»ºå¥½çš„å‰ç«¯ã€Webæˆ–ç§»åŠ¨åº”ç”¨ç¨‹åºå¹¶ä¸å®¹æ˜“ã€‚æ‚¨å°†ä¼šé‡åˆ°çš„ä¸€äº›å¼€é”€æœ‰:</p>
<ul>
<li>æœ‰å¤ªå¤šçš„æ¡†æ¶å¯ä¾›é€‰æ‹©(Expressã€å“ˆæ¯”ç¥ã€Koaç­‰)ã€‚)</li>
<li>åœ¨æ²¡æœ‰ä»»ä½•æ˜ç¡®æŒ‡å¯¼æ–¹é’ˆçš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¸å¾—ä¸ç ”ç©¶å’Œæ±‡æ€»é¡¹ç›®æ‰€éœ€çš„åŒ…</li>
<li>å¿…é¡»å†³å®šæ„å»ºé¡¹ç›®ä»£ç åº“çš„æœ€ä½³å®è·µ</li>
<li>æˆ‘ä»¬åº”è¯¥ä½¿ç”¨å“ªç§ORMï¼Œè¿˜æ˜¯åº”è¯¥ç¼–å†™åŸå§‹æŸ¥è¯¢ï¼ŸğŸ¤”</li>
</ul>
<p>åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†å­¦ä¹ å¦‚ä½•ä½¿ç”¨Sails.jsæ¡†æ¶(Node.jsçš„MVCæ¡†æ¶)æ„å»ºä¸€ä¸ªç”Ÿäº§å°±ç»ªçš„Node.js web APIã€‚æˆ‘ä»¬å°†ä¸ºweb APIæœåŠ¡æ„å»ºç”¨æˆ·ç®¡ç†ç«¯ç‚¹ã€‚æˆ‘ä»¬å°†æ„å»ºç«¯ç‚¹æ¥å®ç°ä»¥ä¸‹åŠŸèƒ½:</p>
<ul>
<li>ç”¨æˆ·æ³¨å†Œ</li>
<li>ç”¨æˆ·ç™»å½•</li>
<li>ç”µå­é‚®ä»¶ç¡®è®¤</li>
<li>å¿˜è®°/é‡ç½®å¯†ç </li>
</ul>
<p>æˆ‘ä»¬å°†ä½¿ç”¨Postmanæµ‹è¯•æˆ‘ä»¬çš„ç«¯ç‚¹ã€‚æœ€åï¼Œæˆ‘ä»¬å°†åœ¨Herokuéƒ¨ç½²ã€‚æˆ‘ä»¬å…ˆä»ä»‹ç»Sails.jså¼€å§‹ã€‚</p>
<h2>å…ˆå†³æ¡ä»¶</h2>
<p>æœ¬æ•™ç¨‹å‡è®¾è¯»è€…å¯¹Node.jså’ŒæœåŠ¡å™¨ç«¯å¼€å‘ç›¸å½“ç†Ÿæ‚‰ã€‚</p>
<h2>ä»€ä¹ˆæ˜¯Sails.jsï¼Ÿ</h2>
<p><a href="https://sailsjs.com" target="_blank" rel="noopener noreferrer"> Sails.js </a>æˆ–Sailsæ˜¯ä¸€ä¸ªå®æ—¶<a href="https://en.wikipedia.org/wiki/Model%E2%80%93view%E2%80%93controller" target="_blank" rel="noopener noreferrer"> MVC </a>æ¡†æ¶ï¼Œç”¨äºæ„å»ºç”Ÿäº§å°±ç»ªçš„ä¼ä¸šNode.jsåº”ç”¨ç¨‹åºã€‚å®ƒæ˜¯ç”±<a href="https://twitter.com/mikermcneil?lang=en" target="_blank" rel="noopener noreferrer">è¿ˆå…‹Â·éº¦å…‹å°¼å°”</a>å’Œé£å¸†å…¬å¸åœ¨2015å¹´å—Ruby on Rails MVCæ¡†æ¶çš„å¯å‘è€Œå»ºé€ çš„ã€‚Sailsè‡ªå¸¦websocketæ”¯æŒï¼Œé€‚åˆæ„å»ºå®æ—¶èŠå¤©åº”ç”¨ã€æ¸¸æˆç­‰ã€‚èˆ¹å¸†è¿˜é…æœ‰:</p>
<ul>
<li>ä¸€ä¸ªåä¸º<a href="https://waterlinejs.org/" target="_blank" rel="noopener noreferrer"> Waterline </a>çš„ORMâ€”â€”node . jsçš„åŸºäºé€‚é…å™¨çš„ORMâ€”â€”è®©åº”ç”¨ç¨‹åºçš„æ•°æ®å±‚å˜å¾—è½»è€Œæ˜“ä¸¾</li>
<li>ä¸€ä¸ªåä¸ºsailsçš„CLIå·¥å…·ï¼Œå¯ä»¥å¸®åŠ©æ‚¨æ„å»ºæ–°çš„sailsåº”ç”¨ç¨‹åºã€ç”Ÿæˆæ§åˆ¶å™¨æ“ä½œã€å¯åŠ¨å¼€å‘æœåŠ¡å™¨ã€æ•°æ®åº“è¿ç§»ç­‰ç­‰</li>
</ul>
<p>Sailsæ­£è¢«åƒ<a href="https://www.postman.com/" target="_blank" rel="noopener noreferrer"> Postman </a>ã€<a href="https://paystack.com/" target="_blank" rel="noopener noreferrer"> Paystack </a>å’Œ<a href="https://devmountain.com" target="_blank" rel="noopener noreferrer"> devmountain </a>è¿™æ ·çš„å…¬å¸ç§¯æåœ°ç”¨äºæ„å»ºä»–ä»¬çš„Web APIsä»¥æ”¯æŒä»–ä»¬çš„å„ç§å®¢æˆ·ã€‚</p>
<blockquote><p>æ³¨æ„:Sailsæ˜¯åœ¨æµè¡Œçš„Express Node.jsæ¡†æ¶ä¹‹ä¸Šæ„å»ºçš„ï¼Œæ‰€ä»¥å¦‚æœæ‚¨å·²ç»ç”¨Expressæ„å»ºäº†Node.jsåº”ç”¨ç¨‹åºï¼Œåº”è¯¥ä¼šæ„Ÿè§‰å¾ˆç†Ÿæ‚‰ã€‚</p></blockquote>
<h2>å…¥é—¨æŒ‡å—</h2>
<p>è¦å¼€å§‹åœ¨Sailsä¸­æ„å»ºæˆ‘ä»¬çš„web APIï¼Œæˆ‘ä»¬éœ€è¦å®‰è£…Sails CLIå·¥å…·ã€‚æˆ‘ä»¬å°†é€šè¿‡åœ¨ç»ˆç«¯ä¸­è¿è¡Œä¸‹é¢çš„å‘½ä»¤æ¥å®ç°ã€‚</p>
<blockquote><p>æˆ‘å‡è®¾ä½ å·²ç»å®‰è£…äº†Node.js( <a href="https://nodejs.org/download/release/v13.12.0/" target="_blank" rel="noopener noreferrer">ç‰ˆæœ¬13.12.0 </a>)</p></blockquote>
<pre>npm install -g sails</pre>
<p>ä»¥ä¸Šå‘½ä»¤å°†åœ¨æ‚¨çš„è®¡ç®—æœºä¸Šå…¨å±€å®‰è£…Sails CLIå·¥å…·ã€‚è¦éªŒè¯Sailsæ˜¯å¦å·²å®‰è£…ï¼Œè¯·è¿è¡Œ:</p>
<pre>sails -v</pre>
<p>å¦‚æœä¸€åˆ‡é¡ºåˆ©ï¼Œä¸Šé¢çš„å‘½ä»¤åº”è¯¥ä¼šè¿”å›ä¸€ä¸ªç‰ˆæœ¬å·ã€‚</p>
<h2>åˆ›å»ºæ–°çš„Sailsåº”ç”¨ç¨‹åº</h2>
<p>è¦åˆ›å»ºä¸€ä¸ªæ–°çš„Sailsåº”ç”¨ç¨‹åºï¼Œè¿è¡Œ<code>sails new</code>å‘½ä»¤å¹¶ä¼ é€’åº”ç”¨ç¨‹åºçš„åç§°ã€‚è¯¥å‘½ä»¤å°†ç”Ÿæˆä¸€ä¸ªæ–°çš„Sailsåº”ç”¨ç¨‹åºï¼Œå¹¶è¿è¡Œ<code>npm install</code>ä¸ºæ‚¨å®‰è£…æ‰€æœ‰çš„ä¾èµ–é¡¹ã€‚</p>
<pre>sails new &lt;appname&gt;</pre>
<p>æ–°çš„å‘½ä»¤ä¹Ÿæ¥å—å¯é€‰æ ‡å¿—ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨<code>--no-frontend</code>æ ‡å¿—å‘Šè¯‰Sailsä¸è¦ç”Ÿæˆâ€œèµ„äº§â€ã€â€œè§†å›¾â€æˆ–â€œä»»åŠ¡â€æ–‡ä»¶å¤¹ã€‚è¿™æ­£æ˜¯æˆ‘ä»¬æƒ³è¦çš„ï¼Œå› ä¸ºæˆ‘ä»¬æ­£åœ¨æ„å»ºä¸€ä¸ªweb APIã€‚è®©æˆ‘ä»¬åƒè¿™æ ·è¿è¡Œå‘½ä»¤:</p>
<pre>sails new logrocket-sails-api --no-frontend</pre>
<blockquote><p>ä¸“ä¸šæç¤º:æ‚¨å¯ä»¥è¿è¡Œå¸¦æœ‰â€”fastæ ‡å¿—çš„æ–°å‘½ä»¤ï¼Œåªç”Ÿæˆsailsåº”ç”¨ç¨‹åºï¼Œè·³è¿‡ä¾èµ–é¡¹çš„å®‰è£…</p></blockquote>
<p>ç°åœ¨ä½ å¯ä»¥<code>cd</code>è¿›å…¥<code>logrocket-sails-api</code>ç›®å½•ï¼Œåœ¨ç¼–è¾‘å™¨ä¸­æ‰“å¼€åº”ç”¨ç¨‹åºã€‚æˆ‘ä»¬å°†ä½¿ç”¨VSä»£ç ï¼Œæ‰€ä»¥æˆ‘ä»¬å°†è¿è¡Œ<code>code .</code>æ¥æ‰“å¼€VSä»£ç ä¸­çš„å½“å‰ç›®å½•ã€‚</p>
<h2>é¡¹ç›®ä»£ç åº“ç»“æ„</h2>
<p><img data-attachment-id="27112" data-permalink="https://blog.logrocket.com/building-a-node-js-web-api-with-sails-js/sailscodenamestructure-nocdn/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/10/sailscodenamestructure-nocdn.png" data-orig-size="980,1073" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="sailscodenamestructure-nocdn" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/10/sailscodenamestructure-nocdn-274x300.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/10/sailscodenamestructure-nocdn-935x1024.png" decoding="async" class="aligncenter size-full wp-image-27112 jetpack-lazy-image" src="../Images/92688e8bfb11e73c86d97813ad6855cd.png" alt="Sails code name structure" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/10/sailscodenamestructure-nocdn.png 980w, https://blog.logrocket.com/wp-content/uploads/2020/10/sailscodenamestructure-nocdn-274x300.png 274w, https://blog.logrocket.com/wp-content/uploads/2020/10/sailscodenamestructure-nocdn-935x1024.png 935w, https://blog.logrocket.com/wp-content/uploads/2020/10/sailscodenamestructure-nocdn-768x841.png 768w" data-lazy-sizes="(max-width: 980px) 100vw, 980px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/10/sailscodenamestructure-nocdn.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/10/sailscodenamestructure-nocdn.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="27112" data-permalink="https://blog.logrocket.com/building-a-node-js-web-api-with-sails-js/sailscodenamestructure-nocdn/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/10/sailscodenamestructure-nocdn.png" data-orig-size="980,1073" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="sailscodenamestructure-nocdn" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/10/sailscodenamestructure-nocdn-274x300.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/10/sailscodenamestructure-nocdn-935x1024.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-27112" src="../Images/92688e8bfb11e73c86d97813ad6855cd.png" alt="Sails code name structure" srcset="https://blog.logrocket.com/wp-content/uploads/2020/10/sailscodenamestructure-nocdn.png 980w, https://blog.logrocket.com/wp-content/uploads/2020/10/sailscodenamestructure-nocdn-274x300.png 274w, https://blog.logrocket.com/wp-content/uploads/2020/10/sailscodenamestructure-nocdn-935x1024.png 935w, https://blog.logrocket.com/wp-content/uploads/2020/10/sailscodenamestructure-nocdn-768x841.png 768w" sizes="(max-width: 980px) 100vw, 980px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/10/sailscodenamestructure-nocdn.png"/></noscript>
<p>ä¸Šé¢çš„æˆªå›¾æè¿°äº†<code>sails new</code>å‘½ä»¤ä¸ºæˆ‘ä»¬ç”Ÿæˆçš„ä»£ç åº“ç»“æ„ã€‚è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹è¿™äº›æ–‡ä»¶å’Œæ–‡ä»¶å¤¹æ˜¯ä»€ä¹ˆ:</p>
<ul>
<li>è¿™ä¸ªç›®å½•æ˜¯ä½ èŠ±è´¹å¤§éƒ¨åˆ†å¼€å‘æ—¶é—´çš„åœ°æ–¹ã€‚é»˜è®¤åŒ…å«<code>controllers/</code>ã€<code>helpers/</code>ã€<code>models/</code>å’Œ<code>policies/</code>å­ç›®å½•</li>
<li>è¿™ä¸ªç›®å½•å°†åŒ…å«ä½ çš„Sailsåº”ç”¨ç¨‹åºä¸­çš„æ‰€æœ‰æ§åˆ¶å™¨</li>
<li>åœ¨Sailsä¸­ï¼ŒåŠ©æ‰‹æ˜¯ä¸€æ®µéµå¾ªèŠ‚ç‚¹æœºå™¨è§„èŒƒçš„å¯é‡ç”¨ä»£ç ã€‚<code>helpers/</code>ç›®å½•å°†åŒ…å«æ‚¨åœ¨åº”ç”¨ç¨‹åºä¸­å®šä¹‰çš„æ‰€æœ‰åŠ©æ‰‹</li>
<li>è¿™ä¸ªç›®å½•å°†åŒ…å«ä½ çš„åº”ç”¨ç¨‹åºæ°´çº¿æ¨¡å‹ã€‚æ°´çº¿æ¨¡å‹é€šå¸¸åªæ˜¯ä¸€ä¸ªåŒ…å«æ•°æ®åº“è¡¨çš„æ•°æ®åº“æ¨¡å¼çš„<code>.js</code>æ–‡ä»¶</li>
<li>ç­–ç•¥æ˜¯æˆæƒå’Œè®¿é—®æ§åˆ¶çš„å¯¼èˆªæœºåˆ¶ã€‚æ‚¨å¯ä»¥åœ¨è¿™ä¸ªæ–‡ä»¶å¤¹ä¸­å®šä¹‰å®ƒä»¬</li>
<li><code>config/</code>â€“æ­¤ç›®å½•åŒ…å«æ‚¨çš„sailsåº”ç”¨ç¨‹åºçš„æ‰€æœ‰é…ç½®æ–‡ä»¶ã€‚ä¸€ä¸ªç‰¹åˆ«å€¼å¾—æ³¨æ„çš„æ–‡ä»¶æ˜¯<code>routes.js</code>é…ç½®æ–‡ä»¶ï¼Œå®ƒç”¨äºå£°æ˜Sailsåº”ç”¨ç¨‹åºå¤„ç†è¯·æ±‚çš„è·¯å¾„</li>
<li>åœ¨è¿™ä¸ªé…ç½®æ–‡ä»¶ä¸­ï¼Œä½ å®šä¹‰äº†ä½ çš„æ•°æ®åº“é€‚é…å™¨ï¼ŒWaterlineå°†ä½¿ç”¨è¿™ä¸ªé€‚é…å™¨(ç¨åä¼šè¯¦ç»†ä»‹ç»)</li>
<li><code>config/policies.js</code>â€“åœ¨è¿™é‡Œï¼Œæ‚¨å¯ä»¥å®šä¹‰ç­–ç•¥ä»¥åŠç­–ç•¥å°†ä¿æŠ¤çš„åŠ¨ä½œæˆ–æ§åˆ¶å™¨</li>
</ul>
<blockquote><p>ä½ å¯ä»¥åœ¨<a href="https://sailsjs.com/documentation/anatomy" target="_blank" rel="noopener noreferrer"> Sailsæ–‡æ¡£</a>ä¸­é˜…è¯»æ›´å¤šå…³äºå…¶ä»–æ–‡ä»¶å’Œæ–‡ä»¶å¤¹çš„ä¿¡æ¯ã€‚</p></blockquote>
<h2>æˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªç»ˆç‚¹</h2>
<p>ç°åœ¨ï¼Œå¦‚æœæ‚¨é€šè¿‡è¿è¡Œ<code>sails lift</code>å¯åŠ¨Sailså¼€å‘æœåŠ¡å™¨ï¼Œå¹¶è®¿é—®<code>localhost:1337</code>ï¼Œæ‚¨å°†è·å¾—ä¸€ä¸ª<code>404</code>ï¼Œå› ä¸ºæˆ‘ä»¬è¿˜æ²¡æœ‰ä¸ºæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºå®šä¹‰ä»»ä½•è·¯ç”±ã€‚</p>
<p><img data-attachment-id="27114" data-permalink="https://blog.logrocket.com/building-a-node-js-web-api-with-sails-js/sailslift-nocdn/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/10/sailslift-nocdn.png" data-orig-size="730,354" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="sailslift-nocdn" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/10/sailslift-nocdn-300x145.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/10/sailslift-nocdn.png" decoding="async" class="aligncenter wp-image-27114 size-full jetpack-lazy-image" src="../Images/05aece740d0e737b19f6803e9a9d64ef.png" alt="sails lift" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/10/sailslift-nocdn.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/10/sailslift-nocdn-300x145.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/10/sailslift-nocdn.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/10/sailslift-nocdn.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="27114" data-permalink="https://blog.logrocket.com/building-a-node-js-web-api-with-sails-js/sailslift-nocdn/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/10/sailslift-nocdn.png" data-orig-size="730,354" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="sailslift-nocdn" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/10/sailslift-nocdn-300x145.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/10/sailslift-nocdn.png" decoding="async" loading="lazy" class="aligncenter wp-image-27114 size-full" src="../Images/05aece740d0e737b19f6803e9a9d64ef.png" alt="sails lift" srcset="https://blog.logrocket.com/wp-content/uploads/2020/10/sailslift-nocdn.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/10/sailslift-nocdn-300x145.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/10/sailslift-nocdn.png"/></noscript>
<p><img data-attachment-id="27115" data-permalink="https://blog.logrocket.com/building-a-node-js-web-api-with-sails-js/notfound-nocdn/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/10/notfound-nocdn.png" data-orig-size="1916,296" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="notfound-nocdn" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/10/notfound-nocdn-300x46.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/10/notfound-nocdn-1024x158.png" decoding="async" class="aligncenter size-full wp-image-27115 jetpack-lazy-image" src="../Images/1c12783e447273b34d305321b26f0284.png" alt="Not found" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/10/notfound-nocdn.png 1916w, https://blog.logrocket.com/wp-content/uploads/2020/10/notfound-nocdn-300x46.png 300w, https://blog.logrocket.com/wp-content/uploads/2020/10/notfound-nocdn-1024x158.png 1024w, https://blog.logrocket.com/wp-content/uploads/2020/10/notfound-nocdn-768x119.png 768w, https://blog.logrocket.com/wp-content/uploads/2020/10/notfound-nocdn-1536x237.png 1536w" data-lazy-sizes="(max-width: 1916px) 100vw, 1916px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/10/notfound-nocdn.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/10/notfound-nocdn.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="27115" data-permalink="https://blog.logrocket.com/building-a-node-js-web-api-with-sails-js/notfound-nocdn/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/10/notfound-nocdn.png" data-orig-size="1916,296" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="notfound-nocdn" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/10/notfound-nocdn-300x46.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/10/notfound-nocdn-1024x158.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-27115" src="../Images/1c12783e447273b34d305321b26f0284.png" alt="Not found" srcset="https://blog.logrocket.com/wp-content/uploads/2020/10/notfound-nocdn.png 1916w, https://blog.logrocket.com/wp-content/uploads/2020/10/notfound-nocdn-300x46.png 300w, https://blog.logrocket.com/wp-content/uploads/2020/10/notfound-nocdn-1024x158.png 1024w, https://blog.logrocket.com/wp-content/uploads/2020/10/notfound-nocdn-768x119.png 768w, https://blog.logrocket.com/wp-content/uploads/2020/10/notfound-nocdn-1536x237.png 1536w" sizes="(max-width: 1916px) 100vw, 1916px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/10/notfound-nocdn.png"/></noscript>
<blockquote><p>ä¸“ä¸šæç¤º:ä½ å¯ä»¥é€šè¿‡è¿è¡Œ<code>sails lift -- port &lt;port-no&gt;</code>æ¥æ”¹å˜å°†è¦ç›‘å¬çš„å·¦èˆ·å¸†</p></blockquote>
<p>è®©æˆ‘ä»¬åˆ›å»ºç¬¬ä¸€ä¸ªç«¯ç‚¹ã€‚é€šå¸¸ï¼Œæ‚¨éœ€è¦è§¦æ‘¸<code>routes.js</code>å¹¶æ·»åŠ ç«¯ç‚¹ã€‚<code>routes.js</code>æ–‡ä»¶æ¥å—ä¸€ä¸ªå­—å…¸/å¯¹è±¡ï¼Œå…¶ä¸­é”®æ˜¯è·¯ç”±ç«¯ç‚¹ï¼Œæ¯”å¦‚è¯´<code>/</code>ï¼Œå€¼æ˜¯å°†å¤„ç†è·¯ç”±è¯·æ±‚çš„æ§åˆ¶å™¨åŠ¨ä½œã€‚è·¯ç”±å…³é”®å­—å¿…é¡»åŒ…å«ä¸€ä¸ªç”±Sailsæ”¯æŒçš„HTTPåŠ¨è¯(GET|POST|PATCH|DELETE ),ç„¶åæ˜¯ä¸€ä¸ªç©ºæ ¼ï¼Œåè·Ÿè·¯ç”±ã€‚</p>
<p>è®©æˆ‘ä»¬ä¸ºåº”ç”¨ç¨‹åºçš„<code>/</code>ç´¢å¼•æ·»åŠ è·¯çº¿ã€‚æ‰“å¼€<code>config/routes.js</code>å¹¶æ·»åŠ ä»¥ä¸‹ä»£ç ç‰‡æ®µ:</p>
<pre>"GET /": "home/index"</pre>
<p>ä¸Šè¿°è·¯ç”±æ„å‘³ç€ï¼Œå¯¹äºGETè¯·æ±‚ï¼Œä¸»æ§åˆ¶å™¨ä¸­çš„ç´¢å¼•æ“ä½œ(æ–¹æ³•)å°†å¤„ç†è¯¥è¯·æ±‚ã€‚</p>
<blockquote><p>è¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„æ—¶æœºæ¥æä¸€ä¸‹ï¼Œåœ¨Sailsä¸­ï¼Œæ‚¨å¯ä»¥çµæ´»åœ°å°†æ‚¨çš„æ§åˆ¶å™¨åŠ¨ä½œ(æ–¹æ³•)æ”¾åœ¨ä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶ä¸­ï¼Œè€Œä¸æ˜¯å°†å®ƒä»¬éƒ½å®šä¹‰åœ¨ä¸€ä¸ªå•ç‹¬çš„æ§åˆ¶å™¨æ–‡ä»¶ä¸­ã€‚è¿™ç§æ–¹æ³•ä½¿åŠ¨ä½œæ›´å…·å¯è¯»æ€§ï¼Œå› æ­¤æ¯ä¸ªåŠ¨ä½œæ–‡ä»¶éƒ½æœ‰é‡ç‚¹ã€‚æˆ‘ä»¬å°†é‡‡ç”¨è¿™ç§æ–¹æ³•ï¼Œç”¨ç›®å½•æ¥è¡¨ç¤ºæ§åˆ¶å™¨å’Œé‡Œé¢çš„<code>.js</code>æ–‡ä»¶ä½œä¸ºåŠ¨ä½œã€‚</p></blockquote>
<p>æ‚¨çš„<code>routes.js</code>æ–‡ä»¶åº”è¯¥å¦‚ä¸‹æ‰€ç¤º:</p>
<p><img data-attachment-id="25548" data-permalink="https://blog.logrocket.com/building-a-node-js-web-api-with-sails-js/routesjs/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/09/routesjs.png" data-orig-size="1922,1057" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="routesjs" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/09/routesjs-300x165.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/09/routesjs-1024x563.png" decoding="async" class="aligncenter size-full wp-image-25548 jetpack-lazy-image" src="../Images/de611dc059ed1f1d1f968d28ab183d96.png" alt="routes.js" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/09/routesjs.png 1922w, https://blog.logrocket.com/wp-content/uploads/2020/09/routesjs-300x165.png 300w, https://blog.logrocket.com/wp-content/uploads/2020/09/routesjs-1024x563.png 1024w, https://blog.logrocket.com/wp-content/uploads/2020/09/routesjs-768x422.png 768w, https://blog.logrocket.com/wp-content/uploads/2020/09/routesjs-1536x845.png 1536w" data-lazy-sizes="(max-width: 1922px) 100vw, 1922px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/09/routesjs.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/09/routesjs.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="25548" data-permalink="https://blog.logrocket.com/building-a-node-js-web-api-with-sails-js/routesjs/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/09/routesjs.png" data-orig-size="1922,1057" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="routesjs" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/09/routesjs-300x165.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/09/routesjs-1024x563.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-25548" src="../Images/de611dc059ed1f1d1f968d28ab183d96.png" alt="routes.js" srcset="https://blog.logrocket.com/wp-content/uploads/2020/09/routesjs.png 1922w, https://blog.logrocket.com/wp-content/uploads/2020/09/routesjs-300x165.png 300w, https://blog.logrocket.com/wp-content/uploads/2020/09/routesjs-1024x563.png 1024w, https://blog.logrocket.com/wp-content/uploads/2020/09/routesjs-768x422.png 768w, https://blog.logrocket.com/wp-content/uploads/2020/09/routesjs-1536x845.png 1536w" sizes="(max-width: 1922px) 100vw, 1922px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/09/routesjs.png"/></noscript>
<p>æˆ‘ä»¬å·²ç»å®Œæˆäº†åˆ›å»ºç¬¬ä¸€ä¸ªç«¯ç‚¹çš„ä¸€åŠã€‚ä¸‹ä¸€æ­¥æ˜¯åˆ›å»º<code>index</code>åŠ¨ä½œã€‚æˆ‘ä»¬å°†ä½¿ç”¨Sails CLI <code>generate</code>å‘½ä»¤åœ¨<code>controllers/home</code>ç›®å½•ä¸­åˆ›å»ºåŠ¨ä½œã€‚è¿è¡Œä»¥ä¸‹å‘½ä»¤:</p>
<pre>sails generate action home/index</pre>
<p><img data-attachment-id="27116" data-permalink="https://blog.logrocket.com/building-a-node-js-web-api-with-sails-js/sailsuccessfullygenerated-nocdn/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/10/sailsuccessfullygenerated-nocdn.png" data-orig-size="730,354" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="sailsuccessfullygenerated-nocdn" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/10/sailsuccessfullygenerated-nocdn-300x145.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/10/sailsuccessfullygenerated-nocdn.png" decoding="async" class="aligncenter wp-image-27116 size-full jetpack-lazy-image" src="../Images/17d84baf037c221f3e4b35f5245c6179.png" alt="sailssuccessfullygenerated" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/10/sailsuccessfullygenerated-nocdn.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/10/sailsuccessfullygenerated-nocdn-300x145.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/10/sailsuccessfullygenerated-nocdn.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/10/sailsuccessfullygenerated-nocdn.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="27116" data-permalink="https://blog.logrocket.com/building-a-node-js-web-api-with-sails-js/sailsuccessfullygenerated-nocdn/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/10/sailsuccessfullygenerated-nocdn.png" data-orig-size="730,354" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="sailsuccessfullygenerated-nocdn" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/10/sailsuccessfullygenerated-nocdn-300x145.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/10/sailsuccessfullygenerated-nocdn.png" decoding="async" loading="lazy" class="aligncenter wp-image-27116 size-full" src="../Images/17d84baf037c221f3e4b35f5245c6179.png" alt="sailssuccessfullygenerated" srcset="https://blog.logrocket.com/wp-content/uploads/2020/10/sailsuccessfullygenerated-nocdn.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/10/sailsuccessfullygenerated-nocdn-300x145.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/10/sailsuccessfullygenerated-nocdn.png"/></noscript>
<p>æˆ‘ä»¬æ²¡æœ‰ä¼ å…¥æ–‡ä»¶æ‰©å±•åï¼Œå› ä¸ºSailså¾ˆèªæ˜åœ°åŒ…å«äº†è¿™ä¸€ç‚¹ã€‚å› æ­¤ï¼Œæ‚¨é€šå¸¸åƒå¯¹å¾…routes.jsä¸­çš„routeså±æ€§ä¸€æ ·ä¼ é€’å‚æ•°</p>
<p>å½“æˆ‘ä»¬è¿è¡Œä¸Šé¢çš„å‘½ä»¤æ—¶ï¼Œä¸€ä¸ªæ–°çš„æ–‡ä»¶å¤¹<code>home</code>å°†è¢«æ·»åŠ åˆ°<code>controllers/</code>ç›®å½•ä¸­ï¼Œå¹¶ä¸”<code>index.js</code>åŠ¨ä½œåº”è¯¥åœ¨å…¶ä¸­ã€‚ä¸‹é¢æ˜¯<code>index.js</code>åŠ¨ä½œçš„é»˜è®¤å†…å®¹:</p>
<p><img data-attachment-id="25552" data-permalink="https://blog.logrocket.com/building-a-node-js-web-api-with-sails-js/inputsundefined/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/09/inputsundefined.png" data-orig-size="1922,1057" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="inputsundefined" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/09/inputsundefined-300x165.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/09/inputsundefined-1024x563.png" decoding="async" class="aligncenter size-full wp-image-25552 jetpack-lazy-image" src="../Images/78b572416d7aa31cde4af66a5ce34dd1.png" alt="inputs is undefined but never used message " data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/09/inputsundefined.png 1922w, https://blog.logrocket.com/wp-content/uploads/2020/09/inputsundefined-300x165.png 300w, https://blog.logrocket.com/wp-content/uploads/2020/09/inputsundefined-1024x563.png 1024w, https://blog.logrocket.com/wp-content/uploads/2020/09/inputsundefined-768x422.png 768w, https://blog.logrocket.com/wp-content/uploads/2020/09/inputsundefined-1536x845.png 1536w" data-lazy-sizes="(max-width: 1922px) 100vw, 1922px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/09/inputsundefined.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/09/inputsundefined.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="25552" data-permalink="https://blog.logrocket.com/building-a-node-js-web-api-with-sails-js/inputsundefined/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/09/inputsundefined.png" data-orig-size="1922,1057" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="inputsundefined" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/09/inputsundefined-300x165.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/09/inputsundefined-1024x563.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-25552" src="../Images/78b572416d7aa31cde4af66a5ce34dd1.png" alt="inputs is undefined but never used message " srcset="https://blog.logrocket.com/wp-content/uploads/2020/09/inputsundefined.png 1922w, https://blog.logrocket.com/wp-content/uploads/2020/09/inputsundefined-300x165.png 300w, https://blog.logrocket.com/wp-content/uploads/2020/09/inputsundefined-1024x563.png 1024w, https://blog.logrocket.com/wp-content/uploads/2020/09/inputsundefined-768x422.png 768w, https://blog.logrocket.com/wp-content/uploads/2020/09/inputsundefined-1536x845.png 1536w" sizes="(max-width: 1922px) 100vw, 1922px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/09/inputsundefined.png"/></noscript>
<p>Sailsä¸­åŠ¨ä½œå’ŒåŠ©æ‰‹çš„æ ¼å¼éµå¾ª<a href="https://node-machine.org/" target="_blank" rel="noopener noreferrer">èŠ‚ç‚¹æœºå™¨</a>è§„èŒƒã€‚ä¸€ç¯‡å¸®åŠ©ä½ ç†è§£è¿™ä¸ªè§„èŒƒçš„æ–‡ç« å¯ä»¥åœ¨<a href="https://www.smashingmagazine.com/2020/05/understanding-machines-open-standard-javascript-functions/" target="_blank" rel="noopener noreferrer">è¿™é‡Œ</a>æ‰¾åˆ°ã€‚</p>
<p>æˆ‘ä»¬æƒ³è¦åšçš„æ˜¯åœ¨å‘<code>/</code>ç«¯ç‚¹å‘å‡ºè¯·æ±‚æ—¶è¿”å›ä¸€ä¸ªJSONå“åº”ã€‚ä¿®æ”¹<code>home/index.js</code>,å¦‚ä¸‹æ‰€ç¤º:</p>
<pre>module.exports = {
  friendlyName: 'Index',
  description: 'Index home.',
  inputs: {
  },
  exits: {
  },
  fn: async function (_, exits) {
    // All done.
    exits.success({message: 'LogRocket Sails API'});
  }
};</pre>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒSails actionsä½¿ç”¨<code>exits.success</code>ä¸ºæ¯ä¸ªè¯·æ±‚è¿”å›ä¸€ä¸ªæˆåŠŸå“åº”ã€‚å› æ­¤ï¼Œå½“ç”¨æˆ·è®¿é—®<code>/</code>æˆ–æˆ‘ä»¬çš„Web APIæ—¶ï¼Œå¸¦æœ‰<code>property</code>æ¶ˆæ¯çš„JSONæœ‰æ•ˆè´Ÿè½½å°†ä½œä¸ºå“åº”è¢«å‘é€å›æ¥ã€‚</p>
<p>ç°åœ¨æˆ‘ä»¬å·²ç»ç†Ÿæ‚‰äº†ï¼Œè®©æˆ‘ä»¬ç»§ç»­å®ç°æˆ‘ä»¬çš„ç”¨æˆ·ç®¡ç†å’Œè®¤è¯ç‰¹æ€§ã€‚æˆ‘ä»¬å°†ä»æ³¨å†Œç«¯ç‚¹å¼€å§‹ã€‚</p>
<h2>æ–°ç”¨æˆ·æ³¨å†Œç«¯ç‚¹</h2>
<p>é¦–å…ˆï¼Œè®©æˆ‘ä»¬æ¥è¯´æ˜æˆ‘ä»¬å¸Œæœ›å¦‚ä½•å¤„ç†è¿™ä¸ªç«¯ç‚¹:</p>
<ul>
<li>è®¾ç½®æ•°æ®åº“è¿æ¥</li>
<li>åœ¨æ•°æ®åº“ä¸­å­˜å‚¨æ–°çš„ç”¨æˆ·è®°å½•</li>
<li>å‘æ–°ç”¨æˆ·å‘é€ç”µå­é‚®ä»¶ç¡®è®¤</li>
<li>æ³¨å†ŒæˆåŠŸåå‘ç”¨æˆ·å‘é€å›å¤</li>
<li>å¦‚æœåœ¨æ³¨å†Œè¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯ï¼Œå¯ä»¥é€‰æ‹©å‘å›é”™è¯¯</li>
</ul>
<h2>è®¾ç½®æ•°æ®åº“è¿æ¥</h2>
<p>æˆ‘ä»¬å°†ä½¿ç”¨<a href="https://www.postgresql.org/" target="_blank" rel="noopener noreferrer"> PostgreSQL </a>ã€‚ä½ å¯ä»¥æŒ‰ç…§è¿™ä¸ª<a href="https://www.postgresql.org/docs/current/tutorial-install.html" target="_blank" rel="noopener noreferrer">æ•™ç¨‹</a>ä¸ºä½ çš„æœºå™¨å®‰è£…PostgreSQLã€‚</p>
<p>Sailsä¸ºWaterlineæä¾›äº†ä¸€ä¸ªå®˜æ–¹çš„<a href="https://www.npmjs.com/package/sails-postgresql" target="_blank" rel="noopener noreferrer"> PostgreSQLé€‚é…å™¨</a>,æˆ‘ä»¬å°†æŒ‰ç…§å®‰è£…ä»»ä½•npmåŒ…çš„æ–¹å¼å®‰è£…å®ƒï¼Œæ–¹æ³•æ˜¯è¿è¡Œ:</p>
<pre>npm install sails-postgresql --save</pre>
<p>å®‰è£…é€‚é…å™¨åï¼Œæ‚¨éœ€è¦åœ¨<code>config/datastore.js</code>ä¸­æä¾›é€‚é…å™¨åç§°å’Œæ‚¨çš„æœ¬åœ°æ•°æ®åº“è¿æ¥URLã€‚</p>
<p>åœ¨æ­¤ä¹‹å‰ï¼Œæ‚¨åº”è¯¥å·²ç»åˆ›å»ºäº†Postgresæ•°æ®åº“ã€‚ç‚¹å‡»è¿™é‡ŒæŸ¥çœ‹<a href="https://www.postgresql.org/docs/9.0/sql-createdatabase.html" target="_blank" rel="noopener noreferrer">å¸®åŠ©</a>ã€‚</p>
<p>é€šè¿‡å–æ¶ˆæ³¨é‡Šè¯¥è¡Œæ¥ä¿®æ”¹<code>config/datastore.js</code>:</p>
<pre>// adapter: 'sails-mysql',
// url: 'mysql://user:<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="4131203232362e332501292e3235">[emailÂ protected]</a>:port/database',</pre>
<p>æ›¿æ¢ä¸º:</p>
<pre>adapter: 'sails-postgresql',
url: 'postgres://logrocket_sails_api:<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="b6dad9d1c4d9d5ddd3c2c5d7dfdac5d7c6dff6dad9d5d7daded9c5c2">[emailÂ protected]</a>:5432/logrocket_sails_api', // Replace with your own connection URL</pre>
<p>PostgreSQLçš„è¿æ¥URLé€šå¸¸é‡‡ç”¨ä»¥ä¸‹å½¢å¼:</p>
<pre>"postgres://{user}:{password}@{hostname}:{port}/{database-name}"</pre>
<p>å¦‚æœSailså¼€å‘æœåŠ¡å™¨ä»åœ¨è¿è¡Œï¼Œåˆ™ç»ˆæ­¢å®ƒï¼Œå¹¶é€šè¿‡è¿è¡Œ<code>sails lift</code>é‡æ–°å¯åŠ¨Sailsã€‚</p>
<blockquote><p>ä¸“ä¸šæç¤º:å¦‚æœä½ ä½¿ç”¨VSä»£ç ï¼Œä½ å¯ä»¥å®‰è£…<a href="https://marketplace.visualstudio.com/items?itemName=dominuskelvin.sailboat" target="_blank" rel="noopener noreferrer">å¸†èˆ¹</a>â€”â€”VSä»£ç çš„Sailså·¥å…·ï¼Œä½ å¯ä»¥ä»å‘½ä»¤é¢æ¿å¯åŠ¨Sailså¼€å‘æœåŠ¡å™¨ã€‚</p></blockquote>
<p>å¦‚æœSailsè¿è¡Œæ²¡æœ‰ä»»ä½•é”™è¯¯ï¼Œé‚£ä¹ˆæ‚¨çš„æ•°æ®åº“å·²ç»æˆåŠŸè¿æ¥ã€‚</p>
<p>è®©æˆ‘ä»¬åœ¨ä¸‹ä¸€æ­¥ä¸­ç»§ç»­åˆ›å»ºæˆ‘ä»¬çš„ç”¨æˆ·æ¨¡å¼ã€‚</p>
<h2>æ¨¡å¼å£°æ˜å’Œç”¨æˆ·æ¨¡å‹</h2>
<p>ç”±äºPostgreSQLæ˜¯ä¸€ä¸ªåŸºäºæ¨¡å¼çš„æ•°æ®åº“ï¼Œå¦‚æœæ²¡æœ‰æ˜ç¡®å®šä¹‰çš„æ¨¡å¼ï¼Œæˆ‘ä»¬å°†æ— æ³•åœ¨è¿™äº›è¡¨ä¸Šåˆ›å»ºè¡¨æˆ–æ–°è®°å½•ã€‚Waterlineè´Ÿè´£å®šä¹‰è¯¥æ¨¡å¼ï¼Œå¹¶ä¸ºæˆ‘ä»¬æä¾›äº†åªéœ€è®¾ç½®JavaScriptå¯¹è±¡æ¥å®šä¹‰å®ƒä»¬çš„APIã€‚</p>
<p>å¯¹äºæˆ‘ä»¬çš„ç”¨æˆ·è¡¨ï¼Œæˆ‘ä»¬éœ€è¦ä»¥ä¸‹å‡ åˆ—:<code>full_name</code>ã€<code>email</code>ã€<code>email_status</code>ã€<code>email_proof_token</code>ã€<code>email_proof_token_expires_at</code>ã€<code>password</code>ã€<code>password_reset_token</code>å’Œ<code>password_reset_token_expires_at</code>ã€‚</p><div class="code-block code-block-54">
<hr/>
<h3>æ›´å¤šæ¥è‡ªLogRocketçš„ç²¾å½©æ–‡ç« :</h3>

<hr/></div>
<p>è®©æˆ‘ä»¬é€šè¿‡è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥åˆ›å»ºç”¨æˆ·æ¨¡å‹:</p>
<pre>sails generate model user</pre>
<p>Sailså°†åœ¨<code>models/User.js</code>ä¸­åˆ›å»ºä¸€ä¸ªåä¸º<code>User.js</code>çš„æ¨¡å‹æ–‡ä»¶ã€‚æ‰“å¼€è¯¥æ–‡ä»¶ï¼Œå¹¶åœ¨<code><a href="https://sailsjs.com/documentation/concepts/models-and-orm/attributes" target="_blank" rel="noopener noreferrer">attributes</a></code>å±æ€§ä¸­æ·»åŠ ä»¥ä¸‹ä»£ç :</p>
<pre>fullName: {
      type: 'string',
      required: true,
      columnName: 'full_name'
    },
    email: {
      type: 'string',
      required: true,
      unique: true,
    },
    emailStatus: {
      type: 'string',
      isIn: ['unconfirmed', 'confirmed'],
      defaultsTo: 'unconfirmed',
      columnName: 'email_status'
    },
    emailProofToken: {
      type: 'string',
      description: 'This will be used in the account verification email',
      columnName: 'email_proof_token'
    },
    emailProofTokenExpiresAt: {
      type: 'number',
      description: 'time in milliseconds representing when the emailProofToken will expire',
      columnName: 'email_proof_token_expires_at'
    },
    password: {
      type: 'string',
      required: true
    }
passwordResetToken: {
      type: 'string',
      description:
        'A unique token used to verify the user\'s identity when recovering a password.',
      columnName: 'password_reset_token',
    },
    passwordResetTokenExpiresAt: {
      type: 'number',
      description:
        'A timestamp representing the moment when this user\'s `passwordResetToken` will expire (or 0 if the user currently has no such token).',
      example: 1508944074211,
      columnName: 'password_reset_token_expires_at',
    },</pre>
<p>ä½¿ç”¨æ°´çº¿å±æ€§å®šä¹‰è§„èŒƒï¼Œæˆ‘ä»¬å®šä¹‰äº†è¡¨ç¤ºç”¨æˆ·è¡¨ä¸­åˆ—çš„æ¨¡å‹å±æ€§ã€‚</p>
<blockquote><p>å¦‚æœæ‚¨æ²¡æœ‰ç”¨<code>columnName</code>å±æ€§ä¸ºå®ƒä»¬æŒ‡å®šä¸€ä¸ªå€¼ï¼ŒSailså°†ä½¿ç”¨å±æ€§é”®ä½œä¸ºåˆ—å</p></blockquote>
<p>æŸ¥çœ‹å…³äºæ°´çº¿<a href="https://sailsjs.com/documentation/concepts/models-and-orm/attributes" target="_blank" rel="noopener noreferrer">å±æ€§</a>çš„æ–‡æ¡£ï¼Œäº†è§£æ›´å¤šå…³äºåœ¨Sailsä¸­è®¾ç½®æ¨¡å‹å±æ€§çš„ä¿¡æ¯ã€‚</p>
<p>åœ¨ç»“æŸä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦ä¸ºæˆ‘ä»¬çš„æ¨¡å‹æŒ‡å®šä¸€ä¸ªè¡¨åã€‚è¿™å°†å‘Šè¯‰Waterlineè¡¨æ ¼çš„åç§°ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å°†ä¿®æ”¹User.jså¹¶æ·»åŠ è¯¥å±æ€§:</p>
<pre>tableName: "users"</pre>
<p><code>User.js</code>ç°åœ¨åº”è¯¥æ˜¯è¿™æ ·çš„:</p>
<pre>/**
 * User.js
 *
 * @description :: A model definition represents a database table/collection.
 * @docs        :: https://sailsjs.com/docs/concepts/models-and-orm/models
 */
module.exports = {
  tableName: "users",
  attributes: {
    fullName: {
      type: 'string',
      required: true,
      columnName: 'full_name'
    },
    email: {
      type: 'string',
      required: true,
      unique: true,
    },
    emailStatus: {
      type: 'string',
      isIn: ['unconfirmed', 'confirmed'],
      defaultsTo: 'unconfirmed',
      columnName: 'email_status'
    },
    emailProofToken: {
      type: 'string',
      description: 'This will be used in the account verification email',
      columnName: 'email_proof_token'
    },
    emailProofTokenExpiresAt: {
      type: 'number',
      description: 'time in milliseconds representing when the emailProofToken will expire',
      columnName: 'email_proof_token_expires_at'
    },
    password: {
      type: 'string',
      required: true
    }
  },
};</pre>
<p>Sailså…è®¸æ‚¨åœ¨è¿”å›è®°å½•ä½œä¸ºå“åº”æ—¶å®šåˆ¶è¦è¿”å›çš„å­—æ®µã€‚å½“è¿”å›ç”¨æˆ·è®°å½•æ—¶ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨è¯¥åŠŸèƒ½åˆ é™¤å¯†ç å­—æ®µã€‚æˆ‘ä»¬æ¥è¡¥å……ä¸€ä¸‹ã€‚åœ¨<code>attributes:{}</code>ä¹‹åæ·»åŠ ä»¥ä¸‹å†…å®¹:</p>
<pre>customToJSON: function () {
    return _.omit(this, ["password"]);
  },</pre>
<p>æˆ‘ä»¬å‘Šè¯‰Sailsï¼Œå½“å°†User.jsæ¨¡å‹çš„å®ä¾‹è½¬æ¢ä¸ºJSONæ—¶ï¼Œåº”è¯¥æ€»æ˜¯å¿½ç•¥<code>password</code>å±æ€§ã€‚</p>
<p>æˆ‘ä»¬åœ¨<code>User.js</code>ä¸­è¦åšçš„æœ€åä¸€ä»¶äº‹æ˜¯åœ¨å­˜å‚¨å¯†ç ä¹‹å‰å¯¹å…¶è¿›è¡ŒåŠ å¯†ã€‚ä½ å¯ä»¥åœ¨æ§åˆ¶å™¨åŠ¨ä½œä¸­è¿™æ ·åšï¼Œä½†æ˜¯æˆ‘ä»¬å°†ä½¿ç”¨æ°´çº¿ç”Ÿå‘½å‘¨æœŸé’©å­ã€‚Waterlineåœ¨å…¶æ¨¡å‹ä¸Šæä¾›äº†ä¸€ä¸ª<code>beforeCreate</code>ç”Ÿå‘½å‘¨æœŸæŒ‚é’©ï¼Œå…è®¸æ‚¨åœ¨åˆ›å»ºä»»ä½•è®°å½•ä¹‹å‰æ‰§è¡Œä¸€äº›ä»»åŠ¡ã€‚</p>
<p>ä¸ºäº†åŠ å¯†æˆ‘ä»¬çš„å¯†ç ï¼Œæˆ‘ä»¬å°†å®‰è£…ä¸€ä¸ªåä¸º<a href="https://www.npmjs.com/package/sails-hook-organics" target="_blank" rel="noopener noreferrer"> sails-hooks-organics </a>çš„sailsæŒ‚é’©(æŒ‚é’©æ˜¯ç”¨äºæ‰©å±•sailsèƒ½åŠ›çš„Sailsæœºåˆ¶)ã€‚è¿™äº›é’©å­ä¸ºæ•£åˆ—å¯†ç ã€æ¯”è¾ƒå¯†ç å’Œåˆ›å»ºéšæœºå­—ç¬¦ä¸²(æˆ‘ä»¬çš„ä»¤ç‰Œå°†éœ€è¦è¿™äº›)æä¾›äº†å¸®åŠ©ã€‚è®©æˆ‘ä»¬å®‰è£…å®ƒ:</p>
<pre>npm install sails-hook-organics --save</pre>
<p>å®‰è£…å®Œæˆåï¼Œåœ¨<code>customToJSON</code>å±æ€§åæ·»åŠ ä»¥ä¸‹ä»£ç :</p>
<pre>// LIFE CYCLE
beforeCreate: async function (values, proceed) {
  // Hash password
  const hashedPassword = await sails.helpers.passwords.hashPassword(
    values.password
  );
  values.password = hashedPassword;
  return proceed();
},</pre>
<p>è®©æˆ‘ä»¬è¿ç§»æˆ‘ä»¬çš„æ•°æ®åº“å§ï¼æˆ‘ä»¬å¯ä»¥é€šè¿‡è¿è¡Œ<code>sails lift</code>æ¥é‡å¯Sailsã€‚ä½†æ˜¯ï¼ŒSailsä¼šæç¤ºæ‚¨è¾“å…¥ä¸€ä¸ªè¿ç§»ç­–ç•¥ï¼Œè¯¥ç­–ç•¥åº”è¯¥æ˜¯ä»¥ä¸‹ç­–ç•¥ä¹‹ä¸€:</p>
<ul>
<li>Alter(æ“¦é™¤/åˆ é™¤å¹¶å°è¯•é‡æ–°æ’å…¥æ‰€æœ‰æ•°æ®(æ¨è))ï¼Œ</li>
<li>Drop(æ¯æ¬¡æ‰¬å¸†æ—¶æ“¦é™¤/ä¸¢å¼ƒæˆ‘ä»¬æ‰€æœ‰çš„æ•°æ®)ï¼Œsafe(ä¸è¦è‡ªåŠ¨è¿ç§»æˆ‘ä»¬çš„æ•°æ®ï¼Œæˆ‘ä»¬ä¼šè‡ªå·±è¿ç§»)</li>
</ul>
<p>å½“æ‚¨çœ‹åˆ°æç¤ºæ—¶ï¼Œè¾“å…¥â€œalter â€,è¿™æ˜¯å¼€å‘æ—¶æ¨èçš„ã€‚</p>
<blockquote><p>ä¸“ä¸šæç¤º:ä¸ºäº†é¿å…æ¯æ¬¡æ‰¬å¸†æ—¶éƒ½å‡ºç°è¿™ä¸ªæç¤ºï¼Œæ‚¨åº”è¯¥åœ¨<code>config/models.js</code>ä¸­é€šè¿‡å–æ¶ˆæ³¨é‡Šè¯¥è¡Œæ¥æ˜¾å¼è®¾ç½®è¿ç§»ç­–ç•¥:</p></blockquote>
<pre>// migrate: 'alter',</pre>
<p>å¦å¤–ï¼Œå–æ¶ˆ<code>config/models.js</code>ä¸­çš„æ³¨é‡Š:</p>
<pre>// schema: true,</pre>
<p>æœ€åï¼Œå› ä¸ºæˆ‘ä»¬ä½¿ç”¨snake_caseä½œä¸ºåˆ—åï¼Œæ‰€ä»¥æˆ‘ä»¬å°†ä¿®æ”¹è‡ªåŠ¨åˆ›å»ºçš„å±æ€§ï¼Œ<code>config/models.js</code>ä¸­çš„<code>createdAt</code>å’Œ<code>updatedAt</code>ï¼Œä¸ºå®ƒä»¬æ·»åŠ <code>columnName</code>ã€‚å®ƒä»¬åº”è¯¥æ˜¯è¿™æ ·çš„:</p>
<pre>createdAt: { type: 'number', autoCreatedAt: true, columnName: 'created_at'},
updatedAt: { type: 'number', autoUpdatedAt: true, columnName: 'updated_at'},</pre>
<p>æœ€åï¼Œè¿è¡Œ<code>sails lift</code>è®©æ‚¨çš„æ›´æ”¹åœ¨æ•°æ®åº“ä¸­ç”Ÿæ•ˆã€‚</p>
<h2>è®¾ç½®æ³¨å†Œç«¯ç‚¹å’Œæ§åˆ¶å™¨</h2>
<p>ç°åœ¨æˆ‘ä»¬å·²ç»è®¾ç½®å¥½äº†ç”¨æˆ·æ¨¡å‹ï¼Œå¹¶ä¸ºæŸ¥è¯¢åšå¥½äº†å‡†å¤‡ï¼Œè®©æˆ‘ä»¬ä¸ºåˆ›å»ºæ–°ç”¨æˆ·åˆ›å»ºè·¯ç”±å’Œæ§åˆ¶å™¨(åŠ¨ä½œ)ã€‚æˆ‘ä»¬å°†ä»å®£å¸ƒ<code>routes.js</code>ä¸­çš„è·¯çº¿å¼€å§‹:</p>
<pre>'POST /user/register': 'user/register'</pre>
<p>è¿è¡Œä»¥ä¸‹å‘½ä»¤åˆ›å»ºæ³¨å†Œæ“ä½œ:</p>
<pre>sails generate action user/register</pre>
<p>æ‰“å¼€<code>user/register.js</code>åŠ¨ä½œæ–‡ä»¶ã€‚åœ¨Sailsä¸­ï¼Œå¦‚æœæ‚¨çš„æ“ä½œéœ€è¦ä»»ä½•æ•°æ®ï¼Œä¾‹å¦‚POSTè¯·æ±‚ï¼Œæ‚¨å¯ä»¥åœ¨æ“ä½œçš„è¾“å…¥å­—æ®µä¸­å®šä¹‰è¯¥æ•°æ®ã€‚è¯¥å®šä¹‰çš„è¯­æ³•ç±»ä¼¼äºæˆ‘ä»¬ä¹‹å‰åœ¨User.jsæ¨¡å‹ä¸­æ‰€åšçš„å±æ€§å®šä¹‰ã€‚å°†ä»¥ä¸‹ä»£ç æ·»åŠ åˆ°<code>inputs:{}</code>ä¸­ï¼Œä½¿å…¶çœ‹èµ·æ¥åƒè¿™æ ·:</p>
<pre>inputs: {
    fullName: {
      type: 'string',
      required: true,
    },
    email: {
      type: 'string',
      required: true,
      unique: true,
      isEmail: true,
    },
    password: {
      type: 'string',
      required: true,
      minLength: 6,
    },
  },
</pre>
<p>æ‚¨å¯ä»¥çœ‹åˆ°Sailså…è®¸æ‚¨é€šè¿‡è®¾ç½®ä¸€äº›éªŒè¯å±æ€§æ¥éªŒè¯è¡Œä¸­çš„æ¯ä¸ªè¾“å…¥ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†è®¾ç½®ä¸€äº›<code>exits</code>ï¼Œå®ƒä»¬æ˜¯ç«¯ç‚¹çš„å¯èƒ½ç»“æœã€‚å›æƒ³ä¸€ä¸‹ï¼ŒæˆåŠŸé€€å‡ºæ„å‘³ç€è¯·æ±‚æˆåŠŸï¼Œæˆ‘ä»¬çš„web APIå°†ä»¥200ä½œä¸ºå“åº”ã€‚ä½†æ˜¯ï¼Œæ‚¨å¯ä»¥è‡ªå®šä¹‰çŠ¶æ€ä»£ç ï¼Œå› ä¸ºè¿™å°†åˆ›å»ºä¸€ä¸ªæ–°è®°å½•ï¼Œæˆ‘ä»¬å¸Œæœ›è¿”å›201ã€‚æ­¤å¤–ï¼Œç”±äºç”µå­é‚®ä»¶æ˜¯ä¸€ä¸ªå”¯ä¸€çš„å­—æ®µï¼Œæˆ‘ä»¬å¸Œæœ›è®¾ç½®ä¸€ä¸ªç”¨æˆ·å·²ç»å­˜åœ¨çš„ç”µå­é‚®ä»¶æ—¶çš„å“åº”ã€‚æœ€åï¼Œæˆ‘ä»¬å°†æœ‰ä¸€ä¸ªé€šç”¨çš„é”™è¯¯å‡ºå£ï¼Œä½œä¸ºä»»ä½•å…¶ä»–ä¸å¯é¢„è§çš„é”™è¯¯çš„æ€»æ‹¬ã€‚å°†ä»¥ä¸‹ä»£ç æ·»åŠ åˆ°<code>exits:{}</code>ä¸­ï¼Œä½¿å…¶çœ‹èµ·æ¥åƒè¿™æ ·:</p>
<pre>success: {
     statusCode: 201,
     description: 'New muna user created',
   },
   emailAlreadyInUse: {
     statusCode: 400,
     description: 'Email address already in use',
   },
   error: {
     description: 'Something went wrong',
   },</pre>
<p>åœ¨ä½ å¯ä»¥ä½¿ç”¨<code>fn</code>å¼‚æ­¥å‡½æ•°ä¸­çš„<code>exits</code>ä¹‹å‰ï¼Œä¸€å®šè¦å°†<code>exit</code>ä½œä¸ºå‚æ•°ä¼ å…¥ï¼Œå¦åˆ™å®ƒå°†ä¸èµ·ä½œç”¨ã€‚</p>
<p>è®©æˆ‘ä»¬ç»§ç»­è®¨è®º<code>fn</code>å¼‚æ­¥å‡½æ•°ã€‚æˆ‘ä»¬å°†ä»å£°æ˜ä¸€ä¸ªtry-catchå—å¼€å§‹ã€‚åœ¨è¯¥å—ä¸­ï¼Œé¦–å…ˆç¡®ä¿ç”µå­é‚®ä»¶å…¨éƒ¨å°å†™:</p>
<pre>const newEmailAddress = inputs.email.toLowerCase();</pre>
<p>ç„¶åï¼Œæˆ‘ä»¬å°†ä¸ºæ­¤ç”¨æˆ·åˆ›å»ºä¸€ä¸ªä»¤ç‰Œï¼Œç”¨äºç”µå­é‚®ä»¶éªŒè¯:</p>
<pre>const token = await sails.helpers.strings.random('url-friendly');</pre>
<p>æ¥ä¸‹æ¥ä½¿ç”¨æ¨¡å‹æ–¹æ³•<code>create()</code>ã€‚åœ¨ç”¨æˆ·æ¨¡å‹ä¸Šï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªæ–°è®°å½•ï¼Œä½†åœ¨æ­¤ä¹‹å‰ï¼Œæˆ‘ä»¬å¿…é¡»åœ¨<code>config/custom.js</code>ä¸­æ·»åŠ ä»¤ç‰Œçš„åˆ°æœŸæ—¶é—´â€”â€”æ‚¨å¯ä»¥ä½¿ç”¨è¯¥æ–‡ä»¶æ¥å®šä¹‰æ‚¨å¸Œæœ›åœ¨å¼€å‘æœŸé—´èƒ½å¤Ÿåœ¨åº”ç”¨ç¨‹åºä¸­è®¿é—®çš„å€¼ã€‚æ‰€ä»¥å»<code>config/custom.js</code>åŠ ä¸Šè¿™ä¸ª:</p>
<pre>emailProofTokenTTL: 24 * 60 * 60 * 1000, // 24 hours</pre>
<p>ç„¶åå›åˆ°<code>user/register.js</code>ï¼Œæ‚¨ç°åœ¨å¯ä»¥åˆ›å»ºæ–°çš„ç”¨æˆ·è®°å½•:</p>
<pre>let newUser = await User.create({
        fullName: inputs.fullName,
        email: newEmailAddress,
        password: inputs.password,
        emailProofToken: token,
        emailProofTokenExpiresAt:
          Date.now() + sails.config.custom.emailProofTokenTTL,
      }).fetch();</pre>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦æ„å»ºç¡®è®¤é“¾æ¥ï¼Œè¯¥é“¾æ¥å°†è¢«å‘é€ç»™ç”¨æˆ·:</p>
<pre>const confirmLink = `${sails.config.custom.baseUrl}/user/confirm?token=${token}`;</pre>
<p>çœ‹åˆ°æˆ‘ä»¬æ²¡æœ‰åœ¨<code>config/custom.js</code>ä¸­å®šä¹‰<code>baseUrl</code>ï¼Œæˆ‘ä»¬çš„ä»£ç å°†ä¼šä¸­æ–­:</p>
<pre>baseUrl: 'http://localhost:1337'</pre>
<blockquote><p>æ³¨æ„:ç¡®è®¤ç«¯ç‚¹å°šä¸å­˜åœ¨</p></blockquote>
<p>æ¥ä¸‹æ¥è¦åšçš„æ˜¯è®¾ç½®å¹¶å‘é€æˆ‘ä»¬çš„ç”µå­é‚®ä»¶:</p>
<pre>const email = {
        to: newUser.email,
        subject: 'Confirm Your account',
        template: 'confirm',
        context: {
          name: newUser.fullName,
          confirmLink: confirmLink,
        },
      };
await sails.helpers.sendMail(email);</pre>
<p>æœ€åï¼Œæˆ‘ä»¬å°†å‘ç”¨æˆ·å‘é€ä¸€ä¸ªå“åº”ï¼Œè¡¨æ˜æˆ‘ä»¬å·²ç»å®Œæˆäº†æ–°ç”¨æˆ·çš„åˆ›å»º:</p>
<pre>return exits.success({
      message: `An account has been created for ${newUser.email} successfully. Check your email to verify`,
    });</pre>
<p>è®©æˆ‘ä»¬çœ‹çœ‹é”™è¯¯å¤„ç†ã€‚åœ¨catchå—ä¸­æ·»åŠ ä»¥ä¸‹ä»£ç ï¼Œé¦–å…ˆæ£€æŸ¥é”™è¯¯æ˜¯å¦æ˜¯ç”±äºå°è¯•ä½¿ç”¨ç°æœ‰ç”µå­é‚®ä»¶æ³¨å†Œè€Œå¯¼è‡´çš„:</p>
<pre>if (error.code === 'E_UNIQUE') {
        return exits.emailAlreadyInUse({
          message: 'Oops :) an error occurred',
          error: 'This email address already exits',
        });
}</pre>
<p>æœ€åï¼Œæˆ‘ä»¬å°†ä½¿ç”¨<code>exits.error</code>æ¥å“åº”æ‰€æœ‰å…¶ä»–é”™è¯¯:</p>
<pre>return exits.error({
      message: 'Oops :) an error occurred',
      error: error.message,
});</pre>
<h2>å‘é€ç”µå­é‚®ä»¶</h2>
<p>æˆ‘ä»¬è¿˜ä¸èƒ½æµ‹è¯•ä¸Šè¿°æ³¨å†Œï¼Œå› ä¸ºæˆ‘ä»¬è¿˜æ²¡æœ‰ä¸ºæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºè®¾ç½®å‘é€ç”µå­é‚®ä»¶ã€‚å°±è¿™ä¹ˆåŠå§ã€‚</p>
<p>æˆ‘ä»¬å°†ä½¿ç”¨<code>nodemailer</code>æ¥å¢å¼ºæˆ‘ä»¬çš„ç”µå­é‚®ä»¶å‘é€æµç¨‹ã€‚æˆ‘ä»¬è¿˜å°†ä½¿ç”¨SendGridä½œä¸º<code>nodemail</code>ä¼ è¾“ã€‚ä¸ºäº†åˆ›å»ºæˆ‘ä»¬çš„ç”µå­é‚®ä»¶ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨<code>nodemailer</code>çš„handlebaræ’ä»¶å°†<code>.hbs</code>æ¨¡æ¿æ–‡ä»¶ç¼–è¯‘æˆç”µå­é‚®ä»¶ã€‚è®©æˆ‘ä»¬ä»å®‰è£…è¿™äº›åŒ…å¼€å§‹:</p>
<pre>npm install nodemailer nodemailer-express-handlebars nodemailer-sendgrid --save</pre>
<p>å®‰è£…åï¼Œæˆ‘ä»¬å°†ç”Ÿæˆä¸€ä¸ªå‘é€ç½‘æ ¼APIå¯†é’¥ï¼Œè¿™æ˜¯å‘é€è¿™äº›ç”µå­é‚®ä»¶æ‰€å¿…éœ€çš„ã€‚æˆ‘ä»¬å°†åœ¨<code>config/local.js</code>ä¸­æ·»åŠ è¿™ä¸ªAPIé”®ã€‚</p>
<blockquote><p>local.jså°†åªåœ¨å¼€å‘ä¸­å¯ç”¨ï¼Œå› æ­¤å¦‚æœå®ƒä¸å­˜åœ¨ï¼Œæ‚¨å°†éœ€è¦åˆ›å»º<code>local.js</code>å¹¶æä¾›æ‚¨çš„SendGrid APIå¯†é’¥ï¼Œä»¥ä¾¿åœ¨æœ¬åœ°æµ‹è¯•è¯¥åº”ç”¨ç¨‹åº</p></blockquote>
<h3>å‘é€é‚®ä»¶åŠ©æ‰‹</h3>
<p>è¯·æ³¨æ„ï¼Œæˆ‘ä»¬æ­£åœ¨å‘¼å«:</p>
<pre>await sails.helpers.sendMail(email);</pre>
<p>æˆ‘ä»¬è¿˜æ²¡æœ‰åˆ›å»ºè¿™ä¸ªåŠ©æ‰‹ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬å°†è¿è¡Œ:</p>
<pre>sails generate helper send-mail</pre>
<p>è¿™å°†åœ¨<code>helpers/</code>ç›®å½•ä¸­åˆ›å»º<code>send-mail.js</code>ã€‚å°†å†…å®¹æ›¿æ¢ä¸º:</p>
<pre>const nodemailer = require("nodemailer");
var nodemailerSendgrid = require("nodemailer-sendgrid");
const hbs = require("nodemailer-express-handlebars");
module.exports = {
  friendlyName: "Send mail",
  description: "",
  inputs: {
    options: {
      type: "ref",
      required: true,
    },
  },
  exits: {
    success: {
      description: "All done.",
    },
  },
  fn: async function (inputs) {
    const transporter = nodemailer.createTransport(
      nodemailerSendgrid({
        apiKey: sails.config.sendGridAPIkey || process.env.SENDGRID_API_KEY,
      })
    );
    transporter.use(
      "compile",
      hbs({
        viewEngine: {
          extName: ".hbs",
          partialsDir: "./views",
          layoutsDir: "./views",
          defaultLayout: "",
        },
        viewPath: "./views/",
        extName: ".hbs",
      })
    );
    try {
      let emailOptions = {
        from: "LogrocketSailsAPI &lt;<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="fa9b969f888eba96959d889599919f8e899b9396899b8a93d4999597">[emailÂ protected]</a>&gt;",
        ...inputs.options,
      };
      await transporter.sendMail(emailOptions);
    } catch (error) {
      sails.log(error);
    }
  },
};</pre>
<p>è¿™ä¸ªåŠ©æ‰‹å°†<code>option</code>ä½œä¸ºå”¯ä¸€çš„å‚æ•°ï¼Œå®ƒå°†æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼ŒåŒ…å«ä¸å‘é€ç”µå­é‚®ä»¶ç›¸å…³çš„ä¿¡æ¯ï¼Œå¦‚ä¸»é¢˜ã€æ¨¡æ¿æ–‡ä»¶ç­‰ã€‚åœ¨<code>transporter.use</code>æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬å‘Šè¯‰<code>nodemailer</code>åœ¨è§†å›¾ç›®å½•ä¸­å¯»æ‰¾<code>.hbs</code>æ–‡ä»¶ï¼Œä»¥ç¡®ä¿è¿™ä¸ªç›®å½•è¢«åˆ›å»ºã€‚</p>
<p>æœ€åï¼Œæˆ‘ä»¬å°†åˆ›å»ºç¡®è®¤ç”µå­é‚®ä»¶æ¨¡æ¿<code>.hbs</code>æ–‡ä»¶ã€‚ç„¶åæ·»åŠ ä»¥ä¸‹æ¨¡æ¿:</p>
<pre>&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8" /&gt;
    &lt;meta name="viewport" content="width=device-width, initial-scale=1.0" /&gt;
    &lt;title&gt;Document&lt;/title&gt;
    &lt;style&gt;
        body {
            padding: 10px 20px;
            font-family: Arial, Helvetica, sans-serif;
        }
        .cta {
            text-decoration: none;
            background-color: rgb(76, 119, 175);
            color: #fff !important;
            font-weight: bold;
            padding: 10px 20px;
            border-radius: 5px;
            margin: 0 auto;
        }
        footer {
            margin-top: 2rem;
        }
        p {
            margin: 30px 0;
        }
    &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;section class="hero"&gt;
        &lt;h1 class="title"&gt;Welcome, {{ name }}&lt;/h1&gt;
    &lt;/section&gt;
    &lt;main&gt;
        &lt;p&gt;Please confirm your account by clicking the button below:&lt;/p&gt;
        &lt;a class="cta" href="{{confirmLink}}" target="_blank"&gt;Confirm email&lt;/a&gt;
        &lt;p&gt;Once confirmed, you'll be able to log in.&lt;/p&gt;
    &lt;/main&gt;
    &lt;footer&gt;
        &lt;p&gt;ğŸ–¤ Love,&lt;/p&gt;
    &lt;/footer&gt;
&lt;/body&gt;
&lt;/html&gt;</pre>
<p>è¯·æ³¨æ„ï¼Œæˆ‘ä»¬ä½¿ç”¨æŠŠæ‰‹æ’å€¼æ¥ä½¿ç”¨æˆ·å¯ä»¥ä½¿ç”¨<code>name</code>å’Œ<code>confirmLink</code>ï¼Œè¿™æ˜¯æˆ‘ä»¬åœ¨è°ƒç”¨<code>sendMail</code>æ—¶ä½œä¸ºç”µå­é‚®ä»¶é€‰é¡¹çš„ä¸€éƒ¨åˆ†ä¼ é€’çš„ã€‚</p>
<p>å…¨éƒ¨å®Œæˆï¼æ‰€ä»¥ç°åœ¨æˆ‘ä»¬å·²ç»å®Œæˆäº†æ³¨å†Œè¿‡ç¨‹ã€‚è¿è¡Œ<code>sails lift</code>å¹¶æ‰“å¼€Postmanæ¥æµ‹è¯•è¿™ä¸ªç«¯ç‚¹ã€‚è¾“å…¥ä¸€ä¸ªæœ‰æ•ˆçš„ç”µå­é‚®ä»¶ï¼Œä½ åº”è¯¥æ³¨å†Œï¼Œä¸€å°ç”µå­é‚®ä»¶åº”è¯¥ä¼šå‘é€ç»™ä½ ã€‚</p>
<p><img data-attachment-id="25933" data-permalink="https://blog.logrocket.com/building-a-node-js-web-api-with-sails-js/sailsliftinpostman/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/09/sailsliftinpostman.png" data-orig-size="730,411" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="sailsliftinpostman" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/09/sailsliftinpostman-300x169.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/09/sailsliftinpostman.png" decoding="async" class="aligncenter size-full wp-image-25933 jetpack-lazy-image" src="../Images/72f75ad1e97a62a44f9207b9c936441e.png" alt="sails lift with postman with a success message" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/09/sailsliftinpostman.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/09/sailsliftinpostman-300x169.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/09/sailsliftinpostman.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/09/sailsliftinpostman.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="25933" data-permalink="https://blog.logrocket.com/building-a-node-js-web-api-with-sails-js/sailsliftinpostman/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/09/sailsliftinpostman.png" data-orig-size="730,411" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="sailsliftinpostman" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/09/sailsliftinpostman-300x169.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/09/sailsliftinpostman.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-25933" src="../Images/72f75ad1e97a62a44f9207b9c936441e.png" alt="sails lift with postman with a success message" srcset="https://blog.logrocket.com/wp-content/uploads/2020/09/sailsliftinpostman.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/09/sailsliftinpostman-300x169.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/09/sailsliftinpostman.png"/></noscript>
<p>ç”µå­é‚®ä»¶ç¡®è®¤</p>
<h2>æ‰“å¼€<code>routes.js</code>å¹¶å°†ä»¥ä¸‹æ¡ç›®æ·»åŠ åˆ°è·¯çº¿å­—å…¸ä¸­:</h2>
<p><code>GET /user/confirm': 'user/confirm</code></p>
<p>ç„¶åè¿è¡Œ<code>sails generate action user/confirm</code>æ¥æ”¯æŒç¡®è®¤åŠ¨ä½œã€‚</p>
<p>æˆ‘ä»¬å¸Œæœ›è¿™ä¸ªè·¯ç”±æ¥å—ä¸€ä¸ªåä¸º<code>token</code>çš„æŸ¥è¯¢å‚æ•°ï¼Œå®ƒæ˜¯ç”µå­é‚®ä»¶çš„ç¡®è®¤æ ‡è®°ã€‚æ‰€ä»¥æˆ‘ä»¬å°†å‘<code>inputs:{}</code>æ·»åŠ ä¸€ä¸ªå•ç‹¬çš„è¾“å…¥ã€‚è®©æˆ‘ä»¬è¡¥å……ä¸€ä¸‹:</p>
<p>æˆ‘ä»¬è¿˜å°†æ·»åŠ ä¸¤ä¸ªå‡ºå£:</p>
<pre>token: {
    type: 'string',
    description: "The confirmation token from the email.",
    example: "4-32fad81jdaf$329",
  },</pre>
<p>åœ¨<code>fn</code>å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬å°†é¦–å…ˆæ£€æŸ¥è¯·æ±‚æ˜¯å¦ä¸åŒ…å«ä»¤ç‰Œå‚æ•°:</p>
<pre>success: {
      description: "Email address confirmed and requesting user logged in.",
    },
  invalidOrExpiredToken: {
    statusCode: 400,
    description:
      "The provided token is expired, invalid, or already used up.",
  },</pre>
<p>ä¹‹åï¼Œæˆ‘ä»¬å°†ä»æ•°æ®åº“ä¸­è·å–è·å¾—ä»¤ç‰Œçš„ç”¨æˆ·:</p>
<pre>if (!inputs.token) {
      return exits.invalidOrExpiredToken({
        error: "The provided token is expired, invalid, or already used up.",
      });
    }</pre>
<p>ç„¶åï¼Œæˆ‘ä»¬å°†æ£€æŸ¥æ˜¯å¦æ²¡æœ‰è¿™æ ·çš„ç”¨æˆ·ï¼Œæˆ–è€…ä»¤ç‰Œæ˜¯å¦å·²ç»è¿‡æœŸ:</p>
<pre>var user = await User.findOne({ emailProofToken: inputs.token });</pre>
<p>æœ€åï¼Œæˆ‘ä»¬å°†æ£€æŸ¥ç”¨æˆ·æ˜¯å¦æœ‰ä¸€ä¸ª<code>unconfirmed</code>çš„<code>emailStatus</code>ï¼Œå¹¶ç»§ç»­å°†å®ƒæ›´æ–°åˆ°<code>confirmed</code>ï¼Œå¹¶å‘è°ƒç”¨è€…å‘å›ä¸€ä¸ªå“åº”:</p>
<pre>if (!user || user.emailProofTokenExpiresAt &lt;= Date.now()) {
     return exits.invalidOrExpiredToken({
       error: "The provided token is expired, invalid, or already used up.",
     });
   }</pre>
<p>ä¸ºäº†æµ‹è¯•è¿™ä¸€ç‚¹ï¼Œè¿è¡Œ<code>sails lift</code>ï¼Œç„¶ååœ¨Postmanä¸­åˆ›å»ºä¸€ä¸ªæ–°ç”¨æˆ·ï¼Œä½¿ç”¨æ‚¨å¯ä»¥è®¿é—®çš„æœ‰æ•ˆç”µå­é‚®ä»¶åœ°å€ã€‚ç„¶åæ£€æŸ¥ç¡®è®¤ç”µå­é‚®ä»¶ï¼Œå¹¶ç‚¹å‡»ç¡®è®¤ç”µå­é‚®ä»¶æŒ‰é’®ã€‚</p>
<pre>if (user.emailStatus === "unconfirmed") {
      await User.updateOne({ id: user.id }).set({
      emailStatus: "confirmed",
      emailProofToken: "",
      emailProofTokenExpiresAt: 0,
  });
  return exits.success({
    message: "Your account has been confirmed",
  });
}</pre>
<p><img decoding="async" class="aligncenter size-full wp-image-27094 jetpack-lazy-image" src="../Images/e351a91f01ab3c22e689768fd68eeba7.png" alt="Email Confirmation Message" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/10/emailconfirmationmessage.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/10/emailconfirmationmessage.png"/></p>
<p>å¦‚æœä¸€åˆ‡é¡ºåˆ©ï¼Œåº”è¯¥ä¼šæ˜¾ç¤ºæ¶ˆæ¯<code>Your account has been confirmed</code>ã€‚</p><noscript><img data-lazy-fallback="1" decoding="async" loading="lazy" class="aligncenter size-full wp-image-27094" src="../Images/e351a91f01ab3c22e689768fd68eeba7.png" alt="Email Confirmation Message" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/10/emailconfirmationmessage.png"/></noscript>
<p><img decoding="async" class="aligncenter size-full wp-image-27095 jetpack-lazy-image" src="../Images/874567c8bf6139148744727ef28efac6.png" alt="words &quot;your account has been confirmed&quot; on blank screen" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/10/youraccounthasbeenconfirmed.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/10/youraccounthasbeenconfirmed.png"/></p>
<p>æˆ‘ä»¬çš„ç”¨æˆ·ç°åœ¨å¯ä»¥åˆ›å»ºå¸æˆ·å¹¶ç¡®è®¤ä»–ä»¬çš„å¯†ç ï¼Œä½†ä»–ä»¬è¿˜ä¸èƒ½ç™»å½•ã€‚è®©æˆ‘ä»¬è§£å†³è¿™ä¸ªé—®é¢˜ï¼</p><noscript><img data-lazy-fallback="1" decoding="async" loading="lazy" class="aligncenter size-full wp-image-27095" src="../Images/874567c8bf6139148744727ef28efac6.png" alt="words &quot;your account has been confirmed&quot; on blank screen" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/10/youraccounthasbeenconfirmed.png"/></noscript>
<p>ç™»å½•åŠŸèƒ½</p>
<h2>ä¸ºäº†å®ç°ç™»å½•ç‰¹æ€§ï¼Œæˆ‘ä»¬å°†åœ¨<code>routes.js</code>ä¸­å£°æ˜ä»¥ä¸‹è·¯ç”±:</h2>
<p>ç„¶åï¼Œæˆ‘ä»¬å°†é€šè¿‡åœ¨ç»ˆç«¯ä¸­è¿è¡Œ<code>sails generate action user/login</code>æ¥åˆ›å»º<code>login</code>åŠ¨ä½œã€‚</p>
<pre>POST /user/login': 'user/login</pre>
<p>ä¸ºäº†è®©ç”¨æˆ·èƒ½å¤Ÿç™»å½•ï¼Œæˆ‘ä»¬å¸Œæœ›æ»¡è¶³ä»¥ä¸‹æ¡ä»¶:</p>
<p>ç”µå­é‚®ä»¶åœ°å€å¿…é¡»å·²ç»æ³¨å†Œ</p>
<ol>
<li>ç”µå­é‚®ä»¶åœ°å€å¿…é¡»å·²ç»ç¡®è®¤</li>
<li>ä¸ºäº†åŠ å¼ºè¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬å°†åœ¨<code>policies/</code>ç›®å½•ä¸­ç¼–å†™ä¸€ä¸ªåä¸º<code>can-login.js</code>çš„ç­–ç•¥ã€‚ä»¥ä¸‹æ˜¯è¿™é¡¹æ”¿ç­–çš„å†…å®¹:</li>
</ol>
<p>è¿™é‡Œï¼Œæˆ‘ä»¬åœ¨ç”¨æˆ·æ¨¡å‹ä¸Šä½¿ç”¨Waterlineæä¾›çš„<code>findOne</code>æ–¹æ³•æ¥è·å–<code>login</code>è¯·æ±‚ä¸­æä¾›çš„ç”µå­é‚®ä»¶ã€‚å¦‚æœæ²¡æœ‰æ‰¾åˆ°è®°å½•ï¼Œæˆ‘ä»¬å°†å‘è°ƒç”¨è€…è¿”å›ä¸€ä¸ª404æ¶ˆæ¯ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ£€æŸ¥<code>emailStatus</code>æ˜¯å¦æ˜¯<code>unconfirmed</code>ï¼Œå¦‚æœæ˜¯ï¼Œé‚£ä¹ˆç”¨æˆ·è¿˜æ²¡æœ‰ç¡®è®¤ä»–/å¥¹çš„å¸æˆ·ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿”å›401(æœªæˆæƒ)ã€‚æœ€åï¼Œå¦‚æœå‰é¢çš„æ¡ä»¶éƒ½ä¸æˆç«‹ï¼Œæˆ‘ä»¬å…è®¸è¯·æ±‚é€šè¿‡<code>return proceed()</code>å›è°ƒã€‚</p>
<pre>module.exports = async function (req, res, proceed) {
  const { email } = req.allParams();
  try {
    const user = await User.findOne({ email: email });
    if (!user) {
      res.status(404).json({
        error: `${email} does not belong to a user`,
      });
    } else if (user.emailStatus === 'unconfirmed') {
      res.status(401).json({
        error: 'This account has not been confirmed. Click on the link in the email sent to you to confirm.',
      });
    } else {
      return proceed();
    }
  } catch (error) {
    res.status(401).json({ error: error.message });
  }
};</pre>
<p>åˆ¶å®šæ”¿ç­–</p>
<h2>ç¼–å†™ç­–ç•¥åªæ˜¯å‘æ“ä½œæ·»åŠ é˜²æŠ¤çš„è¿‡ç¨‹çš„ä¸€éƒ¨åˆ†ã€‚å¦ä¸€éƒ¨åˆ†æ˜¯å°†ç­–ç•¥æ˜ å°„åˆ°<code>config/policies.js</code>æ–‡ä»¶ä¸­çš„æ“ä½œã€‚ä¸ºæ­¤ï¼Œåªéœ€å°†ä»¥ä¸‹ä»£ç ç‰‡æ®µä½œä¸ºæ¡ç›®æ·»åŠ åˆ°æ–‡ä»¶ä¸­çš„å¯¹è±¡:</h2>
<p>ç°åœ¨å……å®ä¸€ä¸‹<code>user/login.js</code>åŠ¨ä½œã€‚é¦–å…ˆï¼Œæˆ‘ä»¬å°†è¾“å…¥æ·»åŠ åˆ°<code>inputs: {}</code>å¯¹è±¡:</p>
<pre>"user/login": 'can-login'</pre>
<p>æˆ‘ä»¬è¿˜å°†æ·»åŠ ä»¥ä¸‹å‡ºå£:</p>
<pre>email: {
    type: "string",
    required: true,
  },
password: {
  type: "string",
  required: true,
},</pre>
<p>ç„¶ååœ¨<code>fn</code>å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬å°†ä»ä¸€ä¸ª<code>try/catch</code>å—å¼€å§‹ã€‚åœ¨<code>try</code>å—ä¸­ï¼Œæˆ‘ä»¬å°†å°è¯•ä½¿ç”¨æä¾›çš„ç”µå­é‚®ä»¶æ‰¾åˆ°ç”¨æˆ·:</p>
<pre>success: {
      description: "Login successful",
    },
  notAUser: {
    statusCode: 404,
    description: "User not found",
  },
  passwordMismatch: {
    statusCode: 401,
    description: "Password do not match",
  },
  operationalError: {
    statusCode: 400,
    description: 'The request was formed properly'
}</pre>
<p>æˆ‘ä»¬å°†æ£€æŸ¥æ˜¯å¦æ²¡æœ‰æ‰¾åˆ°ç”¨æˆ·ï¼Œç„¶åä½¿ç”¨<code>notAUser</code>é€€å‡º:</p>
<pre>const user = await User.findOne({ email: inputs.email });</pre>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ç¬¬ä¸€éƒ¨åˆ†ä¸­å®‰è£…çš„<code>sails-hook-organics</code>æŒ‚é’©æä¾›çš„<code>checkPassword</code>æ–¹æ³•æ¥æ£€æŸ¥å¯†ç :</p>
<pre>if (!user) {
   return exits.notAUser({
     error: `An account belonging to ${inputs.email} was not found`,
   });
}</pre>
<p>ç„¶åæˆ‘ä»¬å°†ç”Ÿæˆä¸€ä¸ªæ–°çš„JWTä»¤ç‰Œ(æˆ‘ä»¬è¿˜æ²¡æœ‰å®ç°è¿™ä¸€ç‚¹):</p>
<pre>await sails.helpers.passwords
    .checkPassword(inputs.password, user.password)
    .intercept('incorrect', (error) =&gt; {
      exits.passwordMismatch({ error: error.message });
});</pre>
<p>ç„¶åï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ç”¨æˆ·è®°å½•åœ¨<code>req</code>æµ/å¯¹è±¡ä¸Šè®¾ç½®ä¸€ä¸ª<code>me</code>å¯¹è±¡:</p>
<pre>const token = await sails.helpers.generateNewJwtToken(user.email);</pre>
<p>æœ€åï¼Œæˆ‘ä»¬å°†è¿”å›æˆåŠŸé€€å‡ºï¼Œæä¾›ä¸€æ¡æ¶ˆæ¯ã€ä½œä¸ºæ•°æ®çš„ç”¨æˆ·å±æ€§å’ŒJWTä»¤ç‰Œ:</p>
<pre>this.req.me = user;</pre>
<p>åœ¨<code>catch</code>å—ä¸­ï¼Œæˆ‘ä»¬å°†é¦–å…ˆä½¿ç”¨Sailså†…ç½®è®°å½•å™¨è®°å½•ä»»ä½•é”™è¯¯:</p>
<pre>return exits.success({
      message: `${user.email} has been logged in`,
      data: user,
      token,
});</pre>
<p>ç„¶åæˆ‘ä»¬å°†æ£€æŸ¥è¯¥é”™è¯¯æ˜¯å¦æ˜¯æ“ä½œé”™è¯¯ã€‚å¦‚æœæ˜¯ï¼Œæˆ‘ä»¬å°†å‘ç”¨æˆ·è¿”å›ä¸€ä¸ªå¸¦æœ‰<code>raw</code>æ¶ˆæ¯çš„JSON:</p>
<pre>sails.log.error(error);</pre>
<p>å¯¹äºå…¶ä»–æˆ‘ä»¬ä¸çŸ¥é“çš„é”™è¯¯ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨<code>error</code>å‡ºå£è¿”å›ä¸€ä¸ª<code>500</code>:</p>
<pre>if (error.isOperational) {
  return exits.operationalError({
    message: `Error logging in user ${inputs.email}`,
    error: error.raw,
  });
}</pre>
<p>æˆ‘ä»¬ä¸èƒ½å®Œå…¨æµ‹è¯•ç™»å½•ç‰¹æ€§ï¼Œå› ä¸ºæˆ‘ä»¬è¿˜æ²¡æœ‰åˆ›å»º<code>generateNewJwtToken</code>åŠ©æ‰‹ã€‚</p>
<pre>return exits.error({
       message: `Error logging in user ${inputs.email}`,
       error: error.message,
 });</pre>
<p>ç”¨äºè®¤è¯çš„JWT</p>
<h2>æˆ‘ä»¬å°†é€šè¿‡è¿è¡Œä»¥ä¸‹å‘½ä»¤å°†<code>jsonwebtoken</code>åŒ…ä½œä¸ºä¾èµ–é¡¹å®‰è£…:</h2>
<p>ç„¶åæˆ‘ä»¬å°†åˆ›å»º<code>generateNewJwtToken</code>åŠ©æ‰‹:</p>
<pre>npm install jsonwebtoken --save</pre>
<p>æ‰“å¼€æ–‡ä»¶ï¼Œè¦æ±‚é¡¶éƒ¨çš„<code>jsonwebtoken</code>åŒ…:</p>
<pre>sails generate helper generate-new-jwt-token</pre>
<p>è¿™ä¸ªåŠ©æ‰‹å°†æ¥å—ä¸€ä¸ªå‚æ•°ï¼Œå³ç”¨æˆ·çš„ç”µå­é‚®ä»¶(æˆ‘ä»¬ä½¿ç”¨ç”µå­é‚®ä»¶ä½œä¸ºå”¯ä¸€æ ‡è¯†ç¬¦æ¥åˆ›å»ºJWTä»¤ç‰Œ)ã€‚å› æ­¤ï¼Œæˆ‘ä»¬åœ¨è¾“å…¥å­—æ®µä¸­æ·»åŠ :</p>
<pre>const jwt = require("jsonwebtoken");</pre>
<p>ç°åœ¨è®©æˆ‘ä»¬çœ‹çœ‹åŠ©æ‰‹çš„èº«ä½“ã€‚æˆ‘ä»¬å°†ä»åˆ›å»ºJWTå‘å¸ƒä»¤ç‰Œæ‰€éœ€çš„æœ‰æ•ˆè´Ÿè½½å¯¹è±¡å¼€å§‹:</p>
<pre>subject: {
    type: "string",
    required: true
}</pre>
<p>ç„¶åï¼Œæˆ‘ä»¬å°†åœ¨<code>config/local.js</code>ä¸­æ·»åŠ ä¸€ä¸ªåä¸º<code>jwtSecret</code>çš„æ¡ç›®ï¼Œå®ƒåº”è¯¥æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚</p>
<pre>const payload = {
     sub: inputs.subject, // subject
     iss: "LogRocket Sails API" // issuer
};</pre>
<p>æˆ‘ä»¬æ²¡æœ‰å°†ç§˜å¯†ç›´æ¥å­˜å‚¨åœ¨ä»£ç ä¸­ï¼Œå› ä¸ºè¿™ä¸åˆ©äºå®‰å…¨æ€§ã€‚</p>
<blockquote><p>ç”±äº<code>config/local.js</code>åœ¨æˆ‘ä»¬ç”Ÿäº§æ—¶ä¸å¯ç”¨ï¼Œæˆ‘ä»¬å°†åœ¨æˆ‘ä»¬çš„æœåŠ¡å™¨ç¯å¢ƒä¸­æ·»åŠ ä¸€ä¸ªåä¸º<code>JWT_SECRET</code>çš„ç¯å¢ƒå˜é‡ã€‚å› æ­¤ï¼Œå°†ä¸‹é¢ä¸€è¡Œæ·»åŠ åˆ°åŠ©æ‰‹ä¸­:</p></blockquote>
<p>ä¸Šé¢çš„ä»£ç åªæ˜¯åœ¨å¼€å‘æ—¶è¯•å›¾ä»<code>config/local.js</code>è·å–ç§˜å¯†ï¼Œè€Œåœ¨éå¼€å‘(å³ç”Ÿäº§)æ—¶ä»ç¯å¢ƒå˜é‡<code>JWT_SECRET</code>è·å–å€¼ã€‚</p>
<pre>const secret = sails.config.jwtSecret || process.env.JWT_SECRET;</pre>
<p>æœ€åï¼Œæˆ‘ä»¬å°†åˆ›å»ºä»¤ç‰Œï¼Œå¹¶å°†å…¶è®¾ç½®ä¸º24å°æ—¶ååˆ°æœŸ:</p>
<p>æœ€åï¼Œæˆ‘ä»¬å°†ä»¤ç‰Œè¿”å›ç»™è°ƒç”¨è€…:</p>
<pre>const token = jwt.sign(payload, secret, { expiresIn: "1d" });</pre>
<p>æµ‹è¯•æˆ‘ä»¬çš„web API</p>
<pre>return token;</pre>
<h2>è®©æˆ‘ä»¬ä½¿ç”¨å·²ç»åˆ›å»ºçš„ç”¨æˆ·å¸æˆ·æ¥æµ‹è¯•Postmanä¸­çš„ç™»å½•ç‰¹æ€§ã€‚å‘ç«¯ç‚¹æä¾›ç”µå­é‚®ä»¶å’Œå¯†ç ï¼Œæ‚¨åº”è¯¥ä¼šä»APIå¾—åˆ°ç±»ä¼¼äºä¸‹é¢æˆªå›¾ä¸­çš„å“åº”:</h2>
<p><img data-attachment-id="27121" data-permalink="https://blog.logrocket.com/building-a-node-js-web-api-with-sails-js/postman-nocdn/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/10/postman-nocdn.png" data-orig-size="730,411" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="postman-nocdn" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/10/postman-nocdn-300x169.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/10/postman-nocdn.png" decoding="async" class="aligncenter size-full wp-image-27121 jetpack-lazy-image" src="../Images/79decc5fedb10267d6de0889a78332b5.png" alt="Postman message with data" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/10/postman-nocdn.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/10/postman-nocdn-300x169.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/10/postman-nocdn.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/10/postman-nocdn.png"/></p>
<p>å¿˜è®°å¯†ç </p><noscript><img data-lazy-fallback="1" data-attachment-id="27121" data-permalink="https://blog.logrocket.com/building-a-node-js-web-api-with-sails-js/postman-nocdn/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/10/postman-nocdn.png" data-orig-size="730,411" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="postman-nocdn" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/10/postman-nocdn-300x169.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/10/postman-nocdn.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-27121" src="../Images/79decc5fedb10267d6de0889a78332b5.png" alt="Postman message with data" srcset="https://blog.logrocket.com/wp-content/uploads/2020/10/postman-nocdn.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/10/postman-nocdn-300x169.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/10/postman-nocdn.png"/></noscript>
<h2>è¿™é‡Œæœ‰ä¸€ä¸ªåœºæ™¯ï¼Œä¸€ä¸ªç”¨æˆ·å›åˆ°ä¸€ä¸ªä½¿ç”¨æˆ‘ä»¬çš„APIçš„å®¢æˆ·ç«¯ï¼Œå´æƒ³ä¸èµ·ä»–ä»¬çš„å¸æˆ·å¯†ç ã€‚è®©æˆ‘ä»¬ç¡®ä¿æˆ‘ä»¬èƒ½å¸®ä¸Šå¿™ã€‚ä¸ºäº†å®ç°å¿˜è®°å¯†ç åŠŸèƒ½ï¼Œæˆ‘ä»¬å°†ä»<code>routes.js</code>ä¸­çš„è·¯ç”±å£°æ˜å¼€å§‹:</h2>
<p>è®©æˆ‘ä»¬ä¹Ÿåˆ›å»ºåŠ¨ä½œæ–‡ä»¶:</p>
<pre>'POST /user/forgot-password': 'user/forgot-password'</pre>
<p>æˆ‘ä»¬å¸Œæœ›åªæœ‰é‚£äº›å¯ä»¥ç™»å½•çš„äººæ‰èƒ½ä¿æŠ¤è¿™ä¸ªç«¯ç‚¹ã€‚æˆ‘ä»¬å·²ç»å®ç°äº†ä¸€ä¸ªåä¸º<code>can-login</code>çš„ç­–ç•¥ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥é‡ç”¨å®ƒã€‚åœ¨<code>config/policies.js</code>ä¸­æ·»åŠ ä»¥ä¸‹æ¡ç›®:</p>
<pre>sails generate action user/forgot-password</pre>
<p>æˆ‘ä»¬å¸Œæœ›<code>forgot-password</code>çš„å·¥ä½œæ–¹å¼æ˜¯ï¼Œå°†å£°ç§°å¿˜è®°å¯†ç çš„ç”¨æˆ·çš„ç”µå­é‚®ä»¶å‘é€åˆ°ç«¯ç‚¹ï¼Œæˆ‘ä»¬å°†å‘ç”¨æˆ·çš„æ”¶ä»¶ç®±å‘é€æ¢å¤é“¾æ¥ã€‚é¦–å…ˆï¼Œè®©æˆ‘ä»¬å£°æ˜ç”µå­é‚®ä»¶è¾“å…¥:</p>
<pre>'user/forgot-password': 'can-login'</pre>
<p>æˆ‘ä»¬æ·»åŠ <code>success</code>é€€å‡º:</p>
<pre>email: {
        description:
          "The email address of the user who wants to recover their password.",
        example: "<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="1c7d707e696f5c7869717e707978736e79327f7371">[emailÂ protected]</a>",
        type: "string",
        required: true,
    },</pre>
<p>å¯¹äº<code>fn</code>,æˆ‘ä»¬é¦–å…ˆå°è¯•è®©ç”¨æˆ·åŒ¹é…è¯¥ç”µå­é‚®ä»¶åœ°å€ï¼Œå¦‚æœä¸åŒ¹é…ï¼Œæˆ‘ä»¬å°±ä¸ç»§ç»­:</p>
<pre>success: {
     description:
       "Email matched a user and a recovery email might have been sent",
 },</pre>
<p>ç„¶åï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå°†å‘é€ç»™ç”¨æˆ·çš„æ¢å¤ä»¤ç‰Œ:</p>
<pre>var user = await User.findOne({ email: inputs.email });
   if (!user) {
     return;
   }</pre>
<p>ç„¶åï¼Œæˆ‘ä»¬å°†ä»¤ç‰ŒåŠå…¶åˆ°æœŸæ—¶é—´å­˜å‚¨åœ¨æ•°æ®åº“ä¸­:</p>
<pre>const token = await sails.helpers.strings.random("url-friendly");</pre>
<p>ç›®å‰åœ¨<code>config/custom.js</code>ä¸­æœ‰<code>passwordResetTokenTTL</code>å±æ€§ï¼Œè®©æˆ‘ä»¬å°†å®ƒå’Œå€¼ç›¸åŠ :</p>
<pre>await User.update({ id: user.id }).set({
      passwordResetToken: token,
      passwordResetTokenExpiresAt:
        Date.now() + sails.config.custom.passwordResetTokenTTL,
});</pre>
<p>å›åˆ°<code>user/forgot-password.js</code>åŠ¨ä½œï¼Œæˆ‘ä»¬å°†ç»§ç»­æ„å»ºé‡ç½®é“¾æ¥ï¼Œç°åœ¨æˆ‘ä»¬å°†è®©å®ƒç›´æ¥æŒ‡å‘è´Ÿè´£é‡ç½®å¯†ç çš„ç«¯ç‚¹ã€‚</p>
<pre>passwordResetTokenTTL: 24 * 60 * 60 * 1000, // 24 hours</pre>
<p>æ­¤é“¾æ¥å–å†³äºæ‚¨å¸Œæœ›å®¢æˆ·ç«¯å¦‚ä½•ä½¿ç”¨é‡ç½®ç«¯ç‚¹ã€‚ç”±äºæˆ‘ä»¬ä¸å…³æ³¨å‰ç«¯ï¼Œæˆ‘ä»¬å°†ç®€å•åœ°å¤åˆ¶é‡ç½®ä»¤ç‰Œå¹¶åœ¨Postmanä¸­ä½¿ç”¨å®ƒ</p>
<blockquote><p>ä»¥ä¸‹æ˜¯ç‰‡æ®µ:</p></blockquote>
<p>ç„¶åï¼Œæˆ‘ä»¬å°†ä½¿ç”¨æˆ‘ä»¬å°šæœªåˆ›å»ºçš„åä¸º<code>forgot-password.hbs</code>çš„ç”µå­é‚®ä»¶æ¨¡æ¿å‘é€ç”µå­é‚®ä»¶ã€‚å› æ­¤ï¼Œåœ¨<code>views/</code>ç›®å½•ä¸­åˆ›å»º<code>forgot-password.hbs</code>ã€‚å‘å…¶ä¸­æ·»åŠ ä»¥ä¸‹æ¨¡æ¿:</p>
<pre>const recoveryLink = `${sails.config.custom.baseUrl}/user/reset-password?token=${token}`;</pre>
<p>å›åˆ°â€œå¿˜è®°å¯†ç â€æ“ä½œï¼Œæ‚¨å°†æ„å»ºç”µå­é‚®ä»¶é€‰é¡¹ï¼Œå¹¶ä½¿ç”¨å®ƒå‘é€ç”µå­é‚®ä»¶:</p>
<pre>&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8" /&gt;
    &lt;meta name="viewport" content="width=device-width, initial-scale=1.0" /&gt;
    &lt;title&gt;Document&lt;/title&gt;
    &lt;style&gt;
        body {
            padding: 10px 20px;
            font-family: Arial, Helvetica, sans-serif;
        }
        .cta {
            text-decoration: none;
            background-color: rgb(76, 119, 175);
            color: #fff !important;
            font-weight: bold;
            padding: 10px 20px !important;
            border-radius: 5px;
            margin: 0 auto;
        }
        footer {
            margin-top: 2rem;
        }
        p {
            margin: 30px 0;
        }
    &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;section class="hero"&gt;
        &lt;h1 class="title"&gt;Forgot your password {{ name }}?&lt;/h1&gt;
    &lt;/section&gt;
    &lt;main&gt;
        &lt;p&gt;
            Someone requested a password reset for your account. If this was not
            you, please disregard this email. Otherwise, simply click the button
            below:
        &lt;/p&gt;
        &lt;a class="cta" href="{{recoverLink}}" target="_blank"&gt;Reset password&lt;/a&gt;
    &lt;/main&gt;
    &lt;footer&gt;
        &lt;p&gt;ğŸ–¤ Love,&lt;/p&gt;
    &lt;/footer&gt;
&lt;/body&gt;
&lt;/html&gt;</pre>
<p>æœ€åï¼Œæˆ‘ä»¬å°†å‘è°ƒç”¨è€…å‘é€ä¸€ä¸ªæˆåŠŸé€€å‡ºçš„å“åº”:</p>
<pre>const email = {
      to: user.emailAddress,
      subject: "Reset Password",
      template: "forgot-password",
      context: {
        name: user.fullName,
        recoverLink: recoveryLink,
      },
    };
    try {
      await sails.helpers.sendMail(email);
    } catch (error) {
      sails.log(error);
    }</pre>
<p>åœ¨æˆ‘ä»¬æµ‹è¯•å¿˜è®°å¯†ç åŠŸèƒ½ä¹‹å‰ï¼Œè®©æˆ‘ä»¬é€šè¿‡å®ç°é‡ç½®å¯†ç åŠŸèƒ½æ¥æ€»ç»“ä¸€ä¸‹ã€‚</p>
<pre>return exits.success({
      message: `A reset password email has been sent to ${user.email}.`,
    });</pre>
<p>é‡ç½®å¯†ç </p>
<h2>å°†ä»¥ä¸‹æ¡ç›®æ·»åŠ åˆ°<code>routes.js</code>æ–‡ä»¶:</h2>
<p>é€šè¿‡è¿è¡Œä»¥ä¸‹å‘½ä»¤åˆ›å»ºæ“ä½œ:</p>
<pre>"POST /user/reset-password": "user/reset-password",</pre>
<p>æ‰“å¼€reset-password.jså¹¶æ·»åŠ ä»¥ä¸‹ä¸¤ä¸ªè¾“å…¥ï¼Œå› ä¸ºæˆ‘ä»¬å¸Œæœ›åœ¨è¯·æ±‚ä¸­å‘é€resetä»¤ç‰Œå’Œæ–°ä»¤ç‰Œ:</p>
<pre>sails generate action user/reset-password</pre>
<p>è¿˜è¦å£°æ˜ä»¥ä¸‹å‡ºå£:</p>
<pre>password: {
     description: "The new, unencrypted password.",
     example: "myfancypassword",
     required: true,
   },
   token: {
     description:
       "The password token that was in the forgot-password endpoint",
     example: "gwa8gs8hgw9h2g9hg29",
     required: true,
   },</pre>
<p>åœ¨<code>fn</code>ä¸­ï¼Œæˆ‘ä»¬æ£€æŸ¥è¯·æ±‚æ˜¯å¦åŒ…å«ä»¤ç‰Œï¼Œå¦åˆ™æˆ‘ä»¬é€šè¿‡<code>invalidToken</code>å‡ºå£å¿«é€Ÿé€€å‡º:</p>
<pre>success: {
     description:
       "Password successfully updated, and requesting user agent automatically logged in",
   },
   invalidToken: {
     statusCode: 401,
     description:
       "The provided password token is invalid, expired, or has already been used.",
   },</pre>
<p>å¦‚æœä»¤ç‰Œæœ‰æ•ˆï¼Œæˆ‘ä»¬ç»§ç»­è·å–å…·æœ‰è¯¥ä»¤ç‰Œçš„ç”¨æˆ·è®°å½•:</p>
<pre>if (!inputs.token) {
     return exits.invalidToken({
       error: "Your reset token is either invalid or expired",
     });
}</pre>
<p>æˆ‘ä»¬è¿˜å°†æ£€æŸ¥æ˜¯å¦æ£€ç´¢åˆ°ç”¨æˆ·è®°å½•ï¼Œä»¥åŠä»¤ç‰Œæ˜¯å¦å°šæœªè¿‡æœŸ:</p>
<pre>var user = await User.findOne({ passwordResetToken: inputs.token });</pre>
<p>ç„¶åï¼Œæˆ‘ä»¬å°†æ•£åˆ—è°ƒç”¨è€…æä¾›çš„æ™®é€šå¯†ç :</p>
<pre>if (!user || user.passwordResetTokenExpiresAt &lt;= Date.now()) {
    return exits.invalidToken({
      error: "Your reset token is either invalid or expired",
    });
  }</pre>
<p>ç„¶åæˆ‘ä»¬ç”¨<code>hashedPassword</code>æ›´æ–°ç”¨æˆ·è®°å½•ï¼Œå¹¶é‡ç½®<code>passwordResetToken</code>å’Œ<code>passwordResetTokenTTL</code>å­—æ®µ:</p>
<pre>const hashedPassword = await sails.helpers.passwords.hashPassword(
      inputs.password
    );</pre>
<p>ä¸ºäº†æˆæƒç”¨æˆ·ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªJWTä»¤ç‰Œ:</p>
<pre>await User.updateOne({ id: user.id }).set({
          password: hashedPassword,
          passwordResetToken: "",
          passwordResetTokenExpiresAt: 0,
    });</pre>
<p>æœ€åï¼Œæˆ‘ä»¬å°†ç”¨æˆ·è®°å½•æ·»åŠ åˆ°<code>req</code>å¯¹è±¡ï¼Œå¹¶é€šè¿‡æˆåŠŸå‡ºå£å‘å›ä¸€ä¸ª200å“åº”ï¼Œå…¶ä¸­åŒ…å«ä¸€æ¡æ¶ˆæ¯ã€ç”¨æˆ·ä¿¡æ¯å’Œç”¨äºæˆæƒçš„JWTä»¤ç‰Œ:</p>
<pre>const token = await sails.helpers.generateNewJwtToken(user.email);</pre>
<p>è®©æˆ‘ä»¬æµ‹è¯•è¿™ä¸¤ä¸ªç«¯ç‚¹ã€‚å›åˆ°Postmanï¼Œä½¿ç”¨æ‚¨ä¹‹å‰åˆ›å»ºçš„å¸æˆ·ç”µå­é‚®ä»¶ç‚¹å‡»å¿˜è®°å¯†ç ç«¯ç‚¹ã€‚è½¬åˆ°æ‚¨çš„æ”¶ä»¶ç®±ï¼Œç„¶åç‚¹å‡»é“¾æ¥å¹¶å¤åˆ¶ä»¤ç‰Œã€‚ä¹‹åï¼Œè¿”å›åˆ°Postmanï¼Œä½¿ç”¨ä»¤ç‰Œå’Œæ–°å¯†ç ç‚¹å‡»é‡ç½®å¯†ç ç«¯ç‚¹ã€‚æ‚¨åº”è¯¥ä»ä¸¤ä¸ªç«¯ç‚¹è·å¾—ä»¥ä¸‹å“åº”:</p>
<pre>this.req.user = user;
return exits.success({
  message: `Password reset successful. ${user.email} has been logged in`,
  data: user,
  token,
});
</pre>
<p><img data-attachment-id="27122" data-permalink="https://blog.logrocket.com/building-a-node-js-web-api-with-sails-js/forgotpasswordendpoint-nocdn/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/10/forgotpasswordendpoint-nocdn.png" data-orig-size="730,411" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="forgotpasswordendpoint-nocdn" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/10/forgotpasswordendpoint-nocdn-300x169.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/10/forgotpasswordendpoint-nocdn.png" decoding="async" class="aligncenter size-full wp-image-27122 jetpack-lazy-image" src="../Images/faa70d853157108b3d1801a4af8499f8.png" alt="forgot password endpoint" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/10/forgotpasswordendpoint-nocdn.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/10/forgotpasswordendpoint-nocdn-300x169.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/10/forgotpasswordendpoint-nocdn.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/10/forgotpasswordendpoint-nocdn.png"/></p>
<p>Â </p><noscript><img data-lazy-fallback="1" data-attachment-id="27122" data-permalink="https://blog.logrocket.com/building-a-node-js-web-api-with-sails-js/forgotpasswordendpoint-nocdn/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/10/forgotpasswordendpoint-nocdn.png" data-orig-size="730,411" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="forgotpasswordendpoint-nocdn" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/10/forgotpasswordendpoint-nocdn-300x169.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/10/forgotpasswordendpoint-nocdn.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-27122" src="../Images/faa70d853157108b3d1801a4af8499f8.png" alt="forgot password endpoint" srcset="https://blog.logrocket.com/wp-content/uploads/2020/10/forgotpasswordendpoint-nocdn.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/10/forgotpasswordendpoint-nocdn-300x169.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/10/forgotpasswordendpoint-nocdn.png"/></noscript>
<p><img decoding="async" class="aligncenter size-full wp-image-27100 jetpack-lazy-image" src="../Images/ecc7f951e56061844930dc83dca21f79.png" alt="forgot password email" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/10/forgotpasswordemail.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/10/forgotpasswordemail.png"/></p>
<p>Â </p><noscript><img data-lazy-fallback="1" decoding="async" loading="lazy" class="aligncenter size-full wp-image-27100" src="../Images/ecc7f951e56061844930dc83dca21f79.png" alt="forgot password email" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/10/forgotpasswordemail.png"/></noscript>
<p><img data-attachment-id="27123" data-permalink="https://blog.logrocket.com/building-a-node-js-web-api-with-sails-js/postmanpassword-nocdn/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/10/postmanpassword-nocdn.png" data-orig-size="730,411" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="postmanpassword-nocdn" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/10/postmanpassword-nocdn-300x169.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/10/postmanpassword-nocdn.png" decoding="async" class="aligncenter size-full wp-image-27123 jetpack-lazy-image" src="../Images/cc3c641f6e4d57980bc0448a81fcb76b.png" alt="password reset successful" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/10/postmanpassword-nocdn.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/10/postmanpassword-nocdn-300x169.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/10/postmanpassword-nocdn.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/10/postmanpassword-nocdn.png"/></p>
<p>å°è¯•ä½¿ç”¨æ–°å¯†ç ç™»å½•ï¼Œåº”è¯¥ä¹Ÿèƒ½æ­£å¸¸å·¥ä½œ:</p><noscript><img data-lazy-fallback="1" data-attachment-id="27123" data-permalink="https://blog.logrocket.com/building-a-node-js-web-api-with-sails-js/postmanpassword-nocdn/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/10/postmanpassword-nocdn.png" data-orig-size="730,411" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="postmanpassword-nocdn" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/10/postmanpassword-nocdn-300x169.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/10/postmanpassword-nocdn.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-27123" src="../Images/cc3c641f6e4d57980bc0448a81fcb76b.png" alt="password reset successful" srcset="https://blog.logrocket.com/wp-content/uploads/2020/10/postmanpassword-nocdn.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/10/postmanpassword-nocdn-300x169.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/10/postmanpassword-nocdn.png"/></noscript>
<p><img data-attachment-id="27124" data-permalink="https://blog.logrocket.com/building-a-node-js-web-api-with-sails-js/newpasswordlogin-nocdn/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/10/newpasswordlogin-nocdn.png" data-orig-size="730,411" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="newpasswordlogin-nocdn" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/10/newpasswordlogin-nocdn-300x169.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/10/newpasswordlogin-nocdn.png" decoding="async" class="aligncenter size-full wp-image-27124 jetpack-lazy-image" src="../Images/b5789ec4850d1806974a4c41afbcd4fa.png" alt="new password login" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/10/newpasswordlogin-nocdn.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/10/newpasswordlogin-nocdn-300x169.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/10/newpasswordlogin-nocdn.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/10/newpasswordlogin-nocdn.png"/></p>
<p>ç°åœ¨æˆ‘ä»¬æˆåŠŸåœ°å®ç°äº†æ‰€æœ‰çš„ç«¯ç‚¹ã€‚ä½ å¯ä»¥å¸¦ä»–ä»¬å»é‚®å·®é‚£é‡Œè½¬ä¸€åœˆã€‚æœ€åï¼Œè®©æˆ‘ä»¬å‘å…¨ä¸–ç•Œæä¾›æˆ‘ä»¬çš„webæœåŠ¡ã€‚</p><noscript><img data-lazy-fallback="1" data-attachment-id="27124" data-permalink="https://blog.logrocket.com/building-a-node-js-web-api-with-sails-js/newpasswordlogin-nocdn/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/10/newpasswordlogin-nocdn.png" data-orig-size="730,411" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="newpasswordlogin-nocdn" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/10/newpasswordlogin-nocdn-300x169.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/10/newpasswordlogin-nocdn.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-27124" src="../Images/b5789ec4850d1806974a4c41afbcd4fa.png" alt="new password login" srcset="https://blog.logrocket.com/wp-content/uploads/2020/10/newpasswordlogin-nocdn.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/10/newpasswordlogin-nocdn-300x169.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/10/newpasswordlogin-nocdn.png"/></noscript>
<p>éƒ¨ç½²</p>
<h2>æˆ‘ä»¬å°†åœ¨Heroku PaaSä¸Šéƒ¨ç½²æˆ‘ä»¬çš„APIã€‚åœ¨æˆ‘ä»¬éƒ¨ç½²ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦åšä¸€äº›æ¸…ç†å·¥ä½œã€‚è®©æˆ‘ä»¬å¼€å§‹æ‰“å¼€<code>config/production.js</code>ï¼Œå®ƒå°†åŒ…å«æˆ‘ä»¬APIçš„æ‰€æœ‰ç”Ÿäº§è®¾ç½®ã€‚</h2>
<p>æŸ¥æ‰¾<code>http</code>å±æ€§ä¸‹çš„è¡Œï¼Œ<code>// trustProxy: true</code>å¹¶å–æ¶ˆå¯¹å®ƒçš„æ³¨é‡Šï¼Œä»¥å…è®¸ä»Herokuæä¾›Sailsã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†é€šè¿‡æ›¿æ¢datastoreå¯¹è±¡çš„defaultå±æ€§ä¸­çš„ä»¥ä¸‹ä¸¤ä¸ªæ¡ç›®ï¼Œç”¨ç”Ÿäº§æ•°æ®åº“è¦†ç›–å¼€å‘æ•°æ®åº“:</p>
<p>å½“æˆ‘ä»¬å°†PostgreSQLæ•°æ®åº“æ·»åŠ åˆ°æ‚¨çš„åº”ç”¨ç¨‹åºæ—¶ï¼ŒHerokuå°†è®¾ç½®ä¸€ä¸ªDATABASE_URL envå˜é‡</p>
<pre>adapter: "sails-postgresql",
url: process.env.DATABASE_URL,</pre>
<blockquote><p>è¿˜è®°å¾—å°†<code>config/production.js</code>ä¸­çš„<code>baseUrl</code>æ›¿æ¢ä¸ºä½ çš„Herokuåº”ç”¨URLï¼Œè¿™æ ·ç”µå­é‚®ä»¶ä¹Ÿèƒ½æ­£å¸¸å·¥ä½œã€‚</p></blockquote>
<p>å®Œæˆåï¼Œåˆ›å»ºä¸€ä¸ªHerokuå¸æˆ·ï¼Œæ‚¨å¯ä»¥åƒåœ¨Herokuä¸Šéƒ¨ç½²ä»»ä½•Node.jsåº”ç”¨ç¨‹åºä¸€æ ·éƒ¨ç½²æ‚¨çš„APIã€‚</p>
<p>ç¡®ä¿æ·»åŠ Heroku PostgreSQLæ’ä»¶ï¼Œå› ä¸ºæ‚¨ä¾èµ–äºä¸€ä¸ªæ•°æ®åº“ã€‚åŒæ ·ï¼Œè®¾ç½®ç¯å¢ƒå˜é‡<code>JWT_SECRET</code>å’Œ<code>SENDGRID_API_KEY</code>ã€‚</p>
<p>è¦å°†æ‚¨çš„æ•°æ®åº“æ¨¡å¼æ”¾åˆ°Herokuä¸Šï¼Œæ‚¨å¯ä»¥å¤åˆ¶æ•°æ®åº“URLå¹¶è¿è¡Œ<code>sails lift</code>å°†è¡¨è¿ç§»åˆ°Herokuæä¾›çš„æ•°æ®åº“ã€‚Herokuæ•°æ®åº“å°†éœ€è¦SSLæ¥è¿æ¥åˆ°å®ƒçš„æ•°æ®åº“ï¼Œæ‰€ä»¥å°†<code>ssl: true</code>æ·»åŠ åˆ°é€‚é…å™¨å±æ€§ä¸­ï¼Œå¦‚ä¸‹æ‰€ç¤º:</p>
<p>æœ€åï¼Œä¸ºäº†å®‰å…¨èµ·è§ï¼Œä½ éœ€è¦ä¼ é€’ä¸€ç»„URLï¼Œè¿™äº›URLå°†è¢«å…è®¸é€šè¿‡å¥—æ¥å­—è¿æ¥åˆ°ä½ çš„åº”ç”¨ç¨‹åºâ€”â€”è¿™æ˜¯å› ä¸ºSailsé»˜è®¤å¸¦æœ‰å†…ç½®çš„websocketsæ”¯æŒã€‚è™½ç„¶æˆ‘ä»¬æ²¡æœ‰ä½¿ç”¨å¥—æ¥å­—ã€‚åªéœ€åœ¨<code>config/production.js</code>ä¸­æ‰¾åˆ°<code>sockets</code>ä¸‹çš„è¡Œï¼Œå¹¶å–æ¶ˆå¯¹ä»¥ä¸‹è¡Œçš„æ³¨é‡Š:</p>
<pre>// config/datastore.js
  adapter: "sails-postgresql",
  url:"heroku-database-url",
  ssl: true</pre>
<p>å°†è¯¥è¡Œæ›¿æ¢ä¸ºæ‚¨çš„Herokuåº”ç”¨ç¨‹åºURL:</p>
<pre>// onlyAllowOrigins: [
    //   'https://example.com',
    //   'https://staging.example.com',
    // ],</pre>
<p>ä¹‹åï¼Œæ‚¨å¯ä»¥åœ¨Herokuä¸Šéƒ¨ç½²ç”±Sailsæä¾›æ”¯æŒçš„Node.js web APIï¼</p>
<pre>onlyAllowOrigins: ['https://logrocketsailsapi.herokuapp.com'], // change to yours!</pre>
<p>è¿™æ˜¯ä¸€ä¸ªæ€»ç»“ï¼</p>
<h2>åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬æ¢ç´¢äº†ä½¿ç”¨Sails MVCæ¡†æ¶åœ¨Node.jsä¸­åˆ›å»ºweb APIsçš„èƒ½åŠ›å’Œç®€æ˜“æ€§ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›æœ‰å¸®åŠ©çš„èµ„æº:</h2>
<p>æœ¬æ–‡çš„<a href="https://github.com/DominusKelvin/logrocket-sails-api" target="_blank" rel="noopener noreferrer">æºä»£ç </a>åœ¨GitHubä¸Šã€‚å¦å¤–<a href="https://www.getpostman.com/collections/8db7150730252619bc9b" target="_blank" rel="noopener noreferrer">è¿™é‡Œçš„</a>æ˜¯ä¸€ä¸ªä¾›æ‚¨æµ‹è¯•ç«¯ç‚¹çš„Postmané›†åˆã€‚</p>

<p>200åª<img src="../Images/61167b9d027ca73ed5aaf59a9ec31267.png" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2019/10/green-check.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" class=" jetpack-lazy-image" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/10/green-check.png"/> <noscript> <img data-lazy-fallback="1" src="../Images/61167b9d027ca73ed5aaf59a9ec31267.png" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/10/green-check.png"/> </noscript>æ˜¾ç¤ºå™¨å‡ºç°æ•…éšœï¼Œç”Ÿäº§ä¸­ç½‘ç»œè¯·æ±‚ç¼“æ…¢</p><div class="code-block code-block-23">
<div class="blog-plug inline-plug node-plug"><h2>éƒ¨ç½²åŸºäºèŠ‚ç‚¹çš„webåº”ç”¨ç¨‹åºæˆ–ç½‘ç«™æ˜¯å®¹æ˜“çš„éƒ¨åˆ†ã€‚ç¡®ä¿æ‚¨çš„èŠ‚ç‚¹å®ä¾‹ç»§ç»­ä¸ºæ‚¨çš„åº”ç”¨ç¨‹åºæä¾›èµ„æºæ˜¯äº‹æƒ…å˜å¾—æ›´åŠ å›°éš¾çš„åœ°æ–¹ã€‚å¦‚æœæ‚¨å¯¹ç¡®ä¿å¯¹åç«¯æˆ–ç¬¬ä¸‰æ–¹æœåŠ¡çš„è¯·æ±‚æˆåŠŸæ„Ÿå…´è¶£ï¼Œ</h2><p>. </p><a href="https://lp.logrocket.com/blg/node-signup" target="_blank">try LogRocket</a><p>LogRocket å°±åƒæ˜¯ç½‘ç»œå’Œç§»åŠ¨åº”ç”¨ç¨‹åºçš„DVRï¼Œè®°å½•ä¸‹ç”¨æˆ·ä¸ä½ çš„åº”ç”¨ç¨‹åºäº¤äº’æ—¶å‘ç”Ÿçš„ä¸€åˆ‡ã€‚æ‚¨å¯ä»¥æ±‡æ€»å¹¶æŠ¥å‘Šæœ‰é—®é¢˜çš„ç½‘ç»œè¯·æ±‚ï¼Œä»¥å¿«é€Ÿäº†è§£æ ¹æœ¬åŸå› ï¼Œè€Œä¸æ˜¯çŒœæµ‹é—®é¢˜å‘ç”Ÿçš„åŸå› ã€‚</p><a class="signup" href="https://lp.logrocket.com/blg/node-signup" target="_blank" rel="noopener noreferrer"><img src="../Images/cae72fd2a54c5f02a6398c4867894844.png" alt="LogRocket Network Request Monitoring" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2019/12/network-request-filter-2-1.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" class=" jetpack-lazy-image" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/12/network-request-filter-2-1.png"/><noscript><img data-lazy-fallback="1" src="../Images/cae72fd2a54c5f02a6398c4867894844.png" alt="LogRocket Network Request Monitoring" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/12/network-request-filter-2-1.png"/></noscript></a><a href="https://lp.logrocket.com/blg/node-signup" target="_blank" rel="noopener noreferrer">https://logrocket.com/signup/</a><p>LogRocketæ£€æµ‹æ‚¨çš„åº”ç”¨ç¨‹åºä»¥è®°å½•åŸºçº¿æ€§èƒ½è®¡æ—¶ï¼Œå¦‚é¡µé¢åŠ è½½æ—¶é—´ã€åˆ°è¾¾ç¬¬ä¸€ä¸ªå­—èŠ‚çš„æ—¶é—´ã€æ…¢é€Ÿç½‘ç»œè¯·æ±‚ï¼Œè¿˜è®°å½•Reduxã€NgRxå’ŒVuexæ“ä½œ/çŠ¶æ€ã€‚</p><p>. </p><a class="signup" href="https://lp.logrocket.com/blg/node-signup" target="_blank" rel="noopener noreferrer">Start monitoring for free</a><p>. </p></div>
</div>

<p class="clearfix"/>
<p class="clearfix"/>
</article>

</div>    
</body>
</html>