<html>
<head>
<title>NextAuth.js for client-side authentication in Next.js | LogRocket Blog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>Next.js | LogRocketåšå®¢ä¸­ç”¨äºå®¢æˆ·ç«¯èº«ä»½éªŒè¯çš„NextAuth.js</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://blog.logrocket.com/nextauth-js-for-next-js-client-side-authentication/#0001-01-01">https://blog.logrocket.com/nextauth-js-for-next-js-client-side-authentication/#0001-01-01</a></blockquote><div><article class="article-post">
<p><em> <strong>ç¼–è€…æŒ‰:</strong>æœ¬æŒ‡å—æœ€åä¸€æ¬¡æ›´æ–°æ˜¯åœ¨2022å¹´3æœˆ8æ—¥ï¼Œä»¥åæ˜ NextAuth.js v4ä¸­å¼•å…¥çš„å˜æ›´ã€‚</em></p>
<p>åœ¨åº”ç”¨ç¨‹åºä¸­ï¼Œèº«ä»½éªŒè¯æ˜¯ä¸€é¡¹é‡è¦è€Œæ•æ„Ÿçš„åŠŸèƒ½ï¼Œåœ¨è¿™äº›åº”ç”¨ç¨‹åºä¸­ï¼Œç”¨æˆ·çš„å‡­æ®(å¦‚ç”¨æˆ·åã€ç”µå­é‚®ä»¶å’Œå¯†ç )å°†è¢«éªŒè¯ï¼Œä»¥ç¡®è®¤ç”¨æˆ·æ˜¯å¦æ˜¯ä»–ä»¬æ‰€å£°ç§°çš„èº«ä»½ã€‚</p>
<p>è¿™æ˜¯ä¸€ç§è¯¢é—®ç”¨æˆ·æ˜¯è°ï¼Œç„¶åæ¥æ”¶è¯æ®ä»¥éªŒè¯å…¶èº«ä»½çš„æ–¹å¼ã€‚ç³»ç»Ÿè·å–ç”¨æˆ·æä¾›çš„å‡­è¯ï¼Œå¹¶æ£€æŸ¥å®ƒä»¬æ˜¯å¦æœ‰æ•ˆã€‚</p>
<p>åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†å¸¦æ‚¨äº†è§£å¦‚ä½•ä½¿ç”¨ä¸€ä¸ªåä¸º<a href="https://next-auth.js.org/" target="_blank" rel="noopener"> NextAuth.js </a>çš„å¼ºå¤§è€Œå®‰å…¨çš„åº“ï¼Œåœ¨<a href="https://nextjs.org/"> Next.js </a>ä¸­è®¾ç½®ä¸éœ€è¦å¯†ç çš„å®¢æˆ·ç«¯èº«ä»½éªŒè¯ã€‚</p>
<p>åœ¨è¿™ç¯‡æ–‡ç« ç»“æŸæ—¶ï¼Œä½ å°†å·²ç»åˆ›å»ºäº†ä¸€ä¸ªå¸¦è®¤è¯çš„åº”ç”¨ç¨‹åºï¼Œä½ çš„ç”¨æˆ·å°†èƒ½å¤Ÿä½¿ç”¨ä»–ä»¬çš„GitHubã€Googleå’Œè„¸ä¹¦å¸æˆ·ç™»å½•ã€‚æ³¨å†ŒæˆåŠŸåï¼Œæˆ‘ä»¬å°†æ˜¾ç¤ºç”¨æˆ·çš„ä¸ªäººèµ„æ–™å›¾ç‰‡å’Œç”µå­é‚®ä»¶ï¼Œæˆ‘ä»¬å°†ä»ä»–ä»¬çš„ç¤¾äº¤åª’ä½“å¸æˆ·ä¸­æ£€ç´¢ã€‚</p>
<p>æˆ‘ä»¬å°†åˆ©ç”¨ReactæŒ‚é’©å’ŒåŠŸèƒ½ç»„ä»¶æ¥æ„å»ºæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºã€‚ä½†æ˜¯åœ¨æˆ‘ä»¬æ·±å…¥æ¢è®¨ä¹‹å‰ï¼Œè®©æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹æˆ‘ä»¬å°†è¦ä½¿ç”¨çš„ä¸¤ä¸ªä¸»è¦å·¥å…·ã€‚</p>
<h2 id="what-is-next-js">Next.jsæ˜¯ä»€ä¹ˆï¼Ÿ</h2>
<p>Next.jsæ˜¯ä¸€ä¸ªæ„å»ºåœ¨Reactä¹‹ä¸Šçš„æ¡†æ¶ï¼Œå®ƒä½¿å¾—å¼€å‘ç”Ÿäº§å°±ç»ªã€å®Œå…¨ä¼˜åŒ–çš„Reactåº”ç”¨ç¨‹åºå˜å¾—è¶…çº§å¿«é€Ÿå’Œç®€å•ã€‚è¿™æ˜¯Reactç”Ÿæ€ç³»ç»Ÿä¸­æœ€å¥½çš„ä¸œè¥¿ä¹‹ä¸€ï¼Œå› ä¸ºå®ƒåœ¨é›¶é…ç½®çš„æƒ…å†µä¸‹æä¾›äº†å¤§é‡çš„åŠŸèƒ½ã€‚</p>
<p>Next.jsè¢«ç½‘é£ã€Tiktokå’Œè€å…‹ç­‰é¡¶çº§å…¬å¸ç”¨äºç”Ÿäº§ã€‚å®ƒéå¸¸å®¹æ˜“å­¦ä¹ ï¼Œå°¤å…¶æ˜¯å¦‚æœä½ ç†Ÿæ‚‰Reactçš„è¯ã€‚</p>
<h2 id="what-is-nextauth-js">ä»€ä¹ˆæ˜¯NextAuth.jsï¼Ÿ</h2>
<p>NextAuth.jsæ˜¯ä¸€ä¸ªå®Œå…¨å®‰å…¨çš„èº«ä»½éªŒè¯è§£å†³æ–¹æ¡ˆï¼Œç”¨äºåœ¨Next.jsåº”ç”¨ç¨‹åºä¸­å®ç°èº«ä»½éªŒè¯ã€‚è¿™æ˜¯ä¸€ä¸ªçµæ´»çš„èº«ä»½éªŒè¯åº“ï¼Œæ—¨åœ¨ä¸ä»»ä½•OAuthæœåŠ¡åŒæ­¥ï¼Œå®Œå…¨æ”¯æŒæ— å¯†ç ç™»å½•ã€‚</p>
<p>å®ƒå¯ä»¥åœ¨æœ‰æˆ–æ²¡æœ‰æ•°æ®åº“çš„æƒ…å†µä¸‹ä½¿ç”¨ï¼Œå¹¶ä¸”é»˜è®¤æ”¯æŒæµè¡Œçš„æ•°æ®åº“ï¼Œå¦‚MySQLã€MongoDBã€PostgreSQLå’ŒMariaDBã€‚</p>
<p>é€šè¿‡ä¸OAuthå’ŒJSON Web Tokenç­‰æœåŠ¡åŒæ­¥ï¼Œå®ƒå¯ä»¥åœ¨æ²¡æœ‰æ•°æ®åº“çš„æƒ…å†µä¸‹ä½¿ç”¨ã€‚</p>
<h2 id="how-does-nextauth-js-work">NextAuth.jsæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ</h2>
<p>æœ‰äº†NextAuth.jsè¿™æ ·çš„åº“ï¼Œæ‚¨ä¸éœ€è¦åƒä½¿ç”¨OAuthæ„å»ºå®‰å…¨çš„Next.jsåº”ç”¨ç¨‹åºé‚£æ ·æˆä¸ºèº«ä»½åè®®æ–¹é¢çš„ä¸“å®¶ã€‚æ„å»ºNextAuth.jsæ˜¯ä¸ºäº†é¿å…å­˜å‚¨æ•æ„Ÿæ•°æ®ï¼Œæ¯”å¦‚ç”¨æˆ·å¯†ç ã€‚å®ƒä¸Next.jsé…åˆå¾—éå¸¸å¥½ã€‚åªéœ€20è¡Œä»£ç ï¼Œæ‚¨å°±å¯ä»¥åœ¨åº”ç”¨ç¨‹åºä¸­å®ç°èº«ä»½éªŒè¯åŠŸèƒ½ã€‚</p>
<p>NextAuth.jsæœ‰ä¸€ä¸ªå®¢æˆ·ç«¯APIï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å®ƒä¸åº”ç”¨ç¨‹åºä¸­çš„ä¼šè¯è¿›è¡Œäº¤äº’ã€‚ä»<a href="https://next-auth.js.org/configuration/providers" target="_blank" rel="noopener">æä¾›è€…</a>è¿”å›çš„ä¼šè¯æ•°æ®åŒ…å«ç”¨æˆ·è´Ÿè½½ï¼Œè¿™å¯ä»¥åœ¨ç”¨æˆ·æˆåŠŸç™»å½•æ—¶æ˜¾ç¤ºç»™ç”¨æˆ·ã€‚</p>
<p>è¿”å›ç»™å®¢æˆ·ç«¯çš„ä¼šè¯æ•°æ®å¦‚ä¸‹æ‰€ç¤º:</p>
<pre class="language-json hljs">{
  expires: '2055-12-07T09:56:01.450Z';
  user: {
        email: '<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="5625373b263a3316332e373b263a337835393b">[emailÂ protected]</a>';
        image: 'https://avatars2.githubusercontent.com/u/45228014?v=4';
        name: 'Ejiro Asiuwhu';
    }
}
</pre>
<p>æ³¨æ„è´Ÿè½½ä¸åŒ…å«ä»»ä½•æ•æ„Ÿæ•°æ®ã€‚ä¼šè¯è´Ÿè½½æˆ–æ•°æ®æ˜¯ä¸ºäº†è¡¨ç¤ºçš„ç›®çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒæ˜¯ä¸ºäº†æ˜¾ç¤ºç»™ç”¨æˆ·çš„ã€‚</p>
<p>NextAuth.jsæä¾›äº†<code>useSession()</code> Reacté’©å­ï¼Œå¯ä»¥ç”¨æ¥æ£€æŸ¥ç”¨æˆ·ç™»å½•çŠ¶æ€ã€‚åŒæ—¶ï¼ŒNextAuth.jsæä¾›äº†Reactåº”ç”¨ç¨‹åºä½¿ç”¨çš„REST APIã€‚è¦äº†è§£æ›´å¤šå…³äºREST API NextAuth exposesçš„ä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹<a href="https://next-auth.js.org/getting-started/rest-api" target="_blank" rel="noopener">å®˜æ–¹æ–‡æ¡£</a>ã€‚</p>
<h2 id="requirements">è¦æ±‚</h2>
<ul>
<li>æœ¬åœ°è®¡ç®—æœºä¸Šå®‰è£…çš„Node.js 10.13æˆ–æ›´é«˜ç‰ˆæœ¬</li>
<li><a href="http://reactjs.org/" target="_blank" rel="noopener"> React.js </a>åŸºç¡€çŸ¥è¯†</li>
</ul>
<h2 id="creating-the-next-js-starter-application">åˆ›å»ºNext.js starteråº”ç”¨ç¨‹åº</h2>
<p>æˆ‘ä¸ºä½ åˆ›å»ºäº†ä¸€ä¸ªstarter Next.jsé¡¹ç›®ï¼Œä½ å¯ä»¥è·Ÿç€åšã€‚é¦–å…ˆï¼Œå°†è¿™ä¸ª<a href="https://github.com/ejirocodes/Nextjs_Authentication" target="_blank" rel="noopener">åº“</a>åˆ†æ”¯åˆ°æ‚¨è‡ªå·±çš„GitHubå¸æˆ·å¹¶å…‹éš†å®ƒã€‚</p>
<pre class="language-bash hljs">git clone https://github.com/&lt;your-Github-username&gt;/Nextjs_Authentication.git
</pre>
<p>è¯¥é¡¹ç›®åŒ…æ‹¬ä¸¤ä¸ªåˆ†æ”¯:<code>starter</code>å’Œ<code>complete</code>ã€‚æŸ¥çœ‹<code>starter</code>åˆ†æ”¯æœºæ„ï¼Œå¼€å§‹è¡ŒåŠ¨ã€‚ä½†æ˜¯ï¼Œå¦‚æœæ‚¨æƒ³çœ‹åˆ°å®Œæˆçš„ä»£ç ï¼Œè¯·æŸ¥çœ‹<code>complete</code>åˆ†æ”¯ã€‚</p>
<p>å…‹éš†å­˜å‚¨åº“åï¼Œå¯¼èˆªåˆ°å·¥ä½œç›®å½•:</p>
<pre class="language-bash hljs">cd Nextjs_Authentication
</pre>
<p>starteré¡¹ç›®æœ€åˆæ˜¯ç”¨React v17.0.1åˆ›å»ºçš„ã€‚ä¸ºäº†é¿å…åœ¨å®‰è£…next-authæ—¶å‡ºç°ä»»ä½•é—®é¢˜ï¼Œè¯·æ›´æ–°<code>package.json</code>ä»¥å‡çº§<code>react</code>å’Œ<code>react-dom</code>:</p>
<pre class="language-json">"dependencies": {
    "next": "10.0.1",
    "react": "^17.0.2",
    "react-dom": "^17.0.2"
  }
</pre>
<p>ç„¶åï¼Œå®‰è£…Next.jsä¾èµ–é¡¹:</p>
<pre class="language-bash hljs">npm i
# or
yarn install
</pre>
<p>æ‚¨åº”è¯¥å·²ç»åœ¨<code>starter</code>åˆ†æ”¯ä¸Šï¼Œä½†æ˜¯ï¼Œå¦‚æœä¸æ˜¯è¿™æ ·ï¼Œè¯·ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤:</p>
<pre class="language-bash hljs">git checkout starter
</pre>
<p>å¯åŠ¨å¼€å‘æœåŠ¡å™¨:</p>
<pre class="language-bash hljs">npm run dev
# or
yarn run dev
</pre>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œé¡¹ç›®å°†åœ¨ç«¯å£3000ä¸Šè¿è¡Œã€‚å¯åŠ¨æµè§ˆå™¨å¹¶å¯¼èˆªè‡³<code><a href="http://localhost:3000" rel="nofollow">http://localhost:3000</a></code>ã€‚æ‚¨åº”è¯¥å¾—åˆ°è¿™æ ·çš„ç»“æœ:</p>
<figure class="wp-caption aligncenter"><img decoding="async" src="../Images/23fdbffad27f01627279dd78d878d947.png" alt="Starter project." data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/12/starter-project.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" class=" jetpack-lazy-image" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/12/starter-project.png"/><noscript><img data-lazy-fallback="1" decoding="async" loading="lazy" src="../Images/23fdbffad27f01627279dd78d878d947.png" alt="Starter project." data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/12/starter-project.png"/></noscript><figcaption class="wp-caption-text">Starter project.</figcaption></figure>
<h2 id="set-up-authentication-with-nextauth-js">ä½¿ç”¨NextAuth.jsè®¾ç½®èº«ä»½éªŒè¯</h2>
<p>ç°åœ¨æˆ‘ä»¬å·²ç»è®¾ç½®äº†Next.js starteråº”ç”¨ç¨‹åºï¼Œæˆ‘ä»¬å‡†å¤‡å­¦ä¹ å¦‚ä½•ä½¿ç”¨NextAuth.jsè®¤è¯Next.jsåº”ç”¨ç¨‹åºã€‚</p>
<p>æœ¬NextAuth.jså®¢æˆ·ç«¯è®¤è¯æ•™ç¨‹å°†æ¶µç›–ä»¥ä¸‹å†…å®¹:</p>

<h3 id="install-nextauth-js">å®‰è£…NextAuth.js</h3>
<p><code>next-auth</code>æ˜¯ä¸€ä¸ªnpmè½¯ä»¶åŒ…ï¼Œå› æ­¤å®‰è£…å®ƒå°†è½»è€Œæ˜“ä¸¾:</p>
<pre class="language-bash hljs">npm i next-auth
# or
yarn add next-auth
</pre>
<p>æˆåŠŸå®‰è£…åï¼Œ<code>next-auth</code>å°†è¢«æ·»åŠ åˆ°æ‚¨çš„<code>package.json</code>æ–‡ä»¶ä¸­çš„ä¾èµ–é¡¹ä¸­:</p>
<pre class="language-json hljs">//Dependencies in package.json
"dependencies": {
  "next": "10.0.1",
  "next-auth": "^4.2.1",
  "react": "^17.0.2",
  "react-dom": "^17.0.2"
}
</pre>
<p>æˆ‘ä»¬å°†è®©ç”¨æˆ·é€‰æ‹©ä½¿ç”¨ä»–ä»¬çš„GitHubã€è°·æ­Œæˆ–è„¸ä¹¦å¸æˆ·ç™»å½•æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºã€‚</p>
<h2 id="h3createagithuboauthapp">[H3]åˆ›å»ºGitHub OAuthåº”ç”¨ç¨‹åº</h2>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†æ·»åŠ ä¸€ä¸ªGitHubèº«ä»½éªŒè¯æä¾›è€…ï¼Œå®ƒæœ¬è´¨ä¸Šå…è®¸ç”¨æˆ·ä½¿ç”¨ä»–ä»¬çš„GitHubå¸æˆ·ç™»å½•æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºã€‚ä½†æ˜¯é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ª<a href="https://github.com/settings/developers" target="_blank" rel="noopener"> GitHub OAuthåº”ç”¨</a>ã€‚ç‚¹å‡»<strong>æ–°OAuthåº”ç”¨</strong>ï¼Œå¹¶ç›¸åº”å¡«å†™è¡¨æ ¼ã€‚æŸ¥çœ‹<a href="https://docs.github.com/en/free-pro-team@latest/developers/apps/creating-an-oauth-app" target="_blank" rel="noopener">å®˜æ–¹æ–‡ä»¶</a>äº†è§£æ›´å¤šä¿¡æ¯ã€‚</p>
<ul>
<li><strong>åº”ç”¨ç¨‹åºåç§°</strong>:è¿™æ˜¯æ‚¨çš„åº”ç”¨ç¨‹åºçš„åç§°ã€‚å®ƒå¯ä»¥è¢«ç§°ä¸ºä»»ä½•ä¸œè¥¿â€”â€”è¿™å¹¶ä¸é‡è¦</li>
<li><strong>ä¸»é¡µç½‘å€</strong>:è¿™æ˜¯æˆ‘ä»¬åº”ç”¨ç¨‹åºä¸»é¡µçš„å®Œæ•´ç½‘å€ã€‚ç”±äºæˆ‘ä»¬ä»å¤„äºå¼€å‘æ¨¡å¼ï¼Œæˆ‘ä»¬å°†å¡«å†™è¿è¡Œå¼€å‘æœåŠ¡å™¨çš„å®Œæ•´URLã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®ƒæ˜¯<code><a href="http://localhost:3000" rel="nofollow">http://localhost:3000</a></code></li>
<li><strong>æˆæƒå›è°ƒURL </strong>:è¿™æ˜¯æˆ‘ä»¬çš„ç”¨æˆ·æˆåŠŸç™»å½•æˆ‘ä»¬çš„åº”ç”¨åï¼ŒGitHubå°†é‡å®šå‘åˆ°çš„URLã€‚åº”è¯¥æ˜¯ä½ çš„ä¸»é¡µç½‘å€åŠ ä¸Š<code>/api/auth/callback</code>ï¼Œäº§ç”Ÿ<code><a href="http://localhost:3000/api/auth/callback" rel="nofollow">http://localhost:3000/api/auth/callback</a></code></li>
</ul>
<p>åœ¨æˆ‘ä»¬çš„OAuthåº”ç”¨ç¨‹åºæ³¨å†Œä¹‹åï¼ŒGitHubä¸“é—¨ä¸ºæˆ‘ä»¬æ–°åˆ›å»ºçš„åº”ç”¨ç¨‹åºåˆ›å»ºäº†ä¸€ä¸ªå®¢æˆ·ç«¯IDå’Œå®¢æˆ·ç«¯å¯†ç ã€‚å°†å®¢æˆ·ç«¯IDå’Œå¯†é’¥å¤åˆ¶åˆ°å‰ªè´´æ¿ã€‚ç‚¹å‡»<strong>ç”Ÿæˆæ–°çš„å®¢æˆ·ç«¯å¯†ç </strong>å¹¶è·å¾—ä¸€ä¸ªå®¢æˆ·ç«¯å¯†ç ã€‚</p>
<h4 id="add-an-environmental-variable">æ·»åŠ ç¯å¢ƒå˜é‡</h4>
<p>æ¥ä¸‹æ¥ï¼Œåœ¨é¡¹ç›®çš„æ ¹ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª<code>.env.local</code>æ–‡ä»¶ã€‚Next.jså†…ç½®äº†å¯¹ç¯å¢ƒå˜é‡çš„æ”¯æŒï¼Œ<code>.env.local</code>ä¼šå°†è¿™äº›å˜é‡åŠ è½½åˆ°<code>process.env</code>ä¸­ã€‚å› æ­¤ï¼Œæ–‡ä»¶åä¸èƒ½æ˜¯éšæœºåç§°ã€‚è¦äº†è§£æ›´å¤šä¿¡æ¯ï¼Œè¯·é˜…è¯»<a href="https://nextjs.org/docs/basic-features/environment-variables" target="_blank" rel="noopener"> Next.jså…³äºç¯å¢ƒå˜é‡</a>çš„æ–‡æ¡£ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œç”¨ä»¥ä¸‹å†…å®¹å¡«å……å®ƒ:</p>
<pre class="language-text hljs">GITHUB_ID=&lt;client id of your github auth app should go in here&gt;
GITHUB_SECRET=&lt;client secret of your github app should go in here&gt;
NEXTAUTH_URL=http://localhost:3000
/pre&gt;</pre>
<blockquote><p>Â </p>
<p><code>[NEXTAUTH_URL](<a href="https://next-auth.js.org/configuration/options" rel="nofollow">https://next-auth.js.org/configuration/options</a>)</code>æ˜¯æˆ‘ä»¬åº”ç”¨çš„ç½‘å€ã€‚ç¡®ä¿ä½¿ç”¨è¿è¡Œå¼€å‘æœåŠ¡å™¨çš„ç«¯å£ã€‚</p>
<p>Â </p></blockquote>
<p>Â </p>
<p>ç°åœ¨ï¼Œå›åˆ°æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºã€‚æˆ‘ä»¬å°†åœ¨<code>pages/api/auth</code>ä¸­åˆ›å»ºä¸€ä¸ªåä¸º<code>[...nextauth].js</code>çš„æ–‡ä»¶ï¼Œå¹¶æ·»åŠ ä»¥ä¸‹ä»£ç :</p>
<p>Â </p>
<pre class="language-javascript hljs">import NextAuth from 'next-auth'
import GitHubProvider from "next-auth/providers/github";

const options = {
    providers: [
        GitHubProvider({
            clientId: process.env.GITHUB_ID,
            clientSecret: process.env.GITHUB_SECRET
        }),
    ],
}

rest apiexport default (req, res) =&gt; NextAuth(req, res, options)
</pre>
<p>åœ¨ç¬¬1è¡Œï¼Œæˆ‘ä»¬æ­£åœ¨å¯¼å…¥NextAuthï¼Œè¿™æ˜¯æˆ‘ä»¬çš„ä¸»åŒ…ã€‚åœ¨ç¬¬2è¡Œï¼Œæˆ‘ä»¬ä»<code>next-auth</code>åº“å¯¼å…¥äº†æˆ‘ä»¬çš„<a href="https://next-auth.js.org/providers/github" target="_blank" rel="noopener"> GitHubæä¾›è€…</a>ï¼Œè¿™äº›æœåŠ¡å¯ä»¥é›†æˆåˆ°æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºä¸­ï¼Œå…è®¸ç”¨æˆ·ç™»å½•ã€‚</p>
<p>åœ¨ç¬¬6è¡Œï¼Œæˆ‘ä»¬æ­£åœ¨é…ç½®GitHubæä¾›è€…ï¼Œå¹¶é€šè¿‡ç¯å¢ƒå˜é‡ä¼ é€’GitHubç§˜å¯†å’Œå®¢æˆ·ç«¯IDã€‚æœ€åï¼Œåœ¨ç¬¬13è¡Œï¼Œæˆ‘ä»¬å¯¼å‡ºäº†ä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°è¿”å›NextAuthå¹¶æ¥å—optionså˜é‡ä½œä¸ºç¬¬ä¸‰ä¸ªå‚æ•°ã€‚</p>
<p>å¥½å§ï¼Œå¥‡è¿¹å·²ç»å‘ç”Ÿäº†ã€‚å¦‚æœæˆ‘ä»¬åˆ©ç”¨ç”±<code>next-auth</code>æä¾›çš„<a href="https://next-auth.js.org/getting-started/rest-api" target="_blank" rel="noopener"> REST API </a>ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æˆ‘ä»¬çš„GitHubè´¦æˆ·ç™»å½•æˆ‘ä»¬çš„åº”ç”¨ã€‚å¯¼èˆªåˆ°<code><a href="http://localhost:3000/api/auth/signin" rel="nofollow">http://localhost:3000/api/auth/signin</a></code>ï¼Œæ‚¨åº”è¯¥ä¼šçœ‹åˆ°è¿™ä¸ªğŸ‘‡ğŸ½</p>
<figure class="wp-caption aligncenter"><img decoding="async" src="../Images/0e25036794e0592083dd985eb2ac0e7f.png" alt="Sign in With Github Activated" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/12/sign-in-github-page.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" class=" jetpack-lazy-image" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/12/sign-in-github-page.png"/><noscript><img data-lazy-fallback="1" decoding="async" loading="lazy" src="../Images/0e25036794e0592083dd985eb2ac0e7f.png" alt="Sign in With Github Activated" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/12/sign-in-github-page.png"/></noscript><figcaption class="wp-caption-text">Sign in with GitHub activated.</figcaption></figure>
<p>éµå¾ªæµç¨‹ï¼Œç„¶åshazamï¼æ‚¨å·²ç™»å½•ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦ä¿å­˜å¹¶æ˜¾ç¤ºç”¨æˆ·ç™»å½•çŠ¶æ€ã€‚</p>
<h4 id="check-user-login-state-with-the-usesession-hook">ç”¨<code>useSession()</code>é’©æ£€æŸ¥ç”¨æˆ·ç™»å½•çŠ¶æ€</h4>
<p>æˆ‘ä»¬éœ€è¦è·å¾—ç”¨æˆ·çš„ç™»å½•çŠ¶æ€ï¼Œå¹¶åœ¨åº”ç”¨ç¨‹åºçš„å‰ç«¯å‘ˆç°ç”¨æˆ·çš„è¯¦ç»†ä¿¡æ¯ã€‚è¿™å¯ä»¥é€šè¿‡ä½¿ç”¨åä¸º<a href="https://nextjs.org/docs/advanced-features/custom-app" target="_blank" rel="noopener">è‡ªå®šä¹‰åº”ç”¨</a>çš„Next.jsç‰¹æ€§è½»æ¾å®ç°ã€‚ç„¶åï¼Œæˆ‘ä»¬å°†æŠŠç»„ä»¶åŒ…è£…åœ¨ä¸€ä¸ªæä¾›è€…ä¸­ã€‚</p>
<p>åœ¨æ‚¨çš„<code>pages</code>ç›®å½•ä¸­åˆ›å»ºä¸€ä¸ª<code>_app.js</code>æ–‡ä»¶(å¦‚æœå®ƒè¿˜ä¸å­˜åœ¨)å¹¶æ·»åŠ ä»¥ä¸‹ä»£ç :</p>
<pre class="language-javascript hljs">import { SessionProvider } from "next-auth/react"
import '../styles/globals.css'

function MyApp({ Component, pageProps }) {
  return (
    &lt;SessionProvider session={pageProps.session}&gt;
      &lt;Component {...pageProps} /&gt;
    &lt;/SessionProvider&gt;
  )
}

export default MyApp
</pre>
<p>é€šè¿‡å°†ç»„ä»¶åŒ…è£…åœ¨ä¸€ä¸ª<code>Session``Provider</code>ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨é¡µé¢ä¹‹é—´å…±äº«ä¼šè¯çŠ¶æ€ã€‚åè¿‡æ¥ï¼Œè¿™å°†åœ¨é¡µé¢å¯¼èˆªæœŸé—´ä¿æŒæˆ‘ä»¬çš„çŠ¶æ€ï¼Œæé«˜æ€§èƒ½ï¼Œå¹¶å‡å°‘ç½‘ç»œæµé‡ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œæ‰“å¼€<code>components/Header.js</code>æ–‡ä»¶ï¼Œä»<code>next-auth/client</code>å¯¼å…¥<code>useSession</code>ã€<code>signIn</code>å’Œ<code>signOut</code>:</p>
<pre class="language-javascript hljs">import { useSession, signIn, signOut } from 'next-auth/react'
</pre>
<p><code>useSession</code>å°†ç”¨äºç®¡ç†æˆ‘ä»¬ç”¨æˆ·çš„ç™»å½•å’Œæ³¨é”€çŠ¶æ€ï¼Œè€Œ<code>signIn</code>å’Œ<code>signOut</code>å°†ç”¨äºæ‰§è¡Œæˆ‘ä»¬åº”ç”¨ç¨‹åºä¸­çš„ç™»å½•å’Œæ³¨é”€åŠŸèƒ½ã€‚</p>
<p>è®©æˆ‘ä»¬åˆ©ç”¨<code>useSession</code>é’©å­:</p>
<pre class="language-javascript hljs"> const { data: session } = useSession();
</pre>
<p>è¯¥ä¼šè¯å°†è¿”å›ç”¨æˆ·çš„è¯¦ç»†ä¿¡æ¯ã€‚è®©æˆ‘ä»¬ä½¿ç”¨è¿”å›çš„è¯¦ç»†ä¿¡æ¯æœ‰æ¡ä»¶åœ°å‘ˆç°ä¸€ä¸ªç™»å½•å’Œæ³¨é”€æŒ‰é’®ã€‚</p>
<p>ç”¨ä»¥ä¸‹ä»£ç æ›¿æ¢<code>components/Header.js</code>ä¸­returnè¯­å¥ä¸­çš„æ‰€æœ‰å†…å®¹:</p>
<pre class="language-javascript hljs"> &lt;div className='header'&gt;
      &lt;Link href='/'&gt;
        &lt;a className='logo'&gt;NextAuth.js&lt;/a&gt;
      &lt;/Link&gt;
           {session &amp;&amp; &lt;a href="#" onClick={handleSignout} className="btn-signin"&gt;Sign out&lt;/a&gt;  } 
           {!session &amp;&amp; &lt;a href="#" onClick={handleSignin}  className="btn-signin"&gt;Sign in&lt;/a&gt;  } 
    &lt;/div&gt;
</pre>
<p>æˆ‘ä»¬éœ€è¦åˆ›å»º<code>handleSignin</code>å’Œ<code>handleSignout</code>æ–¹æ³•ï¼Œä½¿æˆ‘ä»¬çš„ç”¨æˆ·èƒ½å¤Ÿç™»å½•å’Œæ³¨é”€:</p>
<pre class="language-javascript hljs">const handleSignin = (e) =&gt; {
      e.preventDefault()
      signIn()
  }    
const handleSignout = (e) =&gt; {
      e.preventDefault()
      signOut()
    }
</pre>
<p>æ‚¨çš„<code>Header.js</code>ç°åœ¨åº”è¯¥æ˜¯è¿™æ ·çš„:</p>
<pre class="language-javascript hljs">import Link from 'next/link'
import { useSession, signIn, signOut } from 'next-auth/react'

export default function Header () {
  const { data: session } = useSession();

  const handleSignin = (e) =&gt; {
    e.preventDefault()
    signIn()
  }

  const handleSignout = (e) =&gt; {
    e.preventDefault()
    signOut()
  }

  return (
    &lt;div className='header'&gt;
      &lt;Link href='/'&gt;
        &lt;a className='logo'&gt;NextAuth.js&lt;/a&gt;
      &lt;/Link&gt;
      {session &amp;&amp; &lt;a href="#" onClick={handleSignout} className="btn-signin"&gt;Sign out&lt;/a&gt;  }
      {!session &amp;&amp; &lt;a href="#" onClick={handleSignin}  className="btn-signin"&gt;Sign in&lt;/a&gt;  }
    &lt;/div&gt;
  )
}
</pre>
<p>ä½¿ç”¨æ ‡é¢˜æŒ‰é’®éšæ„ç™»å½•å’Œé€€å‡ºåº”ç”¨ç¨‹åºã€‚</p>
<h4 id="retrieve-and-display-user-information">æ£€ç´¢å’Œæ˜¾ç¤ºç”¨æˆ·ä¿¡æ¯</h4>
<p>ç°åœ¨ï¼Œè¿›å…¥æˆ‘ä»¬çš„<code>pages/index.js</code>ã€‚æˆ‘ä»¬éœ€è¦æ ¹æ®ç”¨æˆ·çš„ç™»å½•ä¿¡æ¯æ˜¾ç¤ºå¹¶æœ‰æ¡ä»¶åœ°å‘ˆç°ç”¨æˆ·ä¿¡æ¯ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬å¿…é¡»ä»<code>next-auth</code>è¿›å£<code>useSession</code>é’©å­ã€‚</p>
<p>æ‰€ä»¥ï¼Œç”¨ä¸‹é¢çš„å†…å®¹æ›¿æ¢ä½ çš„<code>index.js</code>:</p>
<pre class="language-javascript hljs">import Head from 'next/head'
import Header from '../components/Header'
import styles from '../styles/Home.module.css'
import { useSession } from 'next-auth/react'

export default function Home() {
  const { data: session, status } = useSession()
  const loading = status === "loading"

  return (
    &lt;div className={styles.container}&gt;
      &lt;Head&gt;
        &lt;title&gt;Nextjs | Next-Auth&lt;/title&gt;
        &lt;link rel="icon" href="/favicon.ico" /&gt;
      &lt;/Head&gt;
      &lt;Header /&gt;
      &lt;main className={styles.main}&gt;
        &lt;h1 className={styles.title}&gt;Authentication in Next.js app using Next-Auth&lt;/h1&gt;
        &lt;div className={styles.user}&gt;
           {loading &amp;&amp; &lt;div className={styles.title}&gt;Loading...&lt;/div&gt;}
           {
            session &amp;&amp;
              &lt;&gt;
               &lt;p style={{ marginBottom: '10px' }}&gt; Welcome, {session.user.name ?? session.user.email}&lt;/p&gt; &lt;br /&gt;
               &lt;img src={session.user.image} alt="" className={styles.avatar} /&gt;
              &lt;/&gt;
            }
           {
            !session &amp;&amp;
              &lt;&gt;
               &lt;p className={styles.title}&gt;Please Sign in&lt;/p&gt;
               &lt;img src="https://cdn.dribbble.com/users/759083/screenshots/6915953/2.gif" alt="" className={styles.avatar} /&gt;
               &lt;p className={styles.credit}&gt;GIF by &lt;a href="https://dribbble.com/shots/6915953-Another-man-down/attachments/6915953-Another-man-down?mode=media"&gt;Another man&lt;/a&gt; &lt;/p&gt;
              &lt;/&gt;
           }
         &lt;/div&gt;
      &lt;/main&gt;
    &lt;/div&gt;
  )
}
</pre>
<p>åœ¨è¿™æ®µä»£ç ä¸­ï¼Œå¦‚æœç”¨æˆ·ç™»å½•åˆ°æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ä¼šè¯çŠ¶æ€ä¸­çš„æ•°æ®æœ‰æ¡ä»¶åœ°å‘ˆç°ç”¨æˆ·çš„å›¾åƒã€å§“åå’Œç…§ç‰‡ã€‚å¦‚æœç”¨æˆ·æ²¡æœ‰ç™»å½•ï¼Œæˆ‘ä»¬ä¼šæ˜¾ç¤ºä¸€ä¸ªè™šæ‹Ÿçš„GIFï¼Œå…¶ä¸­åŒ…å«æŒ‡ç¤ºä»–ä»¬ç™»å½•çš„æ–‡æœ¬ã€‚</p>
<h3 id="Create-a-google-oauth-app">åˆ›å»ºä¸€ä¸ªè°·æ­ŒOAuthåº”ç”¨</h3>
<p>ä¸ºäº†å…è®¸ç”¨æˆ·ä½¿ç”¨ä»–ä»¬çš„Googleå¸æˆ·ç™»å½•æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºï¼Œæˆ‘ä»¬å¿…é¡»ä»<a href="https://console.developers.google.com/" target="_blank" rel="noopener"> Google APIæ§åˆ¶å°</a>è·å–OAuth 2.0å®¢æˆ·ç«¯å‡­è¯ã€‚å¯¼èˆªåˆ°<strong> C <em> <em/> </em> </strong>å‡­è¯ï¼Œç‚¹å‡»<strong>åˆ›å»ºå‡­è¯</strong>ï¼Œç„¶åç‚¹å‡»<strong> OAuthå®¢æˆ·ç«¯ID </strong>:</p>
<figure class="wp-caption aligncenter"><img decoding="async" src="../Images/7a69bdfcede1c584af067f79aea528e8.png" alt="Create Google OAuth Client ID." data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/12/create-google-oauth-client-id.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" class=" jetpack-lazy-image" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/12/create-google-oauth-client-id.png"/><noscript><img data-lazy-fallback="1" decoding="async" loading="lazy" src="../Images/7a69bdfcede1c584af067f79aea528e8.png" alt="Create Google OAuth Client ID." data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/12/create-google-oauth-client-id.png"/></noscript><figcaption class="wp-caption-text">Create Google OAuth client ID.</figcaption></figure>
<p>æ‚¨å°†è¢«è¦æ±‚å¡«å†™ä»¥ä¸‹å†…å®¹:</p>
<ul>
<li><strong>é€‰æ‹©åº”ç”¨ç±»å‹</strong>:é€‰æ‹©<strong> Webåº”ç”¨</strong></li>
<li><strong>åç§°</strong>:è¿™æ˜¯æ‚¨çš„åº”ç”¨ç¨‹åºçš„åç§°</li>
<li><strong>æˆæƒçš„JavaScriptèµ·æº</strong>:è¿™æ˜¯æˆ‘ä»¬åº”ç”¨ç¨‹åºä¸»é¡µçš„å®Œæ•´URLã€‚ç”±äºæˆ‘ä»¬ä»å¤„äºå¼€å‘æ¨¡å¼ï¼Œæˆ‘ä»¬å°†å¡«å†™è¿è¡Œå¼€å‘æœåŠ¡å™¨çš„å®Œæ•´URLã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®ƒæ˜¯<code><a href="http://localhost:3000" rel="nofollow">http://localhost:3000</a></code></li>
<li><strong>æˆæƒé‡å®šå‘URIs </strong>:ç”¨æˆ·é€šè¿‡è°·æ­Œè®¤è¯åå°†è¢«é‡å®šå‘åˆ°æ­¤è·¯å¾„:<code><a href="http://localhost:3000/api/auth/callback/google" rel="nofollow">http://localhost:3000/api/auth/callback/google</a></code></li>
</ul>
<p>æ¥ä¸‹æ¥ï¼Œä¸€ä¸ªå¼¹å‡ºçª—å£å°†æ˜¾ç¤ºæ‚¨çš„å®¢æˆ·ç«¯IDå’Œå®¢æˆ·ç«¯å¯†ç ã€‚å°†å®ƒä»¬å¤åˆ¶å¹¶æ·»åŠ åˆ°æ‚¨çš„<code>env.local</code>æ–‡ä»¶ä¸­:</p>
<pre class="language-text hljs">GOOGLE_ID=&lt;client id of your google auth app should go in here&gt;
GOOGLE_SECRET=&lt;client secret of your google auth app should go in here&gt;
</pre>
<p>æ¥ä¸‹æ¥ï¼Œå¯¼èˆªåˆ°<code>pages/api/auth/[...nextauth].js</code>ï¼Œå°†ä»¥ä¸‹å†…å®¹æ·»åŠ åˆ°æ‚¨çš„æä¾›å•†åˆ—è¡¨ä¸­:</p>
<pre class="language-javascript hljs">import GoogleProvider from 'next-auth/providers/google';
...
   GoogleProvider({
      clientId: process.env.GOOGLE_ID,
      clientSecret: process.env.GOOGLE_SECRET,
    }),
...
</pre>
<p>æ‚¨çš„<code>[...nextauth].js</code>ç°åœ¨åº”è¯¥æ˜¯è¿™æ ·çš„:</p>
<pre class="language-javascript hljs">import NextAuth from 'next-auth';
import GitHubProvider from 'next-auth/providers/github';
import GoogleProvider from 'next-auth/providers/google';

const options = {
    providers: [
        GitHubProvider({
            clientId: process.env.GITHUB_ID,
            clientSecret: process.env.GITHUB_SECRET
        }),
        GoogleProvider({
          clientId: process.env.GOOGLE_ID,
          clientSecret: process.env.GOOGLE_SECRET,
        }),
    ],
}

export default (req, res) =&gt; NextAuth(req, res, options)
</pre>
<p>è¦ä½¿ç”¨Googleå¸æˆ·æµ‹è¯•ç”¨æˆ·ç™»å½•ï¼Œé€€å‡ºå¼€å‘æœåŠ¡å™¨å¹¶è¿è¡Œ<code>npm run dev</code>ã€‚<br/>ç°åœ¨ï¼ŒåæŒ‡äº¤å‰ï¼Œæ˜‚é¦–æŒºèƒ¸ï¼Œæˆ‘ä»¬åº”è¯¥å¯ä»¥ç”¨æˆ‘ä»¬çš„è°·æ­Œè´¦æˆ·ç™»å½•æˆ‘ä»¬çš„åº”ç”¨äº†:</p>
<figure class="wp-caption aligncenter"><img decoding="async" src="../Images/35062375421797d522ca9b2d76cb604b.png" alt="Sign in with Google activated." data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/12/sign-in-google.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" class=" jetpack-lazy-image" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/12/sign-in-google.png"/><noscript><img data-lazy-fallback="1" decoding="async" loading="lazy" src="../Images/35062375421797d522ca9b2d76cb604b.png" alt="Sign in with Google activated." data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/12/sign-in-google.png"/></noscript><figcaption class="wp-caption-text">Sign in with Google activated.</figcaption></figure>
<h3 id="create-a-facebook-oauth-app">åˆ›å»ºè„¸ä¹¦OAuthåº”ç”¨ç¨‹åº</h3>
<p>è¦ä¸ºæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºä½¿ç”¨è„¸ä¹¦ç™»å½•ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªè„¸ä¹¦å¼€å‘è€…å¸æˆ·ã€‚åˆ›å»ºä¸€ä¸ªå¸æˆ·ï¼Œç„¶ååˆ›å»ºä½ çš„åº”ç”¨ç¨‹åºã€‚å¯¹äºåº”ç”¨ç±»å‹ï¼Œé€‰æ‹©<strong>æ¶ˆè´¹è€…</strong>ã€‚åœ¨è¯¦ç»†ä¿¡æ¯å±å¹•ä¸­ï¼Œé€‰æ‹©ä¸€ä¸ªæ˜¾ç¤ºåç§°ã€‚</p>
<p>å®Œæˆåï¼Œæ‚¨çš„å±å¹•åº”è¯¥å¦‚ä¸‹æ‰€ç¤º:</p>
<figure class="wp-caption aligncenter"><img decoding="async" src="../Images/2e16eda1257b32bd5a45ceac8833e645.png" alt="Login options." data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/12/login-options.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" class=" jetpack-lazy-image" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/12/login-options.png"/><noscript><img data-lazy-fallback="1" decoding="async" loading="lazy" src="../Images/2e16eda1257b32bd5a45ceac8833e645.png" alt="Login options." data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/12/login-options.png"/></noscript><figcaption class="wp-caption-text">Login options.</figcaption></figure>
<p>ç‚¹å‡»<strong>è„¸ä¹¦ç™»å½•</strong>å¹¶é€‰æ‹©<strong>ç½‘é¡µ</strong>ã€‚ç°åœ¨ï¼Œæ·»åŠ ä»¥ä¸‹å†…å®¹:</p>

<p>è¦è·å–æ‚¨çš„åº”ç”¨IDå’Œåº”ç”¨å¯†ç ï¼Œè¯·å¯¼èˆªåˆ°<strong>è®¾ç½®</strong>ä¸­çš„<strong>åŸºæœ¬</strong>éƒ¨åˆ†ï¼Œå¤åˆ¶å®ƒä»¬ï¼Œå¹¶å°†å…¶æ·»åŠ åˆ°æ‚¨çš„<code>env.local</code>æ–‡ä»¶ä¸­ï¼Œå¦‚ä¸‹æ‰€ç¤º:</p>
<pre class="language-text hljs">FACEBOOK_ID=&lt;app id of your facebook app should go in here&gt;
FACEBOOK_SECRET=&lt;app secret of your facebook app should go in here&gt;
</pre>
<blockquote><p>ä¸è¦å¿˜è®°åœ¨<strong>åº”ç”¨ç¨‹åºåŸŸ</strong>å­—æ®µä¸­æ·»åŠ <code><a href="http://localhost:3000/" rel="nofollow">http://localhost:3000/</a></code>ã€‚</p></blockquote>
<p>æ¥ä¸‹æ¥ï¼Œå¯¼èˆªåˆ°<code>pages/api/auth/[...nextauth].js</code>ï¼Œå°†ä»¥ä¸‹å†…å®¹æ·»åŠ åˆ°æ‚¨çš„æä¾›å•†åˆ—è¡¨ä¸­:</p>
<pre class="language-javascript hljs">import FacebookProvider from 'next-auth/providers/facebook';
...
    FacebookProvider({
            clientId: process.env.FACEBOOK_ID,
            clientSecret: process.env.FACEBOOK_SECRET
      })
...
</pre>
<p>æ‚¨çš„<code>[...nextauth].js</code>ç°åœ¨åº”è¯¥æ˜¯è¿™æ ·çš„:</p>
<pre class="language-javascript hljs">import NextAuth from 'next-auth';
import GitHubProvider from 'next-auth/providers/github';
import GoogleProvider from 'next-auth/providers/google';
import FacebookProvider from 'next-auth/providers/facebook';

const options = {
    providers: [
        GitHubProvider({
            clientId: process.env.GITHUB_ID,
            clientSecret: process.env.GITHUB_SECRET
        }),
        GoogleProvider({
          clientId: process.env.GOOGLE_ID,
          clientSecret: process.env.GOOGLE_SECRET,
        }),
        FacebookProvider({
          clientId: process.env.FACEBOOK_ID,
          clientSecret: process.env.FACEBOOK_SECRET
        }),
    ],
}

export default (req, res) =&gt; NextAuth(req, res, options)
</pre>
<p>é‡å¯å¼€å‘æœåŠ¡å™¨åï¼Œç”¨æˆ·åº”è¯¥èƒ½å¤Ÿä½¿ç”¨ä»–ä»¬çš„GitHubã€Googleå’Œè„¸ä¹¦å¸æˆ·ç™»å½•åˆ°æ‚¨çš„Next.jsåº”ç”¨ç¨‹åº:</p>
<figure class="wp-caption aligncenter"><img decoding="async" src="../Images/8334758dcfa395465c58930e7ffd9fbe.png" alt="Sign in with Facebook activated." data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/12/sign-in-facebook.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" class=" jetpack-lazy-image" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/12/sign-in-facebook.png"/><noscript><img data-lazy-fallback="1" decoding="async" loading="lazy" src="../Images/8334758dcfa395465c58930e7ffd9fbe.png" alt="Sign in with Facebook activated." data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/12/sign-in-facebook.png"/></noscript><figcaption class="wp-caption-text">Sign in with Facebook activated.</figcaption></figure>
<h2 id="conclusion">ç»“è®º</h2>
<p>åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨NextAuth.jsåœ¨Next.jsä¸­å®ç°äº†ç”¨æˆ·è®¤è¯ï¼Œè¿™æ˜¯ä¸€ä¸ªå®‰å…¨çš„åº“ï¼Œç”¨äºè¯†åˆ«æˆ‘ä»¬çš„ç”¨æˆ·ï¼Œè·å–ç”¨æˆ·é…ç½®æ–‡ä»¶ä¿¡æ¯ï¼Œå¹¶åœ¨æˆ‘ä»¬çš„å‰ç«¯å‘ˆç°å®ƒä»¬ã€‚æˆ‘ä»¬å·²ç»ä»‹ç»äº†å¤§éƒ¨åˆ†ç”¨ä¾‹ï¼Œä½†æ˜¯æ‚¨è¿˜å¯ä»¥ä½¿ç”¨NextAuth.jsåšæ›´å¤šçš„äº‹æƒ…ã€‚æ‚¨å¯ä»¥ä½¿ç”¨JSON Web Tokenã€å®‰å…¨é¡µé¢ç­‰ç­‰æ¥æ·»åŠ æ•°æ®åº“ã€‚</p>
<p>å¦‚æœä½ æ¸´æœ›äº†è§£æ›´å¤šå†…å®¹ï¼Œè¯·æŸ¥çœ‹NextAuth.jså®˜æ–¹æ–‡æ¡£ä¸­çš„<a href="https://next-auth.js.org/tutorials" target="_blank" rel="noopener">æ•™ç¨‹é¡µé¢</a>ã€‚</p>
<p>è¯·åœ¨ä¸‹é¢çš„è¯„è®ºåŒºå‘Šè¯‰æˆ‘ä½ å¯¹æœ¬æ•™ç¨‹çš„çœ‹æ³•ã€‚ä½ ä¹Ÿå¯ä»¥é€šè¿‡<a href="https://twitter.com/ejirocodes" target="_blank" rel="noopener"> Twitter </a>å’Œ<a href="https://github.com/ejirocodes" target="_blank" rel="noopener"> GitHub </a>è”ç³»æˆ‘ã€‚æ„Ÿè°¢æ‚¨çš„é˜…è¯»ï¼Œæ•¬è¯·å…³æ³¨ã€‚</p><div class="code-block code-block-30">
<div class="blog-plug inline-plug next-plug"><h2><a href="https://lp.logrocket.com/blg/nextjs-signup" target="_blank"> LogRocket </a>:å…¨é¢äº†è§£ç”Ÿäº§Next.jsåº”ç”¨</h2><p>è°ƒè¯•ä¸‹ä¸€ä¸ªåº”ç”¨ç¨‹åºå¯èƒ½ä¼šå¾ˆå›°éš¾ï¼Œå°¤å…¶æ˜¯å½“ç”¨æˆ·é‡åˆ°éš¾ä»¥é‡ç°çš„é—®é¢˜æ—¶ã€‚å¦‚æœæ‚¨å¯¹ç›‘è§†å’Œè·Ÿè¸ªçŠ¶æ€ã€è‡ªåŠ¨æ˜¾ç¤ºJavaScripté”™è¯¯ã€è·Ÿè¸ªç¼“æ…¢çš„ç½‘ç»œè¯·æ±‚å’Œç»„ä»¶åŠ è½½æ—¶é—´æ„Ÿå…´è¶£ï¼Œ</p><a href="https://lp.logrocket.com/blg/nextjs-signup" target="_blank">try LogRocket</a><p>. </p><a class="signup" href="https://lp.logrocket.com/blg/nextjs-signup" target="_blank" rel="noopener noreferrer"><img class="alignnone size-full wp-image-46 jetpack-lazy-image" src="../Images/f300c244a1a1cf916df8b4cb02bec6c6.png" data-lazy-src="https://files.readme.io/27c94e7-Image_2017-06-05_at_9.46.04_PM.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://files.readme.io/27c94e7-Image_2017-06-05_at_9.46.04_PM.png"/><noscript><img data-lazy-fallback="1" class="alignnone size-full wp-image-46" src="../Images/f300c244a1a1cf916df8b4cb02bec6c6.png" data-original-src="https://files.readme.io/27c94e7-Image_2017-06-05_at_9.46.04_PM.png"/></noscript></a><a class="signup" href="https://lp.logrocket.com/blg/nextjs-signup" target="_blank" rel="noopener noreferrer"><img class="alignnone size-full wp-image-46 jetpack-lazy-image" src="../Images/d6f5a5dd739296c1dd7aab3d5e77eeb9.png" alt="LogRocket Dashboard Free Trial Banner" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png"/><noscript><img data-lazy-fallback="1" class="alignnone size-full wp-image-46" src="../Images/d6f5a5dd739296c1dd7aab3d5e77eeb9.png" alt="LogRocket Dashboard Free Trial Banner" data-original-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png"/></noscript></a><p>LogRocket å°±åƒæ˜¯ç½‘ç»œå’Œç§»åŠ¨åº”ç”¨çš„DVRï¼Œè®°å½•ä¸‹ä½ çš„Next.jsåº”ç”¨ä¸Šå‘ç”Ÿçš„ä¸€åˆ‡ã€‚æ‚¨å¯ä»¥æ±‡æ€»å¹¶æŠ¥å‘Šé—®é¢˜å‘ç”Ÿæ—¶åº”ç”¨ç¨‹åºçš„çŠ¶æ€ï¼Œè€Œä¸æ˜¯çŒœæµ‹é—®é¢˜å‘ç”Ÿçš„åŸå› ã€‚LogRocketè¿˜å¯ä»¥ç›‘æ§åº”ç”¨ç¨‹åºçš„æ€§èƒ½ï¼ŒæŠ¥å‘Šå®¢æˆ·ç«¯CPUè´Ÿè½½ã€å®¢æˆ·ç«¯å†…å­˜ä½¿ç”¨ç­‰æŒ‡æ ‡ã€‚</p><p>LogRocket Reduxä¸­é—´ä»¶åŒ…ä¸ºæ‚¨çš„ç”¨æˆ·ä¼šè¯å¢åŠ äº†ä¸€å±‚é¢å¤–çš„å¯è§æ€§ã€‚LogRocketè®°å½•Reduxå­˜å‚¨ä¸­çš„æ‰€æœ‰æ“ä½œå’ŒçŠ¶æ€ã€‚</p><p>è®©æ‚¨è°ƒè¯•Next.jsåº”ç”¨çš„æ–¹å¼ç°ä»£åŒ–â€” <a class="signup" href="https://lp.logrocket.com/blg/nextjs-signup" target="_blank" rel="noopener noreferrer">å¼€å§‹å…è´¹ç›‘æ§</a>ã€‚</p></div></div>

<p class="clearfix"/>
<p class="clearfix"/>
</article>

</div>    
</body>
</html>