<html>
<head>
<title>How to create a custom Vuex plugin - LogRocket Blog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>å¦‚ä½•åˆ›å»ºä¸€ä¸ªå®šåˆ¶çš„Vuexæ’ä»¶æ—¥å¿—åšå®¢</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://blog.logrocket.com/how-to-create-a-custom-vuex-plugin/#0001-01-01">https://blog.logrocket.com/how-to-create-a-custom-vuex-plugin/#0001-01-01</a></blockquote><div><article class="article-post">
<p>Vuexæ’ä»¶æ˜¯Vuexä¸­æœ€å…ˆè¿›å’Œæœ€æœ‰ç”¨çš„æ¦‚å¿µä¹‹ä¸€ã€‚ä»–ä»¬æœ‰å„ç§å„æ ·çš„ç”¨ä¾‹ï¼Œä»æ•°æ®æŒä¹…æ€§åˆ°<a href="https://github.com/Kaperskyguru/vuex-slack-notifier"> Slacké€šçŸ¥å™¨</a>ï¼Œå†åˆ°å¢å¼ºVuexæœ¬èº«ã€‚</p>
<p>Vuexæ’ä»¶åªæ˜¯ä¸€ä¸ªæ¥æ”¶å•†åº—ä½œä¸ºå”¯ä¸€å‚æ•°çš„å‡½æ•°ã€‚ç®€å•æ¥è¯´ï¼Œæ’ä»¶å°±æ˜¯åœ¨Vuexä¸­è°ƒç”¨æŸç§ç±»å‹çš„çªå˜æˆ–åŠ¨ä½œæ—¶è§¦å‘/è°ƒç”¨çš„åŠŸèƒ½ã€‚</p>
<p>åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†å¸¦ä½ äº†è§£å¦‚ä½•åˆ›å»ºä¸€ä¸ªå®šåˆ¶çš„Vuexæ’ä»¶ã€‚</p>
<h2 id="subscribingtomutationhooks">è®¢é˜…çªå˜æŒ‚é’©</h2>
<p>åœ¨è®¢é˜…å˜å¼‚é’©å­çš„æ—¶å€™ï¼Œè®°ä½æ’ä»¶æ˜¯ä¸å…è®¸ç›´æ¥å˜å¼‚çŠ¶æ€çš„ã€‚å®ƒä»¬åªèƒ½é€šè¿‡Vuexçªå˜æ¥å¼•å‘å˜åŒ–ã€‚</p>
<p>çªå˜æŒ‚é’©å…¬å¼€äº†ä¸¤ä¸ªå±æ€§:</p>
<ol>
<li><code>mutation.type</code>ç”¨äºç¡®å®šè¢«è§¦å‘çš„çªå˜/åŠ¨ä½œçš„åç§°</li>
<li><code>mutation.payload</code>ç”¨äºæ£€ç´¢è¦æäº¤çš„æ•°æ®<pre>export default (store) =&gt; { store.subscribe((mutation) =&gt; { if (mutation.type === "STORE_ERRORS") { // Alert Slack here console.log(mutation.type, mutation.payload) } }); };</pre></li>
</ol>
<h2 id="subscribingtoactionhooks">è®¢é˜…åŠ¨ä½œæŒ‚é’©</h2>
<p>é™¤äº†å‘<code>type</code>å’Œ<code>payload</code>å‘é€å…³äºè¢«è°ƒç”¨çš„VuexåŠ¨ä½œçš„ä¿¡æ¯ï¼Œè€Œä¸æ˜¯å˜å¼‚ä¿¡æ¯ä¹‹å¤–ï¼Œ<code>subscribeAction()</code>çš„å·¥ä½œæ–¹å¼ä¸<code>subscribe()</code>å®Œå…¨ç›¸åŒã€‚</p>
<pre>  store.subscribeAction((action) =&gt; {
    if (action.type === "getTodos") {
      // Alert Slack here
      console.log(action.type, action.payload)
    }
  });
</pre>
<p>Vuex 3.1.0ä¸­å¢åŠ äº†<code>subscribeAction</code>ã€‚å¦‚æœä½ è¿˜æ²¡æœ‰ï¼Œä½ å¯èƒ½æƒ³å‡çº§å®ƒã€‚</p>
<h2 id="buildingslacknotifiervuexplugin">æ„å»ºæ¾å¼›é€šçŸ¥å™¨Vuexæ’ä»¶</h2>
<p>è®©æˆ‘ä»¬ç»“åˆç›®å‰æ‰€å­¦çš„çŸ¥è¯†æ¥æ„å»ºä¸€ä¸ªå®šåˆ¶çš„Vuexæ’ä»¶ï¼Œå®ƒå°†åœ¨æäº¤çŠ¶æ€æ—¶é€šçŸ¥Slacké€šé“ä»»ä½•é”™è¯¯ã€‚</p>
<h3 id="createpluginclass">åˆ›å»º<code>plugin</code>ç±»</h3>
<p>åœ¨<code>plugins</code>æ–‡ä»¶å¤¹ä¸­åˆ›å»ºä¸€ä¸ªæ–‡ä»¶</p>
<pre>mkdir plugins

touch SlackNotifier.js</pre>
<h3 id="createstore_errorsmutation">åˆ›é€ <code>STORE_ERRORS</code>çªå˜</h3>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªåä¸º<code>STORE_ERRORS</code>çš„Vuexå˜å¼‚ã€‚æ‚¨å¯ä»¥å®ç°è¿™ç§Vuexå˜å¼‚æ¥å­˜å‚¨çŠ¶æ€ä¸­çš„é”™è¯¯ï¼Œæˆ–è€…ä½¿ç”¨å„ç§åŒ…(å¦‚sweetalert)æ¥æ˜¾ç¤ºé”™è¯¯è­¦æŠ¥ã€‚</p>
<p>åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å°†ç®€å•åœ°æŠŠé”™è¯¯å‘é€ç»™æˆ‘ä»¬çš„<code>ErrorService</code>æ¥å¤„ç†å¹¶åœ¨æˆ‘ä»¬çš„ç»„ä»¶ä¸Šæ˜¾ç¤ºå®ƒä»¬ã€‚</p>
<pre>  mutations: {
    // ....

    STORE_ERRORS: (state, error) =&gt; {
      // Call Error Service here
      ErrorService.onError(error);

      // Store error to state(optional)
      if (error.response) {
        state.errors = error.response;
      }
    },

    // ...
  },
</pre>
<p>æ¯å½“è¿™ä¸ªVuexçªå˜è¢«è°ƒç”¨æ—¶ï¼Œæˆ‘ä»¬å¸Œæœ›æˆ‘ä»¬çš„Vuexæ’ä»¶è§¦å‘å¹¶å‘é€é”™è¯¯åˆ°Slackã€‚</p>
<h2 id="buildingtheslacknotifier">å»ºç­‘<code>SlackNotifier</code></h2>
<p>æ‰“å¼€ä½ çš„<code>SlackNotifier</code>ç±»å¹¶ç²˜è´´ä¸‹é¢çš„ä»£ç ã€‚è¯·è®°ä½ä¿®æ”¹æ‚¨çš„ä»£ç ï¼Œä»¥é€‚åº”æ‚¨æƒ³è¦è§‚å¯Ÿçš„Vuexçªå˜å’ŒåŠ¨ä½œçš„ç±»å‹ã€‚åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œæ˜¯<code>STORE_ERRORS</code>çªå˜å’Œæˆ‘ä»¬æ‰€æœ‰çš„VuexåŠ¨ä½œ(ä½ å¯èƒ½æƒ³ä¹Ÿå¯èƒ½ä¸æƒ³è¿™ä¹ˆåš)ã€‚</p>
<pre>import axios from "axios";
const url = // Your Slack Webhook here;
export default (store) =&gt; {
  store.subscribe((mutation) =&gt; {
    if (mutation.type === "STORE_ERRORS") {
      // Alert Slack here
      errorSlackAlert(mutation.payload);
    }
  });
  store.subscribeAction((action) =&gt; {
    // Alert Slack here
    vuexActionSlackAlert(action.type);
  });
};
function vuexActionSlackAlert(type) {
  const data = {
    username: "Action Notifier",
    icon_emoji: ":bangbang:",
  };
  data.text = `Vuex "${type}" action was excuted`;
  data.attachments = [];
  data.attachments = [
    {
      color: "#eed140",
      fields: [
        {
          title: "Environment",
          value: "Development",
          short: true,
        },
      ],
    },
  ];
  postToSlack(data);
}
function errorSlackAlert(payload) {
  const data = {
    username: "Error Notifier",
    icon_emoji: ":bangbang:",
  };
  data.text = payload.message;
  if (payload.resource) {
    data.text = payload.resource.message;
  }
  data.attachments = [];
  data.attachments = [
    {
      color: "#eed140",
      fields: [
        {
          title: "Environment",
          value: "Development",
          short: true,
        },
        {
          title: "StackTrace",
          value: payload.fileName,
          short: true,
        },
      ],
    },
  ];
  postToSlack(data);
}
function postToSlack(message) {
  axios
    .post(url, JSON.stringify(message))
    .then((result) =&gt; console.log(result))
    .catch((error) =&gt; console.log(error));
}
</pre>
<p>é˜…è¯»<a href="https://api.slack.com/messaging/webhooks" target="_blank" rel="noopener noreferrer">å®˜æ–¹æ–‡æ¡£</a>äº†è§£æ›´å¤šå…³äºSlack APIçš„ä¿¡æ¯ã€‚</p>
<p>è®©æˆ‘ä»¬æ¥è§¦åˆ°æ‰€æœ‰çš„Vuexçªå˜ã€‚æ¯å½“è°ƒç”¨æˆ–æ‰§è¡Œå˜å¼‚æ—¶ï¼Œæ£€æŸ¥ä»¥ç¡®ä¿è°ƒç”¨çš„å˜å¼‚ç±»å‹ä¸<code>STORE_ERRORS</code>åŒ¹é…ã€‚å¦‚æœæ˜¯çš„è¯ï¼Œè°ƒç”¨<code>errorSlackAlert</code>æ¥ä¼ é€’<code>payload</code>ï¼Œå®ƒä¼šæ ¹æ®Slackçš„è¦æ±‚æ ¼å¼åŒ–æ¶ˆæ¯ã€‚ç„¶åï¼Œè°ƒç”¨<code>postToSlack</code>å°†æ¶ˆæ¯å‘å¸ƒåˆ°Slack webhookã€‚</p>
<p><img decoding="async" src="../Images/ea78edc648997be78b76b8a7fb5d7036.png" alt="Slack Error Notifier Bot" data-lazy-src="https://paper-attachments.dropbox.com/s_CC026314000B9A7BE4928E193CAC7DE55580F1C451BD150293CA75B75BF9DE40_1595648917938_file.jpeg?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" class=" jetpack-lazy-image" data-original-src="https://paper-attachments.dropbox.com/s_CC026314000B9A7BE4928E193CAC7DE55580F1C451BD150293CA75B75BF9DE40_1595648917938_file.jpeg"/></p><noscript><img data-lazy-fallback="1" decoding="async" src="../Images/ea78edc648997be78b76b8a7fb5d7036.png" alt="Slack Error Notifier Bot" data-original-src="https://paper-attachments.dropbox.com/s_CC026314000B9A7BE4928E193CAC7DE55580F1C451BD150293CA75B75BF9DE40_1595648917938_file.jpeg"/></noscript>
<p>åŒæ ·çš„äº‹æƒ…ä¹Ÿå‘ç”Ÿåœ¨<code>store.subscribeAction(â€¦â€¦.)</code>ä¸Šï¼Œé™¤äº†è¿™æ¬¡æˆ‘ä»¬ä¸æ£€æŸ¥ä»»ä½•ç‰¹å®šç±»å‹çš„VuexåŠ¨ä½œï¼Œè€Œæ˜¯é€šçŸ¥Slackä»»ä½•è¢«è§¦å‘çš„åŠ¨ä½œã€‚</p>
<p><img decoding="async" src="../Images/ee3774161bbccb218b87e139f10718c6.png" alt="Slack Action Notifier Bot" data-lazy-src="https://paper-attachments.dropbox.com/s_CC026314000B9A7BE4928E193CAC7DE55580F1C451BD150293CA75B75BF9DE40_1595648895758_file.jpeg?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" class=" jetpack-lazy-image" data-original-src="https://paper-attachments.dropbox.com/s_CC026314000B9A7BE4928E193CAC7DE55580F1C451BD150293CA75B75BF9DE40_1595648895758_file.jpeg"/></p><noscript><img data-lazy-fallback="1" decoding="async" src="../Images/ee3774161bbccb218b87e139f10718c6.png" alt="Slack Action Notifier Bot" data-original-src="https://paper-attachments.dropbox.com/s_CC026314000B9A7BE4928E193CAC7DE55580F1C451BD150293CA75B75BF9DE40_1595648895758_file.jpeg"/></noscript>
<h2 id="conclusion">ç»“è®º</h2>
<p>å¦‚æœä½ å·²ç»åšåˆ°è¿™ä¸€æ­¥ï¼Œä½ åº”è¯¥å¯¹Vuexä¸­çš„æ’ä»¶æœ‰æ›´æ·±çš„ç†è§£ã€‚ä½ è¿˜åº”è¯¥æ‹¥æœ‰æ„å»ºè‡ªå·±çš„å®šåˆ¶Vuexæ’ä»¶æ‰€éœ€çš„ç»éªŒå’ŒçŸ¥è¯†ã€‚</p>
<p>å¦‚æœä½ æƒ³ä¸ºGithubä¸Šçš„<a href="https://github.com/Kaperskyguru/vuex-slack-notifier" target="_blank" rel="noopener noreferrer"> Vuex Slacké€šçŸ¥ç¨‹åºåšè´¡çŒ®ï¼Œ</a>å‘é€ä¸€ä¸ªPRğŸ˜</p><div class="code-block code-block-20">
<div class="blog-plug inline-plug vue-inline"><h2>åƒç”¨æˆ·ä¸€æ ·ä½“éªŒæ‚¨çš„Vueåº”ç”¨</h2><p>è°ƒè¯•Vue.jsåº”ç”¨ç¨‹åºå¯èƒ½ä¼šå¾ˆå›°éš¾ï¼Œå°¤å…¶æ˜¯å½“ç”¨æˆ·ä¼šè¯æœŸé—´æœ‰å‡ åä¸ª(å¦‚æœä¸æ˜¯å‡ ç™¾ä¸ª)çªå˜æ—¶ã€‚å¦‚æœæ‚¨å¯¹ç›‘è§†å’Œè·Ÿè¸ªç”Ÿäº§ä¸­æ‰€æœ‰ç”¨æˆ·çš„Vueçªå˜æ„Ÿå…´è¶£ï¼Œ</p><a href="https://lp.logrocket.com/blg/vue-signup" target="_blank">try LogRocket</a><p>. </p><a class="signup" href="https://lp.logrocket.com/blg/vue-signup" target="_blank" rel="noopener noreferrer"><img class="alignnone size-full wp-image-46 jetpack-lazy-image" src="../Images/0d269845910c723dd7df26adab9289cb.png" alt="LogRocket Dashboard Free Trial Banner" data-lazy-src="https://files.readme.io/00591d0-687474703a2f2f692e696d6775722e636f6d2f6a3049327856572e706e67.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://files.readme.io/00591d0-687474703a2f2f692e696d6775722e636f6d2f6a3049327856572e706e67.png"/><noscript><img data-lazy-fallback="1" class="alignnone size-full wp-image-46" src="../Images/0d269845910c723dd7df26adab9289cb.png" alt="LogRocket Dashboard Free Trial Banner" data-original-src="https://files.readme.io/00591d0-687474703a2f2f692e696d6775722e636f6d2f6a3049327856572e706e67.png"/></noscript></a><a href="https://lp.logrocket.com/blg/vue-signup" target="_blank" rel="noopener noreferrer">https://logrocket.com/signup/</a><p>LogRocket å°±åƒæ˜¯ç½‘ç»œå’Œç§»åŠ¨åº”ç”¨ç¨‹åºçš„DVRï¼Œè®°å½•ä½ çš„Vueåº”ç”¨ç¨‹åºä¸­å‘ç”Ÿçš„ä¸€åˆ‡ï¼ŒåŒ…æ‹¬ç½‘ç»œè¯·æ±‚ã€JavaScripté”™è¯¯ã€æ€§èƒ½é—®é¢˜ç­‰ç­‰ã€‚æ‚¨å¯ä»¥æ±‡æ€»å¹¶æŠ¥å‘Šé—®é¢˜å‘ç”Ÿæ—¶åº”ç”¨ç¨‹åºçš„çŠ¶æ€ï¼Œè€Œä¸æ˜¯çŒœæµ‹é—®é¢˜å‘ç”Ÿçš„åŸå› ã€‚</p><p>LogRocket Vuexæ’ä»¶å°†Vuexçªå˜è®°å½•åˆ°LogRocketæ§åˆ¶å°ï¼Œä¸ºæ‚¨æä¾›å¯¼è‡´é”™è¯¯çš„ç¯å¢ƒï¼Œä»¥åŠå‡ºç°é—®é¢˜æ—¶åº”ç”¨ç¨‹åºçš„çŠ¶æ€ã€‚</p><p>ç°ä»£åŒ–æ‚¨è°ƒè¯•Vueåº”ç”¨çš„æ–¹å¼- <a class="signup" href="https://lp.logrocket.com/blg/vue-signup" target="_blank" rel="noopener noreferrer">å¼€å§‹å…è´¹ç›‘æ§</a>ã€‚</p></div>


</div>

<p class="clearfix"/>
<p class="clearfix"/>
</article>

</div>    
</body>
</html>