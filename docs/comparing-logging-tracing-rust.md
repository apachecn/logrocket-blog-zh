# Rust - LogRocket åšå®¢ä¸­æ—¥å¿—è®°å½•å’Œè·Ÿè¸ªçš„æ¯”è¾ƒ

> åŸæ–‡ï¼š<https://blog.logrocket.com/comparing-logging-tracing-rust/>

ä½œä¸º web å¼€å‘äººå‘˜ï¼Œæˆ‘ä»¬å¿…é¡»å¤„ç†è½¯ä»¶ä¸­å‡ºç°çš„é”™è¯¯ã€è­¦å‘Šã€bug å’Œäº‹ä»¶ï¼Œå› æ­¤é€šè¿‡ç›‘æ§å’Œè®°å½•é‡è¦äº‹ä»¶æ¥äº†è§£è½¯ä»¶çš„ç»“æ„å’Œè¡Œä¸ºä»¥æœ‰æ•ˆåœ°æ”¶é›†è¶³å¤Ÿçš„æ•°æ®æ¥å¸®åŠ©æˆ‘ä»¬æ›´å¿«åœ°æ‰¾åˆ°æ ¹æœ¬åŸå› æ˜¯è‡³å…³é‡è¦çš„ã€‚

æœ‰æ—¶ï¼Œæœ¯è¯­è·Ÿè¸ªå’Œæ—¥å¿—è®°å½•å¯ä»¥äº’æ¢ä½¿ç”¨ï¼Œä½†å®ƒä»¬å¹¶ä¸å®Œå…¨ç›¸åŒã€‚æˆ‘ä»¬å°†äº†è§£å¦‚ä½•åœ¨ Rust åº”ç”¨ç¨‹åºä¸­å°†æ—¥å¿—è®°å½•ä¸ Rust [æ—¥å¿—ç®±](https://crates.io/crates/log)å’Œè·Ÿè¸ªä¸[è·Ÿè¸ªç®±](https://crates.io/crates/tracing)é›†æˆï¼Œå®ƒä»¬ä¹‹é—´çš„åŒºåˆ«ï¼Œä»¥åŠä¸ºä»€ä¹ˆå®ƒä»¬æ˜¯æ¯ä¸ªè½¯ä»¶ä¸å¯æˆ–ç¼ºçš„ä¸€éƒ¨åˆ†ã€‚

## Rust ä¸­è®°å½•å’Œè·Ÿè¸ªçš„åŒºåˆ«

æ—¥å¿—è®°å½•å’Œè·Ÿè¸ªæœ‰ç›¸ä¼¼çš„ç”¨ä¾‹ä»¥åŠå…±åŒçš„ç›®çš„â€”â€”å¸®åŠ©æ‚¨æ‰¾åˆ°åº”ç”¨ç¨‹åºä¸­é—®é¢˜çš„æ ¹æœ¬åŸå› ã€‚

## é“é”ˆä¼æœ¨

æƒ³è±¡ä¸€ä¸‹ï¼Œä½ è®¾è®¡äº†ä¸€ä¸ªè¢« 50ï¼Œ000 å¤šç”¨æˆ·ä½¿ç”¨çš„åº”ç”¨ç¨‹åºï¼Œçªç„¶å®ƒåœ¨ç”Ÿäº§ä¸­åœæ­¢å·¥ä½œäº†ğŸ™„ã€‚å½“ç„¶ï¼Œæ‚¨å·²ç»æµ‹è¯•è¿‡äº†ï¼Œä½†æ˜¯å‡ ä¹ä¸å¯èƒ½æœ‰ 100%çš„çœŸå®æµ‹è¯•è¦†ç›–ç‡ï¼Œè€Œä¸”ï¼Œå³ä½¿æ‚¨çš„æµ‹è¯•è¦†ç›–ç‡æ˜¯ 100%ï¼Œä¹Ÿä¸æ„å‘³ç€æ‚¨çš„ä»£ç æ˜¯å®Œç¾çš„ã€‚ç°åœ¨ï¼Œæ•´ä¸ªå›¢é˜Ÿå˜æˆäº†æ¶ˆé˜²é˜Ÿã€‚

ä½ æ€ä¹ˆçŸ¥é“å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿå¦‚æœæ‚¨åœ¨åº”ç”¨ç¨‹åºä¸­æ”¾ç½®äº†ä¸€æ®µä»£ç æ¥è®°å½•å‘ç”Ÿçš„é”™è¯¯æˆ–è­¦å‘Šï¼Œæ‚¨ä¼šå¾ˆå®¹æ˜“åœ°å¼•ç”¨è¿™äº›æ•°æ®(æ—¥å¿—æ–‡ä»¶)å¹¶æ‰¾å‡ºåœ¨åº”ç”¨ç¨‹åºåœæ­¢å·¥ä½œæˆ–ç»å†åœæœºä¹‹å‰è®°å½•çš„æ¶ˆæ¯ã€‚è¿™å°†æœ‰åŠ©äºæ‚¨æ›´å¿«åœ°æ‰¾åˆ°é—®é¢˜çš„åŸå› ã€‚

åœ¨ Rust ç”Ÿæ€ç³»ç»Ÿä¸­ï¼Œé›†æˆæ—¥å¿—çš„å®é™…å·¥å…·æ˜¯[æ—¥å¿—ç®±](https://crates.io/crates/log/)ã€‚å®ƒæä¾›äº†ä¸€ä¸ª APIï¼Œä»å…¶ä»–åº“ä¸­æŠ½è±¡å‡ºå®é™…çš„æ—¥å¿—å®ç°ã€‚å®ƒè¢«è®¾è®¡æˆå¯ä»¥è¢«å…¶ä»–åº“ç”¨æ¥ä»¥ä»–ä»¬æƒ³è¦çš„ä»»ä½•æ–¹å¼å®ç°æ—¥å¿—è®°å½•ï¼Œä½¿ç”¨åœ¨ Rust ä¸­ä½œä¸ºå®å®ç°çš„æ ‡å‡†æ—¥å¿—è®°å½•çº§åˆ«ã€‚

ä»¥ä¸‹æ˜¯ä¸åŒæ—¥å¿—çº§åˆ«çš„æ ‡å‡†å®:

```
use log::{ info, warn, error, debug, };

debug!("Something weird occured: {}", someDebugVariable);
error!("{}", "And error occured");
info!("{:?}", "Take note");
warn!("{:#?}", "This is important");

```

è®©æˆ‘ä»¬ä½¿ç”¨å®ƒçš„ä¸€ä¸ªå®ç°(ä½ å¯ä»¥åœ¨[æ–‡æ¡£](https://docs.rs/log/latest/log/)ä¸­æ‰¾åˆ°æ›´å¤š)ï¼Œå³`[env_logger](https://docs.rs/env_logger/*/env_logger/)`ã€‚env è®°å½•å™¨æ˜¯ä¸€ä¸ªæœ€å°çš„é…ç½®è®°å½•å™¨ã€‚å®ƒä¸»è¦å…è®¸æ‚¨ä½¿ç”¨ç¯å¢ƒå˜é‡é…ç½®æ—¥å¿—ï¼Œå¦‚ä¸‹æ‰€ç¤º:

```
RUST_LOG=info cargo run

```

è®©æˆ‘ä»¬æ¢ç´¢ä¸€ä¸‹å¦‚ä½•å°†æ—¥å¿—ä¸ env_logger ä¸€èµ·ä½¿ç”¨ã€‚ç¡®ä¿æ‚¨å·²ç»å®‰è£…äº† [Rust åŠå…¶å·¥å…·é“¾](https://www.rust-lang.org/tools/install)ã€‚

é¦–å…ˆï¼Œé€šè¿‡åœ¨ä½ çš„ç»ˆç«¯ä¸Šè¿è¡Œ`cargo init`æ¥åˆå§‹åŒ–ä¸€ä¸ª Rust åº”ç”¨ç¨‹åºï¼Œç„¶åå°†`env_logger`å’Œ`log`ä½œä¸ºä¾èµ–é¡¹æ·»åŠ åˆ°ä½ çš„`Cargo.toml`æ–‡ä»¶ä¸­ã€‚

```
[dependencies]
env_logger = "0.9.0"
log = "0.4.16"

```

Log è¦æ±‚æ‰€æœ‰å®ç°å®ƒçš„åº“å°† log æ·»åŠ ä¸ºä¾èµ–é¡¹ã€‚

æ¥ä¸‹æ¥ï¼Œå°†`log`åŠå…¶`log`çº§å®å¯¼å…¥åˆ°æ‚¨æƒ³è¦æ·»åŠ æ—¥å¿—çš„æ–‡ä»¶ä¸­ã€‚å¯¹äºè¿™ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬å°†å®ƒæ”¾åœ¨`main.rs`æ–‡ä»¶ä¸­ã€‚

ç„¶åï¼Œåœ¨ä½¿ç”¨å®ä¹‹å‰åˆå§‹åŒ–`env_logger`ï¼Œå¦‚ä¸‹æ‰€ç¤º:

```
use log::{ info, error, debug, warn };
fn main() {
    env_logger::init();
    error!("{}", "And error occured");
    warn!("{:#?}", "This is important");
    info!("{:?}", "Take note");
    debug!("Something weird occured: {}", "Error");
}

```

å¦‚æœåœ¨`env_logger`åˆå§‹åŒ–ä¹‹å‰ä½¿ç”¨ä»»ä½•æ—¥å¿—çº§åˆ«ï¼Œå°†ä¸ä¼šæœ‰ä»»ä½•å½±å“ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœæ‚¨ä½¿ç”¨`cargo run`è¿è¡Œè¿™æ®µä»£ç ï¼Œæ§åˆ¶å°ä¸Šåªä¼šæ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯ã€‚

è¿™æ˜¯å› ä¸ºé”™è¯¯æ—¥å¿—çº§åˆ«æ˜¯é»˜è®¤çš„æ—¥å¿—çº§åˆ«ï¼Œå¹¶ä¸”æ˜¯æ—¥å¿—çº§åˆ«å±‚æ¬¡ç»“æ„ä¸­çš„æœ€é«˜çº§åˆ«ã€‚æ‚¨åº”è¯¥æŸ¥çœ‹[æ–‡æ¡£](https://docs.rs/env_logger/latest/env_logger/)ä»¥è·å¾—æ›´å¤šé…ç½®é€‰é¡¹å’Œå…¶ä»–å¯èƒ½é€‚åˆæ‚¨çš„é¡¹ç›®çš„å®ç°é€‰é¡¹ã€‚

## é“é”ˆè‰²ç—•è¿¹

> åœ¨è½¯ä»¶å·¥ç¨‹ä¸­ï¼Œ[è·Ÿè¸ª](https://en.wikipedia.org/wiki/Tracing_(software))æ¶‰åŠæ—¥å¿—è®°å½•çš„ç‰¹æ®Šç”¨é€”ï¼Œä»¥è®°å½•å…³äºç¨‹åºæ‰§è¡Œçš„ä¿¡æ¯â€“ç»´åŸºç™¾ç§‘

è·Ÿè¸ªåŒ…æ‹¬åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ä»å¤´åˆ°å°¾ç›‘è§†ä»£ç é€»è¾‘æµã€‚å¾ˆå®¹æ˜“å‘ç°è¿™å¯¹æ‚¨æœ‰å¤šé‡è¦ï¼Œå°¤å…¶æ˜¯å¦‚æœæ‚¨æ­£åœ¨è®¾è®¡ä¸€ä¸ªå¤§å‹åº”ç”¨ç¨‹åºï¼Œå…¶ä¸­å¯èƒ½ä¼šå‡ºç°å¤ªå¤šé—®é¢˜ï¼Œè°ƒè¯•å¯èƒ½ä¼šå¾ˆç—›è‹¦ï¼›è·Ÿè¸ªä¸ºæ‚¨æä¾›äº†ä»£ç ä¸­æ´»åŠ¨çš„ç³»ç»Ÿæ¦‚è¿°ã€‚

Rust [è·Ÿè¸ª](https://crates.io/crates/tracing)åº“åˆ©ç”¨è·Ÿè¸ªï¼Œå¹¶ä¸ºå¼€å‘äººå‘˜æä¾›ä¸€ä¸ªå…¨é¢çš„æ¡†æ¶ï¼Œå…è®¸æ‚¨ä» Rust ç¨‹åºä¸­æ”¶é›†ç»“æ„åŒ–çš„ã€åŸºäºäº‹ä»¶çš„è¯Šæ–­ä¿¡æ¯ã€‚

ä»£ç è·Ÿè¸ªåŒ…æ‹¬ä¸‰ä¸ªä¸åŒçš„é˜¶æ®µ:

1.  **æ£€æµ‹**:è¿™æ˜¯å‘åº”ç”¨ç¨‹åºæºä»£ç æ·»åŠ è·Ÿè¸ªä»£ç çš„åœ°æ–¹
2.  **å®é™…è·Ÿè¸ª**:åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­çš„è¿™ä¸€ç‚¹ä¸Šï¼Œæ´»åŠ¨è¢«å†™å…¥ç›®æ ‡å¹³å°è¿›è¡Œåˆ†æ
3.  **åˆ†æ**:åˆ†æå’Œè¯„ä¼°è·Ÿè¸ªç³»ç»Ÿæ”¶é›†çš„ä¿¡æ¯ï¼Œä»¥å‘ç°å’Œç†è§£åº”ç”¨ç¨‹åºä¸­çš„é—®é¢˜çš„é˜¶æ®µã€‚è¿™ä¹Ÿæ˜¯ä½ å¯ä»¥æ’å…¥åƒ [LogRocket](https://logrocket.com/) ã€ [Sentry](https://sentry.io/) æˆ– [Grafana](https://grafana.com/) è¿™æ ·çš„å·¥å…·çš„åœ°æ–¹ï¼Œè®©ä½ å¯è§†åŒ–ä½ çš„æ•´ä¸ªç³»ç»Ÿå·¥ä½œæµç¨‹ã€æ€§èƒ½ã€é”™è¯¯å’Œä½ å¯ä»¥æ”¹è¿›çš„åœ°æ–¹

å°±åƒ log ä¸€æ ·ï¼ŒRust tracing åº“æä¾›äº†ä¸€ä¸ªå¥å£®çš„ APIï¼Œå…è®¸åº“å¼€å‘äººå‘˜å®ç°å¿…è¦çš„åŠŸèƒ½æ¥æ”¶é›†æ‰€éœ€çš„è·Ÿè¸ªæ•°æ®ã€‚

å·²ç»ç¼–å†™äº†å‡ ä¸ªåº“æ¥å¤„ç†è·Ÿè¸ªã€‚æ‚¨å¯ä»¥åœ¨[è·Ÿè¸ªæ–‡æ¡£](https://crates.io/crates/tracing)ä¸­æ‰¾åˆ°å®ƒä»¬ã€‚

è®©æˆ‘ä»¬ä»¥[è¿½è¸ªè®¢é˜…è€…](https://docs.rs/tracing-subscriber/)ä¸ºä¾‹ï¼Œçœ‹çœ‹å¦‚ä½•å°†è¿½è¸ªæ•´åˆåˆ°ä½ çš„ Rust åº”ç”¨ä¸­ã€‚å°†`tracing-subscriber`æ·»åŠ åˆ°æ‚¨çš„ä¾èµ–åˆ—è¡¨ä¸­ã€‚ç¡®ä¿æ·»åŠ `tracing`ä½œä¸ºä¾èµ–é¡¹ã€‚

æ‚¨çš„`/Cargo.toml`æ–‡ä»¶åº”è¯¥å¦‚ä¸‹æ‰€ç¤º:

```
[package]
name = "tracing_examples"
version = "0.1.0"
edition = "2021"
# See more keys and their definitions at https://doc.rust-lang.org/cargo/reference/manifest.html
[dependencies]
tracing = "0.1.34"
tracing-subscriber = "0.3.11"

```

æ¥ä¸‹æ¥ï¼Œåœ¨æ‚¨çš„`main.rs`æ–‡ä»¶ä¸­ï¼Œå¯¼å…¥è·Ÿè¸ªåŠå…¶æ—¥å¿—çº§åˆ«ã€‚

```
use tracing::{info, error, Level};
use tracing_subscriber::FmtSubscriber;

fn main() {
    let subscriber = FmtSubscriber::builder()
        .with_max_level(Level::TRACE)
        .finish();
    tracing::subscriber::set_global_default(subscriber).expect("setting default subscriber failed");
    let number_of_teams: i32 = 3;
    info!(number_of_teams, "We've got {} teams!", number_of_teams);
}

```

åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬æ„å»ºäº†ä¸€ä¸ªè®¢é˜…è€…ï¼Œå®ƒè®°å½•äº†`tracing`äº‹ä»¶çš„æ ¼å¼åŒ–è¡¨ç¤ºï¼Œå¹¶å°†çº§åˆ«è®¾ç½®ä¸º`TRACE`ï¼Œè¿™å°†æ•è·å…³äºåº”ç”¨ç¨‹åºè¡Œä¸ºçš„æ‰€æœ‰ç»†èŠ‚ï¼Œå¹¶å¯ç”¨é”™è¯¯ã€è­¦å‘Šã€ä¿¡æ¯å’Œè°ƒè¯•çº§åˆ«ã€‚

ç»“æœåº”è¯¥æ˜¯è¿™æ ·çš„:

```
2022-05-04T23:30:02.401492Z  INFO tracing_examples: We've got 3 teams! number_of_teams=3

```

æ‚¨å¯ä»¥ä½¿ç”¨è¿™ä¸ª[è·Ÿè¸ªé¥æµ‹ç®±](https://crates.io/crates/tracing-opentelemetry)è½»æ¾åœ°ä¸ OpenTelemetry é›†æˆã€‚ä½¿ç”¨è·Ÿè¸ªè¿˜å¯ä»¥åšæ›´å¤šçš„äº‹æƒ…ã€‚æŸ¥çœ‹æ–‡æ¡£ä»¥è·å–æ›´å¤šä¿¡æ¯å’Œç¤ºä¾‹ã€‚

## Rust æ—¥å¿—å’Œè·Ÿè¸ªåº“çš„æ›¿ä»£æ–¹æ¡ˆ

[Slog](https://crates.io/crates/slog) å’Œ log ä¸€æ ·ï¼Œæ˜¯ Rust çš„ä¸€ä¸ªå¯æ‰©å±•çš„æ—¥å¿—åº“ã€‚å®ƒæ—¨åœ¨æˆä¸ºæ ‡å‡†åŸæœ¨æ¿æ¡ç®±çš„è¶…é›†ã€‚ç„¶è€Œï¼Œä¸åŸæœ¨æ¿æ¡ç®±ä¸åŒçš„æ˜¯ï¼Œå®ƒæ›´éš¾ä½¿ç”¨ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªå¦‚ä½•ç™»å½•ç»ˆç«¯çš„ä¾‹å­ï¼›ä»£ç æ”¹ç¼–è‡ªæ–‡æ¡£ã€‚

```
#[macro_use]
extern crate slog;
extern crate slog_term;
extern crate slog_async;

use slog::Drain;

fn main() {
    let decorator = slog_term::TermDecorator::new().build();
    let drain = slog_term::FullFormat::new(decorator).build().fuse();
    let drain = slog_async::Async::new(drain).build().fuse();

    let _log = slog::Logger::root(drain, o!());
}

```

æ­£å¦‚æ‚¨æ‰€çœ‹åˆ°çš„ï¼Œè¿™å¹¶ä¸åƒæ ‡å‡†çš„åŸæœ¨æ¿æ¡ç®±é‚£ä¹ˆç®€å•ï¼Œå› ä¸ºåœ¨ Rust ç”Ÿæ€ç³»ç»Ÿä¸­æ²¡æœ‰å…¬å¼€å¯ç”¨çš„è·Ÿè¸ªæ›¿ä»£æ–¹æ¡ˆã€‚å¦‚æœæ‚¨è®¤è¯†ä»»ä½•äººï¼Œè¯·åœ¨è¯„è®ºéƒ¨åˆ†ä¸æˆ‘ä»¬åˆ†äº«ã€‚

## ç»“è®º

æ²¡æœ‰è½¯ä»¶æ˜¯å®Œç¾çš„ã€‚æ²¡æœ‰äººç¼–å†™ä»£ç å¹¶è®©å®ƒè¿è¡Œçš„æ„å›¾æ˜¯ä¸€åˆ‡éƒ½å°†æ°¸è¿œå·¥ä½œï¼Œä½ åº”è¯¥é¢„æ–™åˆ°ä¸€äº›æ„æƒ³ä¸åˆ°çš„äº‹æƒ…ä¼šå‘ç”Ÿã€‚æ‚¨åº”è¯¥è®¾ç½®æ—¥å¿—è®°å½•å’Œè·Ÿè¸ªæ¥å¸®åŠ©æ‚¨ç›‘æ§æ‚¨çš„åº”ç”¨ç¨‹åºï¼Œè·Ÿè¸ª bugï¼Œå¹¶åœ¨æ‚¨çš„ç”¨æˆ·å¯¹æ‚¨å¤§å¼å¤§å«ä¹‹å‰ä¿®å¤å®ƒä»¬ã€‚

## [log rocket](https://lp.logrocket.com/blg/rust-signup):Rust åº”ç”¨çš„ web å‰ç«¯çš„å…¨é¢å¯è§æ€§

è°ƒè¯• Rust åº”ç”¨ç¨‹åºå¯èƒ½å¾ˆå›°éš¾ï¼Œå°¤å…¶æ˜¯å½“ç”¨æˆ·é‡åˆ°éš¾ä»¥é‡ç°çš„é—®é¢˜æ—¶ã€‚å¦‚æœæ‚¨å¯¹ç›‘æ§å’Œè·Ÿè¸ª Rust åº”ç”¨ç¨‹åºçš„æ€§èƒ½ã€è‡ªåŠ¨æ˜¾ç¤ºé”™è¯¯ã€è·Ÿè¸ªç¼“æ…¢çš„ç½‘ç»œè¯·æ±‚å’ŒåŠ è½½æ—¶é—´æ„Ÿå…´è¶£ï¼Œ

[try LogRocket](https://lp.logrocket.com/blg/rust-signup)

.

[![LogRocket Dashboard Free Trial Banner](img/d6f5a5dd739296c1dd7aab3d5e77eeb9.png)](https://lp.logrocket.com/blg/rust-signup)

LogRocket å°±åƒæ˜¯ç½‘ç»œå’Œç§»åŠ¨åº”ç”¨ç¨‹åºçš„ DVRï¼Œè®°å½•ä½ çš„ Rust åº”ç”¨ç¨‹åºä¸Šå‘ç”Ÿçš„ä¸€åˆ‡ã€‚æ‚¨å¯ä»¥æ±‡æ€»å¹¶æŠ¥å‘Šé—®é¢˜å‘ç”Ÿæ—¶åº”ç”¨ç¨‹åºçš„çŠ¶æ€ï¼Œè€Œä¸æ˜¯çŒœæµ‹é—®é¢˜å‘ç”Ÿçš„åŸå› ã€‚LogRocket è¿˜å¯ä»¥ç›‘æ§åº”ç”¨çš„æ€§èƒ½ï¼ŒæŠ¥å‘Šå®¢æˆ·ç«¯ CPU è´Ÿè½½ã€å®¢æˆ·ç«¯å†…å­˜ä½¿ç”¨ç­‰æŒ‡æ ‡ã€‚

ç°ä»£åŒ–è°ƒè¯• Rust åº”ç”¨çš„æ–¹å¼â€” [å¼€å§‹å…è´¹ç›‘æ§](https://lp.logrocket.com/blg/rust-signup)ã€‚