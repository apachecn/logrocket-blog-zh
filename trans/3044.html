<html>
<head>
<title>Node.js Express test-driven development with Jest - LogRocket Blog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>Node.js ä½¿ç”¨ Jest - LogRocket åšå®¢è¡¨è¾¾æµ‹è¯•é©±åŠ¨å¼€å‘</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://blog.logrocket.com/node-js-express-test-driven-development-jest/#0001-01-01">https://blog.logrocket.com/node-js-express-test-driven-development-jest/#0001-01-01</a></blockquote><div><article class="article-post">
<p>æµ‹è¯•é©±åŠ¨å¼€å‘ï¼Œæˆ– TDDï¼Œæ˜¯å·¥ä½œåœºæ‰€ä¸­ç›¸å½“å¸¸è§çš„ç¼–ç¨‹é£æ ¼ï¼Œå¹¶ä¸”åœ¨è®¸å¤šæƒ…å†µä¸‹ï¼Œå¯¹äºæŸäº›é¡¹ç›®æ˜¯å¼ºåˆ¶æ€§çš„ã€‚å¹¸è¿çš„æ˜¯ï¼Œå½“æ‚¨ç†è§£è¿‡ç¨‹èƒŒåçš„åŸºæœ¬åŸç†æ—¶ï¼ŒTDD éå¸¸ç®€å•ã€‚</p>
<p>JavaScript ä¸­ä¹Ÿæœ‰å¾ˆå¤šç”¨äºåç«¯æµ‹è¯•çš„åº“å’Œæ¡†æ¶ã€‚å…¶ä¸­æœ€å—æ¬¢è¿çš„ä¸¤ä¸ªæ˜¯<a href="https://jestjs.io/" target="_blank" rel="noopener"> Jest </a>å’Œ<a href="https://mochajs.org/" target="_blank" rel="noopener"> Mocha </a>ï¼Œå¦å¤–è¿˜æœ‰<a href="https://jasmine.github.io/" target="_blank" rel="noopener">èŒ‰è‰</a>ã€<a href="https://github.com/avajs/ava" target="_blank" rel="noopener">è‰¾å¨ƒ</a>ã€<a href="https://github.com/substack/tape" target="_blank" rel="noopener">ç£å¸¦</a>å’Œ<a href="https://qunitjs.com/" target="_blank" rel="noopener"> QUnit </a>ã€‚</p>
<p>Node.js ç°åœ¨æœ‰è‡ªå·±çš„å†…ç½®æµ‹è¯•è¿è¡Œå™¨ï¼Œè‡ª 18 ç‰ˆä»¥æ¥ä¸€ç›´ç¨³å®šã€‚ç„¶è€Œï¼Œå®ƒä»å¤„äºå®éªŒæ¨¡å¼ï¼Œå› æ­¤å¾ˆå¯èƒ½ä¼šéšç€æ—¶é—´çš„æ¨ç§»è€Œæ”¹å˜ã€‚</p>
<p>åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†è®¨è®ºå¦‚ä½•ä½¿ç”¨æ–°çš„ Node.js æµ‹è¯•è¿è¡Œå™¨è¿›è¡Œä¸€äº›åŸºæœ¬æµ‹è¯•ï¼Œä»¥åŠä½¿ç”¨ Jest æµ‹è¯•ä¸åŒçš„ç«¯ç‚¹ã€‚</p>

<h2 id="testing-backend">åç«¯æµ‹è¯•</h2>
<p>é¦–å…ˆï¼Œè®©æˆ‘ä»¬å¼€å§‹ä½¿ç”¨ Node.js è¿›è¡Œåç«¯æµ‹è¯•ã€‚</p>
<h2 id="using-node-js-test-runner-test-backend-code">ä½¿ç”¨ Node.js æµ‹è¯•è¿è¡Œå™¨æµ‹è¯•åç«¯ä»£ç </h2>
<p>å¦‚æœæ‚¨æƒ³è¦ä½¿ç”¨å†…ç½®çš„ Node.js æµ‹è¯•è¿è¡Œå™¨ï¼Œæ‚¨éœ€è¦å¯¼å…¥ä¸‹é¢çš„åº“ï¼Œå¹¶æŒ‰ç…§<a href="https://nodejs.org/api/test.html#test-runner"> Node.js æ–‡æ¡£è¿è¡Œæµ‹è¯•</a>:</p>
<pre class="language-javascript hljs">// JavaScript ESM Modules syntax
import test from 'node:test';

// JavaScript CommonJS syntax
const test = require('node:test');
</pre>
<p>å½“ç„¶ï¼Œä½ è¿˜éœ€è¦ç¡®å®šä½ ç”¨çš„æ˜¯ v18 æˆ–è€…æ›´é«˜ç‰ˆæœ¬ã€‚æ‚¨å¯ä»¥ä½¿ç”¨<code>node -v</code>åœ¨å‘½ä»¤è¡Œä¸­æ£€æŸ¥æ‚¨å½“å‰è¿è¡Œçš„ç‰ˆæœ¬ã€‚</p>
<p>é¦–å…ˆï¼Œè®©æˆ‘ä»¬çœ‹çœ‹ä½¿ç”¨å†…ç½®çš„ Node.js æµ‹è¯•è¿è¡Œå™¨è¿›è¡Œæµ‹è¯•æ˜¯ä»€ä¹ˆæ ·çš„ã€‚</p>
<h3 id="project-setup">é¡¹ç›®è®¾ç½®</h3>
<p>æ‰“å¼€æ‚¨çš„ BASH åº”ç”¨ç¨‹åºå¹¶<code>cd</code>åˆ°æ‚¨é€‰æ‹©çš„ç›®å½•ã€‚è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥æ­å»ºæ‚¨çš„é¡¹ç›®:</p>
<pre class="language-shell hljs">mkdir node-backend-testing
cd node-backend-testing
npm init -y
touch index.js index.test.js
</pre>
<p>æ¥ä¸‹æ¥ï¼Œåœ¨ä»£ç ç¼–è¾‘å™¨ä¸­æ‰“å¼€æ–°åˆ›å»ºçš„é¡¹ç›®ï¼Œå¹¶å°†ä»£ç æ·»åŠ åˆ°å®ƒä»¬ç›¸å…³çš„æ–‡ä»¶ä¸­ã€‚</p>
<p>ä¸‹é¢æ˜¯æ–‡ä»¶<code>index.js</code>çš„ä»£ç :</p>
<pre class="language-javascript hljs">const calcAge = (dob) =&gt; {
    const digits = {
        year: 'numeric',
    };

    const year = new Date().toLocaleDateString('en-US', digits);

    console.log(year);

    return year - dob;
};

const createBox = (x, y) =&gt; {
    return x * y;
};

const canDrive = () =&gt; {
    const age = 18;

    if (age &gt;= 18) {
        return 'Full Driving Licence';
    } else {
        return 'Provisional License';
    }
};

const powerLevel = () =&gt; {
    const power = 9001;

    if (power &gt; 9000) {
        return true;
    } else {
        return false;
    }
};

const workSchedule = (employeeOne, employeeTwo) =&gt; {
    return employeeOne + employeeTwo;
};

module.exports = {
    calcAge,

    createBox,

    canDrive,

    powerLevel,

    workSchedule,
};
</pre>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æœ‰äº†<code>index.test.js</code>çš„ä»£ç :</p>
<pre class="language-javascript hljs">const test = require('node:test');

const assert = require('assert/strict');

const {
  calcAge,
  createBox,
  canDrive,
  powerLevel,
  workSchedule,
} = require('./index');

// Calculates how old someone is and depending on the year this test could pass or fail

test('calculates age', () =&gt; {
  return assert.equal(calcAge(2000), 22);
});

// Creates a box with an equal height and width

test('creates a box', async (t) =&gt; {
  await t.test('creates a small box', () =&gt; {
    assert.equal(createBox(10, 10), 100);
  });

  await t.test('creates a large box', () =&gt; {
    assert.equal(createBox(50, 50), 2500);
  });
});

// Checks to see whether or not the person has a full driving licence

test('checks license', () =&gt; {
  return assert.match(`${canDrive()}`, /Full Driving Licence/);
});

// Confirms that the person has a power level that is over 9000!

test('confirms power level', () =&gt; {
  return assert.ok(powerLevel());
});

// Checks to see if the employees have the same amount of shift work days in a week

test('employees have an equal number of work days', () =&gt; {
  const employeeOne = ['Monday', 'Tuesday', 'Wednesday,', 'Thursday'];

  const employeeTwo = ['Friday', 'Saturday', 'Sunday,', 'Monday'];

  return assert.equal(workSchedule(employeeOne.length, employeeTwo.length), 8);
});
</pre>
<p>æœ€åï¼Œä¸ºæ–‡ä»¶<code>package.json</code>æ·»åŠ ä»¥ä¸‹è¿è¡Œè„šæœ¬:</p>
<pre class="language-json hljs">"scripts": {

"test": "node index.test.js"

},
</pre>
<p>æµ‹è¯•è„šæœ¬è¿è¡ŒèŠ‚ç‚¹æµ‹è¯•è¿è¡Œç¨‹åºï¼Œç„¶åè¿è¡Œ<code>index.test.js</code>ä¸­çš„æµ‹è¯•ã€‚</p>
<h3 id="running-node-tests">è¿è¡ŒèŠ‚ç‚¹æµ‹è¯•</h3>
<p>æ‚¨åªéœ€è¦ä»æ ¹æ–‡ä»¶å¤¹ä¸­è¿è¡Œä¸€ä¸ªå‘½ä»¤ã€‚åŒæ ·ï¼Œæ‚¨éœ€è¦ä½¿ç”¨ Node v18 æˆ–æ›´é«˜ç‰ˆæœ¬æ‰èƒ½å·¥ä½œã€‚</p>
<p>è¿è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œæ‚¨åº”è¯¥çœ‹åˆ°æ§åˆ¶å°ä¸­é€šè¿‡äº†äº”ä¸ªæµ‹è¯•:</p>
<pre class="language-shell hljs">npm run test
</pre>
<p>æ‚¨å¯ä»¥è¯•éªŒä¸€ä¸‹<code>index.js</code>å’Œ<code>index.test.js</code>æ–‡ä»¶ä¸­çš„ä»£ç ï¼Œçœ‹çœ‹æµ‹è¯•æ˜¯é€šè¿‡è¿˜æ˜¯å¤±è´¥ã€‚å¦‚æœæ‚¨æŸ¥çœ‹æ§åˆ¶å°ä¸­çš„æµ‹è¯•é”™è¯¯ï¼Œæ‚¨å°±ä¼šçŸ¥é“å¤±è´¥çš„åŸå› ã€‚</p>
<p>ä¸‹é¢æˆ‘ä¸¾å‡ ä¸ªä¾‹å­ã€‚</p>
<h4 id="calculate-age-test">è®¡ç®—å¹´é¾„æµ‹è¯•</h4>
<p>è¦è®¡ç®—ç”¨æˆ·çš„å¹´é¾„ï¼Œè¯·ä½¿ç”¨å½“å‰å¹´ä»½å‡å»å…¶å‡ºç”Ÿå¹´ä»½ã€‚å‚è§ä¸‹é¢<code>index.test.js</code>æ–‡ä»¶ä¸­çš„ä¾‹å­:</p>
<pre class="language-javascript hljs">test('calculates age', () =&gt; {
  return assert.equal(calcAge(2000), 21);
});
</pre>
<p>è¦æŸ¥çœ‹æµ‹è¯•å¤±è´¥ï¼Œè¯·è¾“å…¥ä¸æ­£ç¡®çš„å¹´é¾„ï¼Œå¦‚<code>21</code>ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œè¯¥å‡½æ•°é¢„æœŸè¿”å›å€¼ä¸º<code>22</code>ï¼Œå› æ­¤æ•°å­—<code>21</code>ä¼šå¯¼è‡´æµ‹è¯•å¤±è´¥ã€‚</p>
<h4 id="create--box-test">åˆ›å»ºä¸€ä¸ªç®±å¼æµ‹è¯•</h4>
<p>è¯¥æµ‹è¯•æœŸæœ›æ–¹ç¨‹<code>10 x 10</code>å’Œ<code>50 x 50</code>åˆ†åˆ«ä¸º<code>100</code>å’Œ<code>2500</code>çš„ç­”æ¡ˆã€‚è¾“å…¥ä¸ç¬¦åˆæ­£ç¡®è¾“å‡ºçš„å€¼ï¼Œä»¥æŸ¥çœ‹æµ‹è¯•æ˜¯å¦å¤±è´¥ã€‚</p>
<pre class="language-javascript hljs">test('creates a box', async (t) =&gt; {
  await t.test('creates a small box', () =&gt; {
    assert.equal(createBox(10, 30), 100);
  });

  await t.test('creates a large box', () =&gt; {
    assert.equal(createBox(50, 20), 2500);
  });
});
</pre>
<h4>æ£€æŸ¥è®¸å¯è¯æµ‹è¯•</h4>
<p>è¿™é¡¹æµ‹è¯•æ£€æŸ¥ä¸€ä¸ªäººæ˜¯å¦æœ‰æœ‰æ•ˆçš„é©¾é©¶æ‰§ç…§ã€‚å°†<code>index.js</code>æ–‡ä»¶çš„<code>canDrive</code>å‡½æ•°ä¸­çš„å¹´é¾„æ›´æ”¹ä¸ºå°äº<code>18</code>çš„å€¼ã€‚æµ‹è¯•å°†ä¼šå¤±è´¥ã€‚</p>
<pre class="language-javascript hljs">const canDrive = () =&gt; {
  const age = 17;

  if (age &gt;= 18) {
    return 'Full Driving Licence';
  } else {
    return 'Provisional License';
  }
};
</pre>
<h4 id="confirm-power-level-test">ç¡®è®¤åŠŸç‡æ°´å¹³æµ‹è¯•</h4>
<p>è¿™ä¸ªæµ‹è¯•æ£€éªŒä¸€ä¸ªäººæ˜¯å¦æœ‰è¶…è¿‡ 9000 çš„å¼‚èƒ½æ°´å¹³(ä½ æŠ“åˆ°é¾™ç  Z å‚è€ƒäº†å—ï¼ŸğŸ˜)</p>
<p>å°†<code>index.js</code>æ–‡ä»¶çš„<code>powerLevel</code>åŠŸèƒ½å†…çš„åŠŸç‡æ°´å¹³æ›´æ”¹ä¸ºå°äº<code>9000</code>ã€‚æµ‹è¯•å°†ä¼šå¤±è´¥ã€‚</p>
<pre class="language-javascript hljs">const powerLevel = () =&gt; {
  const power = 5000;

  if (power &gt; 9000) {
    return true;
  } else {
    return false;
  }
};
</pre>
<h4 id="same-number-work-days-test">ç›¸åŒå·¥ä½œæ—¥æ•°æµ‹è¯•</h4>
<p>æ­¤æµ‹è¯•æ£€æŸ¥å‘˜å·¥çš„å·¥ä½œå¤©æ•°æ˜¯å¦ç›¸ç­‰ã€‚</p><div class="code-block code-block-54">
<hr/>
<h3>æ›´å¤šæ¥è‡ª LogRocket çš„ç²¾å½©æ–‡ç« :</h3>

<hr/></div>
<p>ä¸¤åå‘˜å·¥ç›®å‰æ¯äººå·¥ä½œå››å¤©ï¼Œè¿™æ ·æˆ‘ä»¬æ€»å…±å·¥ä½œå…«å¤©ã€‚è¦çœ‹åˆ°æµ‹è¯•å¤±è´¥ï¼Œåªéœ€åœ¨æ•°ç»„ä¸­è¾“å…¥æˆ–åˆ é™¤å‡ å¤©ï¼Œè¿™æ ·å®ƒä»¬å°±ä¸å†æ˜¯ç›¸åŒçš„é•¿åº¦ã€‚</p>
<pre class="language-javascript hljs">test('employees have an equal number of work days', () =&gt; {
  const employeeOne = ['Monday', 'Tuesday', 'Wednesday,', 'Thursday'];

  const employeeTwo = ['Friday', 'Saturday'];

  return assert.equal(workSchedule(employeeOne.length, employeeTwo.length), 8);
});
</pre>
<h2 id="using-jest-test-backend-code">ä½¿ç”¨ Jest æµ‹è¯•åç«¯ä»£ç </h2>
<p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬ä½¿ç”¨ Jest æµ‹è¯•åº“åšä¸€äº›åç«¯æµ‹è¯•ã€‚</p>
<h3 id="jest-project-setup">é¡¹ç›®è®¾ç½®</h3>
<p>æ‰“å¼€æ‚¨çš„ BASH åº”ç”¨ç¨‹åºå¹¶<code>cd</code>åˆ°æ‚¨å–œæ¬¢çš„ç›®å½•ã€‚è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥æ­å»ºæ‚¨çš„é¡¹ç›®:</p>
<pre class="language-shell hljs">mkdir jest-backend-testing
cd jest-backend-testing
npm init -y
npm i express http-errors jest nodemon supertest
mkdir routes
touch routes/products.js
touch app.js app.test.js server.js
</pre>
<p>ç°åœ¨ï¼Œåœ¨ä»£ç ç¼–è¾‘å™¨ä¸­æ‰“å¼€é¡¹ç›®ï¼Œå¹¶å°†ä¸‹é¢çš„ä»£ç æ·»åŠ åˆ°ç›¸åº”çš„æ–‡ä»¶ä¸­ã€‚</p>
<p>ä¸‹é¢æ˜¯æ–‡ä»¶<code>routes/product.js</code>çš„ä»£ç :</p>
<pre class="language-javascript hljs">const express = require('express');

const router = express.Router();

const createError = require('http-errors');

// Products Array

const products = [{ id: '1', name: 'Playstation 5', inStock: false }];

// GET / =&gt; array of items

router.get('/', (req, res) =&gt; {
  res.json(products);
});

// GET / =&gt; items by ID

router.get('/:id', (req, res, next) =&gt; {
  const product = products.find(
    (product) =&gt; product.id === String(req.params.id)
  );

  // GET /id =&gt; 404 if item not found

  if (!product) {
    return next(createError(404, 'Not Found'));
  }

  res.json(product);
});

router.post('/', (req, res, next) =&gt; {
  const { body } = req;

  if (typeof body.name !== 'string') {
    return next(createError(400, 'Validation Error'));
  }

  const newProduct = {
    id: '1',

    name: body.name,

    inStock: false,
  };

  products.push(newProduct);

  res.status(201).json(newProduct);
});

module.exports = router;
</pre>
<p>æ¥ä¸‹æ¥ï¼Œæ–‡ä»¶<code>app.js</code>çš„ä»£ç :</p>
<pre class="language-javascript hljs">const express = require('express');

const productsRoute = require('./routes/products');

const app = express();

app.use(express.urlencoded({ extended: false }));

app.use(express.json());

app.use('/', productsRoute);

module.exports = app;
</pre>
<p>ä¸‹é¢æ˜¯æ–‡ä»¶<code>app.test.js</code>çš„ä»£ç :</p>
<pre class="language-javascript hljs">const request = require('supertest');

const app = require('./app');

describe('GET /', () =&gt; {
  it('GET / =&gt; array of items', () =&gt; {
    return request(app)
      .get('/')

      .expect('Content-Type', /json/)

      .expect(200)

      .then((response) =&gt; {
        expect(response.body).toEqual(
          expect.arrayContaining([
            expect.objectContaining({
              id: expect.any(String),

              name: expect.any(String),

              inStock: expect.any(Boolean),
            }),
          ])
        );
      });
  });

  it('GET / =&gt; items by ID', () =&gt; {
    return request(app)
      .get('/1')

      .expect('Content-Type', /json/)

      .expect(200)

      .then((response) =&gt; {
        expect(response.body).toEqual(
          expect.objectContaining({
            id: expect.any(String),

            name: expect.any(String),

            inStock: expect.any(Boolean),
          })
        );
      });
  });

  it('GET /id =&gt; 404 if item not found', () =&gt; {
    return request(app).get('/10000000000').expect(404);
  });

  it('POST / =&gt; create NEW item', () =&gt; {
    return (
      request(app)
        .post('/')

        // Item send code

        .send({
          name: 'Xbox Series X',
        })

        .expect('Content-Type', /json/)

        .expect(201)

        .then((response) =&gt; {
          expect(response.body).toEqual(
            expect.objectContaining({
              name: 'Xbox Series X',

              inStock: false,
            })
          );
        })
    );
  });

  it('POST / =&gt; item name correct data type check', () =&gt; {
    return request(app).post('/').send({ name: 123456789 }).expect(400);
  });
});
</pre>
<p>å¿«åˆ°äº†ï¼ä¸‹é¢æ˜¯<code>server.js</code>æ–‡ä»¶çš„ä»£ç :</p>
<pre class="language-javascript hljs">const app = require('./app');

const port = process.env.PORT || 3000;

app.listen(port, () =&gt;
  console.log(`Server running on port ${port}, http://localhost:${port}`)
);
</pre>
<p>æœ€åï¼Œå°†è¿™äº›è¿è¡Œè„šæœ¬æ·»åŠ åˆ°æ‚¨çš„<code>package.json</code>æ–‡ä»¶ä¸­ã€‚</p>
<pre class="language-json hljs">"scripts": {

"start": "node server.js",

"dev": "nodemon server.js",

"test": "jest --watchAll"

},
</pre>
<p><code>start</code>è„šæœ¬ä½¿ç”¨ node è¿è¡ŒæœåŠ¡å™¨æ–‡ä»¶ã€‚</p>
<p><code>dev</code>è„šæœ¬ä½¿ç”¨<code>nodemon</code>è¿è¡ŒæœåŠ¡å™¨æ–‡ä»¶ï¼Œæ”¯æŒè‡ªåŠ¨é‡è½½ã€‚</p>
<p><code>test</code>è„šæœ¬è¿è¡Œ test runner Jestï¼Œè¯¥ Jest è‡ªåŠ¨ç›‘è§†æ–‡ä»¶æ›´æ”¹ã€‚</p>
<h3 id="running-jest-tests">è¿è¡Œ Jest æµ‹è¯•</h3>
<p>æ˜¯æ—¶å€™å¯åŠ¨åº”ç”¨ç¨‹åºå¹¶æµ‹è¯• runner äº†ã€‚åœ¨ä¸åŒçš„é€‰é¡¹å¡æˆ–çª—å£ä¸­è¿è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œè¿™æ ·ä¸€ä¸ªè„šæœ¬è¿è¡Œå¼€å‘æœåŠ¡å™¨ï¼Œå¦ä¸€ä¸ªè¿è¡Œ Jest æµ‹è¯•è¿è¡Œç¨‹åºã€‚</p>
<p>æœåŠ¡å™¨è¿è¡Œåœ¨<a href="http://localhost:3000/"> http://localhost:3000/ </a>:</p>
<pre class="language-shell hljs">npm run dev

npm run test
</pre>
<p>æ‚¨ç°åœ¨åº”è¯¥å·²ç»è¿è¡Œäº†<code>dev</code>æœåŠ¡å™¨ã€‚Jest æµ‹è¯•è¿è¡Œç¨‹åºä¹Ÿåº”è¯¥è¿è¡Œäº”ä¸ªé€šè¿‡çš„æµ‹è¯•ã€‚è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹æ¯ä¸ªæµ‹è¯•ï¼Œä½ å¯ä»¥çœ‹åˆ°ä»–ä»¬é€šè¿‡æˆ–å¤±è´¥ã€‚</p>
<p>æµ‹è¯•ä¸æ ‡é¢˜åŒåï¼Œæ‰€ä»¥åœ¨æ–‡ä»¶ä¸­åº”è¯¥å¾ˆå®¹æ˜“æ‰¾åˆ°ã€‚</p>
<h4 id="array-items-test">é¡¹ç›®é˜µåˆ—æµ‹è¯•</h4>
<p>è¿™ä¸ªæµ‹è¯•æ£€æŸ¥æ˜¯å¦è¿”å›äº†ä¸€ä¸ªå¯¹è±¡æ•°ç»„ã€‚è¦çœ‹åˆ°å®ƒå¤±è´¥ï¼Œæ‰“å¼€<code>products.js</code>æ–‡ä»¶ï¼Œç”¨ä¸‹é¢çš„ä»£ç æ›¿æ¢é¡¶éƒ¨çš„è·¯çº¿:</p>
<pre class="language-javascript hljs">router.get('/', (req, res) =&gt; {
  res.send('products');
});
</pre>
<p>æ‚¨åº”è¯¥å¾—åˆ°é”™è¯¯<code>expected Content-Type" matching /json/, got "text/html; charset=utf-8</code>å¹¶ä¸”æµ‹è¯•åº”è¯¥å¤±è´¥ã€‚</p>
<p>ç°åœ¨å°è¯•å°†å®ƒæ”¹ä¸ºä¸‹é¢çš„ä»£ç :</p>
<pre class="language-javascript hljs">router.get('/', (req, res) =&gt; {
  res.json('products');
});
</pre>
<p>æ‚¨åº”è¯¥ä¼šå¾—åˆ°è¿™ä¸ªé”™è¯¯<code>Expected: ArrayContaining [ObjectContaining {"id": Any&lt;String&gt;, "inStock": Any&lt;Boolean&gt;, "name": Any&lt;String&gt;}]</code>ã€‚</p>
<h4 id="items-id-test">é€šè¿‡<code>id</code>æµ‹è¯•çš„é¡¹ç›®</h4>
<p>è¯¥æµ‹è¯•æ£€æŸ¥è¿”å›çš„é¡¹ç›®æ˜¯å¦å¸¦æœ‰æ­£ç¡®çš„<code>id</code>ã€‚å°†<code>products.js</code>ä¸­æ–‡ä»¶é¡¶éƒ¨çš„<code>products</code>æ•°ç»„æ›´æ”¹ä¸ºä¸€ä¸ªæ•°å­—(è€Œä¸æ˜¯å­—ç¬¦ä¸²)çš„<code>id</code>æ¥æŸ¥çœ‹å®ƒæ˜¯å¦å¤±è´¥:</p>
<pre class="language-javascript hljs">const products = [{ id: 1, name: 'Playstation 5', inStock: false }];
</pre>
<p>æ‚¨åº”è¯¥å¾—åˆ°è¿™ä¸ªé”™è¯¯:<code>expected "Content-Type" matching /json/, got "text/html; charset=utf-8"</code>ã€‚</p>
<h4 id="item-not-found-test">æœªæ‰¾åˆ°é¡¹ç›®æµ‹è¯•</h4>
<p>è¯¥æµ‹è¯•æ£€æŸ¥æ˜¯å¦æœ‰é¡¹ç›®æ‰¾ä¸åˆ°ã€‚è¦çœ‹åˆ°å®ƒå¤±è´¥ï¼Œå°†<code>404 error</code>ä»£ç æ›´æ”¹ä¸º<code>products.js</code>æ–‡ä»¶ä¸­çš„å…¶ä»–ä»£ç ï¼Œå¦‚ä¸‹ä¾‹æ‰€ç¤º:</p>
<pre class="language-javascript hljs">if (!product) {
  return next(createError(400, 'Not Found'));
}
</pre>
<p>æ‚¨åº”è¯¥å¾—åˆ°é”™è¯¯:<code>expected 404 "Not Found", got 400 "Bad Request"</code>ã€‚</p>
<h4 id="correct-data-test">æ­£ç¡®æ•°æ®æµ‹è¯•</h4>
<p>è¯¥æµ‹è¯•æ£€æŸ¥å¯¹è±¡æ˜¯å¦å…·æœ‰æ­£ç¡®çš„æ•°æ®å’Œæ•°æ®ç±»å‹ã€‚è¦çœ‹åˆ°å®ƒå¤±è´¥ï¼Œæ‰“å¼€<code>app.test.js</code>æ–‡ä»¶ï¼Œç”¨ä¸‹é¢çš„ä»£ç æ›¿æ¢å‘é€ä»£ç :</p>
<pre class="language-javascript hljs">.send({

name: 'Nintendo Switch',

})
</pre>
<p>æ‚¨åº”è¯¥ä¼šçœ‹åˆ°ä»¥ä¸‹é”™è¯¯:</p>
<pre class="language-shell hljs"> - Expected  - 2
    + Received  + 3

    - ObjectContaining {
    + Object {
    +   "id": "1",
        "inStock": false,
    -   "name": "Xbox Series X",
    +   "name": "Nintendo Switch",
</pre>
<h4 id="correct-data-type-test">æ­£ç¡®æ•°æ®ç±»å‹æµ‹è¯•</h4>
<p>è¯¥æµ‹è¯•æ£€æŸ¥ name å˜é‡çš„æ•°æ®ç±»å‹æ˜¯å¦æ­£ç¡®ã€‚åªæœ‰åœ¨æ£€æµ‹åˆ°å­—ç¬¦ä¸²æ—¶ï¼Œå®ƒæ‰ä¼šå¤±è´¥ã€‚è¦æŸ¥çœ‹æµ‹è¯•æ˜¯å¦å¤±è´¥ï¼Œæ‰“å¼€<code>app.test.js</code>æ–‡ä»¶ï¼Œæ»šåŠ¨åˆ°åº•éƒ¨ï¼Œå°†æ•°å­—æ”¹ä¸ºå¦‚ä¸‹å­—ç¬¦ä¸²:</p>
<pre class="language-javascript hljs">return request(app).post('/').send({ name: '123456789' }).expect(400);
</pre>
<p>æ‚¨åº”è¯¥å¾—åˆ°è¿™ä¸ªé”™è¯¯:<code>expected 400 "Bad Request", got 201 "Created"</code>ã€‚</p>
<h2 id="jest-new-features">ç¬‘è¯ 28:æ–°åŠŸèƒ½</h2>
<p>Jest 28 äº 2022 å¹´ 4 æœˆå‘å¸ƒï¼Œå¹¶å¸¦æ¥äº†è®¸å¤šæ–°åŠŸèƒ½ã€‚æœ€å—æ¬¢è¿çš„åŠŸèƒ½ä¹‹ä¸€å«åš<a href="https://jestjs.io/docs/cli#--shard">s</a>T4ã€‘å“ˆä¸ã€‚æœ¬è´¨ä¸Šï¼Œåˆ†ç‰‡å…è®¸æ‚¨å°†æµ‹è¯•å¥—ä»¶åˆ†å‰²æˆä¸åŒçš„åˆ†ç‰‡æ¥è¿è¡Œå¥—ä»¶æµ‹è¯•çš„ä¸€éƒ¨åˆ†ã€‚</p>
<p>ä¾‹å¦‚ï¼Œè¦è¿è¡Œä¸‰åˆ†ä¹‹ä¸€çš„æµ‹è¯•ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤:</p>
<pre class="language-shell hljs">jest --shard=1/3
jest --shard=2/3
jest --shard=3/3
</pre>
<h2 id="conclusion">ç»“è®º</h2>
<p>ä»…æ­¤è€Œå·²ï¼æˆ‘ä»¬åˆšåˆšä»‹ç»äº†ä½¿ç”¨ Node å’Œ Jest åœ¨åç«¯è¿›è¡Œæµ‹è¯•ã€‚æˆ‘ä»¬æ‰€æ¶µç›–çš„åªæ˜¯æµ‹è¯•çš„åŸºç¡€ï¼Œè¿˜æœ‰å¾ˆå¤šä¸œè¥¿éœ€è¦å­¦ä¹ ï¼ä½ å¯ä»¥åœ¨è¿™é‡ŒæŸ¥çœ‹å…³äº<a href="https://jestjs.io/" target="_blank" rel="noopener"> Jest </a>çš„å®˜æ–¹æ–‡æ¡£ã€‚</p><div class="code-block code-block-23">
<div class="blog-plug inline-plug node-plug"><h2>200 åª<img src="../Images/61167b9d027ca73ed5aaf59a9ec31267.png" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2019/10/green-check.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" class=" jetpack-lazy-image" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/10/green-check.png"/> <noscript> <img data-lazy-fallback="1" src="../Images/61167b9d027ca73ed5aaf59a9ec31267.png" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/10/green-check.png"/> </noscript>æ˜¾ç¤ºå™¨å‡ºç°æ•…éšœï¼Œç”Ÿäº§ä¸­ç½‘ç»œè¯·æ±‚ç¼“æ…¢</h2><p>éƒ¨ç½²åŸºäºèŠ‚ç‚¹çš„ web åº”ç”¨ç¨‹åºæˆ–ç½‘ç«™æ˜¯å®¹æ˜“çš„éƒ¨åˆ†ã€‚ç¡®ä¿æ‚¨çš„èŠ‚ç‚¹å®ä¾‹ç»§ç»­ä¸ºæ‚¨çš„åº”ç”¨ç¨‹åºæä¾›èµ„æºæ˜¯äº‹æƒ…å˜å¾—æ›´åŠ å›°éš¾çš„åœ°æ–¹ã€‚å¦‚æœæ‚¨å¯¹ç¡®ä¿å¯¹åç«¯æˆ–ç¬¬ä¸‰æ–¹æœåŠ¡çš„è¯·æ±‚æˆåŠŸæ„Ÿå…´è¶£ï¼Œ</p><a href="https://lp.logrocket.com/blg/node-signup" target="_blank">try LogRocket</a><p>. </p><a class="signup" href="https://lp.logrocket.com/blg/node-signup" target="_blank" rel="noopener noreferrer"><img src="../Images/cae72fd2a54c5f02a6398c4867894844.png" alt="LogRocket Network Request Monitoring" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2019/12/network-request-filter-2-1.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" class=" jetpack-lazy-image" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/12/network-request-filter-2-1.png"/><noscript><img data-lazy-fallback="1" src="../Images/cae72fd2a54c5f02a6398c4867894844.png" alt="LogRocket Network Request Monitoring" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/12/network-request-filter-2-1.png"/></noscript></a><a href="https://lp.logrocket.com/blg/node-signup" target="_blank" rel="noopener noreferrer">https://logrocket.com/signup/</a><p>LogRocket å°±åƒæ˜¯ç½‘ç»œå’Œç§»åŠ¨åº”ç”¨ç¨‹åºçš„ DVRï¼Œè®°å½•ä¸‹ç”¨æˆ·ä¸ä½ çš„åº”ç”¨ç¨‹åºäº¤äº’æ—¶å‘ç”Ÿçš„ä¸€åˆ‡ã€‚æ‚¨å¯ä»¥æ±‡æ€»å¹¶æŠ¥å‘Šæœ‰é—®é¢˜çš„ç½‘ç»œè¯·æ±‚ï¼Œä»¥å¿«é€Ÿäº†è§£æ ¹æœ¬åŸå› ï¼Œè€Œä¸æ˜¯çŒœæµ‹é—®é¢˜å‘ç”Ÿçš„åŸå› ã€‚</p><p>LogRocket æ£€æµ‹æ‚¨çš„åº”ç”¨ç¨‹åºä»¥è®°å½•åŸºçº¿æ€§èƒ½è®¡æ—¶ï¼Œå¦‚é¡µé¢åŠ è½½æ—¶é—´ã€åˆ°è¾¾ç¬¬ä¸€ä¸ªå­—èŠ‚çš„æ—¶é—´ã€æ…¢é€Ÿç½‘ç»œè¯·æ±‚ï¼Œè¿˜è®°å½• Reduxã€NgRx å’Œ Vuex æ“ä½œ/çŠ¶æ€ã€‚</p><a class="signup" href="https://lp.logrocket.com/blg/node-signup" target="_blank" rel="noopener noreferrer">Start monitoring for free</a><p>. </p></div>
</div>

<p class="clearfix"/>
<p class="clearfix"/>
</article>

</div>    
</body>
</html>