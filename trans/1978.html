<html>
<head>
<title>Using Sequelize with TypeScript - LogRocket Blog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>ä½¿ç”¨ Sequelize å’Œ TypeScript - LogRocket Blog</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://blog.logrocket.com/using-sequelize-with-typescript/#0001-01-01">https://blog.logrocket.com/using-sequelize-with-typescript/#0001-01-01</a></blockquote><div><article class="article-post">
<p>åœ¨æ‚¨çš„ API ä¸­ç¼–å†™åŸå§‹ SQL å·²ç»è¿‡æ—¶äº†ï¼Œæˆ–è€…æœ€å¥½æ˜¯ä¿ç•™ç»™çœŸæ­£å¤æ‚çš„æŸ¥è¯¢ä½¿ç”¨ã€‚å¯¹äºå¤§å¤šæ•° API æ¥è¯´ï¼Œä½¿ç”¨è®¸å¤šå¯¹è±¡å…³ç³»æ˜ å°„å™¨(ORM)ä¸­çš„ä¸€ä¸ªå°±è¶³å¤Ÿäº†ã€‚</p>
<p>ORM è¿˜æ–¹ä¾¿åœ°å°è£…äº†ä¸æ•°æ®åº“åŠå…¶æŸ¥è¯¢è¯­è¨€é€šä¿¡çš„å¤æ‚ç»†èŠ‚ã€‚</p>
<p>è¿™æ„å‘³ç€æ‚¨å¯ä»¥åœ¨å¤šç§æ•°æ®åº“ç±»å‹ä¸Šä½¿ç”¨å•ä¸ª ORMï¼Œå¦‚ MySQLã€PostgreSQL æˆ– MongoDbï¼Œä»è€Œå¯ä»¥è½»æ¾åœ°åœ¨æ•°æ®åº“ä¹‹é—´åˆ‡æ¢ï¼Œè€Œæ— éœ€é‡å†™ä»£ç ï¼æ‚¨è¿˜å¯ä»¥å°†ä¸åŒç±»å‹çš„æ•°æ®åº“è¿æ¥åˆ°æ‚¨çš„é¡¹ç›®ï¼ŒåŒæ—¶ä½¿ç”¨ç›¸åŒçš„ä»£ç æ¥è®¿é—®å®ƒä»¬ã€‚</p>
<p>åœ¨æœ¬æ–‡ä¸­ï¼Œæ‚¨å°†å­¦ä¹ å¦‚ä½•ä½¿ç”¨å¸¦æœ‰ TypeScript çš„ Sequelize ORMã€‚å› æ­¤ï¼Œæ‹¿èµ·æ‚¨çš„ç¬”è®°æœ¬ç”µè„‘ï¼Œæ‰“å¼€æ‚¨çš„ IDEï¼Œè®©æˆ‘ä»¬å¼€å§‹å§ï¼</p>
<h2>å…ˆå†³æ¡ä»¶</h2>
<p>è¦é˜…è¯»æœ¬æ–‡ï¼Œè¯·å®‰è£…ä»¥ä¸‹è½¯ä»¶:</p>

<h2>è®¾ç½®é¡¹ç›®</h2>
<p>ä¸ºäº†å¼€å§‹æˆ‘ä»¬çš„é¡¹ç›®ï¼Œè®©æˆ‘ä»¬è®¾ç½®ä¸€ä¸ªç®€å•çš„ Express.js API æ¥åˆ›å»ºä¸€ä¸ªå­˜å‚¨é£Ÿè°±å’Œé…æ–™çš„è™šæ‹Ÿé£Ÿè°±ï¼Œå¹¶ç”¨æµè¡Œçš„ç±»åˆ«æ ‡è®°æˆ‘ä»¬çš„é£Ÿè°±ã€‚</p>
<p>é¦–å…ˆï¼Œè®©æˆ‘ä»¬é€šè¿‡åœ¨ç»ˆç«¯ä¸­é”®å…¥ä»¥ä¸‹å‘½ä»¤æ¥åˆ›å»ºé¡¹ç›®ç›®å½•:</p>
<pre>$ mkdir cookbook
$ cd cookbook
</pre>
<p>åœ¨æ–°çš„<code>cookbook</code>é¡¹ç›®ç›®å½•ä¸­ï¼Œä½¿ç”¨<code>yarn</code>å®‰è£…æ‰€éœ€çš„é¡¹ç›®ä¾èµ–é¡¹ã€‚é¦–å…ˆï¼Œè¿è¡Œ<code>npm init</code>ï¼Œç”¨ä¸€ä¸ª<code>package.json</code>æ–‡ä»¶åˆå§‹åŒ– Node.js é¡¹ç›®:</p>
<pre>$ npm init
</pre>
<p>Node.js é¡¹ç›®åˆå§‹åŒ–åï¼Œå®‰è£…ä»<code>express</code>å¼€å§‹çš„ä¾èµ–é¡¹:</p>
<pre>$ yarn add express
</pre>
<p>æ¥ä¸‹æ¥ï¼Œé€šè¿‡è¿è¡Œä»¥ä¸‹å‘½ä»¤å°†<a href="https://www.typescriptlang.org/">ç±»å‹è„šæœ¬</a>æ·»åŠ åˆ°é¡¹ç›®ä¸­:</p>
<pre>$ yarn add -D typescript ts-node @types/express @types/node
</pre>
<p>ğŸ’¡è¯·æ³¨æ„ï¼Œæˆ‘ä»¬åœ¨å®‰è£…å‘½ä»¤ä¸­æ·»åŠ äº†ä¸€ä¸ªæ ‡å¿—<code>-D</code>ã€‚è¿™ä¸ªæ ‡å¿—å‘Šè¯‰ Yarn å°†è¿™äº›åº“æ·»åŠ ä¸ºå¼€å‘ä¾èµ–é¡¹ï¼Œè¿™æ„å‘³ç€åªæœ‰åœ¨é¡¹ç›®å¼€å‘æ—¶æ‰éœ€è¦è¿™äº›åº“ã€‚æˆ‘ä»¬è¿˜ä¸º Express.js å’Œ Node.js æ·»åŠ äº†ç±»å‹å®šä¹‰ã€‚</p>
<p>å°† TypeScript æ·»åŠ åˆ°æˆ‘ä»¬çš„é¡¹ç›®åï¼Œè®©æˆ‘ä»¬åˆå§‹åŒ–å®ƒ:</p>
<pre>$ npx tsc --init
</pre>
<p>è¿™å°†åˆ›å»ºæˆ‘ä»¬çš„ TypeScript é…ç½®æ–‡ä»¶<code>ts.config</code>ï¼Œå¹¶è®¾ç½®é»˜è®¤å€¼:</p>
<pre>// ts.config
{
    "compilerOptions": {
      "target": "es5",                                
      "module": "commonjs",                           
      "sourceMap": true,                           
      "outDir": "dist",                              
      "strict": true,                                 
      "esModuleInterop": true,                        
      "skipLibCheck": true,                           
      "forceConsistentCasingInFileNames": true        
    }
}
</pre>
<p>ç‚¹å‡»äº†è§£æ›´å¤šå…³äº<a href="https://blog.logrocket.com/boost-your-productivity-with-typescript-project-references/">å®šåˆ¶<code>ts.config</code>çš„ä¿¡æ¯ã€‚</a></p>
<p>æœ€åï¼Œè®©æˆ‘ä»¬é€šè¿‡åˆ›å»ºé¡¹ç›®ç›®å½•å’Œæ–‡ä»¶æ¥ä¸ºæˆ‘ä»¬çš„é¡¹ç›®å®šä¹‰ä¸€ä¸ªç®€å•çš„ API ç»“æ„ï¼Œä»¥åŒ¹é…ä¸‹é¢çš„å¤§çº²:</p>
<pre>- dist # the name of our outDir set in tsconfig.json
- src
  - api
    - controllers
    - contracts
    - routes
    - services
  - db
    - dal
    - dto
    - models
    config.ts
    init.ts
  - errors
  index.ts
  ts.config
</pre>
<p>æ—¢ç„¶æˆ‘ä»¬å·²ç»åœ¨<code>index.ts</code>æ–‡ä»¶ä¸­å®šä¹‰äº†æˆ‘ä»¬çš„é¡¹ç›®ç»“æ„ï¼Œè¿™æ˜¯æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºçš„èµ·ç‚¹ï¼Œæ·»åŠ ä¸‹é¢çš„ä»£ç æ¥åˆ›å»ºæˆ‘ä»¬çš„ Express.js æœåŠ¡å™¨:</p>
<pre># src/index.ts

import express, { Application, Request, Response } from 'express'

const app: Application = express()
const port = 3000

// Body parsing Middleware
app.use(express.json());
app.use(express.urlencoded({ extended: true }));
app.get('/', async(req: Request, res: Response): Promise&lt;Response&gt; =&gt; {
    return res.status(200).send({ message: `Welcome to the cookbook API! \n Endpoints available at http://localhost:${port}/api/v1` })
})

try {
    app.listen(port, () =&gt; {
        console.log(`Server running on http://localhost:${port}`)
    })
} catch (error) {
    console.log(`Error occurred: ${error.message}`)
}
</pre>
<p>æˆ‘ä»¬è¿˜å¿…é¡»åŒ…å«ä¸€äº›é¢å¤–çš„åº“ï¼Œä»¥ä¾¿è½»æ¾è¿è¡Œåº”ç”¨ç¨‹åºå¹¶ä¼ å…¥ç¯å¢ƒå˜é‡ã€‚è¿™äº›é™„åŠ åº“æ˜¯ä½¿ç”¨<code>yarn add -D nodemon</code> çš„<a href="https://blog.logrocket.com/nodemon-tutorial-automatically-restart-node-js-apps-with-nodemon/"> nodemonï¼Œä½¿ç”¨<code>yarn add -D eslint</code> </a>çš„<a href="https://eslint.org/"> eslintï¼Œä»¥åŠä½¿ç”¨<code>yarn add dotenv</code> </a>çš„<a href="https://blog.logrocket.com/customizing-node-js-env-files/"> dotenvã€‚</a></p>
<h2>è®¾ç½®é¡ºåºè¡¨å•</h2>
<p>æ­¤æ—¶ï¼ŒExpress.js åº”ç”¨ç¨‹åºæ­£åœ¨è¿è¡Œï¼Œæ‰€ä»¥æ˜¯æ—¶å€™å¼•å…¥æœ‰è¶£çš„ä¸œè¥¿äº†:Sequelize ORMï¼</p>
<p>é€šè¿‡è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œå°† Sequelize æ·»åŠ åˆ°é¡¹ç›®ä¸­:</p>
<pre>$ yarn add sequelize
$ yarn add mysql2
</pre>
<p>è™½ç„¶æˆ‘ä»¬ä¸º MySQL æ·»åŠ äº†æ•°æ®åº“é©±åŠ¨ç¨‹åºï¼Œè¿™å®Œå…¨æ˜¯åŸºäºä¸ªäººåå¥½ï¼Œä½†æ‚¨å¯ä»¥å®‰è£…æ‚¨é¦–é€‰æ•°æ®åº“çš„ä»»ä½•é©±åŠ¨ç¨‹åºã€‚æŸ¥çœ‹æ­¤å¤„çš„<a href="https://sequelize.org/master/manual/getting-started.html#installing">äº†è§£å…¶ä»–å¯ç”¨çš„æ•°æ®åº“é©±åŠ¨ç¨‹åº</a>ã€‚</p>
<h3>å¯åŠ¨å¡å¥å°”æ³½çš„è¿æ¥</h3>
<p>å®‰è£… Sequelize åï¼Œæˆ‘ä»¬å¿…é¡»å¯åŠ¨å®ƒåˆ°æˆ‘ä»¬æ•°æ®åº“çš„è¿æ¥ã€‚ä¸€æ—¦å¯åŠ¨ï¼Œæ­¤è¿æ¥å°†æ³¨å†Œæˆ‘ä»¬çš„æ¨¡å‹:</p>
<pre># db/config.ts

import { Dialect, Sequelize } from 'sequelize'

const dbName = process.env.DB_NAME as string
const dbUser = process.env.DB_USER as string
const dbHost = process.env.DB_HOST
const dbDriver = process.env.DB_DRIVER as Dialect
const dbPassword = process.env.DB_PASSWORD

const sequelizeConnection = new Sequelize(dbName, dbUser, dbPassword, {
  host: dbHost,
  dialect: dbDriver
})

export default sequelizeConnection
</pre>
<h3>åˆ›å»ºå’Œæ³¨å†Œé¡ºåºæ¨¡å‹</h3>
<p>Sequelize æä¾›äº†ä¸¤ç§æ³¨å†Œæ¨¡å‹çš„æ–¹æ³•:<a href="https://sequelize.org/master/manual/model-basics.html#using--a-href-----class-lib-sequelize-js-sequelize-html-instance-method-define---code-sequelize-define--code---a--">ä½¿ç”¨<code>sequelize.define</code> </a>æˆ–è€…æ‰©å±• Sequelize æ¨¡å‹ç±»ã€‚åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨æ¨¡å‹æ‰©å±•æ–¹æ³•æ¥æ³¨å†Œæˆ‘ä»¬çš„<code>Ingredient</code>æ¨¡å‹ã€‚</p>
<p>æˆ‘ä»¬é¦–å…ˆåˆ›å»ºä»¥ä¸‹æ¥å£:</p>
<ul>
<li>å®šä¹‰æˆ‘ä»¬æ¨¡å‹çš„æ‰€æœ‰å¯èƒ½å±æ€§</li>
<li><code>IngredientInput</code>å®šä¹‰ä¼ é€’ç»™ Sequelize çš„<code>model.create</code>çš„å¯¹è±¡çš„ç±»å‹</li>
<li><code>IngredientOuput</code>å®šä¹‰ä»<code>model.create</code>ã€<code>model.update</code>å’Œ<code>model.findOne</code>è¿”å›çš„å¯¹è±¡</li>
</ul>
<pre># db/models/Ingredient.ts

import { DataTypes, Model, Optional } from 'sequelize'
import sequelizeConnection from '../config'

interface IngredientAttributes {
  id: number;
  name: string;
  slug: string;
  description?: string;
  foodGroup?: string;
  createdAt?: Date;
  updatedAt?: Date;
  deletedAt?: Date;
}
export interface IngredientInput extends Optional&lt;IngredientAttributes, 'id' | 'slug'&gt; {}
export interface IngredientOuput extends Required&lt;IngredientAttributes&gt; {}
</pre>
<p>æ¥ä¸‹æ¥ï¼Œåˆ›å»ºä¸€ä¸ªæ‰©å±•ã€åˆå§‹åŒ–å¹¶å¯¼å‡º<code>import {Model} from 'sequelize'</code> Sequelize æ¨¡å‹ç±»çš„<code>Ingredient</code>ç±»:</p>
<pre># db/models/Ingredient.ts

...

class Ingredient extends Model&lt;IngredientAttributes, IngredientInput&gt; implements IngredientAttributes {
  public id!: number
  public name!: string
  public slug!: string
  public description!: string
  public foodGroup!: string

  // timestamps!
  public readonly createdAt!: Date;
  public readonly updatedAt!: Date;
  public readonly deletedAt!: Date;
}

Ingredient.init({
  id: {
    type: DataTypes.INTEGER.UNSIGNED,
    autoIncrement: true,
    primaryKey: true,
  },
  name: {
    type: DataTypes.STRING,
    allowNull: false
  },
  slug: {
    type: DataTypes.STRING,
    allowNull: false,
    unique: true
  },
  description: {
    type: DataTypes.TEXT
  },
  foodGroup: {
    type: DataTypes.STRING
  }
}, {
  timestamps: true,
  sequelize: sequelizeConnection,
  paranoid: true
})

export default Ingredient
</pre>
<p>ğŸ’¡æ³¨æ„ï¼Œæˆ‘ä»¬åœ¨æ¨¡å‹ä¸­æ·»åŠ äº†é€‰é¡¹<code>paranoid: true</code>;è¿™é€šè¿‡æ·»åŠ ä¸€ä¸ªåœ¨è°ƒç”¨<code>destroy</code>æ–¹æ³•æ—¶å°†è®°å½•æ ‡è®°ä¸º<code>deleted</code>çš„<code>deletedAt</code>å±æ€§ï¼Œå¯¹æ¨¡å‹è¿›è¡Œäº†è½¯åˆ é™¤ã€‚</p>
<p>è¦å®Œæˆæˆ‘ä»¬çš„æ¨¡å‹å¹¶åœ¨è¿æ¥çš„æ•°æ®åº“ä¸­åˆ›å»ºå®ƒçš„ç›®æ ‡è¡¨ï¼Œè¿è¡Œ model <code>sync</code>æ–¹æ³•:</p>
<pre># db/init.ts

import { Recipe, RecipeTags, Tag, Review, Ingredient, RecipeIngredients } from './models'
const isDev = process.env.NODE_ENV === 'development'

const dbInit = () =&gt; {
  Ingredient.sync({ alter: isDev })
}
export default dbInit 
</pre>
<p>ğŸ’¡<code>sync</code>æ–¹æ³•æ¥å—<code>force</code>å’Œ<code>alter</code>é€‰é¡¹ã€‚<code>force</code>é€‰é¡¹å¼ºåˆ¶é‡æ–°åˆ›å»ºä¸€ä¸ªè¡¨ã€‚<code>alter</code>é€‰é¡¹åˆ›å»ºä¸€ä¸ªä¸å­˜åœ¨çš„è¡¨æ ¼ï¼Œæˆ–è€…æ›´æ–°è¡¨æ ¼ä»¥åŒ¹é…æ¨¡å‹ä¸­å®šä¹‰çš„å±æ€§ã€‚</p>
<p>ğŸ’¡ä¸“ä¸šæç¤º:ä¿ç•™åœ¨å¼€å‘ç¯å¢ƒä¸­ä½¿ç”¨<code>force</code>æˆ–<code>alter</code>,è¿™æ ·æ‚¨å°±ä¸ä¼šæ„å¤–åœ°é‡æ–°åˆ›å»ºæ‚¨çš„ç”Ÿäº§æ•°æ®åº“ï¼Œä¸¢å¤±æ‚¨çš„æ‰€æœ‰æ•°æ®æˆ–åº”ç”¨å¯¹æ•°æ®åº“çš„æ›´æ”¹ï¼Œè¿™å¯èƒ½ä¼šç ´åæ‚¨çš„åº”ç”¨ç¨‹åºã€‚</p>
<h2>åœ¨ DAL å’ŒæœåŠ¡ä¸­ä½¿ç”¨æˆ‘ä»¬çš„æ¨¡å‹</h2>
<p>æ•°æ®è®¿é—®å±‚(DAL)æ˜¯æˆ‘ä»¬å®ç° SQL æŸ¥è¯¢çš„åœ°æ–¹ï¼Œæˆ–è€…åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ˜¯ Sequelize æ¨¡å‹æŸ¥è¯¢è¿è¡Œçš„åœ°æ–¹:</p>
<pre># db/dal/ingredient.ts

import {Op} from 'sequelize'
import {Ingredient} from '../models'
import {GetAllIngredientsFilters} from './types'
import {IngredientInput, IngredientOuput} from '../models/Ingredient'

export const create = async (payload: IngredientInput): Promise&lt;IngredientOuput&gt; =&gt; {
    const ingredient = await Ingredient.create(payload)
    return ingredient
}

export const update = async (id: number, payload: Partial&lt;IngredientInput&gt;): Promise&lt;IngredientOuput&gt; =&gt; {
    const ingredient = await Ingredient.findByPk(id)
    if (!ingredient) {
        // @todo throw custom error
        throw new Error('not found')
    }
    const updatedIngredient = await (ingredient as Ingredient).update(payload)
    return updatedIngredient
}

export const getById = async (id: number): Promise&lt;IngredientOuput&gt; =&gt; {
    const ingredient = await Ingredient.findByPk(id)
    if (!ingredient) {
        // @todo throw custom error
        throw new Error('not found')
    }
    return ingredient
}

export const deleteById = async (id: number): Promise&lt;boolean&gt; =&gt; {
    const deletedIngredientCount = await Ingredient.destroy({
        where: {id}
    })
    return !!deletedIngredientCount
}

export const getAll = async (filters?: GetAllIngredientsFilters): Promise&lt;IngredientOuput[]&gt; =&gt; {
    return Ingredient.findAll({
        where: {
            ...(filters?.isDeleted &amp;&amp; {deletedAt: {[Op.not]: null}})
        },
        ...((filters?.isDeleted || filters?.includeDeleted) &amp;&amp; {paranoid: true})
    })
}
</pre>
<p>å°†<code>paranoid: true</code>é€‰é¡¹æ·»åŠ åˆ°<code>findAll</code>æ¨¡å‹æ–¹æ³•åŒ…æ‹¬ç»“æœä¸­è®¾ç½®äº†<code>deletedAt</code>çš„è½¯åˆ é™¤è®°å½•ã€‚å¦åˆ™ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œç»“æœä¸åŒ…æ‹¬è½¯åˆ é™¤çš„è®°å½•ã€‚</p>
<p>åœ¨ä¸Šé¢çš„ DAL ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬çš„<code>ModelInput</code>ç±»å‹å®šä¹‰å®šä¹‰äº†ä¸€äº›å¸¸ç”¨çš„ CRUD æŸ¥è¯¢ï¼Œå¹¶åœ¨<code>db/dal/types.ts</code>ä¸­æ”¾ç½®äº†ä»»ä½•é¢å¤–çš„ç±»å‹:</p>
<pre># db/dal/types.ts

export interface GetAllIngredientsFilters {
    isDeleted?: boolean
    includeDeleted?: boolean
}
</pre>
<p>ğŸ’¡Sequelize ORM æœ‰ä¸€äº›éå¸¸é…·çš„å»ºæ¨¡æ–¹æ³•ï¼ŒåŒ…æ‹¬<code>findAndCountAll</code>ï¼Œå®ƒè¿”å›ä¸€ä¸ªè®°å½•åˆ—è¡¨å’Œæ‰€æœ‰ç¬¦åˆè¿‡æ»¤æ ‡å‡†çš„è®°å½•çš„è®¡æ•°ã€‚è¿™å¯¹äºåœ¨ API ä¸­è¿”å›åˆ†é¡µåˆ—è¡¨å“åº”éå¸¸æœ‰ç”¨ã€‚</p>
<p>ç°åœ¨æˆ‘ä»¬å¯ä»¥åˆ›å»ºæˆ‘ä»¬çš„æœåŠ¡ï¼Œå®ƒå……å½“æˆ‘ä»¬çš„æ§åˆ¶å™¨å’Œ DAL ä¹‹é—´çš„ä¸­ä»‹:</p>
<pre># api/services/ingredientService.ts

import * as ingredientDal from '../dal/ingredient'
import {GetAllIngredientsFilters} from '../dal/types'
import {IngredientInput, IngredientOuput} from '../models/Ingredient'

export const create = (payload: IngredientInput): Promise&lt;IngredientOuput&gt; =&gt; {
    return ingredientDal.create(payload)
}
export const update = (id: number, payload: Partial&lt;IngredientInput&gt;): Promise&lt;IngredientOuput&gt; =&gt; {
    return ingredientDal.update(id, payload)
}
export const getById = (id: number): Promise&lt;IngredientOuput&gt; =&gt; {
    return ingredientDal.getById(id)
}
export const deleteById = (id: number): Promise&lt;boolean&gt; =&gt; {
    return ingredientDal.deleteById(id)
}
export const getAll = (filters: GetAllIngredientsFilters): Promise&lt;IngredientOuput[]&gt; =&gt; {
    return ingredientDal.getAll(filters)
}
</pre>
<h2>ä½¿ç”¨è·¯çº¿å’Œæ§åˆ¶å™¨å¯åŠ¨æ¨¡å‹</h2>
<p>æˆ‘ä»¬å·²ç»èµ°äº†å¾ˆé•¿çš„è·¯äº†ï¼ç°åœ¨ï¼Œæˆ‘ä»¬å·²ç»æœ‰äº†ä»æ•°æ®åº“ä¸­è·å–æ•°æ®çš„æœåŠ¡ï¼Œæ˜¯æ—¶å€™ä½¿ç”¨è·¯çº¿å’Œæ§åˆ¶å™¨å°†æ‰€æœ‰çš„é­”åŠ›å¸¦ç»™å…¬ä¼—äº†ã€‚</p>
<p>è®©æˆ‘ä»¬ä»åœ¨<code>src/api/routes/ingredients.ts</code>ä¸­åˆ›å»ºæˆ‘ä»¬çš„<code>Ingredients</code>è·¯çº¿å¼€å§‹:</p>
<pre># src/api/routes/ingredients.ts

import { Router } from 'express'

const ingredientsRouter = Router()
ingredientsRouter.get(':/slug', () =&gt; {
  // get ingredient
})
ingredientsRouter.put('/:id', () =&gt; {
  // update ingredient
})
ingredientsRouter.delete('/:id', () =&gt; {
  // delete ingredient
})
ingredientsRouter.post('/', () =&gt; {
  // create ingredient
})

export default ingredientsRouter
</pre>
<p>æˆ‘ä»¬çš„ cookbook API æœ€ç»ˆä¼šæœ‰å‡ ä¸ªè·¯ç”±ï¼Œæ¯”å¦‚<code>Recipes</code>å’Œ<code>Tags</code>ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¿…é¡»åˆ›å»ºä¸€ä¸ª<code>index.ts</code>æ–‡ä»¶ï¼Œå°†ä¸åŒçš„è·¯ç”±æ³¨å†Œåˆ°å®ƒä»¬çš„åŸºæœ¬è·¯å¾„ï¼Œå¹¶æœ‰ä¸€ä¸ªä¸­å¤®å¯¼å‡ºæ¥è¿æ¥åˆ°æˆ‘ä»¬ä¹‹å‰çš„ Express.js æœåŠ¡å™¨:</p>
<pre># src/api/routes/index.ts

import { Router } from 'express'
import ingredientsRouter from './ingredients'

const router = Router()

router.use('/ingredients', ingredientsRouter)

export default router
</pre>
<p>è®©æˆ‘ä»¬æ›´æ–°æˆ‘ä»¬çš„<code>src/index.ts</code>æ¥å¯¼å…¥æˆ‘ä»¬å¯¼å‡ºçš„è·¯çº¿ï¼Œå¹¶å°†å®ƒä»¬æ³¨å†Œåˆ°æˆ‘ä»¬çš„ Express.js æœåŠ¡å™¨:</p>
<pre># src/index.ts

import express, { Application, Request, Response } from 'express'
import routes from './api/routes'

const app: Application = express()

...

app.use('/api/v1', routes)
</pre>
<p>åœ¨åˆ›å»ºå’Œè¿æ¥è·¯ç”±ä¹‹åï¼Œè®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ§åˆ¶å™¨æ¥é“¾æ¥åˆ°æˆ‘ä»¬çš„è·¯ç”±å¹¶è°ƒç”¨æœåŠ¡æ–¹æ³•ã€‚</p>
<p>ä¸ºäº†æ”¯æŒåœ¨è·¯çº¿å’Œæ§åˆ¶å™¨ä¹‹é—´è¾“å…¥å‚æ•°å’Œç»“æœï¼Œè®©æˆ‘ä»¬æ·»åŠ æ•°æ®ä¼ è¾“å¯¹è±¡(dto)å’Œæ˜ å°„å™¨æ¥è½¬æ¢ç»“æœ:</p>
<pre># src/api/controllers/ingredient/index.ts

import * as service from '../../../db/services/IngredientService'
import {CreateIngredientDTO, UpdateIngredientDTO, FilterIngredientsDTO} from '../../dto/ingredient.dto'
import {Ingredient} from '../../interfaces'
import * as mapper from './mapper'

export const create = async(payload: CreateIngredientDTO): Promise&lt;Ingredient&gt; =&gt; {
    return mapper.toIngredient(await service.create(payload))
}
export const update = async (id: number, payload: UpdateIngredientDTO): Promise&lt;Ingredient&gt; =&gt; {
    return mapper.toIngredient(await service.update(id, payload))
}
export const getById = async (id: number): Promise&lt;Ingredient&gt; =&gt; {
    return mapper.toIngredient(await service.getById(id))
}
export const deleteById = async(id: number): Promise&lt;Boolean&gt; =&gt; {
    const isDeleted = await service.deleteById(id)
    return isDeleted
}
export const getAll = async(filters: FilterIngredientsDTO): Promise&lt;Ingredient[]&gt; =&gt; {
    return (await service.getAll(filters)).map(mapper.toIngredient)
}
</pre>
<p>ç°åœ¨ï¼Œç”¨å¯¹æ§åˆ¶å™¨çš„è°ƒç”¨æ›´æ–°è·¯ç”±å™¨:</p>
<pre># src/api/routes/ingredients.ts

import { Router, Request, Response} from 'express'
import * as ingredientController from '../controllers/ingredient'
import {CreateIngredientDTO, FilterIngredientsDTO, UpdateIngredientDTO} from '../dto/ingredient.dto'

const ingredientsRouter = Router()

ingredientsRouter.get(':/id', async (req: Request, res: Response) =&gt; {
    const id = Number(req.params.id)
    const result = await ingredientController.getById(id)
    return res.status(200).send(result)
})
ingredientsRouter.put('/:id', async (req: Request, res: Response) =&gt; {
    const id = Number(req.params.id)
    const payload:UpdateIngredientDTO = req.body

    const result = await ingredientController.update(id, payload)
    return res.status(201).send(result)
})
ingredientsRouter.delete('/:id', async (req: Request, res: Response) =&gt; {
    const id = Number(req.params.id)

    const result = await ingredientController.deleteById(id)
    return res.status(204).send({
        success: result
    })
})
ingredientsRouter.post('/', async (req: Request, res: Response) =&gt; {
    const payload:CreateIngredientDTO = req.body
    const result = await ingredientController.create(payload)
    return res.status(200).send(result)
})
ingredientsRouter.get('/', async (req: Request, res: Response) =&gt; {
    const filters:FilterIngredientsDTO = req.query
    const results = await ingredientController.getAll(filters)
    return res.status(200).send(results)
})
export default ingredientsRouter 
</pre>
<p>æ­¤æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥æ·»åŠ ä¸€ä¸ªæ„å»ºè„šæœ¬æ¥è¿è¡Œæˆ‘ä»¬çš„ API:</p>
<pre># package.json

...
"scripts": {
  "dev": "nodemon src/index.ts",
  "build": "npx tsc"
},
...
</pre>
<p>è¦æŸ¥çœ‹æœ€ç»ˆäº§å“ï¼Œè¯·ä½¿ç”¨<code>yarn run dev</code>è¿è¡Œ APIï¼Œå¹¶è®¿é—®ä½äº<a href="http://localhost:3000/api/v1/ingredients" rel="nofollow">http://localhost:3000/API/v1/ingredients</a>çš„æˆ‘ä»¬çš„é…æ–™ç«¯ç‚¹ã€‚</p>
<h2>ç»“è®º</h2>
<p>åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ Express.js è®¾ç½®äº†ä¸€ä¸ªç®€å•çš„ TypeScript åº”ç”¨ç¨‹åºæ¥ä½¿ç”¨ Sequelize ORMï¼Œå¹¶é€æ­¥å®Œæˆäº†åˆå§‹åŒ– Sequelizeã€åˆ›å»ºæ¨¡å‹å’Œé€šè¿‡ ORM è¿è¡ŒæŸ¥è¯¢çš„è¿‡ç¨‹ã€‚</p>
<p>åœ¨æˆ‘ä»¬çš„é¡¹ç›®ä¸­ä½¿ç”¨ Sequelize with TypeScript æœ‰åŠ©äºæˆ‘ä»¬ç¼–å†™æ›´å°‘çš„ä»£ç å¹¶æŠ½è±¡æ•°æ®åº“å¼•æ“ï¼ŒåŒæ—¶ä¸ºæ¨¡å‹è¾“å…¥å’Œè¾“å‡ºå®šä¹‰ä¸¥æ ¼çš„ç±»å‹ã€‚è¿™ä½¿å¾—æˆ‘ä»¬çš„ä»£ç æ›´åŠ ä¸€è‡´ï¼Œå³ä½¿æˆ‘ä»¬æ”¹å˜æ•°æ®åº“ç±»å‹ï¼Œä¹Ÿèƒ½é˜²æ­¢æˆ‘ä»¬çš„è¡¨å‘ç”Ÿ SQL æ³¨å…¥ã€‚</p>
<p>æœ¬æ–‡çš„å®Œæ•´ä»£ç å¯ä»¥åœ¨ Github ä¸Šæ‰¾åˆ°ã€‚æˆ‘å¸Œæœ›ä½ è§‰å¾—è¿™ç¯‡æ–‡ç« å¾ˆå®¹æ˜“ç†è§£ï¼Œæˆ‘å¾ˆæƒ³å¬å¬ä½ å…³äºåœ¨ä½ çš„åº”ç”¨ä¸­ä½¿ç”¨ Sequelize çš„é…·æ–¹æ³•çš„ä»»ä½•æƒ³æ³•ï¼Œæˆ–è€…ä½ åœ¨è¯„è®ºåŒºæœ‰ä»»ä½•é—®é¢˜ï¼</p><div class="code-block code-block-21">
<div class="blog-plug inline-plug typescript-plug"><h2><a class="signup" href="https://lp.logrocket.com/blg/typescript-signup" target="_blank" rel="noopener noreferrer"> LogRocket </a>:å…¨é¢äº†è§£æ‚¨çš„ç½‘ç»œå’Œç§»åŠ¨åº”ç”¨</h2>
<a href="https://lp.logrocket.com/blg/typescript-signup" class="signup" target="_blank" rel="noopener noreferrer"><img class="alignnone size-full wp-image-46 jetpack-lazy-image" src="../Images/d6f5a5dd739296c1dd7aab3d5e77eeb9.png" alt="LogRocket Dashboard Free Trial Banner" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png"/><noscript><img data-lazy-fallback="1" class="alignnone size-full wp-image-46" src="../Images/d6f5a5dd739296c1dd7aab3d5e77eeb9.png" alt="LogRocket Dashboard Free Trial Banner" data-original-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png"/></noscript></a>
<p>LogRocket æ˜¯ä¸€ä¸ªå‰ç«¯åº”ç”¨ç¨‹åºç›‘æ§è§£å†³æ–¹æ¡ˆï¼Œå¯ä»¥è®©æ‚¨å›æ”¾é—®é¢˜ï¼Œå°±åƒé—®é¢˜å‘ç”Ÿåœ¨æ‚¨è‡ªå·±çš„æµè§ˆå™¨ä¸­ä¸€æ ·ã€‚LogRocket ä¸éœ€è¦çŒœæµ‹é”™è¯¯å‘ç”Ÿçš„åŸå› ï¼Œä¹Ÿä¸éœ€è¦å‘ç”¨æˆ·è¯¢é—®æˆªå›¾å’Œæ—¥å¿—è½¬å‚¨ï¼Œè€Œæ˜¯è®©æ‚¨é‡æ”¾ä¼šè¯ä»¥å¿«é€Ÿäº†è§£å“ªé‡Œå‡ºé”™äº†ã€‚å®ƒå¯ä»¥ä¸ä»»ä½•åº”ç”¨ç¨‹åºå®Œç¾é…åˆï¼Œä¸ç®¡æ˜¯ä»€ä¹ˆæ¡†æ¶ï¼Œå¹¶ä¸”æœ‰æ’ä»¶å¯ä»¥è®°å½•æ¥è‡ª Reduxã€Vuex å’Œ@ngrx/store çš„é¢å¤–ä¸Šä¸‹æ–‡ã€‚</p>
<p>é™¤äº†è®°å½• Redux æ“ä½œå’ŒçŠ¶æ€ï¼ŒLogRocket è¿˜è®°å½•æ§åˆ¶å°æ—¥å¿—ã€JavaScript é”™è¯¯ã€å †æ ˆè·Ÿè¸ªã€å¸¦æœ‰å¤´+æ­£æ–‡çš„ç½‘ç»œè¯·æ±‚/å“åº”ã€æµè§ˆå™¨å…ƒæ•°æ®å’Œè‡ªå®šä¹‰æ—¥å¿—ã€‚å®ƒè¿˜ä½¿ç”¨ DOM æ¥è®°å½•é¡µé¢ä¸Šçš„ HTML å’Œ CSSï¼Œç”šè‡³ä¸ºæœ€å¤æ‚çš„å•é¡µé¢å’Œç§»åŠ¨åº”ç”¨ç¨‹åºé‡æ–°åˆ›å»ºåƒç´ çº§å®Œç¾è§†é¢‘ã€‚</p>
<a class="signup" href="https://lp.logrocket.com/blg/typescript-signup" target="_blank" rel="noopener noreferrer">Try it for free</a><p>.</p></div>
</div>

<p class="clearfix"/>
<p class="clearfix"/>
</article>

</div>    
</body>
</html>