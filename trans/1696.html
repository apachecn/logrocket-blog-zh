<html>
<head>
<title>Caching in Node.js to optimize app performance - LogRocket Blog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>Node.js ä¸­çš„ç¼“å­˜å¯ä¼˜åŒ–åº”ç”¨æ€§èƒ½</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://blog.logrocket.com/caching-node-js-optimize-app-performance/#0001-01-01">https://blog.logrocket.com/caching-node-js-optimize-app-performance/#0001-01-01</a></blockquote><div><article class="article-post">
<p><em> <strong>ç¼–è€…æŒ‰</strong>:æœ¬æ–‡æœ€åä¸€æ¬¡æ›´æ–°æ˜¯åœ¨ 2022 å¹´ 10 æœˆ 14 æ—¥ï¼ŒåŒ…å«äº†å¸¸è§ç¼“å­˜åŒ…çš„ä¿¡æ¯ï¼Œæ¯”å¦‚<code>node-cache</code>å’Œ Memcachedã€‚</em></p>
<p>ç¼“å­˜æ˜¯ web å¼€å‘ä¸­ä½¿ç”¨çš„ä¸€ç§æŠ€æœ¯ï¼Œç”¨äºå¤„ç†ä¸å¦‚ä½•ç®¡ç†ã€å­˜å‚¨å’Œæ£€ç´¢æ•°æ®ç›¸å…³çš„æ€§èƒ½ç“¶é¢ˆã€‚ç¼“å­˜å±‚æˆ–æœåŠ¡å™¨å……å½“è¾…åŠ©å­˜å‚¨å±‚ï¼Œé€šå¸¸é€Ÿåº¦æ›´å¿«ã€æ€§èƒ½æ›´é«˜ï¼Œå¯ä»¥ä¸´æ—¶å­˜å‚¨æ•°æ®å­é›†ã€‚é¢„è®¡å­˜å‚¨åœ¨ç¼“å­˜ä¸­çš„æ•°æ®ä¸ä¼šç»å¸¸æ”¹å˜ã€‚</p>
<p>å…¶æ€æƒ³æ˜¯ï¼Œå°†æ¥å¯¹å­˜å‚¨åœ¨ç¼“å­˜ä¸­çš„é¢‘ç¹è®¿é—®çš„æ•°æ®çš„è¯·æ±‚å¯ä»¥å¾ˆå¿«å¾—åˆ°æ»¡è¶³ï¼Œå¹¶ä¸”é€šå¸¸æ¯”è®¿é—®æ•°æ®çš„ä¸»å­˜å‚¨ä½ç½®(é€šå¸¸æ˜¯æ•°æ®åº“)æ›´å¿«ã€‚é«˜é€Ÿç¼“å­˜å±‚é€šå¸¸æä¾›ä¸€ç§æ›´æœ‰æ•ˆçš„æ–¹å¼æ¥é‡ç”¨å…ˆå‰æ£€ç´¢æˆ–è®¡ç®—çš„æ•°æ®ã€‚</p>
<p>åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†è®¨è®ºä»¥ä¸‹å†…å®¹:</p>

<h2 id="why-cache-data">ä¸ºä»€ä¹ˆé¦–å…ˆè¦ç¼“å­˜æ•°æ®ï¼Ÿ</h2>
<p>å¯¹äºåº”ç”¨ç¨‹åºä¸­ç‰¹å®šç‚¹çš„æ•°æ®çŠ¶æ€å¾ˆå°‘å‘ç”Ÿå˜åŒ–çš„æƒ…å†µï¼Œé€šå¸¸å»ºè®®ä½¿ç”¨ç¼“å­˜ã€‚æƒ³æƒ³äº§å“åˆ—è¡¨ã€å›½å®¶ç”µè¯ä»£ç æˆ–å•†åº—ä½ç½®ã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œå¯¹äºæœ€è¿‘çš„ä¸€ä¸ªç‰¹æ€§ï¼Œæˆ‘éœ€è¦ä»å¤–éƒ¨ API è·å–ä¸€ä¸ªé“¶è¡Œåˆ—è¡¨ã€‚æœ€æœ‰æ•ˆæ–¹æ³•æ˜¯è¿›è¡Œä¸€æ¬¡ API è°ƒç”¨ï¼Œå¹¶å°†å“åº”å­˜å‚¨åœ¨ç¼“å­˜ä¸­ã€‚</p>
<p>è¿™æ„å‘³ç€ï¼Œéšåï¼Œæˆ‘ä»¬å°†ä¸éœ€è¦é€šè¿‡äº’è”ç½‘è¿›è¡ŒåŒæ ·çš„ API è°ƒç”¨ï¼›ç›¸åï¼Œæˆ‘ä»¬å¯ä»¥ä»ç¼“å­˜ä¸­æ£€ç´¢æ•°æ®ï¼Œå› ä¸ºæˆ‘ä»¬ä¸å¸Œæœ›å®ƒçªç„¶æ”¹å˜ã€‚åœ¨è¯¥å±‚ç¼“å­˜æ•°æ®æˆ– API å“åº”å¯ä»¥æ˜¾è‘—æé«˜æˆ‘ä»¬çš„åº”ç”¨æ€§èƒ½ã€‚</p>
<p>ä½¿ç”¨ç¼“å­˜ç³»ç»Ÿï¼Œæ•°æ®æ£€ç´¢è¿‡ç¨‹å·²ç»å¾—åˆ°ä¼˜åŒ–ï¼Œå› ä¸ºæ•°æ®å­˜å‚¨åœ¨å†…å­˜ä¸­ã€‚è¿™ä¸å¤§å¤šæ•°ä¼ ç»Ÿæ•°æ®åº“ä¸­çš„ç£ç›˜å­˜å‚¨æœºåˆ¶å½¢æˆå¯¹æ¯”ï¼Œåœ¨ç£ç›˜å­˜å‚¨æœºåˆ¶ä¸­ï¼Œè¯»å–å’Œå†™å…¥(å°±æŸ¥è¯¢è€Œè¨€)ä¸å¦‚å†…å­˜å­˜å‚¨ç³»ç»Ÿå¿«ã€‚</p>
<p>å†…å­˜æ•°æ®åº“é€šå¸¸ç”±ç®¡ç†å¤§é‡æ•°æ®å¹¶ä¾èµ–å¿«é€Ÿå“åº”æ—¶é—´çš„åº”ç”¨ç¨‹åºä½¿ç”¨ã€‚è€ƒè™‘åˆ°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥æ€»ç»“å†…å­˜æ•°æ®åº“çš„ä¸€äº›ä¸»è¦ä¼˜åŠ¿:</p>
<ul>
<li>æ›´å°‘çš„ CPU å¾€è¿”/å¤„ç†ï¼Œå¯¼è‡´æ›´å¿«çš„äº‹åŠ¡æˆ–æŸ¥è¯¢</li>
<li>æ›´å¿«çš„è¯»/å†™é€Ÿåº¦ï¼Œç¡®ä¿å¤šç”¨æˆ·å¹¶å‘ï¼Œä»è€Œé™ä½æ•°æ®åº“åŸºç¡€æ¶æ„çš„å¼€æ”¯</li>
<li>ä½å»¶è¿Ÿå’Œå¯æ‰©å±•æ€§</li>
<li>ç®€å•æ•°æ®è®¿é—®æ£€ç´¢</li>
</ul>
<p>å¦ä¸€æ–¹é¢ï¼Œå†…å­˜æ•°æ®åº“æ¯”ä¼ ç»Ÿæ•°æ®åº“æ›´ä¸ç¨³å®šï¼Œå› ä¸ºå¦‚æœ RAM å´©æºƒï¼Œæˆ‘ä»¬å¾ˆå®¹æ˜“ä¸¢å¤±æ•°æ®ã€‚ä¼ ç»Ÿæ•°æ®åº“åœ¨è¿™æ–¹é¢è¡¨ç°å‡ºè‰²ï¼Œå› ä¸ºåœ¨å‡ºç°ä»»ä½•é—®é¢˜æ—¶ï¼Œæ•°æ®ä»ç„¶å¯ä»¥ä»ç£ç›˜ä¸­æ¢å¤ã€‚</p>
<h2 id="database-caching-types">æ•°æ®åº“ç¼“å­˜ç±»å‹</h2>
<p>ç¼“å­˜æ•°æ®çš„ç±»å‹æˆ–æ–¹æ³•åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šå–å†³äºç¼“å­˜çš„ç§ç±»(å¯ä»¥åˆ†ä¸ºåº”ç”¨ç¨‹åºçº§æˆ–æœ¬åœ°ç¼“å­˜ã€æ•°æ®åº“é›†æˆç¼“å­˜ä»¥åŠç‹¬ç«‹æˆ–è¿œç¨‹ç¼“å­˜)ä»¥åŠåº”ç”¨ç¨‹åºç¼“å­˜è®¾ç½®çš„ç›®çš„ã€‚è™½ç„¶åº”ç”¨ç¨‹åºçº§æˆ–æœ¬åœ°ç¼“å­˜æ˜¯æœ‰ç›Šçš„ï¼Œå› ä¸ºå½“åº•å±‚æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶ï¼Œæ•°æ®åº“å¯ä»¥è‡ªåŠ¨æ›´æ–°å…¶ç¼“å­˜ï¼Œä½†ç¼“å­˜åœ¨å†…å­˜æˆ–èµ„æºçš„å¤§å°å’Œå¯ç”¨æ€§æ–¹é¢æ˜¯æœ‰é™çš„ã€‚</p>
<p>æœ¬åœ°ç¼“å­˜å­˜å‚¨åº”ç”¨å±‚ä¸­é¢‘ç¹è®¿é—®çš„æ•°æ®ã€‚è¿™ç§æ–¹æ³•æ¶ˆé™¤äº†ä¸æ£€ç´¢æ•°æ®ç›¸å…³çš„ç½‘ç»œæµé‡ï¼Œä¸å…¶ä»–ç¼“å­˜æ¶æ„ç›¸æ¯”ï¼Œæ•°æ®æ£€ç´¢é€Ÿåº¦æ›´å¿«ã€‚ç„¶è€Œï¼Œå› ä¸ºæˆ‘ä»¬çŸ¥é“å¤§å¤šæ•°åº”ç”¨ç¨‹åºä½¿ç”¨å¤šä¸ªæœåŠ¡å™¨ï¼Œå¦‚æœæ¯ä¸ªæœåŠ¡å™¨éƒ½æœ‰è‡ªå·±çš„ç¼“å­˜ï¼Œé‚£ä¹ˆç®¡ç†å’ŒåŒæ­¥å®ƒä»¬ä¹‹é—´çš„æ•°æ®çš„å·¥ä½œå°±ä¼šæˆä¸ºä¸€ä¸ªå·¨å¤§çš„é—®é¢˜ã€‚</p>
<p>æ­¤å¤–ï¼Œå­˜å‚¨åœ¨æœ¬åœ°ç¼“å­˜ä¸­çš„æ•°æ®åœ¨å‘ç”Ÿæ•…éšœæ—¶å¾ˆå®¹æ˜“ä¸¢å¤±ã€‚è¿™å¯èƒ½ä¼šå¦å®šç¼“å­˜æ•°æ®ã€‚ä½¿ç”¨è¿œç¨‹ç¼“å­˜å¯ä»¥ç¼“è§£è¿™äº›ç¼ºç‚¹ã€‚å¯¹äºè¿œç¨‹ç¼“å­˜ï¼Œå­˜åœ¨ä¸“é—¨ç”¨äºåœ¨å†…å­˜ä¸­å­˜å‚¨æ•°æ®çš„å•ç‹¬å®ä¾‹ã€‚ä¾‹å¦‚ Redisã€Memcached ç­‰ç­‰ã€‚</p>
<p>è¿œç¨‹ç¼“å­˜å­˜å‚¨åœ¨éš”ç¦»çš„ä¸“ç”¨æœåŠ¡å™¨ä¸Šï¼Œé€šå¸¸æ„å»ºåœ¨é”®å€¼å­˜å‚¨ä¸Šã€‚å®ƒä»¬å¯ä»¥æ¯ç§’æä¾›å¤§é‡è¯·æ±‚ï¼Œå¹¶ä¸”å…·æœ‰é«˜å¯ç”¨æ€§å’Œä½å»¶è¿Ÿï¼Œé€‚ç”¨äºä»»åŠ¡å…³é”®å‹å·¥ä½œè´Ÿè½½ã€‚åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†åˆ©ç”¨è¿œç¨‹ç¼“å­˜ã€‚</p>
<h2 id="caching-patterns-strategies">ç¼“å­˜æ¨¡å¼å’Œç­–ç•¥</h2>
<p>ä¸¤ç§å¸¸è§çš„ç¼“å­˜æ–¹æ³•æ˜¯å¤‡ç”¨ç¼“å­˜å’Œç›´å†™ç¼“å­˜èŒƒä¾‹ã€‚</p>
<h3 id="cache-aside-pattern">ç¼“å­˜å¤‡ç”¨æ¨¡å¼</h3>
<p>æ—è¾¹ç¼“å­˜æ¨¡å¼ï¼Œä¹Ÿç§°ä¸ºå»¶è¿ŸåŠ è½½ï¼Œæ˜¯æœ€å¸¸è§çš„å¯ç”¨ç¼“å­˜æ¨¡å¼ã€‚å®ƒçš„å·¥ä½œæ–¹å¼æ˜¯åœ¨è¯·æ±‚æ•°æ®åæ›´æ–°ç¼“å­˜ã€‚è¿™æ ·ï¼Œä¸ºäº†ä»æ•°æ®åº“ä¸­è¯»å–æ•°æ®ï¼Œé¦–å…ˆæ£€æŸ¥ç¼“å­˜ä»¥ç¡®å®šæ•°æ®æ˜¯å¦å¯ç”¨ã€‚å¦‚æœæ•°æ®å¯ç”¨(ä¹Ÿç§°ä¸ºç¼“å­˜å‘½ä¸­)ï¼Œåˆ™è¿”å›ç¼“å­˜çš„æ•°æ®ï¼Œå¹¶å‘è°ƒç”¨è€…å‘å‡ºå“åº”ã€‚</p>
<p>å¦ä¸€æ–¹é¢ï¼Œå¦‚æœæ•°æ®ä¸å¯ç”¨(ä¹Ÿç§°ä¸ºç¼“å­˜æœªå‘½ä¸­)ï¼Œåˆ™å‘æ•°æ®åº“æŸ¥è¯¢æ•°æ®ã€‚ç„¶åç”¨ä»æ•°æ®åº“ä¸­æ£€ç´¢åˆ°çš„æ•°æ®å¡«å……ç¼“å­˜ã€‚è¿™ç§æ–¹æ³•çš„ä¸»è¦ä¼˜ç‚¹æ˜¯ï¼Œå®ƒä¸ºæ¡†æ¶æä¾›äº†ä¸€ç§ç›´æ¥çš„ç¼“å­˜æ–¹å¼ï¼Œå¯ä»¥åœ¨å¹•åæˆ–è‡ªå®šä¹‰ä»£ç ä¸­å¤„ç†æƒ°æ€§ç¼“å­˜ã€‚æ­¤å¤–ï¼Œè¿™ç§æ–¹æ³•å¯ä»¥ç«‹å³æé«˜æ€§èƒ½ã€‚</p>
<p>å¦ä¸€ä¸ªä¼˜ç‚¹æ˜¯ç¼“å­˜åªåŒ…å«åº”ç”¨ç¨‹åºè¯·æ±‚çš„æ•°æ®ï¼Œè¿™æœ‰åŠ©äºä¿æŒç¼“å­˜è¾ƒå°ä¸”æˆæœ¬è¾ƒä½ã€‚å¦ä¸€æ–¹é¢ï¼Œè¿™ç§æ–¹æ³•çš„ä¸€ä¸ªå¸¸è§ç¼ºç‚¹æ˜¯ï¼Œåªæœ‰åœ¨ç¼“å­˜æœªå‘½ä¸­åæ‰ä¼šå°†æ•°æ®åŠ è½½åˆ°ç¼“å­˜ä¸­ï¼Œå› ä¸ºæœ€åˆæ²¡æœ‰æ•°æ®å­˜å‚¨åœ¨ç¼“å­˜ä¸­ã€‚æ­¤å¤–ï¼ŒæŸ¥è¯¢çš„åˆå§‹å“åº”æ—¶é—´ä¹Ÿæœ‰ä¸€äº›å¼€é”€ï¼Œå› ä¸ºéœ€è¦å¾€è¿”äºç¼“å­˜å’Œæ•°æ®åº“ã€‚</p>
<h3 id="write-through-cache-pattern">ç›´å†™é«˜é€Ÿç¼“å­˜æ¨¡å¼</h3>
<p>æˆ–è€…ï¼Œä½¿ç”¨ç›´å†™ç¼“å­˜æ¨¡å¼ï¼Œå½“ä¸»æ•°æ®åº“æ›´æ–°æ—¶ï¼Œç¼“å­˜ä¼šç«‹å³æ›´æ–°ã€‚åœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼Œç¼“å­˜çš„å¡«å……é¡ºåºé€šå¸¸æ˜¯ç›¸åçš„ã€‚æ–¹æ³•æ˜¯åœ¨ä¸»æ•°æ®åº“æ›´æ–°åç«‹å³æ›´æ–°ç¼“å­˜ã€‚ä½¿ç”¨ç›´å†™ç¼“å­˜ç­–ç•¥ï¼Œå½“åº”ç”¨ç¨‹åºæˆ–åç«¯è¿›ç¨‹æ›´æ–°ä¸»æ•°æ®åº“æ—¶ï¼Œç¼“å­˜ä¸­çš„æ•°æ®ä¹Ÿä¼šæ›´æ–°ã€‚</p>
<p>åœ¨ç”±äºç¼“å­˜å†…çš„æ•°æ®è¿‡æœŸæˆ–æ•°æ®ç¼ºå¤±è€Œå¯¼è‡´ç¼“å­˜æœªå‘½ä¸­çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨å»¶è¿ŸåŠ è½½æ¨¡å¼æ¥æ›´æ–°ç¼“å­˜ã€‚å› æ­¤ï¼Œç›´å†™æ¨¡å¼æ€»æ˜¯ä¸å»¶è¿ŸåŠ è½½æ¨¡å¼ä¸€èµ·ä½¿ç”¨ã€‚</p>
<p>è¿™ç§æ¨¡å¼çš„ä¸€ä¸ªä¼˜ç‚¹æ˜¯æ•°æ®åº“è¯»å–æ›´å°‘ï¼Œå› æ­¤æ•°æ®åº“çš„æ€§èƒ½æ˜¯é¡¶çº§çš„ã€‚å¦ä¸€ä¸ªä¼˜ç‚¹æ˜¯ï¼Œå®ƒæä¾›äº†æ›´å¥½çš„åº”ç”¨ç¨‹åºæ€§èƒ½ï¼Œå¹¶ä¸”ä¿è¯äº†ç”¨æˆ·ä½“éªŒï¼Œå› ä¸ºåœ¨ç¼“å­˜ä¸­æ‰¾åˆ°æ•°æ®çš„å¯èƒ½æ€§å¾ˆé«˜ã€‚</p><div class="code-block code-block-54">
<hr/>
<h3>æ›´å¤šæ¥è‡ª LogRocket çš„ç²¾å½©æ–‡ç« :</h3>

<hr/></div>
<p>è¿™ç§æ–¹æ³•çš„ç¼ºç‚¹æ˜¯ï¼Œå³ä½¿ä¸ç»å¸¸è®¿é—®çš„æ•°æ®ä¹Ÿä¼šå†™å…¥ç¼“å­˜ï¼Œä»è€Œå¯¼è‡´ç¼“å­˜æ›´å¤§ã€æ›´æ˜‚è´µã€‚æ€»ä¹‹ï¼Œè¦å®ç°è¡Œä¸šæ ‡å‡†çš„ç¼“å­˜ç­–ç•¥ï¼Œå»ºè®®ä½¿ç”¨è¿™ä¸¤ç§æ¨¡å¼ï¼Œå¹¶ä¸ºæ•°æ®è®¾ç½®é€‚å½“çš„è¿‡æœŸé™åˆ¶ï¼Œä»¥ä¿æŒæ•°æ®æœ€æ–°ã€‚</p>
<h2 id="exploring-common-caching-packages">æ¢ç´¢å¸¸è§çš„ç¼“å­˜åŒ…</h2>
<p>åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†é‡ç‚¹ä½¿ç”¨ Redis ä½œä¸ºæˆ‘ä»¬çš„ç¼“å­˜æœåŠ¡å™¨ï¼Œä½†æ˜¯å…¶ä»–åŒæ ·å¯ä»¥ä½¿ç”¨çš„è¡Œä¸šç¼“å­˜æœåŠ¡å™¨åŒ…æ‹¬<a href="https://www.npmjs.com/package/node-cache" target="_blank" rel="noopener">èŠ‚ç‚¹ç¼“å­˜</a>ã€<a href="https://www.npmjs.com/package/memcache" target="_blank" rel="noopener">å†…å­˜ç¼“å­˜</a>ã€<a href="https://www.npmjs.com/package/flat-cache">å¹³é¢ç¼“å­˜</a>ã€<a href="https://www.npmjs.com/package/cacache" target="_blank" rel="noopener"> cacache </a>ç­‰ã€‚ä¸‹é¢æˆ‘ä»¬æ¥ç®€å•æ¢è®¨ä¸€ä¸‹<code>node-cache</code>å’Œ Memcacheã€‚</p>
<h3 id="node-cache-package"><code>Node-cache</code></h3>
<p><code>Node-cache</code>æ˜¯ä¸€ä¸ªç®€å•çš„å†…éƒ¨èŠ‚ç‚¹å†…éƒ¨ç¼“å­˜æ¨¡å—ï¼Œå®ƒæœ‰ç±»ä¼¼äºå…¶ä»–ç¼“å­˜åº“çš„<code>set</code>ã€<code>get</code>å’Œ<code>delete</code>æ–¹æ³•ã€‚å®ƒåœ¨ npm ä¸Šå¯ç”¨ï¼Œå¯ä»¥ç”¨<code>npm install node-cache --save</code>å‘½ä»¤å®‰è£…ã€‚</p>
<p>ä½œä¸ºä¸€ç§æ™®éçš„åšæ³•ï¼Œè¿™äº›é”®å¯ä»¥æœ‰ä¸€ä¸ªè¶…æ—¶(TTL ),è¶…æ—¶åå®ƒä»¬ä¼šè‡ªåŠ¨è¿‡æœŸå¹¶ä»ç¼“å­˜ä¸­åˆ é™¤ã€‚è¦åˆå§‹åŒ–è¯¥åº“ï¼Œè¯·å‚è§ä»¥ä¸‹å†…å®¹:</p>
<pre class="language-javascript hljs">const NodeCache = require( "node-cache" ); 
const myCache = new NodeCache();
</pre>
<p>ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>set</code>æ–¹æ³•å­˜å‚¨ä¸€ä¸ªå¯†é’¥ã€‚ç”¨ TTL(ä»¥ç§’ä¸ºå•ä½)è®¾ç½®é”®/å€¼å¯¹çš„æ ¼å¼å¦‚ä¸‹æ‰€ç¤º:</p>
<p><code>myCache.set( key, val, [ ttl ] )</code></p>
<p>å¦‚æœæˆåŠŸï¼Œå®ƒå°†è¿”å›<code>true</code>:</p>
<pre class="language-javascript hljs">obj = { name: "Alexander", age: 42 };
data = myCache.set( "key", obj, 20000 ); 
//true 
</pre>
<p>å…³äºå¯ç”¨æ–¹æ³•ä»¥åŠå¦‚ä½•ä½¿ç”¨å®ƒä»¬çš„æ›´å¤šç»†èŠ‚å’Œä¿¡æ¯å¯ä»¥åœ¨<a href="https://github.com/node-cache/node-cache">Git</a><a href="https://github.com/node-cache/node-cache">H</a><a href="https://github.com/node-cache/node-cache">ub repo</a>ä¸­æ‰¾åˆ°ã€‚</p>
<h3 id="memcached">Memcached</h3>
<p>ç„¶è€Œï¼ŒMemcached æ˜¯ä¸€ä¸ªå…è´¹ã€å¼€æºã€é«˜æ€§èƒ½çš„åˆ†å¸ƒå¼å†…å­˜å¯¹è±¡ç¼“å­˜ç³»ç»Ÿã€‚å®ƒæ˜¯ä¸€ä¸ªå†…å­˜ä¸­çš„é”®å€¼å­˜å‚¨ï¼Œç”¨äºå­˜å‚¨å­—ç¬¦ä¸²ã€å¯¹è±¡ç­‰å°å—çš„ä»»æ„æ•°æ®ã€‚Memcached æ˜¯ä¸€ä¸ªåŠŸèƒ½å…¨é¢çš„ Node.js å®¢æˆ·æœºï¼Œå…¶æ ¸å¿ƒæ˜¯å¯ä¼¸ç¼©æ€§ã€æ€§èƒ½å’Œé«˜å¯ç”¨æ€§ã€‚</p>
<p>è¦å®‰è£… Memcachedï¼Œæˆ‘ä»¬å¯ä»¥è¿è¡Œ:</p>
<p><code>npm install memcached</code></p>
<p>åœ¨ other ä¸­ï¼Œä¸ºäº†è®¾ç½®å®¢æˆ·æœºï¼Œæ„é€ å‡½æ•°æ¥å—ä¸¤ä¸ªä¸åŒçš„å‚æ•°:æœåŠ¡å™¨ä½ç½®å’Œé€‰é¡¹ã€‚è¯­æ³•å¦‚ä¸‹æ‰€ç¤º:</p>
<pre class="language-javascript hljs">var Memcached = require('memcached'); 
var memcached = new Memcached (Server locations, options);
</pre>
<p>æ³¨æ„:å…¬å…±æ–¹æ³•çš„é“¾æ¥å¯ä»¥åœ¨<a href="https://www.npmjs.com/package/memcached#public-methods" target="_blank" rel="noopener">æ–‡æ¡£</a>ä¸­æ‰¾åˆ°ã€‚</p>
<h2 id="caching-techniques-in-node-apps">èŠ‚ç‚¹åº”ç”¨ä¸­çš„ç¼“å­˜æŠ€æœ¯</h2>
<p>åœ¨è®¾è®¡åº”ç”¨ç¨‹åºæ¶æ„æ—¶ï¼Œåº”ç”¨ç¨‹åºå¤„ç†æ•°æ®çš„é€Ÿåº¦æ˜¯ä¸€ä¸ªä¸»è¦çš„æ€§èƒ½è€ƒè™‘å› ç´ ã€‚ä½œä¸ºå·¥ç¨‹å¸ˆï¼Œæˆ‘ä»¬éœ€è¦æ˜ç¡®åœ°ç¡®å®šæˆ‘ä»¬çš„æ•°æ®å¤„ç†/å¤„ç†å‘¨æœŸçš„å“ªäº›éƒ¨åˆ†åº”è¯¥è¢«ç¼“å­˜ã€‚</p>
<p>ç¼“å­˜ç³»ç»Ÿä¸æ˜¯å­¤ç«‹ä½¿ç”¨çš„ã€‚ç¼“å­˜åŸºæœ¬ä¸Šæ˜¯ä¸€ä¸ªæŠ½è±¡å±‚ï¼ŒåŒ…æ‹¬ä¸€ä¸ªä¸­é—´å­˜å‚¨æœºåˆ¶å’Œä¸€ä¸ªåç«¯ç³»ç»Ÿ(åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­æ˜¯ Node.js ),é€šå¸¸è¿˜æœ‰ä¸€ä¸ªä¼ ç»Ÿçš„æ•°æ®åº“ã€‚é‡ç‚¹æ˜¯å®ç°ä¸€ä¸ªé«˜æ•ˆçš„æ•°æ®æ£€ç´¢è¿‡ç¨‹ï¼Œè€Œç¼“å­˜ç³»ç»Ÿå°±æ˜¯ä¸ºè¿™ä¸€ç‰¹å®šç›®çš„è€Œä¼˜åŒ–çš„ã€‚</p>
<p>å¯¹äº Node.js åº”ç”¨ç¨‹åºï¼Œç¼“å­˜ç­–ç•¥åº”è¯¥è§£å†³ä»¥ä¸‹é—®é¢˜:</p>
<ul>
<li><strong>æ›´æ–°æˆ–ä½œåºŸæ¥è‡ª</strong><strong/><strong>ç¼“å­˜</strong>çš„é™ˆæ—§æ•°æ®:web å¼€å‘ä¸­ä¸€ä¸ªéå¸¸å¸¸è§çš„é—®é¢˜æ˜¯å¤„ç†ç¼“å­˜è¿‡æœŸé€»è¾‘ä»¥ç»´æŠ¤æœ€æ–°çš„ç¼“å­˜</li>
<li><strong>ç¼“å­˜ç»å¸¸è®¿é—®çš„æ•°æ®</strong>:ç¼“å­˜åœ¨è¿™é‡Œå¾ˆæœ‰æ„ä¹‰ï¼Œå› ä¸ºæˆ‘ä»¬å¯ä»¥ä¸€æ¬¡æ€§å¤„ç†æ•°æ®ï¼Œå°†å…¶å­˜å‚¨åœ¨ç¼“å­˜ä¸­ï¼Œç„¶åç¨åç›´æ¥æ£€ç´¢ï¼Œè€Œæ— éœ€è¿›è¡Œä»»ä½•æ˜‚è´µæˆ–è€—æ—¶çš„æ“ä½œã€‚ç„¶åï¼Œæˆ‘ä»¬éœ€è¦å®šæœŸæ›´æ–°ç¼“å­˜ï¼Œä»¥ä¾¿ç”¨æˆ·å¯ä»¥çœ‹åˆ°æœ€æ–°çš„ä¿¡æ¯</li>
</ul>
<h3 id="scalability-issues">å¯æ‰©å±•æ€§é—®é¢˜</h3>
<p>å¤§å‹åº”ç”¨ç¨‹åºå¿…é¡»å¤„ç†ã€è½¬æ¢å’Œå­˜å‚¨å¤§å‹æ•°æ®é›†ã€‚å› ä¸ºæ•°æ®æ˜¯è¿™äº›åº”ç”¨åŠŸèƒ½çš„åŸºç¡€ï¼Œæˆ‘ä»¬å¤„ç†æ•°æ®çš„æ–¹å¼å†³å®šäº†æˆ‘ä»¬çš„åº”ç”¨åœ¨é‡å¤–çš„è¡¨ç°ã€‚</p>
<p>Web åº”ç”¨ç¨‹åºæœ€ç»ˆä¼šå‘å±•åˆ°èƒ½å¤Ÿæ»¡è¶³å¤§é‡æ•°æ®çš„éœ€æ±‚ã€‚é€šå¸¸ï¼Œæˆ‘ä»¬éœ€è¦å°†è¿™äº›æ•°æ®å­˜å‚¨åœ¨å­˜å‚¨ç³»ç»Ÿä¸­ï¼Œä¾‹å¦‚æ•°æ®åº“ã€‚è¯´åˆ°æ•°æ®æ£€ç´¢ï¼Œæœ‰æ—¶ä»ä¸­é—´å­˜å‚¨æœºåˆ¶è·å–æ•°æ®æ¯”æ‰§è¡Œå‡ æ¬¡æ•°æ®åº“æŸ¥è¯¢æ›´å¿«ã€‚</p>
<p>å½“æˆ‘ä»¬æœ‰å¾ˆå¤šç”¨æˆ·æ—¶ï¼Œéœ€è¦æ‰¾åˆ°æ›¿ä»£çš„è§£å†³æ–¹æ¡ˆæ¥æ£€ç´¢æ•°æ®ï¼Œè€Œä¸æ˜¯æ€»æ˜¯ä»ç£ç›˜è¯»å–ã€‚å½“æ¶‰åŠåˆ° I/O æ—¶ï¼Œåº”ç”¨ç¨‹åºå­˜å‚¨ç³»ç»Ÿå…·æœ‰å±€é™æ€§ï¼Œå› æ­¤æˆ‘ä»¬åº”è¯¥ä»”ç»†äº†è§£ä»¥æœ€å¿«æ–¹å¼å­˜å‚¨å’Œæ£€ç´¢æ•°æ®çš„æœ€ä½³æœºåˆ¶ã€‚æ¬¢è¿æ¥åˆ° Redis çš„ç¼“å­˜ä¸–ç•Œã€‚</p>
<h3 id="node-js-caching-redis">node . js caching with redis èŠ‚ç‚¹. js å¿«å–</h3>
<p>Redis æ˜¯ä¸€ä¸ªé¦–é€‰çš„ç¼“å­˜è§£å†³æ–¹æ¡ˆï¼Œå› ä¸º<a href="https://blog.logrocket.com/guide-to-fully-understanding-redis/" target="_blank" rel="noopener">å®ƒçš„æ•´ä¸ªæ•°æ®åº“éƒ½å­˜å‚¨åœ¨å†…å­˜</a>ä¸­ï¼Œå¹¶ä¸”å®ƒä½¿ç”¨ç£ç›˜æ•°æ®åº“è¿›è¡Œæ•°æ®æŒä¹…åŒ–ã€‚å› ä¸º Redis æ˜¯ä¸€ä¸ªå†…å­˜æ•°æ®åº“ï¼Œå®ƒçš„æ•°æ®è®¿é—®æ“ä½œæ¯”ä»»ä½•å…¶ä»–åŸºäºç£ç›˜çš„æ•°æ®åº“éƒ½è¦å¿«ï¼Œè¿™ä½¿å¾— Redis æˆä¸ºç¼“å­˜çš„å®Œç¾é€‰æ‹©ã€‚</p>
<p>å®ƒçš„é”®å€¼æ•°æ®å­˜å‚¨ç³»ç»Ÿæ˜¯å¦ä¸€ä¸ªä¼˜åŠ¿ï¼Œå› ä¸ºå®ƒä½¿å­˜å‚¨å’Œæ£€ç´¢æ›´åŠ ç®€å•ã€‚ä½¿ç”¨ Redisï¼Œæˆ‘ä»¬å¯ä»¥åˆ†åˆ«ä½¿ç”¨<code>SET</code>å’Œ<code>GET</code>æ–¹æ³•åœ¨ç¼“å­˜ä¸­å­˜å‚¨å’Œæ£€ç´¢æ•°æ®ã€‚é™¤æ­¤ä¹‹å¤–ï¼ŒRedis è¿˜å¯ä»¥å¤„ç†å¤æ‚çš„æ•°æ®ç±»å‹ï¼Œæ¯”å¦‚åˆ—è¡¨ã€é›†åˆã€å­—ç¬¦ä¸²ã€æ•£åˆ—ã€ä½å›¾ç­‰ç­‰ã€‚</p>
<p>ä½¿ç”¨ Redis è¿›è¡Œç¼“å­˜çš„è¿‡ç¨‹éå¸¸ç®€å•ã€‚å½“æˆ‘ä»¬æ”¶åˆ°ç”¨æˆ·å¯¹å¯ç”¨äº†ç¼“å­˜çš„è·¯ç”±çš„è¯·æ±‚æ—¶ï¼Œæˆ‘ä»¬é¦–å…ˆæ£€æŸ¥æ‰€è¯·æ±‚çš„æ•°æ®æ˜¯å¦å·²ç»å­˜å‚¨åœ¨ç¼“å­˜ä¸­ã€‚å¦‚æœæ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥ä» Redis ç¼“å­˜ä¸­å¿«é€Ÿæ£€ç´¢å®ƒï¼Œå¹¶å°†å“åº”å‘é€å›æ¥ã€‚</p>
<p>ä½†æ˜¯ï¼Œå¦‚æœæ•°æ®æ²¡æœ‰å­˜å‚¨åœ¨ç¼“å­˜ä¸­ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºâ€œç¼“å­˜æœªå‘½ä¸­â€ï¼Œæˆ‘ä»¬å¿…é¡»é¦–å…ˆä»æ•°æ®åº“æˆ–å¤–éƒ¨ API è°ƒç”¨ä¸­æ£€ç´¢æ•°æ®ï¼Œå¹¶å°†å…¶å‘é€ç»™å®¢æˆ·ç«¯ã€‚æˆ‘ä»¬è¿˜ç¡®ä¿å°†æ£€ç´¢åˆ°çš„æ•°æ®å­˜å‚¨åœ¨ç¼“å­˜ä¸­ï¼Œä»¥ä¾¿ä¸‹æ¬¡å‘å‡ºç›¸åŒçš„è¯·æ±‚æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ç®€å•åœ°å°†ç¼“å­˜çš„æ•°æ®å‘é€å›ç”¨æˆ·ã€‚</p>
<p>æ—¢ç„¶æˆ‘ä»¬å¯¹è¦åšçš„äº‹æƒ…æœ‰äº†æ¸…æ™°çš„æƒ³æ³•ï¼Œè®©æˆ‘ä»¬å¼€å§‹å®æ–½å§ã€‚</p>
<h3 id="creating-custom-cache-service-node-js">åœ¨ Node.js ä¸­åˆ›å»ºè‡ªå®šä¹‰ç¼“å­˜æœåŠ¡</h3>
<p>æŸ¥è¯¢æœ‰æ—¶éœ€è¦å‡ é¡¹æ“ä½œï¼Œå¦‚ä»æ•°æ®åº“ä¸­æ£€ç´¢æ•°æ®ã€æ‰§è¡Œè®¡ç®—ã€ä»ç¬¬ä¸‰æ–¹æœåŠ¡ä¸­æ£€ç´¢é™„åŠ æ•°æ®ç­‰ç­‰ã€‚æ‰€æœ‰è¿™äº›éƒ½å¯èƒ½å½±å“åº”ç”¨ç¨‹åºçš„æ•´ä½“æ€§èƒ½ã€‚ç¼“å­˜çš„ç›®æ ‡æ˜¯æé«˜è¿™äº›æ•°æ®è®¿é—®æ“ä½œçš„æ•ˆç‡ã€‚</p>
<p>åœ¨è¿™ä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†äº†è§£å¦‚ä½•ä½¿ç”¨ Redis ä¸º Node.js åº”ç”¨ç¨‹åºåˆ›å»ºä¸€ä¸ªç®€å•çš„ç¼“å­˜ï¼Œç„¶åæ£€æŸ¥å®ƒå¦‚ä½•å½±å“å…¶æ€§èƒ½ã€‚ä¸‹é¢é‡ç‚¹ä»‹ç»äº†è¿™äº›æ­¥éª¤:</p>
<ol>
<li>å¯åŠ¨ä¸€ä¸ªç®€å•çš„ Node.js åº”ç”¨ç¨‹åº</li>
<li>ç¼–å†™å¯é‡ç”¨çš„è‡ªå®šä¹‰ Redis å®ç°/ç¼“å­˜æœåŠ¡</li>
<li>å±•ç¤ºå¦‚ä½•ä½¿ç”¨ Redis ç¼“å­˜æ¥è‡ªå¤–éƒ¨ API è°ƒç”¨çš„æ•°æ®æ¥å¸®åŠ©æé«˜æˆ‘ä»¬åº”ç”¨ç¨‹åºçš„æ€§èƒ½</li>
</ol>
<p>åˆ›å»ºç®€å•çš„è‡ªå®šä¹‰ç¼“å­˜æœåŠ¡å°†ä½¿æˆ‘ä»¬èƒ½å¤Ÿ:</p>
<ul>
<li>åˆ›å»ºä¸€ä¸ªå¯é‡ç”¨çš„æœåŠ¡ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨åº”ç”¨ç¨‹åºçš„å¤šä¸ªéƒ¨åˆ†ä½¿ç”¨å®ƒ</li>
<li>è§„èŒƒåŒ–ç¼“å­˜ APIï¼Œå¹¶éšç€åº”ç”¨çš„å¢é•¿æ·»åŠ æ›´å¤šæˆ‘ä»¬éœ€è¦çš„æ–¹æ³•</li>
<li>è½»æ¾åœ°ç”¨å¦ä¸€ä¸ªæ¨¡å—æ›¿æ¢æˆ‘ä»¬é€‰æ‹©çš„ç¼“å­˜æ¨¡å—(å¦‚æœéœ€è¦)</li>
</ul>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬èµ°å§ï¼æ‚¨å¯ä»¥ä½¿ç”¨<a href="https://github.com/firebase007/Node.js_performance_with_caching" target="_blank" rel="noopener"> GitHub repo </a>æ¥è·Ÿè¿›æˆ‘ä»¬çš„è¿›å±•ã€‚</p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬å°†å¿«é€Ÿå¼•å¯¼ä¸€ä¸ªç®€å•çš„ Node.js åº”ç”¨ç¨‹åºã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡è¿è¡Œ<code>npm init</code>æ¥åšåˆ°è¿™ä¸€ç‚¹ï¼Œå®ƒä¸ºæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª<code>package.json</code>æ–‡ä»¶:</p>
<pre class="language-json hljs">{
  "name": "performance_at_scale_node.js",
  "version": "1.0.0",
  "description": "A sample app to showcase Redis caching and how it affects an app overall performance benchmark",
  "main": "app.js",
  "scripts": {
    "start": "node app.js"
  },
  "keywords": [
    "Node.js",
    "Redis",
    "Performance",
    "Cache",
    "Caching",
    "JavaScript",
    "Backend",
    "LogRocket",
    "Frontend_Monitoring"
  ],
  "author": "Alexander Nnakwue",
  "license": "MIT",
  "dependencies": {
    "@hapi/joi": "^15.0.1",
    "axios": "^0.21.1",
    "body-parser": "^1.19.0",
    "dotenv": "^8.2.0",
    "express": "^4.17.1",
    "global": "^4.4.0",
    "redis": "^3.0.2",
    "util": "^0.12.3"
  }
}
</pre>
<p>åœ¨ä¸Šé¢çš„æ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬å·²ç»å®‰è£…äº†åº”ç”¨ç¨‹åºæ‰€éœ€çš„ä¸€äº›ä¾èµ–é¡¹ã€‚æˆ‘ä»¬å®‰è£…äº† Redis ç”¨äºç¼“å­˜ï¼ŒAxios ç”¨äº HTTP è¯·æ±‚ï¼Œ@hapi/joi ç”¨äºæ¨¡å¼/ <code>(req.body)</code>éªŒè¯ï¼Œ<code>global</code>ç”¨äºè¦æ±‚å…¨å±€å˜é‡ï¼ŒExpress ç”¨äºæˆ‘ä»¬çš„åŸºæœ¬ Express æœåŠ¡å™¨ï¼Œä»¥åŠå…¶ä»–ä¸€äº›ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬åœ¨æˆ‘ä»¬çš„é¡¹ç›®ç›®å½•çš„æ ¹ç›®å½•ä¸­è®¾ç½®ä¸€ä¸ªç®€å•çš„ Express æœåŠ¡å™¨ï¼›æˆ‘ä»¬å¯ä»¥ç»™å®ƒèµ·ä»»ä½•æˆ‘ä»¬æƒ³è¦çš„åå­—ã€‚å‚è§ä¸‹é¢<code>app.js</code>æ–‡ä»¶ä¸­çš„ Express æœåŠ¡å™¨:</p>
<pre class="language-javascript hljs">require('dotenv').config()
const express = require('express')
const bodyParser = require('body-parser')
const config = require('./config')
const routes = require('./app/routes')

const app = express()
require("./cacheManager");

app.use(bodyParser.json())
// parse application/x-www-form-urlencoded
app.use(bodyParser.urlencoded({ extended: true }))

// parse application/json
app.use(bodyParser.json())
app.get('/', (req, res) =&gt; {
    // eslint-disable-next-line no-tabs
    res.status(200).send('Welcome to the Node.js Cache and Performance App')
})
// add routes here
routes(app)

// catch 404 and forward to error handler
app.use((req, res, next) =&gt; {
    const err = new Error('Not Found')
    err.status = 404
    res.send('Route not found')
    next(err)
})
app.listen(process.env.PORT || config.port, () =&gt; {
    console.log(`${config.name} listening on port ${config.port}!`)
})

module.exports = app
</pre>
<p>åœ¨ä¸Šé¢çš„æœåŠ¡å™¨æ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æˆ‘ä»¬æ­£åœ¨å¯¼å…¥ä¸€ä¸ª<code>cacheManager</code>æ–‡ä»¶ï¼Œå®ƒåŸºæœ¬ä¸Šä½¿ç”¨<code>util</code>æ¨¡å—å¤„ç† Redis ä¸­ä¸å¼‚æ­¥ç¼“å­˜æœ‰å…³çš„æ‰€æœ‰äº‹æƒ…ã€‚</p>
<p>è®©æˆ‘ä»¬çœ‹çœ‹è¯¥æ–‡ä»¶çš„å†…å®¹:</p>
<pre class="language-javascript hljs">"use strict";

const redis = require("redis");
const {promisify} = require("util");
const config = require('./config')
const redisClient = redis.createClient(
    {
        host: config.redis_host,
        port: config.redis_port
    }
);
const password = config.redis_password || null;
if(password &amp;&amp; password != "null"){
    redisClient.auth(password, (err,res) =&gt; {
        console.log("res",res);
        console.log("err",err);
    });
}
try{
    redisClient.getAsync = promisify(redisClient.get).bind(redisClient);
    redisClient.setAsync = promisify(redisClient.set).bind(redisClient);
    redisClient.lpushAsync = promisify(redisClient.lpush).bind(redisClient);
    redisClient.lrangeAsync = promisify(redisClient.lrange).bind(redisClient);
    redisClient.llenAsync = promisify(redisClient.llen).bind(redisClient);
    redisClient.lremAsync = promisify(redisClient.lrem).bind(redisClient);
    redisClient.lsetAsync = promisify(redisClient.lset).bind(redisClient);
    redisClient.hmsetAsync = promisify(redisClient.hmset).bind(redisClient);
    redisClient.hmgetAsync = promisify(redisClient.hmget).bind(redisClient);
    redisClient.clear = promisify(redisClient.del).bind(redisClient);
}catch (e) {
    console.log("redis error", e);
}

redisClient.on("connected", function () {
    console.log("Redis is connected");
});
redisClient.on("error", function (err) {
    console.log("Redis error.", err);
});
setInterval(function() {
    console.log("Keeping alive - Node.js Performance Test with Redis");
    redisClient.set('ping', 'pong');
}, 1000 * 60 * 4);

global.cache = redisClient;
module.exports = redisClient;
</pre>
<p>ä»ä¸Šé¢çš„æ–‡ä»¶ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬å·²ç»åˆ›å»ºäº†ä¸€ä¸ª Redis å®¢æˆ·ç«¯ï¼Œå¹¶ä½¿ç”¨æˆ‘ä»¬çš„<code>env</code>å˜é‡ä¸­çš„<code>config</code>è¿æ¥åˆ°ä¸€ä¸ª Redis é›†ç¾¤ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬æ­£åœ¨è®¾ç½®æ¯å››åˆ†é’Ÿè¿è¡Œä¸€æ¬¡çš„ä¿æŒæ´»åŠ¨è„šæœ¬:</p>
<pre class="language-javascript hljs">09:02:42 web.1   |  Keeping alive - Node.js Performance Test with Redis
09:06:42 web.1   |  Keeping alive - Node.js Performance Test with Redis
09:10:42 web.1   |  Keeping alive - Node.js Performance Test with Redis
09:14:42 web.1   |  Keeping alive - Node.js Performance Test with Redis
09:18:42 web.1   |  Keeping alive - Node.js Performance Test with Redis
09:22:42 web.1   |  Keeping alive - Node.js Performance Test with Redis
09:26:42 web.1   |  Keeping alive - Node.js Performance Test with Redis
09:30:42 web.1   |  Keeping alive - Node.js Performance Test with Redis
09:34:42 web.1   |  Keeping alive - Node.js Performance Test with Redis
09:38:42 web.1   |  Keeping alive - Node.js Performance Test with Redis
09:42:42 web.1   |  Keeping alive - Node.js Performance Test with Redis
09:46:42 web.1   |  Keeping alive - Node.js Performance Test with Redis
</pre>
<p>ä¿å­˜æ‰€æœ‰<code>env</code>å˜é‡çš„<code>config</code>æ–‡ä»¶å¦‚ä¸‹æ‰€ç¤º:</p>
<pre>require('dotenv').config()
const { env } = process
module.exports = {
    name: env.APP_NAME,
    baseUrl: env.APP_BASE_URL,
    port: env.PORT,
    redis_host: env.REDIS_HOST,
    redis_port: env.REDIS_PORT,
    redis_password: env.REDIS_PASSWORD,
    paystack_secret_key: env.PAYSTACK_SECRET_KEY
}
</pre>
<p>ç°åœ¨æˆ‘ä»¬å·²ç»å®Œæˆäº†æ‰€æœ‰çš„è®¾ç½®ï¼Œæˆ‘ä»¬å¯ä»¥ç»§ç»­è¿™ä¸ªç»ƒä¹ ä¸­æœ€é‡è¦çš„éƒ¨åˆ†:å…è®¸æˆ‘ä»¬åº”ç”¨ Redis ç¼“å­˜ç­–ç•¥çš„å®é™…ä¸šåŠ¡é€»è¾‘ã€‚è¯·å‚è§ä¸‹é¢æˆ‘ä»¬åº”ç”¨ç¨‹åºçš„æ–‡ä»¶å¤¹ç»“æ„:</p>
<p><img data-attachment-id="137365" data-permalink="https://blog.logrocket.com/caching-node-js-optimize-app-performance/attachment/redis-folder-structure-app-2/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/04/redis-folder-structure-app-1.png" data-orig-size="400,982" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Redis Folder Structure App" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/04/redis-folder-structure-app-1-122x300.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/04/redis-folder-structure-app-1.png" decoding="async" class="aligncenter size-full wp-image-137365 jetpack-lazy-image" src="../Images/495028b74beaa515c270c6f9f5a02a28.png" alt="Redis Folder Structure App" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2021/04/redis-folder-structure-app-1.png 400w, https://blog.logrocket.com/wp-content/uploads/2021/04/redis-folder-structure-app-1-122x300.png 122w" data-lazy-sizes="(max-width: 400px) 100vw, 400px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2021/04/redis-folder-structure-app-1.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/04/redis-folder-structure-app-1.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="137365" data-permalink="https://blog.logrocket.com/caching-node-js-optimize-app-performance/attachment/redis-folder-structure-app-2/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/04/redis-folder-structure-app-1.png" data-orig-size="400,982" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Redis Folder Structure App" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/04/redis-folder-structure-app-1-122x300.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/04/redis-folder-structure-app-1.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-137365" src="../Images/495028b74beaa515c270c6f9f5a02a28.png" alt="Redis Folder Structure App" srcset="https://blog.logrocket.com/wp-content/uploads/2021/04/redis-folder-structure-app-1.png 400w, https://blog.logrocket.com/wp-content/uploads/2021/04/redis-folder-structure-app-1-122x300.png 122w" sizes="(max-width: 400px) 100vw, 400px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/04/redis-folder-structure-app-1.png"/></noscript>
<p>åœ¨<code>app</code>æ–‡ä»¶å¤¹ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°åœ¨<code>paystack</code>æ–‡ä»¶å¤¹ä¸­æœ‰ä¸€ä¸ªåä¸º<code>paystackRepository.js</code>çš„æ–‡ä»¶ã€‚è¿™ä¸ªæ–‡ä»¶è°ƒç”¨ Paystack APIï¼Œå®ƒè·å–é“¶è¡Œåˆ—è¡¨å¹¶è§£æé“¶è¡Œå¸å·ã€‚å¯ä»¥åœ¨è¿™é‡Œ<a href="https://paystack.com/docs/identity-verification/resolve-account-number/">æ‰¾åˆ°è¿™ä¸ª Paystack API ç‰¹æ€§çš„æ–‡æ¡£é“¾æ¥ã€‚</a></p>
<p><code>paystackRepository.js</code>æ–‡ä»¶çš„å†…å®¹å¦‚ä¸‹:</p>
<pre class="language-javascript hljs">const axios = require("axios");
const config = require('../../config')
const {handleAxiosError} = require("../../helpers");
const _axios = axios.create({
    baseURL: "https://api.paystack.co",
    headers: {
        Authorization: `Bearer ${config.paystack_secret_key}`
    }
});

exports.banks = async () =&gt; {
    try {
        return {
            data: (await _axios
                .get(`bank`)).data.data
        };
    } catch (error) {
        console.log('An Error Occurred', error, handleAxiosError(error));
        return {error: error.message};
    }
};

exports.resolveAccountNumber = async (bankCode, accountNumber) =&gt; {
    try {
        return {
            data: (await _axios
                .get(`bank/resolve`, {
                    params: {
                        bank_code: bankCode,
                        account_number: accountNumber
                    }
                })).data.data
        };
    } catch (error) {
        console.log('An Error Occurred', error, handleAxiosError(error));
        return {error: error.message};
    }
};
</pre>
<p>ä»ä¸Šé¢çš„æ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æˆ‘ä»¬ä½¿ç”¨ Axios å’Œå­˜å‚¨åœ¨æˆ‘ä»¬çš„<code>env</code>å˜é‡ä¸­çš„<code>PAYSTACK_SECRET_KEY</code>å¤´å‘ Paystack çš„ API å‘å‡º HTTP è¯·æ±‚ã€‚</p>
<p>åœ¨<code>bankAccount</code>æ–‡ä»¶å¤¹é‡Œé¢ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹<code>BankService.js</code>æ–‡ä»¶ã€‚å®ƒè°ƒç”¨<code>paystackRepository.js</code>æ–‡ä»¶æ¥è·å–é“¶è¡Œåˆ—è¡¨å¹¶è§£æé“¶è¡Œè´¦å·ï¼Œæ­£å¦‚æˆ‘ä»¬å‰é¢æ‰€è®¨è®ºçš„ã€‚æˆ‘ä»¬è¿˜åœ¨è¿›è¡Œç¬¬ä¸€æ¬¡ API è°ƒç”¨åç¼“å­˜ç»“æœï¼Œä»¥æ¶ˆé™¤åç»­è°ƒç”¨çš„éœ€è¦:</p>
<pre class="language-javascript hljs">"use strict";

const paystackRepository = require("../paystack/PaystackRepository");

exports.fetchAllBanks = async () =&gt; {
    // incase we are calling this endpoint a second time, we do not need to make a new API request 
    let banks = await cache.getAsync("bank-list");
    console.log("Data from cache", banks);
    if(banks)
        return {data: JSON.parse(banks)};
  const {error, data} = await paystackRepository.banks();
  if(error) return {error};
  // Store the bank list in a cache, since it rarely changes
  let cacheResponse = await cache.setAsync("bank-list", JSON.stringify(data));
  console.log("Cache", cacheResponse);
  return {
      data
  }
};

exports.resolveAccount = async (bankName, accountNumber) =&gt; {
    // Relying on the cached data is faster, as it rarely changes
let banks = JSON.parse(await cache.getAsync("bank-list"));

console.log(banks, 'banks')
    // Incase the data is not stored in the cache yet (but we expect it to be), make an API call to get bank lists 
    if(!banks){
        const {error, data} = await paystackRepository.banks();
        if(error)return {error};
        banks = data;
    }
    const bank = banks.find(bank =&gt; {
        return bank.name == bankName
    })
    if(!bank)
        return {error: "Bank Not Found"};
    console.log(bank.code)
    const {error, data} =  await paystackRepository.resolveAccountNumber(bank.code, accountNumber);
    if(error)return {error };
    return {
        data: {
            accountNumber,
            bankName,
            accountName: data.account_name
        }
    }
};

exports.resolveAccountPerfTest = async (bankName, accountNumber) =&gt; {
    // if there were no cache mechanism in place we needed to go fetch the bank lists compulsorily at every API call
    let banks;
    if(bankName &amp;&amp; accountNumber) {
        const {error, data} = await paystackRepository.banks();
        if(error)return {error};
        banks = data;
    }

    const bank = banks.find(bank =&gt; {
        return bank.name == bankName
    })
    if(!bank)
        return {error: "Bank Not Found"};
    const {error, data} =  await paystackRepository.resolveAccountNumber(bank.code, accountNumber);
    if(error)return {error };
    return {
        data: {
            accountNumber,
            bankName,
            accountName: data.account_name
        }
    }
};
</pre>
<p>å¯¹äº<code>fetchAllBanks</code>æœåŠ¡ï¼Œæˆ‘ä»¬ä» Redis è·å–é“¶è¡Œåˆ—è¡¨ï¼Œä½†åœ¨å‘å‡ºåˆå§‹ API è¯·æ±‚æ—¶ï¼Œå¿…é¡»å…ˆå°†ç»“æœä¿å­˜åˆ° Redis ç¼“å­˜ä¸­ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æˆ‘ä»¬å¤åˆ¶äº†<code>resolveAccount</code>æ–¹æ³•ï¼Œå¹¶åˆ é™¤äº†åä¸º<code>resolveAccountPerfTest</code>çš„ç¬¬äºŒä¸ªæ–¹æ³•çš„ Redis å®ç°ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å¯ä»¥å¯¼èˆªåˆ°æ§åˆ¶å™¨æ–‡ä»¶ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬å®é™…ä½¿ç”¨è¿™äº›æ–¹æ³•:</p>
<pre class="language-javascript hljs">"use strict";
const bankService = require("./BankService");
const {
    sendErrorResponse,
    sendResponse
  } = require("../../helpers");

exports.fetchAllBanks = async (req, res, next) =&gt; {
    const {error, data} = await bankService.fetchAllBanks();
    if(error)
        return sendErrorResponse({res, message: error});
    return sendResponse({res, responseBody: data});
};

exports.resolveAccountNumber = async (req, res) =&gt; {
    const {bankName, accountNumber} = req.body;
    const {error, data} = await bankService.resolveAccount(bankName, accountNumber);
    if(error)
        return sendErrorResponse({res, message: error});
    return sendResponse({res, responseBody: data});
};

exports.resolveAccountPerfTest = async (req, res) =&gt; {
    const {bankName, accountNumber} = req.body;
    const {error, data} = await bankService.resolveAccountPerfTest(bankName, accountNumber);
    if(error)
        return sendErrorResponse({res, message: error});
    return sendResponse({res, responseBody: data});
};
</pre>
<p>æœ€åï¼Œåœ¨æµ‹è¯•æˆ‘ä»¬çš„å®ç°ä¹‹å‰ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹ä¸€ä¸‹ä½äº<code>routes</code>æ–‡ä»¶å¤¹ä¸­çš„ routes æ–‡ä»¶:</p>
<pre class="language-javascript hljs">"use strict";

const router = require("express").Router();
const accountValidator = require("../bankAccount/BankAccountValidator");
const accountController = require("../bankAccount/BankAccountController");

router.get("/banks", accountController.fetchAllBanks);
router.post("/resolve", accountValidator.resolveAccount, accountController.resolveAccountNumber);
// TEST ROUTE TO SIMULATE PERFORMANCE METRICS BASED ON CACHING OUR ROUTES
router.post("/resolve/perf/test", accountValidator.resolveAccount, accountController.resolveAccountPerfTest);

module.exports = router;
</pre>
<p>è¦äº†è§£å…¶ä»–å¯¼å…¥æ–‡ä»¶çš„å®ç°ç»†èŠ‚ï¼Œ<a href="https://github.com/firebase007/Node.js_performance_with_caching" target="_blank" rel="noopener">å‚è€ƒ GitHub </a>ä¸Šçš„æºä»£ç ã€‚æ­¤å¤–ï¼Œè¯·æ³¨æ„ï¼Œæˆ‘ä»¬å·²ç»åœ¨ Render ä¸Šéƒ¨ç½²äº†æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºï¼Œä»¥ä¾¿åœ¨æ¨¡æ‹Ÿçš„çœŸå®ç¯å¢ƒä¸­æµ‹è¯•æˆ‘ä»¬çš„å®ç°ã€‚åŸºç¡€ URL æ˜¯<code><a href="https://node-js-caching.onrender.com" rel="nofollow">https://node-js-caching.onrender.com</a></code>ã€‚è™½ç„¶è¿™ä¸æ˜¯ä¸¥æ ¼è¦æ±‚çš„ï¼Œä½†ä¹Ÿå¯ä»¥éšæ„é˜…è¯»å…³äºéƒ¨ç½²è‡ªå·±çš„ Node.js åº”ç”¨ç¨‹åºæ¥æ¸²æŸ“çš„æ–‡ç« ã€‚</p>
<p>ç°åœ¨æ˜¯æ—¶å€™æµ‹è¯•æˆ‘ä»¬çš„ API ç«¯ç‚¹äº†ï¼Œä»¥äº²çœ¼è§è¯ç¼“å­˜çš„æ€§èƒ½ä¼˜åŠ¿ã€‚åœ¨æˆ‘ä»¬å¼€å§‹ä¹‹å‰ï¼Œå½“æˆ‘ç¬¬ä¸€æ¬¡æµ‹è¯•è¿™ä¸ª API æ—¶ï¼Œç”¨äº† 14.91 ç§’æ‰è¿”å›ä¸€ä¸ªå“åº”ã€‚æˆ‘çŒœæ˜¯å› ä¸ºå†·å¯åŠ¨ã€‚è¯·å‚è§ä¸‹å›¾:</p>
<p><img data-attachment-id="137367" data-permalink="https://blog.logrocket.com/caching-node-js-optimize-app-performance/attachment/testing-api-without-caching/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/04/testing-api-without-caching.png" data-orig-size="730,553" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Result of testing the API without caching" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/04/testing-api-without-caching-300x227.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/04/testing-api-without-caching.png" decoding="async" class="aligncenter size-full wp-image-137367 jetpack-lazy-image" src="../Images/989699f71f5bfc0e689e82f3ba98fdc3.png" alt="Result Of Testing The API Without Caching" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2021/04/testing-api-without-caching.png 730w, https://blog.logrocket.com/wp-content/uploads/2021/04/testing-api-without-caching-300x227.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2021/04/testing-api-without-caching.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/04/testing-api-without-caching.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="137367" data-permalink="https://blog.logrocket.com/caching-node-js-optimize-app-performance/attachment/testing-api-without-caching/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/04/testing-api-without-caching.png" data-orig-size="730,553" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Result of testing the API without caching" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/04/testing-api-without-caching-300x227.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/04/testing-api-without-caching.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-137367" src="../Images/989699f71f5bfc0e689e82f3ba98fdc3.png" alt="Result Of Testing The API Without Caching" srcset="https://blog.logrocket.com/wp-content/uploads/2021/04/testing-api-without-caching.png 730w, https://blog.logrocket.com/wp-content/uploads/2021/04/testing-api-without-caching-300x227.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/04/testing-api-without-caching.png"/></noscript>
<p>Â </p>
<p>åœ¨ç¬¬ä¸€æ¬¡è¯·æ±‚ä¹‹åï¼Œæˆ‘ä»ç¼“å­˜ä¸­åˆ é™¤äº†é“¶è¡Œåˆ—è¡¨ï¼Œå¹¶æå‡ºäº†å¦ä¸€ä¸ªæ–°çš„è¯·æ±‚ã€‚è¿™æ˜¯ç»“æœ:</p>
<p><img data-attachment-id="137369" data-permalink="https://blog.logrocket.com/caching-node-js-optimize-app-performance/attachment/result-after-initial-cold-start/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/04/result-after-initial-cold-start.png" data-orig-size="730,555" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Result after the initial cold start" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/04/result-after-initial-cold-start-300x228.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/04/result-after-initial-cold-start.png" decoding="async" class="aligncenter size-full wp-image-137369 jetpack-lazy-image" src="../Images/f8d82fdf19d4e5641a73b718a99f8016.png" alt="Result After The Initial Cold Start" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2021/04/result-after-initial-cold-start.png 730w, https://blog.logrocket.com/wp-content/uploads/2021/04/result-after-initial-cold-start-300x228.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2021/04/result-after-initial-cold-start.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/04/result-after-initial-cold-start.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="137369" data-permalink="https://blog.logrocket.com/caching-node-js-optimize-app-performance/attachment/result-after-initial-cold-start/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/04/result-after-initial-cold-start.png" data-orig-size="730,555" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Result after the initial cold start" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/04/result-after-initial-cold-start-300x228.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/04/result-after-initial-cold-start.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-137369" src="../Images/f8d82fdf19d4e5641a73b718a99f8016.png" alt="Result After The Initial Cold Start" srcset="https://blog.logrocket.com/wp-content/uploads/2021/04/result-after-initial-cold-start.png 730w, https://blog.logrocket.com/wp-content/uploads/2021/04/result-after-initial-cold-start-300x228.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/04/result-after-initial-cold-start.png"/></noscript>
<p>ä»ä¸Šé¢çš„æˆªå›¾å¯ä»¥çœ‹å‡ºï¼Œæˆ‘ä»¬åœ¨ç¬¬äºŒä¸ªè¯·æ±‚ä¸Šè·å¾—äº†æ›´å¿«çš„å“åº”å‘¨æœŸï¼Œå¤§çº¦ 899 æ¯«ç§’ã€‚å¿«å¤šäº†ï¼Œå¯¹å§ï¼Ÿæ³¨æ„ï¼Œåœ¨è¿™ä¸ªåˆå§‹è¯·æ±‚ä¹‹åï¼Œæˆ‘ä»¬ç°åœ¨åœ¨ Redis ç¼“å­˜ä¸­æœ‰äº†æˆ‘ä»¬çš„é“¶è¡Œåˆ—è¡¨ã€‚</p>
<p>ç¬¬äºŒæ¬¡å‘å‡ºè¯·æ±‚ä¸ä¼šä¸€ç›´æŸ¥è¯¢å¤–éƒ¨æ”¯ä»˜å †æ ˆ API å®ƒåªæ˜¯ä»æˆ‘ä»¬çš„ç¼“å­˜ä¸­è·å–æ•°æ®ï¼Œè¿™æ ·æ•ˆç‡æ›´é«˜ã€‚è§ä¸‹æ–‡:</p>
<p><img data-attachment-id="137371" data-permalink="https://blog.logrocket.com/caching-node-js-optimize-app-performance/attachment/result-from-api-after-caching-banks-list/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/04/result-from-api-after-caching-banks-list.png" data-orig-size="730,553" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Result from our API after caching the banks list" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/04/result-from-api-after-caching-banks-list-300x227.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/04/result-from-api-after-caching-banks-list.png" decoding="async" class="aligncenter size-full wp-image-137371 jetpack-lazy-image" src="../Images/01ff4eb1efb82cee02f634c34f9e70d4.png" alt="Result From Our API After Caching The Banks List" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2021/04/result-from-api-after-caching-banks-list.png 730w, https://blog.logrocket.com/wp-content/uploads/2021/04/result-from-api-after-caching-banks-list-300x227.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2021/04/result-from-api-after-caching-banks-list.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/04/result-from-api-after-caching-banks-list.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="137371" data-permalink="https://blog.logrocket.com/caching-node-js-optimize-app-performance/attachment/result-from-api-after-caching-banks-list/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/04/result-from-api-after-caching-banks-list.png" data-orig-size="730,553" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Result from our API after caching the banks list" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/04/result-from-api-after-caching-banks-list-300x227.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/04/result-from-api-after-caching-banks-list.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-137371" src="../Images/01ff4eb1efb82cee02f634c34f9e70d4.png" alt="Result From Our API After Caching The Banks List" srcset="https://blog.logrocket.com/wp-content/uploads/2021/04/result-from-api-after-caching-banks-list.png 730w, https://blog.logrocket.com/wp-content/uploads/2021/04/result-from-api-after-caching-banks-list-300x227.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/04/result-from-api-after-caching-banks-list.png"/></noscript>
<p>Â </p>
<p>æ­£å¦‚æˆ‘ä»¬æ‰€çœ‹åˆ°çš„ï¼Œåœ¨ç¼“å­˜äº†é“¶è¡Œåˆ—è¡¨ä¹‹åï¼Œæˆ‘ä»¬ä» API è·å¾—äº†æ›´å¿«çš„å“åº”â€”â€”å¤§çº¦ 304 æ¯«ç§’ã€‚</p>
<p>æ€»ä¹‹ï¼Œæˆ‘ä»¬çš„æƒ³æ³•æ˜¯æ¯”è¾ƒå¯¹ç¬¬ä¸‰æ–¹æœåŠ¡è¿›è¡Œå¤–éƒ¨ API è°ƒç”¨ä¸ç¼“å­˜ç»“æœçš„æ€§èƒ½ï¼Œè€Œä¸æ˜¯å†æ¬¡è¿›è¡Œç›¸åŒçš„ API è°ƒç”¨ã€‚æˆ‘ä»¬ç°åœ¨å·²ç»äº²çœ¼çœ‹åˆ°äº†ç»“æœã€‚</p>
<p>ä½œä¸ºå¦ä¸€ä¸ªä¾‹å­ï¼Œæˆ‘ä½¿ç”¨ Redis æ¥å­˜å‚¨åœ¨åç«¯åº”ç”¨ç¨‹åºä¸Šç”Ÿæˆçš„ä¸€æ¬¡æ€§å¯†ç (OTP)ä»¤ç‰Œã€‚ä¸å°†ä»¤ç‰Œä¿å­˜åˆ°æ•°æ®åº“å¹¶åœ¨ç”¨æˆ·åœ¨å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºä¸Šè¾“å…¥å€¼æ—¶æŸ¥è¯¢è®°å½•ç›¸æ¯”ï¼Œè¿™ç§æ–¹æ³•æä¾›äº†æ›´å¿«çš„æŸ¥æ‰¾é€Ÿåº¦ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç¤ºä¾‹ç‰‡æ®µ:</p>
<pre class="language-javascript hljs">exports.verifyOTP = async (req,res) =&gt; {
const {otp} = req.body
// get the OTP stored in the cache earlier
const getOTPDetails = await cache.getAsync('otpKey');
const otpCode = JSON.parse(getDetails).code;
if (Number(otp) == Number(otpCode) ) {
    return sendResponse(res, "OTP Verified Successfully", 201)
}
return sendErrorResponse(res, "Unable to verify OTP. Please check the code sent to your email gain", 400)
}
</pre>
<p>å¦å¤–ï¼Œä¸è¦å¿˜è®°ï¼Œåœ¨ç”Ÿæˆæˆ–è¯·æ±‚ OTP æ—¶ï¼Œå¿…é¡»å·²ç»åœ¨ç¼“å­˜ä¸­è®¾ç½®äº† OTPã€‚</p>
<h2 id="conclusion">ç»“è®º</h2>
<p>å¯¹äºä»»ä½•æ•°æ®å¯†é›†å‹åº”ç”¨ç¨‹åºæ¥è¯´ï¼Œç¼“å­˜éƒ½æ˜¯ä¸€é¡¹è¿‘ä¹å¼ºåˆ¶æ€§çš„æ“ä½œã€‚å®ƒç¼©çŸ­äº†åº”ç”¨ç¨‹åºå“åº”æ—¶é—´ï¼Œç”šè‡³é™ä½äº†ä¸å¸¦å®½å’Œæ•°æ®é‡ç›¸å…³çš„æˆæœ¬ã€‚é€šè¿‡åœ¨æœåŠ¡å™¨ä¸Šæœ¬åœ°ä¿å­˜ä»¥å‰è¯·æ±‚ç»“æœçš„å‰¯æœ¬ï¼Œå®ƒæœ‰åŠ©äºæœ€å°åŒ–æ˜‚è´µçš„æ•°æ®åº“æ“ä½œã€ç¬¬ä¸‰æ–¹ API è°ƒç”¨å’ŒæœåŠ¡å™¨åˆ°æœåŠ¡å™¨çš„è¯·æ±‚ã€‚</p>
<p>åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦å°†ç¼“å­˜å§”æ‰˜ç»™å¦ä¸€ä¸ªåº”ç”¨ç¨‹åºæˆ–é”®å€¼å­˜å‚¨ç³»ç»Ÿï¼Œä»¥å…è®¸æˆ‘ä»¬åœ¨éœ€è¦æ—¶å­˜å‚¨å’Œä½¿ç”¨æ•°æ®ã€‚Redis å°±æ˜¯è¿™æ ·ä¸€ä¸ªé€‰é¡¹ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å°†å…¶ç”¨äºç¼“å­˜ã€‚å®ƒæ”¯æŒä¸€äº›å¾ˆå¥½çš„ç‰¹æ€§ï¼ŒåŒ…æ‹¬æ•°æ®ç»“æ„ï¼Œæ¯”å¦‚å­—ç¬¦ä¸²ã€æ•£åˆ—ã€åˆ—è¡¨ã€é›†åˆã€å¸¦æœ‰èŒƒå›´æŸ¥è¯¢çš„æ’åºé›†åˆã€ä½å›¾ã€è¶…çº§æ—¥å¿—ç­‰ç­‰ã€‚</p>
<p>åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å›é¡¾äº†æé«˜ Node.js åº”ç”¨ç¨‹åºæ€§èƒ½çš„ç¼“å­˜ç­–ç•¥çš„å¿«é€Ÿä»‹ç»ã€‚è™½ç„¶æœ‰å…¶ä»–å·¥å…·å¯ä»¥å®ç°è¿™ä¸€ç›®çš„ï¼Œä½†æˆ‘ä»¬é€‰æ‹©äº† Redisï¼Œå› ä¸ºå®ƒæ˜¯å¼€æºçš„ï¼Œåœ¨ä¸šç•Œéå¸¸å—æ¬¢è¿ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Redis æ¥ç¼“å­˜åº”ç”¨ç¨‹åºä¸­é¢‘ç¹æŸ¥è¯¢çš„æ•°æ®ï¼Œå¹¶è·å¾—å¯è§‚çš„æ€§èƒ½æå‡ã€‚ä¸‹æ¬¡è§ï¼ğŸ™‚</p><div class="code-block code-block-23">
<div class="blog-plug inline-plug node-plug"><h2>200 åª<img src="../Images/61167b9d027ca73ed5aaf59a9ec31267.png" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2019/10/green-check.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" class=" jetpack-lazy-image" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/10/green-check.png"/> <noscript> <img data-lazy-fallback="1" src="../Images/61167b9d027ca73ed5aaf59a9ec31267.png" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/10/green-check.png"/> </noscript>æ˜¾ç¤ºå™¨å‡ºç°æ•…éšœï¼Œç”Ÿäº§ä¸­ç½‘ç»œè¯·æ±‚ç¼“æ…¢</h2><p>éƒ¨ç½²åŸºäºèŠ‚ç‚¹çš„ web åº”ç”¨ç¨‹åºæˆ–ç½‘ç«™æ˜¯å®¹æ˜“çš„éƒ¨åˆ†ã€‚ç¡®ä¿æ‚¨çš„èŠ‚ç‚¹å®ä¾‹ç»§ç»­ä¸ºæ‚¨çš„åº”ç”¨ç¨‹åºæä¾›èµ„æºæ˜¯äº‹æƒ…å˜å¾—æ›´åŠ å›°éš¾çš„åœ°æ–¹ã€‚å¦‚æœæ‚¨å¯¹ç¡®ä¿å¯¹åç«¯æˆ–ç¬¬ä¸‰æ–¹æœåŠ¡çš„è¯·æ±‚æˆåŠŸæ„Ÿå…´è¶£ï¼Œ</p><a href="https://lp.logrocket.com/blg/node-signup" target="_blank">try LogRocket</a><p>. </p><a class="signup" href="https://lp.logrocket.com/blg/node-signup" target="_blank" rel="noopener noreferrer"><img src="../Images/cae72fd2a54c5f02a6398c4867894844.png" alt="LogRocket Network Request Monitoring" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2019/12/network-request-filter-2-1.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" class=" jetpack-lazy-image" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/12/network-request-filter-2-1.png"/><noscript><img data-lazy-fallback="1" src="../Images/cae72fd2a54c5f02a6398c4867894844.png" alt="LogRocket Network Request Monitoring" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/12/network-request-filter-2-1.png"/></noscript></a><a href="https://lp.logrocket.com/blg/node-signup" target="_blank" rel="noopener noreferrer">https://logrocket.com/signup/</a><p>LogRocket å°±åƒæ˜¯ç½‘ç»œå’Œç§»åŠ¨åº”ç”¨ç¨‹åºçš„ DVRï¼Œè®°å½•ä¸‹ç”¨æˆ·ä¸ä½ çš„åº”ç”¨ç¨‹åºäº¤äº’æ—¶å‘ç”Ÿçš„ä¸€åˆ‡ã€‚æ‚¨å¯ä»¥æ±‡æ€»å¹¶æŠ¥å‘Šæœ‰é—®é¢˜çš„ç½‘ç»œè¯·æ±‚ï¼Œä»¥å¿«é€Ÿäº†è§£æ ¹æœ¬åŸå› ï¼Œè€Œä¸æ˜¯çŒœæµ‹é—®é¢˜å‘ç”Ÿçš„åŸå› ã€‚</p><p>LogRocket æ£€æµ‹æ‚¨çš„åº”ç”¨ç¨‹åºä»¥è®°å½•åŸºçº¿æ€§èƒ½è®¡æ—¶ï¼Œå¦‚é¡µé¢åŠ è½½æ—¶é—´ã€åˆ°è¾¾ç¬¬ä¸€ä¸ªå­—èŠ‚çš„æ—¶é—´ã€æ…¢é€Ÿç½‘ç»œè¯·æ±‚ï¼Œè¿˜è®°å½• Reduxã€NgRx å’Œ Vuex æ“ä½œ/çŠ¶æ€ã€‚</p><a class="signup" href="https://lp.logrocket.com/blg/node-signup" target="_blank" rel="noopener noreferrer">Start monitoring for free</a><p>. </p></div>
</div>

<p class="clearfix"/>
<p class="clearfix"/>
</article>

</div>    
</body>
</html>