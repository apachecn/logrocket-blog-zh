<html>
<head>
<title>Create a URL shortener with Cloudflare Workers - LogRocket Blog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>ä½¿ç”¨Cloudflare Workers - LogRocketåšå®¢åˆ›å»ºä¸€ä¸ªURL shortener</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://blog.logrocket.com/creating-url-shortener-cloudflare-workers/#0001-01-01">https://blog.logrocket.com/creating-url-shortener-cloudflare-workers/#0001-01-01</a></blockquote><div><article class="article-post">
<p>ä½ æ›¾ç»ä½¿ç”¨è¿‡åƒ<a href="https://bitly.com" target="_blank" rel="noopener"> Bitly </a>æˆ–<a href="https://tinyurl.com/app" target="_blank" rel="noopener"> TinyURL </a>è¿™æ ·çš„å·¥å…·æ¥ç¼©çŸ­é•¿é“¾æ¥å—ï¼Ÿæˆ–è€…ï¼Œæ‚¨æ˜¯å¦æƒ³çŸ¥é“è¿™äº›æœåŠ¡æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿä¹Ÿè®¸ä½ æƒ³å»ºç«‹ä¸€ä¸ªç½‘å€ç¼©çŸ­å™¨ï¼Œä½†æ˜¯æ²¡æœ‰æ—¶é—´æˆ–è€…åˆé€‚çš„å·¥å…·å»åšã€‚æ— è®ºå¦‚ä½•ï¼Œå¦‚æœä½ å¯¹è¿™ä¸ªè¯é¢˜æ„Ÿå…´è¶£ï¼Œè¿™ç¯‡æ–‡ç« éå¸¸é€‚åˆä½ ã€‚</p>
<p>åœ¨æœ¬å¸–ä¸­ï¼Œæˆ‘ä»¬å°†å±•ç¤ºå¦‚ä½•ä½¿ç”¨<a href="https://workers.cloudflare.com" target="_blank" rel="noopener"> Cloudflare Workers </a>æ„å»ºä¸€ä¸ªåŸºæœ¬çš„URL shorteneræœåŠ¡ã€‚æˆ‘ä»¬å°†æä¾›æœ‰å…³URL shorteneræœåŠ¡å¦‚ä½•å·¥ä½œçš„è¯¦ç»†ä¿¡æ¯ï¼Œä»‹ç»Cloudflare Workersçš„å‡ ä¸ªåŠŸèƒ½ï¼Œå¹¶é€æ­¥è¯´æ˜å¦‚ä½•å¼€å§‹ä½¿ç”¨Cloudflare Workersã€‚</p>
<p><em>å‘å‰è·³è½¬:</em></p>

<p>æˆ‘ä»¬å¼€å§‹å§ï¼</p>
<h2 id="what-is-cloudflare-workers">ä»€ä¹ˆæ˜¯Cloudflare Workersï¼Ÿ</h2>
<p>Cloudflare Workersæ˜¯ä¸€é¡¹å…è®¸æ‚¨å°†æ— æœåŠ¡å™¨ä»£ç éƒ¨ç½²åˆ°Cloudflareç½‘ç»œçš„æœåŠ¡ã€‚Cloudflare networkæˆ–Edgeæ˜¯ä¸€ä¸ªéå¸ƒå…¨çƒçš„webæœåŠ¡å™¨ç½‘ç»œã€‚Cloudflare Workersçš„ä¸€ä¸ªä¼˜ç‚¹æ˜¯ï¼Œæ‚¨ä¸å¿…æ‹…å¿ƒä»£ç çš„ä¼¸ç¼©æ€§ã€‚æ­¤å¤–ï¼Œæ‚¨ä¸å¿…æ‹…å¿ƒä»£ç æ‰€åœ¨çš„æ—¶åŒºï¼›Workersä¸­çš„ä»£ç åœ¨éƒ¨ç½²åå‡ ç§’é’Ÿå†…å°±ä¼šä¼ éå…¨çƒã€‚</p>
<p>æœ€é‡è¦çš„æ˜¯ï¼ŒCloudflare Workersæä¾›äº†ä¸€ä¸ªç®€å•çš„é”®å€¼æ•°æ®å­˜å‚¨ï¼Œç§°ä¸ºKVã€‚åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†ç»“åˆä½¿ç”¨Cloudflare Workerså’ŒKV storageæ¥ç¼©çŸ­æˆ‘ä»¬çš„URLã€‚</p>
<h2 id="project-overview-url-shortener-service">é¡¹ç›®æ¦‚è¿°:ç½‘å€ç¼©å†™æœåŠ¡</h2>
<p>æˆ‘ä»¬å°†ä»æ„å»ºä¸€ä¸ªç®€å•çš„ã€éåŠ¨æ€çš„URLç¼©å†™å™¨å¼€å§‹ï¼Œåœ¨è¿™é‡Œä½ å¯ä»¥ç¡¬ç¼–ç ä½ æƒ³è¦é‡å®šå‘åˆ°çš„ç½‘ç«™ã€‚è¿™å°†ä½œä¸ºå­¦ä¹ å¦‚ä½•ä½¿ç”¨<a href="https://developers.cloudflare.com/workers/wrangler/" target="_blank" rel="noopener"> Wrangler </a> (Cloudflareçš„å®˜æ–¹CLIå·¥å…·)çš„ä»‹ç»ï¼Œå¹¶å°†æ¼”ç¤ºå·¥äººé¢†åŸŸçš„åŸºæœ¬æ¦‚å¿µã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†å¢åŠ ä¸€äº›è¶£å‘³ï¼Œå¢åŠ å¯¹åŠ¨æ€URLçš„æ”¯æŒã€‚åŸºæœ¬ä¸Šï¼Œæˆ‘ä»¬å°†ä¸Cloudflare Workers KV storeè¿›è¡Œäº¤äº’ï¼Œå¹¶è¾“å…¥URLçš„ç®€çŸ­ç‰ˆæœ¬å’Œæˆ‘ä»¬æƒ³è¦é‡å®šå‘åˆ°çš„å®é™…URLã€‚KVå­˜å‚¨ä¸­çš„æ•°æ®å°†ç±»ä¼¼äºä»¥ä¸‹ç»“æ„:</p>
<pre class="language-javascript hljs">'short-url': 'https://my-cool-website.com'
'submit': 'https://my-cool-site.org/blog/ideas/submit'
</pre>
<p>æœ€åï¼Œæˆ‘ä»¬å°†æŠŠæˆ‘ä»¬çš„ä»£ç éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå¹¶åœ¨å…¨çƒèŒƒå›´å†…çœ‹åˆ°å®ƒçš„è¿è¡Œã€‚</p>
<p>ä½ å·²ç»å…´å¥‹äº†å—ï¼Ÿå¤ªå¥½äº†ï¼Œæˆ‘ä»¬è·³è¿›å»å§ï¼</p>
<h2 id="setting-up-the-environment">è®¾ç½®ç¯å¢ƒ</h2>
<p>è¦é˜…è¯»æœ¬æ–‡ï¼Œæ‚¨éœ€è¦ä»¥ä¸‹å†…å®¹:</p>
<ul>
<li>Node.jså’Œnpm</li>
<li>ç‰§é©¬äºº</li>
<li>curl(æˆ–æ‚¨é€‰æ‹©çš„æµè§ˆå™¨)æ¥æµ‹è¯•URL shortener</li>
</ul>
<p>æˆ‘ä½¿ç”¨<a href="https://asdf-vm.com/" target="_blank" rel="noopener"> asdfå·¥å…·</a>æ¥ç®¡ç†æˆ‘çš„æœ¬åœ°ä¾èµ–é¡¹ï¼Œä½†æ˜¯ä½ å¯ä»¥ä½¿ç”¨ä»»ä½•ä½ å–œæ¬¢çš„ç‰ˆæœ¬ç®¡ç†å™¨ã€‚åœ¨æ’°å†™æœ¬æ–‡æ—¶ï¼Œè¿™é‡Œæ˜¯æˆ‘çš„èŠ‚ç‚¹å’Œnpmç‰ˆæœ¬:</p>
<pre class="language-javascript hljs">$ node --version
v18.5.0
$ npm --version
8.12.1
</pre>
<p>ç‰§é©¬äººæ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œæ„å»ºå·¥å…·ï¼Œæœ€è¿‘ï¼Œå®ƒè·å¾—äº†2.0ç‰ˆæœ¬ã€‚å¯¹äºè¿™ä¸ªèŒä½çš„ç›®çš„ï¼Œç‰§é©¬äººå°†æ»¡è¶³æˆ‘ä»¬æ‰€æœ‰çš„éœ€æ±‚ã€‚åœ¨æœªæ¥ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šä½¿ç”¨<a href="https://blog.logrocket.com/ditch-wrangler-cli-miniflare/" target="_blank" rel="noopener"> Miniflareï¼Œå®ƒæ˜¯ç‰§é©¬äºº</a>çš„ä¸€ä¸ªæ›´å¼ºå¤§ã€åŠŸèƒ½æ›´ä¸°å¯Œçš„å…„å¼Ÿã€‚ä½†æ˜¯ï¼Œç°åœ¨è®©æˆ‘ä»¬é€šè¿‡npmåœ¨å…¨çƒèŒƒå›´å†…å®‰è£…ç‰§é©¬äºº:</p>
<pre class="language-javascript hljs">$ npm install -g <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="334441525d545f564173011d031d0102">[emailÂ protected]</a>
</pre>
<p>åœ¨æ’°å†™æœ¬æ–‡æ—¶ï¼Œæœ€æ–°çš„ç‰§é©¬äººç‰ˆæœ¬æ˜¯2.0.21ï¼Œæ‰€ä»¥æˆ‘ä»¬å°†ä½¿ç”¨è¯¥ç‰ˆæœ¬ã€‚</p>
<p>é…·æ¯™äº†ã€‚ç°åœ¨æˆ‘ä»¬å·²ç»æœ‰äº†æ‰€æœ‰çš„ä¾èµ–é¡¹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨Wrangler CLIæ¥ç”Ÿæˆæˆ‘ä»¬çš„starter Cloudflare Workerã€‚</p>
<h2 id="generating-the-project">ç”Ÿæˆé¡¹ç›®</h2>
<p>ç‰§é©¬äººCLIå·¥å…·å°†è¯æ˜åœ¨è¿™é‡Œéå¸¸æœ‰ç”¨ã€‚</p>
<p>é¦–å…ˆï¼Œè®©æˆ‘ä»¬è¿è¡Œä¸€ä¸ªå‘½ä»¤æ¥æ­£ç¡®å¯åŠ¨å’Œè®¾ç½®æˆ‘ä»¬çš„é¡¹ç›®:</p>
<pre class="language-javascript hljs">$ wrangler init short-it
</pre>
<p>è¯¥å‘½ä»¤å°†è¯¢é—®å‡ ä¸ªé—®é¢˜ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬å°†å¯¹æ‰€æœ‰è¿™äº›é—®é¢˜å›ç­”â€œæ˜¯â€(é€šè¿‡é”®å…¥<strong> y </strong>):</p>
<pre class="language-javascript hljs">$ wrangler init short-it
 â›…ï¸ wrangler 2.0.21
--------------------
Using npm as package manager.
âœ¨ Created short-it/wrangler.toml
Would you like to use git to manage this Worker? (y/n)
âœ¨ Initialized git repository at short-it
No package.json found. Would you like to create one? (y/n)
âœ¨ Created short-it/package.json
Would you like to use TypeScript? (y/n)
âœ¨ Created short-it/tsconfig.json
Would you like to create a Worker at short-it/src/index.ts?
  None
â¯ Fetch handler
  Scheduled handler
âœ¨ Created short-it/src/index.ts

added 62 packages, and audited 63 packages in 1s

1 package is looking for funding
  run `npm fund` for details

found 0 vulnerabilities
âœ¨ Installed @cloudflare/workers-types and typescript into devDependencies

To start developing your Worker, run `cd short-it &amp;&amp; npm start`
To publish your Worker to the Internet, run `npm run deploy`
</pre>
<p>å¦‚æœæ‚¨å¯¹ç‰§é©¬äººçš„æ‰€æœ‰é—®é¢˜éƒ½åšå‡ºäº†è‚¯å®šçš„å›ç­”ï¼Œé‚£ä¹ˆæ‚¨å°†è·å¾—ä¸€ä¸ªé¡¹ç›®åç§°<code>short-it</code>ï¼Œå…¶ä¸­åŒ…å«ä»¥ä¸‹å†…å®¹:</p>
<ul>
<li>ç›®å½•ï¼Œè¿™æ„å‘³ç€æ‚¨å·²ç»å‡†å¤‡å¥½å°†å®ƒæ¨é€ç»™æ‚¨çš„Gitæä¾›è€…äº†</li>
<li><code>package.json</code>æ–‡ä»¶</li>
<li><code>tsconfig.json</code>åŒ…å«æ‰€æœ‰ç±»å‹è„šæœ¬é…ç½®çš„æ–‡ä»¶</li>
<li>ç”¨ä¸€äº›ç®€å•æ˜äº†çš„é€»è¾‘æäº¤æ–‡ä»¶ï¼Œä»¥è·å¾—æˆ‘ä»¬å‘˜å·¥çš„å›åº”</li>
</ul>
<p>å¤ªæ£’äº†ã€‚è®©æˆ‘ä»¬çœ‹çœ‹è¿™ä¸œè¥¿æœ‰æ²¡æœ‰ç”¨ï¼</p>
<p>è®©æˆ‘ä»¬<code>cd</code>è¿›å…¥<code>short-it</code>ç›®å½•ï¼Œåœ¨æœ¬åœ°å¼€å‘æ¨¡å¼ä¸‹å¯åŠ¨ç‰§é©¬äºº:</p>
<pre class="language-javascript hljs">$ cd short-it
$ wrangler dev --local
</pre>
<p>è¿™åº”è¯¥ä¼šåœ¨http://localhost:8787/ ä¸Šè¿è¡Œæˆ‘ä»¬çš„Workerã€‚å¦‚æœæˆ‘ä»¬è®¿é—®localhostï¼Œæˆ‘ä»¬åº”è¯¥ä¼šçœ‹åˆ°ä¸€ä¸ªç®€å•çš„â€œHello Worldï¼â€æ¶ˆæ¯:</p>
<figure id="attachment_128988" aria-describedby="caption-attachment-128988" class="wp-caption aligncenter"><img data-attachment-id="128988" data-permalink="https://blog.logrocket.com/creating-url-shortener-cloudflare-workers/attachment/hello-world-message/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/08/hello-world-message.png" data-orig-size="730,502" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Hello world message" data-image-description="" data-image-caption="&lt;p&gt;Generated Worker is displaying a â€œHello World!â€ message.&lt;/p&gt;&#10;" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/08/hello-world-message-300x206.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/08/hello-world-message.png" decoding="async" class="size-full wp-image-128988 jetpack-lazy-image" src="../Images/f2b11ff4282f14e8ea1b6cf06ebaa6b2.png" alt="Hello World Message" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/08/hello-world-message.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/08/hello-world-message-300x206.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/08/hello-world-message.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/08/hello-world-message.png"/><noscript><img data-lazy-fallback="1" data-attachment-id="128988" data-permalink="https://blog.logrocket.com/creating-url-shortener-cloudflare-workers/attachment/hello-world-message/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/08/hello-world-message.png" data-orig-size="730,502" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Hello world message" data-image-description="" data-image-caption="&lt;p&gt;Generated Worker is displaying a â€œHello World!â€ message.&lt;/p&gt;&#10;" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/08/hello-world-message-300x206.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/08/hello-world-message.png" decoding="async" loading="lazy" class="size-full wp-image-128988" src="../Images/f2b11ff4282f14e8ea1b6cf06ebaa6b2.png" alt="Hello World Message" srcset="https://blog.logrocket.com/wp-content/uploads/2022/08/hello-world-message.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/08/hello-world-message-300x206.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/08/hello-world-message.png"/></noscript><figcaption id="caption-attachment-128988" class="wp-caption-text">Generated Worker is displaying a â€œHello World!â€ message.</figcaption></figure>
<p>è€¶ï¼æˆ‘ä»¬æˆåŠŸäº†ã€‚ä½†æ˜¯æ€ä¹ˆåšå‘¢ï¼Ÿè®©æˆ‘ä»¬ä»”ç»†çœ‹çœ‹ã€‚</p>
<h2 id="how-does-cloudflare-workers-work">Cloudflareå·¥ä½œäººå‘˜æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ</h2>
<p>æˆ‘ä»¬åœ¨æœ¬åœ°ä»ç”Ÿæˆçš„Workerä¸­è·å¾—äº†ç¬¬ä¸€æ¡æ¶ˆæ¯ï¼Œä½†æ˜¯è¿™åˆ°åº•æ˜¯å¦‚ä½•å·¥ä½œçš„å‘¢ï¼Ÿ</p>
<p>è®©æˆ‘ä»¬ä»”ç»†æŸ¥çœ‹ç”Ÿæˆçš„<code>src/index.ts</code>æ–‡ä»¶ï¼Œä»¥ä¾¿æ›´å¥½åœ°ç†è§£é‚£é‡Œå‘ç”Ÿäº†ä»€ä¹ˆã€‚</p>
<pre class="language-javascript hljs">// src/index.ts

/**
 * Welcome to Cloudflare Workers! This is your first worker.
 *
 * - Run `wrangler dev src/index.ts` in your terminal to start a development server
 * - Open a browser tab at http://localhost:8787/ to see your worker in action
 * - Run `wrangler publish src/index.ts --name my-worker` to publish your worker
 *
 * Learn more at https://developers.cloudflare.com/workers/
 */

export interface Env {
  // Example binding to KV. Learn more at https://developers.cloudflare.com/workers/runtime-apis/kv/
  // MY_KV_NAMESPACE: KVNamespace;
  //
  // Example binding to Durable Object. Learn more at https://developers.cloudflare.com/workers/runtime-apis/durable-objects/
  // MY_DURABLE_OBJECT: DurableObjectNamespace;
  //
  // Example binding to R2. Learn more at https://developers.cloudflare.com/workers/runtime-apis/r2/
  // MY_BUCKET: R2Bucket;
}

export default {
  async fetch(
    request: Request,
    env: Env,
    ctx: ExecutionContext
  ): Promise&lt;Response&gt; {
    return new Response("Hello World!");
  },
};
</pre>
<p>ä¸Šé¢çš„ä»£ç åŒ…æ‹¬æˆ‘ä»¬ç¯å¢ƒçš„å®šä¹‰(<code>Env</code>æ¥å£)å’Œä¸€äº›ä¸<code>ENV</code>æ¥å£ç›¸å…³çš„æ³¨é‡Šã€‚</p>
<p>ç”±äºæ¥å£è¶…å‡ºäº†æœ¬æ–‡çš„èŒƒå›´ï¼Œæˆ‘ä»¬å°†å¿½ç•¥è¿™éƒ¨åˆ†ä»£ç ï¼Œåªå…³æ³¨ä¸»è¦é€»è¾‘:</p>
<pre class="language-javascript hljs">// src/index.ts

export default {
  async fetch(
    request: Request,
    env: Env,
    ctx: ExecutionContext
  ): Promise&lt;Response&gt; {
    return new Response("Hello World!");
  },
};
</pre>
<p>è¿™é‡Œå‘ç”Ÿçš„æ˜¯æˆ‘ä»¬çš„<code>index.ts</code>å¯¼å‡ºä¸€ä¸ª<code>fetch</code>å‡½æ•°ã€‚è¿™æ˜¯ä¸€ä¸ªç±»ä¼¼äº<a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API/Using_web_workers" target="_blank" rel="noopener"> Web Workers </a>çš„ç•Œé¢ã€‚äº‹å®ä¸Š,â€œCloudflare Workersâ€è¿™ä¸ªåç§°å°±æ˜¯ä»è¿™ä¸ªæ¥å£äº§ç”Ÿçš„ã€‚Cloudflare Workersç±»ä¼¼äºWeb Workersï¼Œåªæ˜¯å®ƒè¿è¡Œåœ¨CloudflareåŸºç¡€æ¶æ„ä¸Šï¼Œè€Œä¸æ˜¯æµè§ˆå™¨ä¸Šã€‚</p>
<p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œ<code>fetch</code>å‡½æ•°è¿”å›ä¸€ä¸ªå¸¦æœ‰â€œHello Worldï¼â€çš„æ–°çš„<code>Response</code>å¯¹è±¡æ–‡å­—ã€‚æ‰€ä»¥å½“æˆ‘ä»¬è¿è¡Œæˆ‘ä»¬çš„Workeræ—¶ï¼Œè¿™ä¸ª<code>fetch</code>å‡½æ•°è¢«è°ƒç”¨ã€‚ç„¶åï¼Œè¢«è°ƒç”¨çš„<code>fetch</code>å‡½æ•°è¿”å›â€œHello Worldï¼â€å“åº”ï¼Œè¿™æ˜¯æˆ‘ä»¬åœ¨æµè§ˆå™¨ä¸­(æˆ–é€šè¿‡ä»»ä½•ç”¨äºè°ƒç”¨Workerçš„å·¥å…·)è·å¾—çš„ã€‚</p>
<p>å¥½äº†ï¼Œæˆ‘ä»¬å·²ç»ææ¸…æ¥šäº†Cloudflare Workersçš„åŸºæœ¬æƒ…å†µã€‚æˆ‘ä»¬å¯ä»¥æ»¡æ€€ä¿¡å¿ƒåœ°ç»§ç»­å‰è¿›ã€‚å¦‚æœæ‚¨ä¸ç†Ÿæ‚‰TypeScriptï¼Œä¸è¦æ‹…å¿ƒï¼›æˆ‘ä»¬å°†åªæ˜¯ç®€å•åœ°ä½¿ç”¨å®ƒçš„ç‰¹æ€§ã€‚æƒ³è±¡è¿™æ˜¯ä¸€ä¸ªè½»é‡çº§çš„TypeScriptä¸–ç•Œã€‚</p>
<p>å¤ªå¥½äº†ï¼Œè®©æˆ‘ä»¬ç»§ç»­å‰è¿›å§ï¼</p>
<h2 id="adding-a-first-redirect">æ·»åŠ ç¬¬ä¸€ä¸ªé‡å®šå‘</h2>
<p>æˆ‘ä»¬å°†æ…¢æ…¢å¼€å§‹ç ”ç©¶æˆ‘ä»¬çš„é€»è¾‘ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬ä¼šè®©æˆ‘ä»¬çš„URL shortenerå°†ç”¨æˆ·é‡å®šå‘åˆ°ä¸€ä¸ªä¸åŒçš„ç½‘ç«™ã€‚è¿™å°†æ˜¯åé¢å˜åŒ–çš„åŸºç¡€ã€‚</p>
<p>ç›®å‰ï¼Œæˆ‘ä»¬ä¼šè®©ç”¨æˆ·åœ¨è®¿é—®æˆ‘ä»¬çš„æœ¬åœ°å‘˜å·¥æ—¶ï¼Œè½¬åˆ°https://http.cat/ç½‘ç«™çš„ä¸€ä¸ªé¡µé¢ã€‚</p>
<p>å¦‚æœä½ ä¸ç†Ÿæ‚‰<a href="https://http.cat/" target="_blank" rel="noopener">https://http.cat/</a>ï¼Œè¿™æ˜¯ä¸€ä¸ªæœ‰è¶£çš„ç½‘ç«™ï¼Œæ˜¾ç¤ºä¸åŒHTTPçŠ¶æ€çš„å„ç§çŒ«å›¾ç‰‡ã€‚ä¾‹å¦‚ï¼Œå¦‚æœç”¨æˆ·å‘æˆ‘ä»¬çš„å·¥ä½œäººå‘˜å‘<a href="http://localhost:8787/404" rel="nofollow">http://localhost:8787/404</a>å‘å‡ºè¯·æ±‚ï¼Œä»–ä»¬å°†è¢«å®šå‘åˆ°ã€https://http.cat/404ã€‘çš„ã€‚</p>
<p>ä¸ºäº†å®ç°è¿™ä¸ªé‡å®šå‘ï¼Œæˆ‘ä»¬å°†ç¼–è¾‘<code>src/index.ts</code>ï¼Œå¦‚ä¸‹æ‰€ç¤º:</p>
<pre class="language-javascript hljs">// src/index.ts
// ...

const basePath = "https://http.cat";

export default {
  async fetch(
    request: Request,
    _env: Env,
    _ctx: ExecutionContext
  ): Promise&lt;Response&gt; {
    const url = new URL(request.url);

    const { pathname } = url;

    const redirectURL = basePath + pathname;

    if (pathname === "/") {
      return new Response("Hello World from our awesome Worker!");
    }

    return Response.redirect(redirectURL, 301);
  },
};
</pre>
<p>ç°åœ¨ï¼Œå¦‚æœæˆ‘ä»¬è®¿é—®http://localhost:8787 ,æˆ‘ä»¬ä¼šæ”¶åˆ°ä¸€æ¡æ›´æ–°çš„æ¶ˆæ¯:â€œä½ å¥½ï¼Œä¸–ç•Œï¼Œæ¥è‡ªæˆ‘ä»¬ä¼Ÿå¤§çš„å·¥ä½œè€…ï¼â€ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º:</p>
<figure id="attachment_128990" aria-describedby="caption-attachment-128990" class="wp-caption aligncenter"><img data-attachment-id="128990" data-permalink="https://blog.logrocket.com/creating-url-shortener-cloudflare-workers/attachment/hello-world-from-awesome-worker/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/08/hello-world-from-awesome-worker.png" data-orig-size="730,502" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Hello world from awesome worker" data-image-description="" data-image-caption="&lt;p&gt;Worker displaying an updated  â€œHello worldâ€ message.&lt;/p&gt;&#10;" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/08/hello-world-from-awesome-worker-300x206.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/08/hello-world-from-awesome-worker.png" decoding="async" class="size-full wp-image-128990 jetpack-lazy-image" src="../Images/6ae1697341aa9c44e43ec7dc1a667a58.png" alt="Hello World From Awesome Worker" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/08/hello-world-from-awesome-worker.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/08/hello-world-from-awesome-worker-300x206.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/08/hello-world-from-awesome-worker.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/08/hello-world-from-awesome-worker.png"/><noscript><img data-lazy-fallback="1" data-attachment-id="128990" data-permalink="https://blog.logrocket.com/creating-url-shortener-cloudflare-workers/attachment/hello-world-from-awesome-worker/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/08/hello-world-from-awesome-worker.png" data-orig-size="730,502" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Hello world from awesome worker" data-image-description="" data-image-caption="&lt;p&gt;Worker displaying an updated  â€œHello worldâ€ message.&lt;/p&gt;&#10;" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/08/hello-world-from-awesome-worker-300x206.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/08/hello-world-from-awesome-worker.png" decoding="async" loading="lazy" class="size-full wp-image-128990" src="../Images/6ae1697341aa9c44e43ec7dc1a667a58.png" alt="Hello World From Awesome Worker" srcset="https://blog.logrocket.com/wp-content/uploads/2022/08/hello-world-from-awesome-worker.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/08/hello-world-from-awesome-worker-300x206.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/08/hello-world-from-awesome-worker.png"/></noscript><figcaption id="caption-attachment-128990" class="wp-caption-text">Worker displaying an updated â€œHello worldâ€ message.</figcaption></figure>
<p>ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬å°è¯•å»<a href="http://localhost:8787/404" rel="nofollow">http://localhost:8787/404</a>ï¼Œæˆ‘ä»¬ä¼šè¢«é‡å®šå‘åˆ°https://http.cat/404<a href="https://http.cat/404" target="_blank" rel="noopener"/>ã€‚</p>
<figure id="attachment_128993" aria-describedby="caption-attachment-128993" class="wp-caption aligncenter"><img data-attachment-id="128993" data-permalink="https://blog.logrocket.com/creating-url-shortener-cloudflare-workers/attachment/user-redirected/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/08/user-redirected.gif" data-orig-size="588,376" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="User redirected" data-image-description="" data-image-caption="&lt;p&gt;User is redirected to the http.cat/404 website.&lt;/p&gt;&#10;" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/08/user-redirected-300x192.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/08/user-redirected.gif" decoding="async" class="size-full wp-image-128993 jetpack-lazy-image" src="../Images/18317c9ad25a6f5c59c30e06df5e47c7.png" alt="User Redirected" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/08/user-redirected.gif?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/08/user-redirected.gif"/><noscript><img data-lazy-fallback="1" data-attachment-id="128993" data-permalink="https://blog.logrocket.com/creating-url-shortener-cloudflare-workers/attachment/user-redirected/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/08/user-redirected.gif" data-orig-size="588,376" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="User redirected" data-image-description="" data-image-caption="&lt;p&gt;User is redirected to the http.cat/404 website.&lt;/p&gt;&#10;" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/08/user-redirected-300x192.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/08/user-redirected.gif" decoding="async" loading="lazy" class="size-full wp-image-128993" src="../Images/18317c9ad25a6f5c59c30e06df5e47c7.png" alt="User Redirected" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/08/user-redirected.gif"/></noscript><figcaption id="caption-attachment-128993" class="wp-caption-text">User is redirected to the http.cat/404 website.</figcaption></figure>
<p>å¤ªå¥½äº†ï¼Œæˆ‘ä»¬ç¬¬ä¸€æ¬¡é‡å®šå‘æˆåŠŸäº†ã€‚ç°åœ¨ï¼Œè®©æˆ‘ä»¬çš„ç½‘å€ç¼©çŸ­å™¨å®é™…ä¸Šç¼©çŸ­ä¸€äº›ç½‘å€ã€‚</p>
<h2 id="shortening-the-url">ç¼©çŸ­URL</h2>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬å°†æ·»åŠ ä¸€ä¸ªå°çš„æ•°æ®ç»“æ„æ¥å­˜å‚¨æˆ‘ä»¬ç¼©çŸ­çš„URLã€‚æˆ‘ä»¬å¯ä»¥è¿™æ ·åš:</p>
<pre class="language-javascript hljs">const shortURLs = {
  "/blog": "https://pragmaticpineapple.com/",
  "/twitter": "https://twitter.com/nikolalsvk",
  "/github": "https://github.com/nikolalsvk",
} as Record&lt;any, string&gt;;

export default {
  async fetch(
    request: Request,
    _env: Env,
    _ctx: ExecutionContext
  ): Promise&lt;Response&gt; {
    const url = new URL(request.url);

    const { pathname } = url;

    const redirectURL = shortURLs[pathname];

    if (!redirectURL) {
      return new Response(
        `There is no defined URL for the path: '${pathname}', sorry :(`
      );
    }

    return Response.redirect(redirectURL, 301);
  },
};
</pre>
<p>è¿™é‡Œï¼Œæˆ‘ä»¬æ·»åŠ äº†å‡ ä¸ªç®€çŸ­çš„URL:</p>

<p>ä½ å¯ä»¥æŠŠå®ƒæ”¹æˆä½ å–œæ¬¢çš„ä»»ä½•ä¸œè¥¿ï¼Œåªæ˜¯ä¸ºäº†çœ‹çœ‹å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚ç°åœ¨ï¼Œå½“æˆ‘è®¿é—®http://localhost:8787/blog æ—¶ï¼Œæˆ‘è¢«é‡å®šå‘åˆ°æˆ‘çš„åšå®¢æ‰€åœ¨çš„ä¸€ä¸ªæ›´é•¿çš„URLã€‚ç»“æœå¦‚ä¸‹:</p>
<figure id="attachment_128995" aria-describedby="caption-attachment-128995" class="wp-caption aligncenter"><img data-attachment-id="128995" data-permalink="https://blog.logrocket.com/creating-url-shortener-cloudflare-workers/attachment/redirects-to-blog/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/08/redirects-to-blog.gif" data-orig-size="588,376" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Redirects to blog" data-image-description="" data-image-caption="&lt;p&gt;Visiting /blog redirects to the actual blog page.&lt;/p&gt;&#10;" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/08/redirects-to-blog-300x192.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/08/redirects-to-blog.gif" decoding="async" class="size-full wp-image-128995 jetpack-lazy-image" src="../Images/c022903be4eb6d69e513efedb6d3c14a.png" alt="Redirects to Blog" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/08/redirects-to-blog.gif?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/08/redirects-to-blog.gif"/><noscript><img data-lazy-fallback="1" data-attachment-id="128995" data-permalink="https://blog.logrocket.com/creating-url-shortener-cloudflare-workers/attachment/redirects-to-blog/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/08/redirects-to-blog.gif" data-orig-size="588,376" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Redirects to blog" data-image-description="" data-image-caption="&lt;p&gt;Visiting /blog redirects to the actual blog page.&lt;/p&gt;&#10;" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/08/redirects-to-blog-300x192.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/08/redirects-to-blog.gif" decoding="async" loading="lazy" class="size-full wp-image-128995" src="../Images/c022903be4eb6d69e513efedb6d3c14a.png" alt="Redirects to Blog" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/08/redirects-to-blog.gif"/></noscript><figcaption id="caption-attachment-128995" class="wp-caption-text">Visiting /blog redirects to the actual blog page.</figcaption></figure>
<p>ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬è¯·æ±‚æŸä¸ªè·¯å¾„ï¼Œæ¯”å¦‚<a href="http://localhost:8787/missing" rel="nofollow">http://localhost:8787/missing</a>ï¼Œæˆ‘ä»¬ä¼šå¾—åˆ°ä¸‹é¢çš„é”™è¯¯æ¶ˆæ¯:â€œæ²¡æœ‰ä¸ºè¯¥è·¯å¾„å®šä¹‰çš„URL:'/missing 'ï¼Œå¯¹ä¸èµ·:(â€ã€‚</p>
<figure id="attachment_128997" aria-describedby="caption-attachment-128997" class="wp-caption aligncenter"><img data-attachment-id="128997" data-permalink="https://blog.logrocket.com/creating-url-shortener-cloudflare-workers/attachment/error-message-missing/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/08/error-message-missing.png" data-orig-size="686,472" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Error message missing" data-image-description="" data-image-caption="&lt;p&gt;Visiting /missing displays an error message.&lt;/p&gt;&#10;" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/08/error-message-missing-300x206.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/08/error-message-missing.png" decoding="async" class="size-full wp-image-128997 jetpack-lazy-image" src="../Images/d6aaa341dad5063896da9576279586dd.png" alt="Error Message Missing" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/08/error-message-missing.png 686w, https://blog.logrocket.com/wp-content/uploads/2022/08/error-message-missing-300x206.png 300w" data-lazy-sizes="(max-width: 686px) 100vw, 686px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/08/error-message-missing.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/08/error-message-missing.png"/><noscript><img data-lazy-fallback="1" data-attachment-id="128997" data-permalink="https://blog.logrocket.com/creating-url-shortener-cloudflare-workers/attachment/error-message-missing/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/08/error-message-missing.png" data-orig-size="686,472" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Error message missing" data-image-description="" data-image-caption="&lt;p&gt;Visiting /missing displays an error message.&lt;/p&gt;&#10;" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/08/error-message-missing-300x206.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/08/error-message-missing.png" decoding="async" loading="lazy" class="size-full wp-image-128997" src="../Images/d6aaa341dad5063896da9576279586dd.png" alt="Error Message Missing" srcset="https://blog.logrocket.com/wp-content/uploads/2022/08/error-message-missing.png 686w, https://blog.logrocket.com/wp-content/uploads/2022/08/error-message-missing-300x206.png 300w" sizes="(max-width: 686px) 100vw, 686px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/08/error-message-missing.png"/></noscript><figcaption id="caption-attachment-128997" class="wp-caption-text">Visiting /missing displays an error message.</figcaption></figure>
<p>å¤ªæ£’äº†ï¼Œç°åœ¨æˆ‘ä»¬å·²ç»å‡†å¤‡å¥½æŠŠç¡¬ç¼–ç çš„URLå’Œå®ƒä»¬çš„ç¼©å†™ç‰ˆæœ¬è½¬ç§»åˆ°æŸä¸ªåœ°æ–¹äº†ã€‚å¹¸è¿çš„æ˜¯ï¼Œæˆ‘ä»¬æ­£åœ¨ä½¿ç”¨Cloudflare Workersï¼Œå®ƒæä¾›äº†ä¸€ä¸ªç®€å•çš„åä¸ºKVçš„é”®å€¼å­˜å‚¨ã€‚</p>
<h2 id="adding-storage">æ·»åŠ å­˜å‚¨</h2>
<p>åœ¨ä¸ºæˆ‘ä»¬çš„é¡¹ç›®å®é™…åˆ›å»ºKVä¹‹å‰ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦é€šè¿‡Wranglerç™»å½•Cloudflare Workersã€‚è¿™æ˜¯å¿…è¦çš„ï¼Œå› ä¸ºWranglerç¨åéœ€è¦è”ç³»Cloudflareï¼Œä»¥ä¾¿ä¸ºæˆ‘ä»¬åˆ›å»ºKVå®ä¾‹ã€‚</p>
<h3 id="logging-into-cloudflare">ç™»å½•åˆ°Cloudflare</h3>
<p>è¦ç™»å½•åˆ°Cloudflareï¼Œè¯·ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤:</p>
<pre class="language-javascript hljs">$ wrangler login
</pre>
<p>å°†ä¼šæ‰“å¼€ä¸€ä¸ªæµè§ˆå™¨ï¼Œè¦æ±‚æ‚¨ç™»å½•Cloudflareã€‚ä¸ç”¨æ‹…å¿ƒï¼›è¿™ä¸ªå…è´¹è®¡åˆ’æ¶µç›–äº†æˆ‘ä»¬åœ¨è¿™ä¸ªæ•™ç¨‹ä¸­éœ€è¦çš„æ‰€æœ‰ä¸œè¥¿ï¼Œå¹¶ä¸”ä¸ä¼šè¦æ±‚ä½ ä»˜è´¹ã€‚è¯·ç»§ç»­æ³¨å†Œï¼Œæˆ–è€…å¦‚æœæ‚¨å·²ç»æœ‰å¸æˆ·ï¼Œè¯·ç™»å½•ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼ŒCloudflareä¼šè¯¢é—®æ‚¨æ˜¯å¦è¦æˆæƒç»™ç‰§é©¬äººã€‚åŒæ„åï¼Œæ‚¨åº”è¯¥ä¼šçœ‹åˆ°ä»¥ä¸‹å±å¹•:</p>
<figure id="attachment_128999" aria-describedby="caption-attachment-128999" class="wp-caption aligncenter"><img data-attachment-id="128999" data-permalink="https://blog.logrocket.com/creating-url-shortener-cloudflare-workers/attachment/wrangler-cli-tool/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/08/wrangler-cli-tool.png" data-orig-size="730,479" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Wrangler CLI tool" data-image-description="" data-image-caption="&lt;p&gt;The Wrangler CLI tool is now properly connected.&lt;/p&gt;&#10;" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/08/wrangler-cli-tool-300x197.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/08/wrangler-cli-tool.png" decoding="async" class="size-full wp-image-128999 jetpack-lazy-image" src="../Images/083b13681ee95a282f49fff424ac4580.png" alt="Wrangler CLI Tool" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/08/wrangler-cli-tool.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/08/wrangler-cli-tool-300x197.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/08/wrangler-cli-tool.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/08/wrangler-cli-tool.png"/><noscript><img data-lazy-fallback="1" data-attachment-id="128999" data-permalink="https://blog.logrocket.com/creating-url-shortener-cloudflare-workers/attachment/wrangler-cli-tool/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/08/wrangler-cli-tool.png" data-orig-size="730,479" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Wrangler CLI tool" data-image-description="" data-image-caption="&lt;p&gt;The Wrangler CLI tool is now properly connected.&lt;/p&gt;&#10;" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/08/wrangler-cli-tool-300x197.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/08/wrangler-cli-tool.png" decoding="async" loading="lazy" class="size-full wp-image-128999" src="../Images/083b13681ee95a282f49fff424ac4580.png" alt="Wrangler CLI Tool" srcset="https://blog.logrocket.com/wp-content/uploads/2022/08/wrangler-cli-tool.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/08/wrangler-cli-tool-300x197.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/08/wrangler-cli-tool.png"/></noscript><figcaption id="caption-attachment-128999" class="wp-caption-text">The Wrangler CLI tool is now properly connected.</figcaption></figure>
<p>æ³¨å†Œè¿‡ç¨‹ä¸­ä¸åº”è¯¥å‡ºç°ä»»ä½•é—®é¢˜ã€‚ä½†æ˜¯ï¼Œå¦‚æœä½ åœ¨ä»»ä½•æ—¶å€™é‡åˆ°å›°éš¾ï¼Œä½ å¯ä»¥æŒ‰ç…§<a href="https://developers.cloudflare.com/fundamentals/account-and-billing/account-setup/" target="_blank" rel="noopener"> Cloudflareçš„æŒ‡å—åˆ›å»ºä¸€ä¸ªè´¦æˆ·</a>ã€‚</p>
<p>å‰å®³ï¼ç°åœ¨æ‚¨å·²ç»æ³¨å†Œå¹¶ç™»å½•äº†ï¼Œè®©æˆ‘ä»¬æ£€æŸ¥ä¸€ä¸‹æ‰€æœ‰çš„ä¸œè¥¿æ˜¯å¦éƒ½è¿æ¥å¥½äº†ã€‚</p>
<p>ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤:</p>
<pre class="language-javascript hljs">$ wrangler whoami
 â›…ï¸ wrangler 2.0.21
--------------------
Getting User settings...
ğŸ‘‹ You are logged in with an OAuth Token, associated with the email '<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="c6a8afada9aaa7b5a3a7b686a1aba7afaae8a5a9ab">[emailÂ protected]</a>'!
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Account Name         â”‚ Account ID.                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Nikola Äuza Personal â”‚ 98a16dfefca0e2ee27e1e79ba590d973 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</pre>
<p>å¾ˆå¥½ï¼Œæˆ‘ä»¬å·²ç»å‡†å¤‡å¥½åˆ›å»ºä¸€ä¸ªKVåç§°ç©ºé—´äº†ã€‚</p>
<h3 id="creating-a-kv-namespace">åˆ›å»ºKVåç§°ç©ºé—´</h3>
<p>KVå‘½åç©ºé—´å¯ä»¥çœ‹ä½œæ˜¯Cloudflareç½‘ç»œä¸ŠKV upçš„ä¸€ä¸ªå®ä¾‹ã€‚æˆ‘ä»¬å°†åˆ›å»ºä¸¤ä¸ªKVåç§°ç©ºé—´:ä¸€ä¸ªç”¨äºæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºå°†ç”Ÿæ´»å’Œå·¥ä½œçš„ç”Ÿäº§ç¯å¢ƒï¼Œå¦ä¸€ä¸ªç”¨äºé¢„è§ˆç¯å¢ƒã€‚åœ¨æµ‹è¯•å’Œå¼€å‘URL shorteneræ—¶ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨é¢„è§ˆåç§°ç©ºé—´ã€‚</p>
<p>æˆ‘ä»¬å°†ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤é€šè¿‡Wrangleråˆ›å»ºKVåç§°ç©ºé—´:</p>
<pre class="language-javascript hljs">$ wrangler kv:namespace create SHORT_URLS
ğŸŒ€ Creating namespace with title "short-it-SHORT_URLS"
âœ¨ Success!
Add the following to your configuration file in your kv_namespaces array:
{ binding = "SHORT_URLS", id = "029d374ebd984e19b0bb98e37ab1a95e" }

$ wrangler kv:namespace create SHORT_URLS --preview
 â›…ï¸ wrangler 2.0.21
--------------------
ğŸŒ€ Creating namespace with title "short-it-SHORT_URLS_preview"
âœ¨ Success!
Add the following to your configuration file in your kv_namespaces array:
{ binding = "SHORT_URLS", preview_id = "99a72876e5f84cf58de722b1c2080604" }
</pre>
<p>åœ¨è¿è¡Œè¿™ä¸¤ä¸ªå‘½ä»¤å¹¶åˆ›å»ºäº†ä¸¤ä¸ªåç§°ç©ºé—´ä¹‹åï¼Œæˆ‘ä»¬éœ€è¦å‘Šè¯‰Wrangleråœ¨è¿è¡Œ<code>wrangler dev</code>æ—¶ä½¿ç”¨è¿™äº›åç§°ç©ºé—´ã€‚</p>
<p>æˆ‘ä»¬å°†æŠŠå…³äºKVåç§°ç©ºé—´çš„ä¿¡æ¯æ·»åŠ åˆ°é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„<code>wrangler.toml</code>æ–‡ä»¶ä¸­ã€‚å®ƒåº”è¯¥æ˜¯è¿™æ ·çš„:</p>
<pre class="language-javascript hljs">name = "short-it"
main = "src/index.ts"
compatibility_date = "2022-07-15"

kv_namespaces = [
  { binding = "SHORT_URLS", id = "029d374ebd984e19b0bb98e37ab1a95e", preview_id = "99a72876e5f84cf58de722b1c2080604" }
]
</pre>
<p><code>wrangler.toml</code>æ–‡ä»¶æ˜¯ä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œå®ƒå‘Šè¯‰<code>wrangler</code>å…³äºæˆ‘ä»¬é¡¹ç›®çš„æŸäº›ä¿¡æ¯ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬å·²ç»å‡†å¤‡å¥½å‘KVæ·»åŠ ä¸€äº›æ•°æ®ã€‚</p>
<h3 id="adding-data-to-the-kv">å‘KVæ·»åŠ æ•°æ®</h3>
<p>æˆ‘ä»¬çš„ä¸‹ä¸€æ­¥æ˜¯å°†æ•°æ®æ’­ç§åˆ°KVã€‚è¯·è®°ä½ï¼Œæˆ‘ä»¬æœ‰ä¸¤ä¸ªåç§°ç©ºé—´ï¼Œå› æ­¤æˆ‘ä»¬å¿…é¡»è¿è¡Œä¸¤ä¸ªå‘½ä»¤æ¥å°†æ•°æ®æ”¾åœ¨è¿™ä¸¤ä¸ªåœ°æ–¹ã€‚è®©æˆ‘ä»¬å°†<code>/blog</code>æ¡ç›®æ·»åŠ åˆ°KV:</p>
<pre class="language-javascript hljs">$ wrangler kv:key put --binding SHORT_URLS "/blog" "https://pragmaticpineapple.com/" --preview false
 â›…ï¸ wrangler 2.0.21
--------------------
Writing the value "https://pragmaticpineapple.com/" to key "/blog" on namespace 029d374ebd984e19b0bb98e37ab1a95e.

$ wrangler kv:key put --binding SHORT_URLS "/blog" "https://pragmaticpineapple.com/" --preview
 â›…ï¸ wrangler 2.0.21
--------------------
Writing the value "https://pragmaticpineapple.com/" to key "/blog" on namespace 99a72876e5f84cf58de722b1c2080604.
</pre>
<p>å¤ªæ£’äº†ã€‚ç°åœ¨æˆ‘ä»¬åœ¨KVä¸­æœ‰ä¸€ä¸ªæ¡ç›®ã€‚æ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬æ·»åŠ ä»KVè¯»å–å¹¶é‡å®šå‘ç”¨æˆ·çš„é€»è¾‘ã€‚</p>
<h3 id="reading-from-the-kv">KVè¯»æ•°</h3>
<p>æˆ‘ä»¬å°†å¿«é€Ÿåˆ é™¤æ—§çš„ç¡¬ç¼–ç çŸ­URLï¼Œå¹¶æ·»åŠ å¯¹KVçš„è°ƒç”¨ï¼Œå¦‚ä¸‹æ‰€ç¤º:</p>
<pre class="language-javascript hljs">// src/index.ts
export interface Env {
  SHORT_URLS: KVNamespace;
}

export default {
  async fetch(
    request: Request,
    env: Env,
    _ctx: ExecutionContext
  ): Promise&lt;Response&gt; {
    const url = new URL(request.url);

    const { pathname } = url;

    const redirectURL = await env.SHORT_URLS.get(pathname);

    if (!redirectURL) {
      return new Response(
        `There is no defined URL for the path: '${pathname}', sorry :(`
      );
    }

    return Response.redirect(redirectURL, 301);
  },
};
</pre>
<p>è¿™é‡Œæˆ‘ä»¬æ·»åŠ <code>SHORT_URLS</code>ä½œä¸º<code>KVNamespace</code>ç±»å‹ã€‚è¿™å°†å…è®¸æˆ‘ä»¬è°ƒç”¨KVæ–¹æ³•æ¥è·å¾—æ­£ç¡®çš„æ•°æ®ã€‚è¿™æ¬¡æˆ‘ä»¬ä½¿ç”¨<code>await env.SHORT_URLS.get(pathname)</code>ï¼Œè€Œä¸æ˜¯å¸¦æœ‰URLçš„ç¡¬ç¼–ç å¯¹è±¡ã€‚</p>
<p>å¯¹<code>env.SHORT_URLS.get(pathname)</code>çš„è°ƒç”¨è¯•å›¾ä»KVè·å–å¯†é’¥ã€‚å¦‚æœå®ƒå›æŠ¥æ‰¿è¯ºï¼Œæˆ‘ä»¬å¿…é¡»<code>await</code>ã€‚ä½†æ˜¯ï¼Œå¦‚æœç»™å®šçš„<code>pathname</code>æœ‰å€¼ï¼Œé‚£ä¹ˆç”¨æˆ·ä¼šè¢«é‡å®šå‘åˆ°è¯¥URLã€‚</p>
<p>ç°åœ¨ï¼Œå½“æˆ‘ä»¬è®¿é—®<a href="http://localhost:8787/blog" rel="nofollow">http://localhost:8787/blog</a>æ—¶ï¼Œæˆ‘ä»¬å°†è¢«é‡å®šå‘åˆ°æˆ‘ä»¬æ”¾åœ¨KVä¸­çš„å®é™…åšå®¢URLã€‚å®ƒçœ‹èµ·æ¥ä¼šåƒè¿™æ ·:</p>
<figure id="attachment_129001" aria-describedby="caption-attachment-129001" class="wp-caption aligncenter"><img data-attachment-id="129001" data-permalink="https://blog.logrocket.com/creating-url-shortener-cloudflare-workers/attachment/still-redirects-blog/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/08/still-redirects-blog.gif" data-orig-size="588,376" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Still redirects blog" data-image-description="" data-image-caption="&lt;p&gt;Visiting /blog still redirects us to the actual blog page.&lt;/p&gt;&#10;" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/08/still-redirects-blog-300x192.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/08/still-redirects-blog.gif" decoding="async" class="size-full wp-image-129001 jetpack-lazy-image" src="../Images/59e4acbb317ae74b448d15d3d971fad5.png" alt="Still Redirects Blog" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/08/still-redirects-blog.gif?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/08/still-redirects-blog.gif"/><noscript><img data-lazy-fallback="1" data-attachment-id="129001" data-permalink="https://blog.logrocket.com/creating-url-shortener-cloudflare-workers/attachment/still-redirects-blog/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/08/still-redirects-blog.gif" data-orig-size="588,376" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Still redirects blog" data-image-description="" data-image-caption="&lt;p&gt;Visiting /blog still redirects us to the actual blog page.&lt;/p&gt;&#10;" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/08/still-redirects-blog-300x192.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/08/still-redirects-blog.gif" decoding="async" loading="lazy" class="size-full wp-image-129001" src="../Images/59e4acbb317ae74b448d15d3d971fad5.png" alt="Still Redirects Blog" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/08/still-redirects-blog.gif"/></noscript><figcaption id="caption-attachment-129001" class="wp-caption-text">Visiting /blog still redirects us to the actual blog page.</figcaption></figure>
<p>ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬ç°åœ¨å°è¯•è®¿é—®æˆ‘ä»¬ç¡¬ç¼–ç çš„ä»»ä½•å…¶ä»–URLï¼Œæˆ‘ä»¬å°†å¾—åˆ°ä¸€æ¡æ¶ˆæ¯ï¼Œè¯´æ˜è¿™äº›URLç¼ºå°‘é‡å®šå‘:</p>
<figure id="attachment_129003" aria-describedby="caption-attachment-129003" class="wp-caption aligncenter"><img data-attachment-id="129003" data-permalink="https://blog.logrocket.com/creating-url-shortener-cloudflare-workers/attachment/url-missing-redirect/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/08/url-missing-redirect.gif" data-orig-size="588,376" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="URL missing redirect" data-image-description="" data-image-caption="&lt;p&gt;Visiting /twitter results in a message indicating the URL is missing a redirect.&lt;/p&gt;&#10;" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/08/url-missing-redirect-300x192.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/08/url-missing-redirect.gif" decoding="async" class="size-full wp-image-129003 jetpack-lazy-image" src="../Images/3bb5f377e1edef762f520d0e025c025f.png" alt="URL Missing Redirect" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/08/url-missing-redirect.gif?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/08/url-missing-redirect.gif"/><noscript><img data-lazy-fallback="1" data-attachment-id="129003" data-permalink="https://blog.logrocket.com/creating-url-shortener-cloudflare-workers/attachment/url-missing-redirect/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/08/url-missing-redirect.gif" data-orig-size="588,376" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="URL missing redirect" data-image-description="" data-image-caption="&lt;p&gt;Visiting /twitter results in a message indicating the URL is missing a redirect.&lt;/p&gt;&#10;" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/08/url-missing-redirect-300x192.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/08/url-missing-redirect.gif" decoding="async" loading="lazy" class="size-full wp-image-129003" src="../Images/3bb5f377e1edef762f520d0e025c025f.png" alt="URL Missing Redirect" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/08/url-missing-redirect.gif"/></noscript><figcaption id="caption-attachment-129003" class="wp-caption-text">Visiting /twitter results in a message indicating the URL is missing a redirect.</figcaption></figure>
<p>è®©æˆ‘ä»¬ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¿«é€Ÿå°†Twitterçš„ç¼©å†™URLæ·»åŠ åˆ°KVä¸­:</p>
<pre class="language-javascript hljs">$ wrangler kv:key put --binding SHORT_URLS "/twitter" "https://twitter.com/nikolalsvk" --preview false
â›…ï¸ wrangler 2.0.21
--------------------
Writing the value "https://twitter.com/nikolalsvk" to key "/twitter" on namespace 029d374ebd984e19b0bb98e37ab1a95e.

$ wrangler kv:key put --binding SHORT_URLS "/twitter" "https://twitter.com/nikolalsvk" --preview
 â›…ï¸ wrangler 2.0.21
--------------------
Writing the value "https://twitter.com/nikolalsvk" to key "/twitter" on namespace 99a72876e5f84cf58de722b1c2080604.
</pre>
<p>ç°åœ¨ï¼Œå½“æˆ‘ä»¬åˆ·æ–°<a href="http://localhost:8787/twitter" rel="nofollow">http://localhost:8787/twitter</a>æ—¶ï¼Œæˆ‘ä»¬åº”è¯¥è¢«é‡å®šå‘åˆ°Twitterå¸æˆ·ã€‚</p>
<figure id="attachment_129005" aria-describedby="caption-attachment-129005" class="wp-caption aligncenter"><img data-attachment-id="129005" data-permalink="https://blog.logrocket.com/creating-url-shortener-cloudflare-workers/attachment/twitter-loading/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/08/twitter-loading.gif" data-orig-size="588,376" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Twitter loading" data-image-description="" data-image-caption="&lt;p&gt;Twitter loads after we added the shortened URL to the KV.&lt;/p&gt;&#10;" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/08/twitter-loading-300x192.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/08/twitter-loading.gif" decoding="async" class="size-full wp-image-129005 jetpack-lazy-image" src="../Images/eae6ea2c03624a2cb74329afae514bd9.png" alt="Twitter Loading" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/08/twitter-loading.gif?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/08/twitter-loading.gif"/><noscript><img data-lazy-fallback="1" data-attachment-id="129005" data-permalink="https://blog.logrocket.com/creating-url-shortener-cloudflare-workers/attachment/twitter-loading/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/08/twitter-loading.gif" data-orig-size="588,376" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Twitter loading" data-image-description="" data-image-caption="&lt;p&gt;Twitter loads after we added the shortened URL to the KV.&lt;/p&gt;&#10;" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/08/twitter-loading-300x192.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/08/twitter-loading.gif" decoding="async" loading="lazy" class="size-full wp-image-129005" src="../Images/eae6ea2c03624a2cb74329afae514bd9.png" alt="Twitter Loading" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/08/twitter-loading.gif"/></noscript><figcaption id="caption-attachment-129005" class="wp-caption-text">Twitter loads after we added the shortened URL to the KV.</figcaption></figure>
<p>å‰å®³äº†ï¼Œç°åœ¨æˆ‘ä»¬æœ‰ä¸¤ä¸ªçŸ­ç½‘å€:<code>/blog</code>å’Œ<code>/twitter</code>ã€‚è®©æˆ‘ä»¬å°è¯•éƒ¨ç½²æˆ‘ä»¬çš„æœåŠ¡ï¼Œå¹¶åœ¨ç”Ÿäº§ä¸­çœ‹åˆ°å®ƒã€‚</p>
<h2 id="deploying-cloudflare-workers">éƒ¨ç½²Cloudflareå·¥ä½œäººå‘˜</h2>
<p>Cloudflare Workerséƒ¨ç½²æ­¥éª¤ç›¸å½“ç®€å•ã€‚æˆ‘ä»¬å°†åˆ©ç”¨<code>wrangler publish</code>ï¼Œå°±åƒè¿™æ ·:</p>
<pre class="language-javascript hljs">$ wrangler publish
 â›…ï¸ wrangler 2.0.21
--------------------
Retrieving cached values for userId from node_modules/.cache/wrangler
Your worker has access to the following bindings:
- KV Namespaces:
  - SHORT_URLS: 029d374ebd984e19b0bb98e37ab1a95e
Total Upload: 0.45 KiB / gzip: 0.29 KiB
Worker ID: short-it
Worker ETag: f8395cab29edf297137631b803b14c32daaae982758c23e3019b700e2468c277
Uploaded short-it (2.14 sec)
Published short-it (6.33 sec)
  short-it.nikolalsvk.workers.dev
</pre>
<p>ç°åœ¨ï¼Œè¿™äº›æœåŠ¡å·²ç»åœ¨https://short-it . nikolalsvk . workers . devä¸Šçº¿ã€‚è€¶ï¼</p>
<p>å¦‚æœä½ æŒ‰ç…§æœ¬æ•™ç¨‹å­¦ä¹ ï¼Œä½ çš„æœåŠ¡åº”è¯¥ä½äºURL <a href="https://short-it.YOUR_SUBDOMAIN.workers.dev" rel="nofollow"> https://short-itçš„æŸä¸ªåœ°æ–¹ã€‚YOUR_SUBDOMAIN.workers.dev </a>ï¼Œè¿™å–å†³äºæ‚¨ä¸º<code>YOUR_SUBDOMAIN</code>é€‰æ‹©çš„å†…å®¹ã€‚</p>
<p>æ­¤æ—¶ï¼Œæˆ‘ä»¬çš„Workerè„šæœ¬å·²åœ¨å…¨çƒéƒ¨ç½²åœ¨Cloudflare Edgeç½‘ç»œä¸Šã€‚è¿™æ„å‘³ç€ï¼Œå¦‚æœä¸–ç•Œå„åœ°çš„æœ‹å‹å’Œé™Œç”Ÿäººè®¿é—®https://short-it.nikolalsvk.workers.dev/twitterï¼Œä»–ä»¬ä¼šä»¥æƒŠäººçš„é€Ÿåº¦è¢«é‡å®šå‘åˆ°æˆ‘ä»¬çš„Twitterè´¦æˆ·ã€‚</p>
<h2 id="wrapping-up">åŒ…æ‰</h2>
<p>æ„Ÿè°¢æ‚¨è·Ÿéšæˆ‘ä»¬çš„æ—…ç¨‹ï¼Œä½¿ç”¨Cloudflare Workersåˆ›å»ºç®€å•çš„URL shorteneræœåŠ¡ã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬ä»‹ç»äº†Cloudflareä¸Šä¸‹æ–‡ä¸­çš„Workerçš„æ¦‚å¿µã€‚æˆ‘ä»¬è¿˜æ¼”ç¤ºäº†å¦‚ä½•åœ¨Cloudflareçš„KVå­˜å‚¨ä¸­åˆ›å»ºå’Œç®¡ç†æ•°æ®ã€‚</p>
<p>æˆ‘ä»¬èƒ½å¤Ÿä½¿ç”¨ç‰§é©¬äººå¹³ç¨³åœ°æ‰§è¡Œæ‰€æœ‰è¿™äº›ï¼Œè¿™æä¾›äº†ä¸€ä¸ªå¾ˆå¥½çš„å¼€å‘äººå‘˜ä½“éªŒã€‚ä½†æ˜¯ï¼Œæœ€é‡è¦çš„æ˜¯ï¼Œæˆ‘ä»¬è®¾æ³•åˆ›å»ºã€æµ‹è¯•å’Œéƒ¨ç½²äº†æˆ‘ä»¬çš„å°å‹æœåŠ¡ï¼Œå®ƒå¯ä»¥åœ¨ä¸–ç•Œçš„å„ä¸ªè§’è½å¿«é€Ÿè¿è¡Œã€‚</p>
<p>åœ¨ç±»ä¼¼çš„æŠ€æœ¯æˆ–æœåŠ¡ä¸­å®ç°è¿™ä¸€ç‚¹å¯èƒ½éœ€è¦å¤§é‡çš„é‡‘é’±å’ŒåŠªåŠ›ã€‚ç„¶è€Œï¼ŒCloudflareæ”¯æŒæ¯å¤©100ï¼Œ000ä¸ªè¯·æ±‚çš„å¤§é‡å…è´¹å±‚ã€‚å› æ­¤ï¼Œä½ å¯ä»¥ç¼©çŸ­è®¸å¤šç½‘å€ï¼Œå¹¶åœ¨è¿›å…¥ä»˜è´¹è®¡åˆ’ä¹‹å‰æœ‰è®¸å¤šè®¿é—®ã€‚</p>
<p>æœ¬æ–‡ä¸­çš„æ‰€æœ‰ä»£ç éƒ½å¯ä»¥åœ¨<a href="https://github.com/nikolalsvk/short-it" target="_blank" rel="noopener"> GitHub repo </a>ä¸­è·å¾—(å¦‚æœä½ å–œæ¬¢çš„è¯ï¼Œè¯·ç»™å®ƒæ‰“æ˜Ÿå·)ã€‚shorteneræœåŠ¡åœ¨<a href="https://short-it.nikolalsvk.workers.dev" rel="nofollow">https://short-it . nikolalsvk . workers . dev</a>ä¸Šçº¿ã€‚</p>
<p>å¦‚æœä½ å–œæ¬¢è¿™ç¯‡æ–‡ç« ï¼Œè¯·è€ƒè™‘ä¸ä½ çš„æœ‹å‹å’ŒåŒäº‹åˆ†äº«ã€‚</p>
<p>ä¸‹æ¬¡è§ï¼Œå¹²æ¯ï¼</p><div class="code-block code-block-2">
<div class="blog-plug base-cta"><h2>ä½¿ç”¨<a class="signup" href="https://lp.logrocket.com/blg/signup" target="_blank" rel="noopener noreferrer"> LogRocket </a>æ¶ˆé™¤ä¼ ç»Ÿé”™è¯¯æŠ¥å‘Šçš„å¹²æ‰°</h2>
<a href="https://lp.logrocket.com/blg/signup" class="signup" target="_blank" rel="noopener noreferrer"><img class="alignnone size-full wp-image-46 jetpack-lazy-image" src="../Images/d6f5a5dd739296c1dd7aab3d5e77eeb9.png" alt="LogRocket Dashboard Free Trial Banner" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png"/><noscript><img data-lazy-fallback="1" class="alignnone size-full wp-image-46" src="../Images/d6f5a5dd739296c1dd7aab3d5e77eeb9.png" alt="LogRocket Dashboard Free Trial Banner" data-original-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png"/></noscript></a>
<p><a href="https://lp.logrocket.com/blg/signup" target="_blank" rel="noopener noreferrer"> LogRocket </a>æ˜¯ä¸€ä¸ªæ•°å­—ä½“éªŒåˆ†æè§£å†³æ–¹æ¡ˆï¼Œå®ƒå¯ä»¥ä¿æŠ¤æ‚¨å…å—æ•°ç™¾ä¸ªå‡é˜³æ€§é”™è¯¯è­¦æŠ¥çš„å½±å“ï¼Œåªé’ˆå¯¹å‡ ä¸ªçœŸæ­£é‡è¦çš„é¡¹ç›®ã€‚LogRocketä¼šå‘Šè¯‰æ‚¨åº”ç”¨ç¨‹åºä¸­å®é™…å½±å“ç”¨æˆ·çš„æœ€å…·å½±å“åŠ›çš„bugå’ŒUXé—®é¢˜ã€‚</p>
<p>ç„¶åï¼Œä½¿ç”¨å…·æœ‰æ·±å±‚æŠ€æœ¯é¥æµ‹çš„ä¼šè¯é‡æ”¾æ¥ç¡®åˆ‡åœ°æŸ¥çœ‹ç”¨æˆ·çœ‹åˆ°äº†ä»€ä¹ˆä»¥åŠæ˜¯ä»€ä¹ˆå¯¼è‡´äº†é—®é¢˜ï¼Œå°±åƒä½ åœ¨ä»–ä»¬èº«åçœ‹ä¸€æ ·ã€‚</p>
<p>LogRocketè‡ªåŠ¨èšåˆå®¢æˆ·ç«¯é”™è¯¯ã€JSå¼‚å¸¸ã€å‰ç«¯æ€§èƒ½æŒ‡æ ‡å’Œç”¨æˆ·äº¤äº’ã€‚ç„¶åLogRocketä½¿ç”¨æœºå™¨å­¦ä¹ æ¥å‘Šè¯‰ä½ å“ªäº›é—®é¢˜æ­£åœ¨å½±å“å¤§å¤šæ•°ç”¨æˆ·ï¼Œå¹¶æä¾›ä½ éœ€è¦ä¿®å¤å®ƒçš„ä¸Šä¸‹æ–‡ã€‚</p>
<p>å…³æ³¨é‡è¦çš„bugâ€”<a class="signup" href="https://lp.logrocket.com/blg/signup-issue-free" target="_blank" rel="noopener noreferrer">ä»Šå¤©å°±è¯•è¯•LogRocketã€‘ã€‚</a></p></div></div>

<p class="clearfix"/>
<p class="clearfix"/>
</article>

</div>    
</body>
</html>