<html>
<head>
<title>useState vs. useRef: Similarities, differences, and use cases - LogRocket Blog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>useState vs. useRef:ç›¸ä¼¼æ€§ã€å·®å¼‚å’Œç”¨ä¾‹</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://blog.logrocket.com/usestate-vs-useref/#0001-01-01">https://blog.logrocket.com/usestate-vs-useref/#0001-01-01</a></blockquote><div><article class="article-post">
<p>è¿™ç¯‡æ–‡ç« è§£é‡Šäº† React é’©å­<code>useState</code>å’Œ<code>useRef</code>ã€‚æ‚¨å°†å­¦ä¹ å®ƒä»¬çš„åŸºæœ¬ç”¨æ³•ï¼Œå¹¶äº†è§£ä¸¤ç§æŒ‚é’©çš„ä¸åŒç”¨ä¾‹ã€‚</p>
<p>ä½ å¯ä»¥åœ¨<a href="https://codesandbox.io/s/gifted-austin-28p3z?file=/src/App.js">ä»£ç æ²™ç®±</a>ä¸­æ‰¾åˆ°è¿™äº›ä¾‹å­ã€‚è¦æŸ¥çœ‹ä¸åŒçš„ç¤ºä¾‹ï¼Œåªéœ€ä¿®æ”¹<code>App.js:</code>ä¸­çš„ä»¥ä¸‹ä»£ç è¡Œ</p>
<pre>export default AppDemo6; // change to AppDemo&lt;Nr&gt;</pre>
<h2>ç†è§£<code>useState</code>æŒ‚é’©</h2>
<p><code><a href="https://reactjs.org/docs/hooks-state.html">useState</a></code>é’©å­æ”¯æŒåŠŸèƒ½ç»„ä»¶çš„ç»„ä»¶çŠ¶æ€å¼€å‘ã€‚åœ¨ React 16.8 ä¹‹å‰ï¼Œç»„ä»¶å±€éƒ¨çŠ¶æ€åªèƒ½åœ¨åŸºäºç±»çš„ç»„ä»¶ä¸­å®ç°ã€‚</p>
<p>çœ‹ä¸€ä¸‹ä¸‹é¢çš„ä»£ç ã€‚</p>
<pre>import { useState } from "react";
function AppDemo1() {
  const stateWithUpdater = useState(true);
  const darkMode = stateWithUpdater[0];
  const darkModeUpdater = stateWithUpdater[1];
  return (
    &lt;div&gt;
      &lt;p&gt;{darkMode ? "dark mode on" : "dark mode off"}&lt;/p&gt;
      &lt;button onClick={() =&gt; darkModeUpdater(!darkMode)}&gt;
        toggle dark mode
      &lt;/button&gt;
    &lt;/div&gt;
  );
}</pre>
<p><code>useState</code>é’©å­è¿”å›ä¸€ä¸ªåŒ…å«ä¸¤é¡¹çš„æ•°ç»„ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å®ç°äº†ä¸€ä¸ªå¸ƒå°”ç»„ä»¶çŠ¶æ€ï¼Œå¹¶ç”¨<code>true</code>åˆå§‹åŒ–æˆ‘ä»¬çš„é’©å­ã€‚</p>
<p>åªæœ‰åœ¨æœ€åˆçš„æ¸²æŸ“å‘¨æœŸä¸­æ‰ä¼šè€ƒè™‘è¿™ä¸ªå‚æ•°<code>useState</code>ã€‚ç„¶è€Œï¼Œå¦‚æœä½ éœ€è¦ä¸€ä¸ªè®¡ç®—å¤æ‚çš„åˆå§‹å€¼ï¼Œé‚£ä¹ˆä½ å¯ä»¥<a href="https://reactjs.org/docs/hooks-reference.html#lazy-initial-state">ä¼ é€’ä¸€ä¸ªå›è°ƒå‡½æ•°</a>æ¥ä¼˜åŒ–æ€§èƒ½ã€‚</p>
<p>ç¬¬ä¸€ä¸ªæ•°ç»„é¡¹è¡¨ç¤ºå®é™…çŠ¶æ€ï¼Œç¬¬äºŒä¸ªé¡¹æ„æˆçŠ¶æ€æ›´æ–°å™¨å‡½æ•°ã€‚<code>onClick</code>å¤„ç†ç¨‹åºæ¼”ç¤ºäº†å¦‚ä½•ä½¿ç”¨æ›´æ–°å‡½æ•°(<code>darkModeUpdate</code>)æ¥æ”¹å˜çŠ¶æ€å˜é‡(<code>darkMode</code>)ã€‚åƒè¿™æ ·æ›´æ–°ä½ çš„çŠ¶æ€æ˜¯å¾ˆé‡è¦çš„ã€‚ä»¥ä¸‹ä»£ç æ˜¯éæ³•çš„:</p>
<pre>darkMode = true;</pre>
<p>å¦‚æœä½ æœ‰ä¸€äº›ä½¿ç”¨<code>useState</code>é’©å­çš„ç»éªŒï¼Œä½ å¯èƒ½ä¼šå¯¹æˆ‘çš„ä¾‹å­çš„è¯­æ³•æ„Ÿåˆ°ç–‘æƒ‘ã€‚é»˜è®¤ç”¨æ³•æ˜¯åœ¨<a href="https://blog.logrocket.com/javascript-concepts-before-learning-react/">æ•°ç»„ææ„</a>çš„å¸®åŠ©ä¸‹åˆ©ç”¨è¿”å›çš„æ•°ç»„é¡¹ã€‚</p>
<pre>const [darkMode, setDarkMode] = useState(true);</pre>
<p>æé†’ä¸€ä¸‹ï¼Œä½¿ç”¨ä»»ä½•é’©å­æ—¶ï¼Œéƒ½è¦éµå¾ª<a href="https://reactjs.org/docs/hooks-rules.html">é’©å­</a>çš„è§„åˆ™ï¼Œè€Œä¸ä»…ä»…æ˜¯<code>useState</code>æˆ–<code>useRef</code>è§„åˆ™ï¼Œè¿™ä¸€ç‚¹è‡³å…³é‡è¦:</p>
<ul>
<li>é’©å­åº”è¯¥åªä» React å‡½æ•°çš„é¡¶å±‚è°ƒç”¨</li>
<li>ä¸å¾—ä»åµŒå¥—ä»£ç ä¸­è°ƒç”¨æŒ‚é’©(ä¾‹å¦‚ï¼Œå¾ªç¯ã€æ¡ä»¶)</li>
<li>é’©å­ä¹Ÿå¯ä»¥ä»è‡ªå®šä¹‰é’©å­åœ¨é¡¶å±‚è°ƒç”¨</li>
</ul>
<p>ç°åœ¨æˆ‘ä»¬å·²ç»ä»‹ç»äº†åŸºç¡€çŸ¥è¯†ï¼Œè®©æˆ‘ä»¬ç”¨ä¸‹é¢çš„ç¤ºä¾‹ä»£ç æ¥çœ‹çœ‹é’©å­çš„å„ä¸ªæ–¹é¢ã€‚</p>
<pre>import { useState } from "react";
import "./styles.css";
function AppDemo2() {
  console.log("render App");
  const [darkMode, setDarkMode] = useState(false);
  return (
    &lt;div className={`App ${darkMode &amp;&amp; "dark-mode"}`}&gt;
      &lt;h1&gt;The useState hook&lt;/h1&gt;
      &lt;h2&gt;Click the button to toggle the state&lt;/h2&gt;
      &lt;button
        onClick={() =&gt; {
          setDarkMode(!darkMode);
        }}
      &gt;
        toggle dark mode
      &lt;/button&gt;
    &lt;/div&gt;
  );
}</pre>
<p>å¦‚æœ<code>darkMode</code>è¢«è®¾ç½®ä¸º<code>true</code>ï¼Œé‚£ä¹ˆä¸€ä¸ªé¢å¤–çš„ CSS ç±»(<code>dark-mode</code>)è¢«æ·»åŠ åˆ°<code>className</code>ï¼Œå¹¶ä¸”èƒŒæ™¯å’Œæ–‡æœ¬çš„é¢œè‰²è¢«åè½¬ã€‚ä»è®°å½•ä¸­çš„æ§åˆ¶å°è¾“å‡ºå¯ä»¥çœ‹å‡ºï¼Œæ¯æ¬¡çŠ¶æ€æ”¹å˜æ—¶ï¼Œç›¸åº”çš„ç»„ä»¶éƒ½ä¼šè¢«é‡æ–°å‘ˆç°ã€‚</p>
<figure id="attachment_50026" aria-describedby="caption-attachment-50026" class="wp-caption aligncenter"><img data-attachment-id="50026" data-permalink="https://blog.logrocket.com/usestate-vs-useref/attachment/component-re-render-every-state-change/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/05/component-re-render-every-state-change.gif" data-orig-size="524,530" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="App component re-renders on state change" data-image-description="" data-image-caption="&lt;p&gt;Every state change re-renders the App component.&lt;/p&gt;&#10;" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/05/component-re-render-every-state-change-297x300.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/05/component-re-render-every-state-change.gif" decoding="async" class="size-full wp-image-50026 jetpack-lazy-image" src="../Images/be8570ae7a12fc56cc4beca5e6a1ddfe.png" alt="App Component Re-rendering on Every State Change" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2021/05/component-re-render-every-state-change.gif?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/05/component-re-render-every-state-change.gif"/><noscript><img data-lazy-fallback="1" data-attachment-id="50026" data-permalink="https://blog.logrocket.com/usestate-vs-useref/attachment/component-re-render-every-state-change/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/05/component-re-render-every-state-change.gif" data-orig-size="524,530" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="App component re-renders on state change" data-image-description="" data-image-caption="&lt;p&gt;Every state change re-renders the App component.&lt;/p&gt;&#10;" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/05/component-re-render-every-state-change-297x300.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/05/component-re-render-every-state-change.gif" decoding="async" loading="lazy" class="size-full wp-image-50026" src="../Images/be8570ae7a12fc56cc4beca5e6a1ddfe.png" alt="App Component Re-rendering on Every State Change" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/05/component-re-render-every-state-change.gif"/></noscript><figcaption id="caption-attachment-50026" class="wp-caption-text">Every state change re-renders the <code>App</code> component.</figcaption></figure>
<p>åœ¨è¿™é‡Œï¼ŒReact DevTools ç‰¹åˆ«æœ‰åŠ©äºåœ¨ç»„ä»¶æ¸²æŸ“æ—¶çªå‡ºæ˜¾ç¤ºæ›´æ–°ã€‚åœ¨æœ€åä¸€ä¸ªè®°å½•ä¸­ï¼Œæ‚¨å¯ä»¥çœ‹åˆ°ç»„ä»¶å‘¨å›´é—ªçƒçš„è¾¹æ¡†ï¼Œé€šçŸ¥æ‚¨å¦ä¸€ä¸ªç»„ä»¶æ¸²æŸ“å‘¨æœŸã€‚</p>
<figure id="attachment_50028" aria-describedby="caption-attachment-50028" class="wp-caption aligncenter"><img data-attachment-id="50028" data-permalink="https://blog.logrocket.com/usestate-vs-useref/attachment/react-devtools-highlight-option/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/05/react-devtools-highlight-option.png" data-orig-size="730,289" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="React DevTools highlight option" data-image-description="" data-image-caption="&lt;p&gt;Option to visually highlight re-renders.&lt;/p&gt;&#10;" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/05/react-devtools-highlight-option-300x119.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/05/react-devtools-highlight-option.png" decoding="async" class="size-full wp-image-50028 jetpack-lazy-image" src="../Images/844bf391136074a5d88d1564f84efcd4.png" alt="Enabling React DevTools Option to Highlight Re-renders" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2021/05/react-devtools-highlight-option.png 730w, https://blog.logrocket.com/wp-content/uploads/2021/05/react-devtools-highlight-option-300x119.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2021/05/react-devtools-highlight-option.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/05/react-devtools-highlight-option.png"/><noscript><img data-lazy-fallback="1" data-attachment-id="50028" data-permalink="https://blog.logrocket.com/usestate-vs-useref/attachment/react-devtools-highlight-option/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/05/react-devtools-highlight-option.png" data-orig-size="730,289" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="React DevTools highlight option" data-image-description="" data-image-caption="&lt;p&gt;Option to visually highlight re-renders.&lt;/p&gt;&#10;" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/05/react-devtools-highlight-option-300x119.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/05/react-devtools-highlight-option.png" decoding="async" loading="lazy" class="size-full wp-image-50028" src="../Images/844bf391136074a5d88d1564f84efcd4.png" alt="Enabling React DevTools Option to Highlight Re-renders" srcset="https://blog.logrocket.com/wp-content/uploads/2021/05/react-devtools-highlight-option.png 730w, https://blog.logrocket.com/wp-content/uploads/2021/05/react-devtools-highlight-option-300x119.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/05/react-devtools-highlight-option.png"/></noscript><figcaption id="caption-attachment-50028" class="wp-caption-text">Option to visually highlight re-renders.</figcaption></figure>
<p>åœ¨ä¸‹ä¸€ä¸ªä¾‹å­ä¸­ï¼Œæ ‡é¢˜è¢«æå–åˆ°ä¸€ä¸ªå•ç‹¬çš„ React ç»„ä»¶ä¸­(<code>Description</code>)ã€‚</p>
<pre>import { useState } from "react";
import "./styles.css";
function AppDemo3() {
  console.log("render App");
  const [darkMode, setDarkMode] = useState(false);
  return (
    &lt;div className={`App ${darkMode &amp;&amp; "dark-mode"}`}&gt;
      &lt;Description /&gt;
      &lt;button
        onClick={() =&gt; {
          setDarkMode(!darkMode);
        }}
      &gt;
        toggle dark mode
      &lt;/button&gt;
    &lt;/div&gt;
  );
}
const Description = () =&gt; {
  console.log("render Description");
  return (
    &lt;&gt;
      &lt;h1&gt;The useState hook&lt;/h1&gt;
      &lt;h2&gt;Click the button to toggle the state&lt;/h2&gt;
    &lt;/&gt;
  );
};</pre>
<p>æ¯å½“ç”¨æˆ·å•å‡»æŒ‰é’®æ—¶ï¼Œ<code>App</code>ç»„ä»¶å°±ä¼šè¢«å‘ˆç°ï¼Œå› ä¸ºç›¸åº”çš„ click å¤„ç†ç¨‹åºä¼šæ›´æ–°<code>darkMode</code>çŠ¶æ€å˜é‡ã€‚æ­¤å¤–ï¼Œå­ç»„ä»¶<code>Description</code>ä¹Ÿå¾—åˆ°äº†æ¸²æŸ“ã€‚</p>
<figure id="attachment_50032" aria-describedby="caption-attachment-50032" class="wp-caption aligncenter"><img data-attachment-id="50032" data-permalink="https://blog.logrocket.com/usestate-vs-useref/attachment/child-component-re-render-every-state-change/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/05/child-component-re-render-every-state-change.gif" data-orig-size="524,530" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="App and child components re-render on state change" data-image-description="" data-image-caption="&lt;p&gt;Every state change re-renders the App and child components.&lt;/p&gt;&#10;" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/05/child-component-re-render-every-state-change-297x300.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/05/child-component-re-render-every-state-change.gif" decoding="async" class="size-full wp-image-50032 jetpack-lazy-image" src="../Images/a5fc5ba026367b5ceda578ed73f82707.png" alt="App and Child Components Re-rendering on Every State Change" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2021/05/child-component-re-render-every-state-change.gif?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/05/child-component-re-render-every-state-change.gif"/><noscript><img data-lazy-fallback="1" data-attachment-id="50032" data-permalink="https://blog.logrocket.com/usestate-vs-useref/attachment/child-component-re-render-every-state-change/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/05/child-component-re-render-every-state-change.gif" data-orig-size="524,530" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="App and child components re-render on state change" data-image-description="" data-image-caption="&lt;p&gt;Every state change re-renders the App and child components.&lt;/p&gt;&#10;" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/05/child-component-re-render-every-state-change-297x300.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/05/child-component-re-render-every-state-change.gif" decoding="async" loading="lazy" class="size-full wp-image-50032" src="../Images/a5fc5ba026367b5ceda578ed73f82707.png" alt="App and Child Components Re-rendering on Every State Change" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/05/child-component-re-render-every-state-change.gif"/></noscript><figcaption id="caption-attachment-50032" class="wp-caption-text">Every state change re-renders the <code>App</code> and child components.</figcaption></figure>
<p>ä¸‹å›¾ä¸­çš„<a href="https://wavez.github.io/react-hooks-lifecycle/">è¯´æ˜äº†çŠ¶æ€å˜åŒ–å¯¼è‡´æ¸²æŸ“å¾ªç¯ã€‚</a></p>
<figure id="attachment_50033" aria-describedby="caption-attachment-50033" class="wp-caption aligncenter"><img data-attachment-id="50033" data-permalink="https://blog.logrocket.com/usestate-vs-useref/attachment/react-hooks-lifecycle-diagram/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/05/react-hooks-lifecycle-diagram.png" data-orig-size="730,503" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Diagram of the React Hooks lifecycle" data-image-description="" data-image-caption="&lt;p&gt;A state update re-renders the corresponding component.&lt;/p&gt;&#10;" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/05/react-hooks-lifecycle-diagram-300x207.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/05/react-hooks-lifecycle-diagram.png" decoding="async" class="size-full wp-image-50033 jetpack-lazy-image" src="../Images/1ced5fbae8d695fc394c2814558c1613.png" alt="Diagram of the React Hooks Lifecycle" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2021/05/react-hooks-lifecycle-diagram.png 730w, https://blog.logrocket.com/wp-content/uploads/2021/05/react-hooks-lifecycle-diagram-300x207.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2021/05/react-hooks-lifecycle-diagram.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/05/react-hooks-lifecycle-diagram.png"/><noscript><img data-lazy-fallback="1" data-attachment-id="50033" data-permalink="https://blog.logrocket.com/usestate-vs-useref/attachment/react-hooks-lifecycle-diagram/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/05/react-hooks-lifecycle-diagram.png" data-orig-size="730,503" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Diagram of the React Hooks lifecycle" data-image-description="" data-image-caption="&lt;p&gt;A state update re-renders the corresponding component.&lt;/p&gt;&#10;" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/05/react-hooks-lifecycle-diagram-300x207.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/05/react-hooks-lifecycle-diagram.png" decoding="async" loading="lazy" class="size-full wp-image-50033" src="../Images/1ced5fbae8d695fc394c2814558c1613.png" alt="Diagram of the React Hooks Lifecycle" srcset="https://blog.logrocket.com/wp-content/uploads/2021/05/react-hooks-lifecycle-diagram.png 730w, https://blog.logrocket.com/wp-content/uploads/2021/05/react-hooks-lifecycle-diagram-300x207.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/05/react-hooks-lifecycle-diagram.png"/></noscript><figcaption id="caption-attachment-50033" class="wp-caption-text">A state update re-renders the corresponding component.</figcaption></figure>
<p>ä¸ºä»€ä¹ˆç†è§£ React é’©å­ç”Ÿå‘½å‘¨æœŸå¾ˆé‡è¦ï¼Ÿä¸€æ–¹é¢ï¼Œåªè¦ä¸é€šè¿‡ updater å‡½æ•°æ›´æ–°çŠ¶æ€ï¼ŒçŠ¶æ€å°±ä¼šåœ¨æ¸²æŸ“è¿‡ç¨‹ä¸­ä¿æŒä¸å˜ï¼Œè¿™æœ¬èº«å°±ä¼šè§¦å‘æ–°çš„æ¸²æŸ“å‘¨æœŸã€‚</p>
<h3>ä½¿ç”¨å¸¦æœ‰<code>useEffect</code>çš„<code>useState</code>æŒ‚é’©</h3>
<p>å¦ä¸€ä¸ªéœ€è¦ç†è§£çš„é‡è¦æ¦‚å¿µæ˜¯<code><a href="https://reactjs.org/docs/hooks-effect.html">useEffect</a></code>é’©å­ï¼Œæ‚¨å¾ˆå¯èƒ½å¿…é¡»åœ¨åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨å®ƒæ¥è°ƒç”¨å¼‚æ­¥ä»£ç (ä¾‹å¦‚ï¼Œè·å–æ•°æ®)ã€‚æ­£å¦‚ä½ åœ¨å‰é¢çš„å›¾ä¸­çœ‹åˆ°çš„ï¼Œ<code>useState</code>å’Œ<code>useEffect</code>é’©å­ç´§å¯†è€¦åˆï¼Œå› ä¸ºçŠ¶æ€å˜åŒ–å¯èƒ½ä¼šè°ƒç”¨æ•ˆæœã€‚</p>
<p>è®©æˆ‘ä»¬çœ‹çœ‹ä¸‹é¢çš„ä¾‹å­ã€‚æˆ‘ä»¬å¼•å…¥ä¸¤ä¸ªé¢å¤–çš„çŠ¶æ€å˜é‡:<code>loading</code>å’Œ<code>lang</code>ã€‚æ¯å½“<code>url</code>é“å…·æ”¹å˜æ—¶ï¼Œè¯¥æ•ˆæœå°±ä¼šè¢«è°ƒç”¨ã€‚å®ƒè·å–ä¸€ä¸ªè¯­è¨€å­—ç¬¦ä¸²(æˆ–è€…æ˜¯<code>en</code>æˆ–è€…æ˜¯<code>de</code>)å¹¶ç”¨<code>setLang</code> updater å‡½æ•°æ›´æ–°çŠ¶æ€ã€‚</p>
<p>æ ¹æ®è¯­è¨€çš„ä¸åŒï¼Œæ ‡é¢˜ä¸­ä¼šå‘ˆç°è‹±è¯­æˆ–å¾·è¯­å­—ç¬¦ä¸²ã€‚æ­¤å¤–ï¼Œåœ¨è·å–è¿‡ç¨‹ä¸­ï¼Œè®¾ç½®äº†ä¸€ä¸ª<code>loading</code>çŠ¶æ€ï¼Œå¹¶ä¸”æ ¹æ®è¯¥å€¼(<code>true</code>æˆ–<code>false</code>)ï¼Œå‘ˆç°ä¸€ä¸ªåŠ è½½æŒ‡ç¤ºç¬¦è€Œä¸æ˜¯æ ‡é¢˜ã€‚</p>
<pre>import { useEffect, useState } from "react";
import "./styles.css";
  function App4({ url }) {
  console.log("render App");
  const [loading, setLoading] = useState(true);
  const [lang, setLang] = useState("de");
  const [darkMode, setDarkMode] = useState(false);
  useEffect(() =&gt; {
    console.log("useEffect");
    const fetchData = async function () {
      try {
        setLoading(true);
        const response = await axios.get(url);
        if (response.status === 200) {
          const { language } = response.data;
          setLang(language);
        }
      } catch (error) {
        throw error;
      } finally {
        setLoading(false);
      }
    };
    fetchData();
  }, [url]);
  return (
    &lt;div className={`App ${darkMode &amp;&amp; "dark-mode"}`}&gt;
      {loading ? (
        &lt;div&gt;Loading...&lt;/div&gt;
      ) : (
        &lt;&gt;
          &lt;h1&gt;
            {lang === "en"
              ? "The useState hook is awesome"
              : "Der useState Hook ist toll"}
          &lt;/h1&gt;
          &lt;button
            onClick={() =&gt; {
              setDarkMode(!darkMode);
            }}
          &gt;
            toggle dark mode
          &lt;/button&gt;
        &lt;/&gt;
      )}
    &lt;/div&gt;
  );
}</pre>
<figure id="attachment_50036" aria-describedby="caption-attachment-50036" class="wp-caption aligncenter"><img data-attachment-id="50036" data-permalink="https://blog.logrocket.com/usestate-vs-useref/attachment/setting-state-useeffect/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/05/setting-state-useeffect.gif" data-orig-size="542,604" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Setting loading and lang state inside useEffect" data-image-description="" data-image-caption="&lt;p&gt;Setting loading and lang state inside useEffect.&lt;/p&gt;&#10;" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/05/setting-state-useeffect-269x300.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/05/setting-state-useeffect.gif" decoding="async" class="size-full wp-image-50036 jetpack-lazy-image" src="../Images/21e2c8f799aeb431652b3ecd859e1ea1.png" alt="Setting Loading and Lang State Inside useEffect" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2021/05/setting-state-useeffect.gif?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/05/setting-state-useeffect.gif"/><noscript><img data-lazy-fallback="1" data-attachment-id="50036" data-permalink="https://blog.logrocket.com/usestate-vs-useref/attachment/setting-state-useeffect/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/05/setting-state-useeffect.gif" data-orig-size="542,604" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Setting loading and lang state inside useEffect" data-image-description="" data-image-caption="&lt;p&gt;Setting loading and lang state inside useEffect.&lt;/p&gt;&#10;" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/05/setting-state-useeffect-269x300.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/05/setting-state-useeffect.gif" decoding="async" loading="lazy" class="size-full wp-image-50036" src="../Images/21e2c8f799aeb431652b3ecd859e1ea1.png" alt="Setting Loading and Lang State Inside useEffect" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/05/setting-state-useeffect.gif"/></noscript><figcaption id="caption-attachment-50036" class="wp-caption-text">Setting loading and lang state inside <code>useEffect</code>.</figcaption></figure>
<p>è®©æˆ‘ä»¬å‡è®¾æˆ‘ä»¬æƒ³åœ¨è·å–å½“å‰è¯­è¨€æ—¶åˆ‡æ¢é»‘æš—æ¨¡å¼ã€‚åœ¨æ›´æ–°äº†è¯­è¨€ä¹‹åï¼Œæˆ‘ä»¬æ·»åŠ äº†å¯¹<code>setDarkMode</code>æ›´æ–°å™¨çš„è°ƒç”¨ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬éœ€è¦å°†<code>darkMode</code>çŠ¶æ€ä½œä¸ºä¾èµ–é¡¹æ·»åŠ åˆ°æ•ˆæœçš„ä¾èµ–æ•°ç»„ä¸­ã€‚</p>
<blockquote><p>ä¸ºä»€ä¹ˆå¿…é¡»è¿™æ ·åšè¶…å‡ºäº†æœ¬æ–‡çš„èŒƒå›´ï¼Œä½†æ˜¯ä½ å¯ä»¥åœ¨æˆ‘ä¹‹å‰çš„æ–‡ç« ä¸­<a href="https://blog.logrocket.com/guide-to-react-useeffect-hook/">è¯¦ç»†é˜…è¯»<code>useEffect</code>é’©å­</a>ã€‚</p></blockquote>
<pre>import { useEffect, useState } from "react";
import "./styles.css";
function AppDemo5({ url }) {
  console.log("render App");
  const [loading, setLoading] = useState(true);
  const [lang, setLang] = useState("de");
  const [darkMode, setDarkMode] = useState(false);
  useEffect(() =&gt; {
    console.log("useEffect");
    const fetchData = async function () {
      try {
        setLoading(true);
        const response = await axios.get(url);
        if (response.status === 200) {
          const { language } = response.data;
          setLang(language);
          setDarkMode(!darkMode);
        }
      } catch (error) {
        throw error;
      } finally {
        setLoading(false);
      }
    };
    fetchData();
  }, [url, darkMode]);
  return (
    &lt;div className={`App ${darkMode &amp;&amp; "dark-mode"}`}&gt;
      {loading ? (
        &lt;div&gt;Loading...&lt;/div&gt;
      ) : (
        &lt;&gt;
          &lt;h1&gt;
            {lang === "en"
              ? "The useState hook is awesome"
              : "Der useState Hook ist toll"}
          &lt;/h1&gt;
          &lt;button
            onClick={() =&gt; {
              setDarkMode(!darkMode);
            }}
          &gt;
            toggle dark mode
          &lt;/button&gt;
        &lt;/&gt;
      )}
    &lt;/div&gt;
  );
}</pre>
<p>ä¸å¹¸çš„æ˜¯ï¼Œæˆ‘ä»¬é€ æˆäº†ä¸€ä¸ªæ— é™å¾ªç¯ã€‚</p>
<figure id="attachment_50090" aria-describedby="caption-attachment-50090" class="wp-caption aligncenter"><img data-attachment-id="50090" data-permalink="https://blog.logrocket.com/usestate-vs-useref/attachment/useeffect-render-infinite-loop/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/05/useeffect-render-infinite-loop.gif" data-orig-size="550,586" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Infinite loop of renders caused by useEffect" data-image-description="" data-image-caption="&lt;p&gt;Wrong usage of state in combination with useEffect causes an infinite loop.&lt;/p&gt;&#10;" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/05/useeffect-render-infinite-loop-282x300.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/05/useeffect-render-infinite-loop.gif" decoding="async" class="size-full wp-image-50090 jetpack-lazy-image" src="../Images/e7b9e8e1266fd8ba68a935fcaca6205a.png" alt="Incorrect Use of useEffect Causes an Infinite Loop of Renders" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2021/05/useeffect-render-infinite-loop.gif?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/05/useeffect-render-infinite-loop.gif"/><noscript><img data-lazy-fallback="1" data-attachment-id="50090" data-permalink="https://blog.logrocket.com/usestate-vs-useref/attachment/useeffect-render-infinite-loop/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/05/useeffect-render-infinite-loop.gif" data-orig-size="550,586" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Infinite loop of renders caused by useEffect" data-image-description="" data-image-caption="&lt;p&gt;Wrong usage of state in combination with useEffect causes an infinite loop.&lt;/p&gt;&#10;" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/05/useeffect-render-infinite-loop-282x300.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/05/useeffect-render-infinite-loop.gif" decoding="async" loading="lazy" class="size-full wp-image-50090" src="../Images/e7b9e8e1266fd8ba68a935fcaca6205a.png" alt="Incorrect Use of useEffect Causes an Infinite Loop of Renders" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/05/useeffect-render-infinite-loop.gif"/></noscript><figcaption id="caption-attachment-50090" class="wp-caption-text">Wrong usage of state in combination with <code>useEffect</code> causes an infinite loop.</figcaption></figure>
<p>è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿå› ä¸ºæˆ‘ä»¬å·²ç»å°†<code>darkMode</code>æ·»åŠ åˆ°æ•ˆæœçš„ä¾èµ–æ•°ç»„ä¸­ï¼Œå¹¶ä¸”æˆ‘ä»¬æ›´æ–°äº†æ•ˆæœå†…éƒ¨çš„ç¡®åˆ‡çŠ¶æ€ï¼Œæ‰€ä»¥æ•ˆæœå†æ¬¡è¢«è°ƒç”¨ï¼Œå†æ¬¡æ›´æ–°çŠ¶æ€ï¼Œå¦‚æ­¤å¾ªç¯å¾€å¤ã€‚</p>
<p>ä½†æ˜¯æœ‰ä¸€æ¡å‡ºè·¯ï¼æˆ‘ä»¬å¯ä»¥é€šè¿‡<a href="https://reactjs.org/docs/hooks-reference.html#functional-updates">ä»å…ˆå‰çš„çŠ¶æ€</a>è®¡ç®—æ–°çš„çŠ¶æ€æ¥é¿å…<code>darkMode</code>æˆä¸ºæ•ˆæœçš„ä¾èµ–ã€‚æˆ‘ä»¬é€šè¿‡ä¼ é€’ä¸€ä¸ªå…·æœ‰å…ˆå‰çŠ¶æ€çš„å‡½æ•°ä½œä¸ºå‚æ•°æ¥è°ƒç”¨<code>setDarkMode</code>æ›´æ–°å™¨ã€‚</p>
<p>ä¿®æ”¹åçš„<code>useEffect</code>å®ç°å¦‚ä¸‹æ‰€ç¤º:</p>
<pre>  useEffect(() =&gt; {
    console.log("useEffect");
    const fetchData = async function () {
      try {
        setLoading(true);
        const response = await axios.get(url);
        if (response.status === 200) {
          const { language } = response.data;
          setLang(language);
          setDarkMode((previous) =&gt; !previous); // no access of darkMode state
        }
      } catch (error) {
        throw error;
      } finally {
        setLoading(false);
      }
    };
    fetchData();
  }, [url]); // no darkMode dependency</pre>
<h3>ä¸åŸºäºç±»çš„ç»„ä»¶çš„åŒºåˆ«</h3>
<p>å¦‚æœæ‚¨å·²ç»ä½¿ç”¨ React å¾ˆé•¿æ—¶é—´äº†ï¼Œæˆ–è€…æ‚¨ç›®å‰æ­£åœ¨å¤„ç†é—ç•™ä»£ç ï¼Œé‚£ä¹ˆæ‚¨åº”è¯¥çŸ¥é“åŸºäºç±»çš„ç»„ä»¶ã€‚å¯¹äºåŸºäºç±»çš„ç»„ä»¶ï¼Œåªæœ‰ä¸€ä¸ªå¯¹è±¡è¡¨ç¤ºç»„ä»¶çŠ¶æ€ã€‚ä¸ºäº†æ›´æ–°æ•´ä½“çŠ¶æ€çš„ä¸€éƒ¨åˆ†ï¼Œæ‚¨å¯ä»¥åˆ©ç”¨é€šç”¨çš„<code>[setState](<a href="https://reactjs.org/docs/state-and-lifecycle.html" rel="nofollow">https://reactjs.org/docs/state-and-lifecycle.html</a>)</code>æ–¹æ³•ã€‚</p>
<p>å‡è®¾æˆ‘ä»¬åªæƒ³æ›´æ–°<code>darkMode</code>çŠ¶æ€å˜é‡ã€‚ç„¶åï¼Œæ‚¨å¯ä»¥å°†æ›´æ–°çš„å±æ€§æ”¾å…¥å¯¹è±¡ä¸­ï¼›è¯¥å·çš„å…¶ä»–åœ°æ–¹ä¸å—å½±å“ã€‚</p>
<pre>this.setState({darkMode: false});</pre>
<p>ç„¶è€Œï¼Œå¯¹äºåŠŸèƒ½ç»„ä»¶ï¼Œé¦–é€‰æ–¹å¼æ˜¯ä½¿ç”¨å¯ä»¥å•ç‹¬æ›´æ–°çš„åŸå­çŠ¶æ€å˜é‡ã€‚å¦åˆ™ï¼Œä½ å¯ä»¥å¾ˆå¿«å‘ç°è‡ªå·±åœ¨æ³ªä¹‹è°·ã€‚</p>
<p>ä¸<code>AppDemo6</code>ç›¸æ¯”ï¼Œä»¥ä¸‹ç»„ä»¶(<code>AppDemo7</code>)ä»…åœ¨çŠ¶æ€ç®¡ç†æ–¹é¢è¿›è¡Œäº†é‡æ„ã€‚æˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªçŠ¶æ€å¯¹è±¡(<code>state</code>)ï¼Œè€Œä¸æ˜¯ä¸‰ä¸ªåŸå§‹æ•°æ®ç±»å‹çš„åŸå­çŠ¶æ€å˜é‡ã€‚</p>
<pre>import { useEffect, useState } from "react";
import "./styles.css";
function AppDemo7({ url }) {
  const initialState = {
    loading: true,
    lang: "de",
    darkMode: true
  };
  const [state, setState] = useState(initialState);
  console.log("render App", state);
  useEffect(() =&gt; {
    console.log("useEffect");
    const fetchData = async function () {
      try {
        setState((prev) =&gt; ({
          loading: true,
          lang: prev.lang,
          darkMode: prev.darkMode
        }));
        const response = await axios.get(url);
        if (response.status === 200) {
          const { language } = response.data;
          setState((prev) =&gt; ({
            lang: language,
            darkMode: !prev.darkMode,
            loading: prev.loading
          }));
        }
      } catch (error) {
        throw error;
      } finally {
        setState((prev) =&gt; ({
          loading: false,
          lang: prev.lang,
          darkMode: prev.darkMode
        }));
      }
    };
    fetchData();
  }, [url]);
  return (
    &lt;div className={`App ${state.darkMode &amp;&amp; "dark-mode"}`}&gt;
      {state.loading ? (
        &lt;div&gt;Loading...&lt;/div&gt;
      ) : (
        &lt;&gt;
          &lt;h1&gt;
            {state.lang === "en"
              ? "The useState hook is awesome"
              : "Der useState Hook ist toll"}
          &lt;/h1&gt;
          &lt;button
            onClick={() =&gt; {
              setState((prev) =&gt; ({
                darkMode: !prev.darkMode,
                // lang: prev.lang,
                loading: prev.loading
              }));
            }}
          &gt;
            toggle dark mode
          &lt;/button&gt;
        &lt;/&gt;
      )}
    &lt;/div&gt;
  );
}</pre>
<p>å¦‚ä½ æ‰€è§ï¼Œä»£ç å¾ˆä¹±ï¼Œå¾ˆéš¾ç»´æŠ¤ã€‚å®ƒè¿˜åŒ…æ‹¬ä¸€ä¸ª bugï¼Œç”¨<code>onClick</code>å¤„ç†ç¨‹åºä¸­çš„æ³¨é‡Šæ‰çš„å±æ€§æ¥è¯´æ˜ã€‚å½“ç”¨æˆ·å•å‡»æŒ‰é’®æ—¶ï¼Œæ•´ä½“çŠ¶æ€è®¡ç®—ä¸æ­£ç¡®ã€‚</p>
<p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ<code>lang</code>å±æ€§ä¸å­˜åœ¨ã€‚è¿™å¯¼è‡´äº†ä¸€ä¸ªé”™è¯¯ï¼Œå¯¼è‡´æ–‡æœ¬ä»¥å¾·è¯­å‘ˆç°ï¼Œå› ä¸º<code>state.lang</code>æ˜¯<code>undefined</code>ã€‚æˆ‘å¸Œæœ›æˆ‘å·²ç»æ˜ç¡®è¡¨æ˜è¿™æ˜¯ä¸€ä¸ªåä¸»æ„ã€‚é¡ºä¾¿è¯´ä¸€ä¸‹ï¼Œ<a href="https://reactjs.org/docs/hooks-faq.html#should-i-use-one-or-many-state-variables"> React å›¢é˜Ÿä¹Ÿä¸å»ºè®®</a>ã€‚</p>
<h2>ç†è§£<code>useRef</code>æŒ‚é’©</h2>
<p><code><a href="https://reactjs.org/docs/hooks-reference.html#useref">useRef</a></code>æŒ‚é’©ä¸<code>useState</code>ç›¸ä¼¼ï¼Œä½†æœ‰æ‰€ä¸åŒğŸ˜€ã€‚åœ¨æˆ‘æ¾„æ¸…ä¹‹å‰ï¼Œæˆ‘å…ˆè§£é‡Šä¸€ä¸‹å®ƒçš„åŸºæœ¬ç”¨æ³•ã€‚</p>
<pre>import { useRef } from 'react';
const AppDemo8 = () =&gt; {
  const ref1 = useRef();
  const ref2 = useRef(2021);
  console.log("render");
  console.log(ref1, ref2);
  return (
    &lt;div&gt;
      &lt;h2&gt;{ref1.current}&lt;/h2&gt;
      &lt;h2&gt;{ref2.current}&lt;/h2&gt;
    &lt;/div&gt;
  );
};</pre>
<p>ç»“æœå¹¶ä¸å¼•äººæ³¨ç›®ï¼Œä½†å´æ­ç¤ºäº†ç—‡ç»“æ‰€åœ¨ã€‚</p>
<figure id="attachment_50094" aria-describedby="caption-attachment-50094" class="wp-caption aligncenter"><img data-attachment-id="50094" data-permalink="https://blog.logrocket.com/usestate-vs-useref/attachment/values-stored-current-property/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/05/values-stored-current-property.png" data-orig-size="730,181" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Values stored in the current property" data-image-description="" data-image-caption="&lt;p&gt;The values are stored in the current property.&lt;/p&gt;&#10;" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/05/values-stored-current-property-300x74.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/05/values-stored-current-property.png" decoding="async" class="size-full wp-image-50094 jetpack-lazy-image" src="../Images/9e3731c53cd1a2693f8c162523ed525c.png" alt="useRef Values Are Stored in the Current Property" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2021/05/values-stored-current-property.png 730w, https://blog.logrocket.com/wp-content/uploads/2021/05/values-stored-current-property-300x74.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2021/05/values-stored-current-property.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/05/values-stored-current-property.png"/><noscript><img data-lazy-fallback="1" data-attachment-id="50094" data-permalink="https://blog.logrocket.com/usestate-vs-useref/attachment/values-stored-current-property/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/05/values-stored-current-property.png" data-orig-size="730,181" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Values stored in the current property" data-image-description="" data-image-caption="&lt;p&gt;The values are stored in the current property.&lt;/p&gt;&#10;" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/05/values-stored-current-property-300x74.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/05/values-stored-current-property.png" decoding="async" loading="lazy" class="size-full wp-image-50094" src="../Images/9e3731c53cd1a2693f8c162523ed525c.png" alt="useRef Values Are Stored in the Current Property" srcset="https://blog.logrocket.com/wp-content/uploads/2021/05/values-stored-current-property.png 730w, https://blog.logrocket.com/wp-content/uploads/2021/05/values-stored-current-property-300x74.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/05/values-stored-current-property.png"/></noscript><figcaption id="caption-attachment-50094" class="wp-caption-text">The values are stored in the <code>current</code> property.</figcaption></figure>
<p>æˆ‘ä»¬é€šè¿‡è°ƒç”¨ã€‚é’©å­è°ƒç”¨è¿”å›ä¸€ä¸ªå…·æœ‰å±æ€§<code>current</code>çš„å¯¹è±¡ï¼Œè¯¥å±æ€§å­˜å‚¨å®é™…å€¼ã€‚å¦‚æœæ‚¨å°†ä¸€ä¸ªå‚æ•°<code>initialValue</code>ä¼ é€’ç»™<code>useRef(initialValue)</code>ï¼Œé‚£ä¹ˆè¿™ä¸ªå€¼å°†å­˜å‚¨åœ¨<code>current</code>ä¸­ã€‚</p>
<p>è¿™å°±æ˜¯ç¬¬ä¸€ä¸ª<code>console.log</code>è¾“å‡ºå­˜å‚¨<code>undefined</code>çš„åŸå› :å› ä¸ºæˆ‘ä»¬åœ¨æ²¡æœ‰ä»»ä½•å‚æ•°çš„æƒ…å†µä¸‹è°ƒç”¨äº†é’©å­ã€‚åˆ«æ‹…å¿ƒï¼Œæˆ‘ä»¬å¯ä»¥ç¨åèµ‹å€¼ã€‚</p>
<p>è¦è®¿é—® ref çš„å€¼ï¼Œæ‚¨éœ€è¦è®¿é—®å®ƒçš„<code>current</code>å±æ€§ï¼Œå°±åƒæˆ‘ä»¬åœ¨ JSX éƒ¨åˆ†æ‰€åšçš„é‚£æ ·ã€‚å®šä¹‰å¼•ç”¨åï¼Œå®ƒä»¬åœ¨åˆå§‹æ¸²æŸ“ä¸­ç›´æ¥å¯ç”¨ã€‚</p>
<p>ä½†æ˜¯æˆ‘ä»¬åˆ°åº•ä¸ºä»€ä¹ˆéœ€è¦<code>useRef</code>ï¼Ÿä¸ºä»€ä¹ˆä¸ç”¨æ™®é€šçš„<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/let">å˜é‡<code>let</code>ä»£æ›¿</a>ï¼Ÿåˆ«æ€¥â€”â€”æˆ‘ä»¬å›å¤´å†è°ˆé‚£ä¸ªã€‚</p>
<h3><code>useRef</code>çš„å¸¸è§ç”¨ä¾‹</h3>
<p>è®©æˆ‘ä»¬çœ‹çœ‹ä¸‹é¢çš„ä¾‹å­ã€‚</p>
<pre>import { useRef } from "react";
import "./styles.css";
const AppDemo9 = () =&gt; {
  const countRef = useRef(0);
  console.log("render");
  return (
    &lt;div className="App"&gt;
      &lt;h2&gt;count: {countRef.current}&lt;/h2&gt;
      &lt;button
        onClick={() =&gt; {
          countRef.current = countRef.current + 1;
          console.log(countRef.current);
        }}
      &gt;
        increase count
      &lt;/button&gt;
    &lt;/div&gt;
  );
};</pre>
<p>æˆ‘ä»¬çš„ç›®æ ‡æ˜¯å®šä¹‰ä¸€ä¸ªåä¸º<code>countRef</code>çš„ refï¼Œç”¨<code>0</code>åˆå§‹åŒ–è¿™ä¸ªå€¼ï¼Œå¹¶åœ¨æ¯æ¬¡ç‚¹å‡»æŒ‰é’®æ—¶å¢åŠ è¿™ä¸ªè®¡æ•°å™¨å˜é‡ã€‚æ¸²æŸ“çš„è®¡æ•°å€¼åº”è¯¥æ›´æ–°ã€‚ä¸å¹¸çš„æ˜¯ï¼Œå®ƒä¸èµ·ä½œç”¨â€”â€”ç”šè‡³æ§åˆ¶å°è¾“å‡ºä¹Ÿè¯æ˜äº†<code>current</code>å±æ€§ä¿å­˜äº†æ­£ç¡®çš„æ›´æ–°ã€‚</p>
<figure id="attachment_50097" aria-describedby="caption-attachment-50097" class="wp-caption aligncenter"><img data-attachment-id="50097" data-permalink="https://blog.logrocket.com/usestate-vs-useref/attachment/count-no-update-click/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/05/count-no-update-click.gif" data-orig-size="582,376" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Count doesnâ€™t update on button click" data-image-description="" data-image-caption="&lt;p&gt;Count does not update on button click.&lt;/p&gt;&#10;" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/05/count-no-update-click-300x194.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/05/count-no-update-click.gif" decoding="async" class="size-full wp-image-50097 jetpack-lazy-image" src="../Images/7710aa9812f6426fbf210b91faab1759.png" alt="Count Doesn't Update on Button Click" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2021/05/count-no-update-click.gif?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/05/count-no-update-click.gif"/><noscript><img data-lazy-fallback="1" data-attachment-id="50097" data-permalink="https://blog.logrocket.com/usestate-vs-useref/attachment/count-no-update-click/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/05/count-no-update-click.gif" data-orig-size="582,376" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Count doesnâ€™t update on button click" data-image-description="" data-image-caption="&lt;p&gt;Count does not update on button click.&lt;/p&gt;&#10;" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/05/count-no-update-click-300x194.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/05/count-no-update-click.gif" decoding="async" loading="lazy" class="size-full wp-image-50097" src="../Images/7710aa9812f6426fbf210b91faab1759.png" alt="Count Doesn't Update on Button Click" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/05/count-no-update-click.gif"/></noscript><figcaption id="caption-attachment-50097" class="wp-caption-text">Count does not update on button click.</figcaption></figure>
<p>æ­£å¦‚æ‚¨ä»æˆ‘ä»¬çš„å¦ä¸€ä¸ªæ§åˆ¶å°è¾“å‡ºå‘ˆç°ä¸­çœ‹åˆ°çš„ï¼Œæˆ‘ä»¬çš„ç»„ä»¶æ²¡æœ‰é‡æ–°å‘ˆç°ã€‚æˆ‘ä»¬å¯ä»¥åˆ©ç”¨<code>useState</code>æ¥ä»£æ›¿è¿™ç§è¡Œä¸ºã€‚</p>
<p>ä»€ä¹ˆï¼Ÿæ‰€ä»¥<code>useRef</code>æŒºæ²¡ç”¨çš„ï¼Ÿæ²¡é‚£ä¹ˆå¿«â€”â€”å’Œå…¶ä»–è§¦å‘é‡æ¸²æŸ“çš„é’©å­ç»“åˆä½¿ç”¨å¾ˆæ–¹ä¾¿ï¼Œæ¯”å¦‚<code>useState</code>ã€<code><a href="https://reactjs.org/docs/hooks-reference.html#usereducer">useReducer</a></code>å’Œ<code><a href="https://reactjs.org/docs/hooks-reference.html#usecontext">useContext</a></code>ã€‚</p>
<p>ä½ å¾—æŠŠ<code>useRef</code>å½“æˆä½ å·¥å…·ç®±é‡Œçš„å¦ä¸€ä¸ªå·¥å…·ï¼Œä½ å¾—æ˜ç™½ä»€ä¹ˆæ—¶å€™ç”¨å®ƒã€‚è¿˜è®°å¾—ä¸Šé¢çš„ç»„ä»¶ç”Ÿå‘½å‘¨æœŸå›¾å—ï¼Ÿrefs çš„å€¼(ç‰¹åˆ«æ˜¯<code>current</code>å±æ€§)åœ¨æ•´ä¸ªæ¸²æŸ“å‘¨æœŸä¸­ä¿æŒä¸å˜ã€‚è¿™ä¸æ˜¯ä¸€ä¸ªé”™è¯¯ï¼›è¿™æ˜¯ä¸€ä¸ªç‰¹ç‚¹ã€‚</p>
<p>è€ƒè™‘è¿™æ ·çš„æƒ…å†µï¼Œæ‚¨æƒ³è¦æ›´æ–°ç»„ä»¶çš„æ•°æ®(å³ï¼Œå®ƒçš„çŠ¶æ€å˜é‡)æ¥è§¦å‘å‘ˆç°ï¼Œä»¥ä¾¿æ›´æ–° UIã€‚æ‚¨ä¹Ÿå¯èƒ½éœ€è¦ç›¸åŒçš„è¡Œä¸ºï¼Œä½†æœ‰ä¸€ä¸ªä¾‹å¤–:æ‚¨ä¸å¸Œæœ›è§¦å‘æ¸²æŸ“å¾ªç¯ï¼Œå› ä¸ºè¿™å¯èƒ½ä¼šå¯¼è‡´é”™è¯¯ã€å°´å°¬çš„ç”¨æˆ·ä½“éªŒ(ä¾‹å¦‚ï¼Œé—ªçƒ)æˆ–æ€§èƒ½é—®é¢˜ã€‚</p>
<p>ä½ å¯ä»¥æŠŠ refs æƒ³è±¡æˆåŸºäºç±»çš„ç»„ä»¶çš„<a href="https://reactjs.org/docs/hooks-faq.html#is-there-something-like-instance-variables">å®ä¾‹å˜é‡ã€‚ref æ˜¯ä¸€ä¸ªé€šç”¨å®¹å™¨ï¼Œç”¨äºå­˜å‚¨ä»»ä½•ç±»å‹çš„æ•°æ®ï¼Œå¦‚åŸå§‹æ•°æ®æˆ–å¯¹è±¡ã€‚</a></p>
<p>å¥½å§ï¼Œæˆ‘ä»¬å°†å±•ç¤ºä¸€ä¸ªæœ‰ç”¨çš„ä¾‹å­ã€‚</p>
<pre>import { useState } from "react";
import "./styles.css";
const AppDemo10 = () =&gt; {
  const [value, setValue] = useState("");
  console.log("render");
  const handleInputChange = (e) =&gt; {
    setValue(e.target.value);
  };
  return (
    &lt;div className="App"&gt;
      &lt;input value={value} onChange={handleInputChange} /&gt;
    &lt;/div&gt;
  );
};</pre>
<p>ä»ä¸‹é¢çš„è®°å½•ä¸­å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ªç»„ä»¶åªæ˜¯å‘ˆç°ä¸€ä¸ªè¾“å…¥å­—æ®µï¼Œå¹¶å°†å…¶å€¼å­˜å‚¨åœ¨<code>value</code>çŠ¶æ€å˜é‡ä¸­ã€‚æ§åˆ¶å°è¾“å‡ºæ˜¾ç¤ºï¼Œæ¯æ¬¡å‡»é”®æ—¶éƒ½ä¼šé‡æ–°å‘ˆç°<code>AppDemo10</code>ç»„ä»¶ã€‚</p>
<p>è¿™å¯èƒ½æ˜¯æ‚¨æƒ³è¦çš„è¡Œä¸ºï¼Œä¾‹å¦‚ï¼Œå¯¹æ¯ä¸ªå­—ç¬¦æ‰§è¡Œæœç´¢ç­‰æ“ä½œã€‚è¿™è¢«ç§°ä¸º<a href="https://reactjs.org/docs/uncontrolled-components.html">å—æ§ç»„ä»¶</a>ã€‚ç„¶è€Œï¼Œå®ƒå¯èƒ½æ­£å¥½ç›¸åï¼Œå¹¶ä¸”æ¸²æŸ“å˜å¾—æœ‰é—®é¢˜ã€‚ç„¶åä½ éœ€è¦ä¸€ä¸ª<a href="https://reactjs.org/docs/uncontrolled-components.html">ä¸å—æ§ç»„ä»¶</a>ã€‚</p>
<figure id="attachment_50098" aria-describedby="caption-attachment-50098" class="wp-caption aligncenter"><img data-attachment-id="50098" data-permalink="https://blog.logrocket.com/usestate-vs-useref/attachment/controlled-component-renders-every-keystroke/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/05/controlled-component-renders-every-keystroke.gif" data-orig-size="612,376" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Controlled component rendering on every keystroke" data-image-description="" data-image-caption="&lt;p&gt;A controlled component renders on every keystroke.&lt;/p&gt;&#10;" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/05/controlled-component-renders-every-keystroke-300x184.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/05/controlled-component-renders-every-keystroke.gif" decoding="async" class="size-full wp-image-50098 jetpack-lazy-image" src="../Images/d557aa7b965c4e057a255dfbd9cfef9a.png" alt="A Controlled Component Rendering on Every Keystroke" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2021/05/controlled-component-renders-every-keystroke.gif?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/05/controlled-component-renders-every-keystroke.gif"/><noscript><img data-lazy-fallback="1" data-attachment-id="50098" data-permalink="https://blog.logrocket.com/usestate-vs-useref/attachment/controlled-component-renders-every-keystroke/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/05/controlled-component-renders-every-keystroke.gif" data-orig-size="612,376" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Controlled component rendering on every keystroke" data-image-description="" data-image-caption="&lt;p&gt;A controlled component renders on every keystroke.&lt;/p&gt;&#10;" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/05/controlled-component-renders-every-keystroke-300x184.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/05/controlled-component-renders-every-keystroke.gif" decoding="async" loading="lazy" class="size-full wp-image-50098" src="../Images/d557aa7b965c4e057a255dfbd9cfef9a.png" alt="A Controlled Component Rendering on Every Keystroke" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/05/controlled-component-renders-every-keystroke.gif"/></noscript><figcaption id="caption-attachment-50098" class="wp-caption-text">A controlled component renders on every keystroke.</figcaption></figure>
<p>è®©æˆ‘ä»¬é‡å†™è¿™ä¸ªä¾‹å­ï¼Œä½¿ç”¨ä¸€ä¸ªå¸¦æœ‰<code>useRef</code>çš„ä¸å—æ§åˆ¶çš„ç»„ä»¶ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªæŒ‰é’®æ¥æ›´æ–°ç»„ä»¶çš„çŠ¶æ€å¹¶å­˜å‚¨å®Œå…¨å¡«å……çš„è¾“å…¥å­—æ®µã€‚</p>
<pre>import { useState, useRef } from "react";
import "./styles.css";
const AppDemo11 = () =&gt; {
  const [value, setValue] = useState("");
  const valueRef = useRef();
  console.log("render");
  const handleClick = () =&gt; {
    console.log(valueRef);
    setValue(valueRef.current.value);
  };
  return (
    &lt;div className="App"&gt;
      &lt;h4&gt;Value: {value}&lt;/h4&gt;
      &lt;input ref={valueRef} /&gt;
      &lt;button onClick={handleClick}&gt;click&lt;/button&gt;
    &lt;/div&gt;
  );
};</pre>
<p>ä½¿ç”¨è¿™ç§è§£å†³æ–¹æ¡ˆï¼Œæˆ‘ä»¬ä¸ä¼šåœ¨æ¯æ¬¡å‡»é”®æ—¶å¯¼è‡´æ¸²æŸ“å¾ªç¯ã€‚å¦ä¸€æ–¹é¢ï¼Œæˆ‘ä»¬éœ€è¦ç”¨ä¸€ä¸ªæŒ‰é’®â€œæäº¤â€è¾“å…¥æ¥æ›´æ–°çŠ¶æ€å˜é‡<code>value</code>ã€‚ä»æ§åˆ¶å°è¾“å‡ºå¯ä»¥çœ‹å‡ºï¼Œç¬¬äºŒæ¬¡æ¸²æŸ“é¦–å…ˆå‘ç”Ÿåœ¨å•å‡»æŒ‰é’®æ—¶ã€‚</p>
<figure id="attachment_50114" aria-describedby="caption-attachment-50114" class="wp-caption aligncenter"><img data-attachment-id="50114" data-permalink="https://blog.logrocket.com/usestate-vs-useref/attachment/uncontrolled-component-no-re-renders/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/05/uncontrolled-component-no-re-renders.gif" data-orig-size="612,376" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Uncontrolled components donâ€™t trigger re-renders" data-image-description="" data-image-caption="&lt;p&gt;An uncontrolled component does not trigger re-renders on change.&lt;/p&gt;&#10;" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/05/uncontrolled-component-no-re-renders-300x184.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/05/uncontrolled-component-no-re-renders.gif" decoding="async" class="size-full wp-image-50114 jetpack-lazy-image" src="../Images/d6a309909348bd9cfe4bb25d025170a0.png" alt="An Uncontrolled Component Does Not Trigger a Re-render" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2021/05/uncontrolled-component-no-re-renders.gif?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/05/uncontrolled-component-no-re-renders.gif"/><noscript><img data-lazy-fallback="1" data-attachment-id="50114" data-permalink="https://blog.logrocket.com/usestate-vs-useref/attachment/uncontrolled-component-no-re-renders/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/05/uncontrolled-component-no-re-renders.gif" data-orig-size="612,376" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Uncontrolled components donâ€™t trigger re-renders" data-image-description="" data-image-caption="&lt;p&gt;An uncontrolled component does not trigger re-renders on change.&lt;/p&gt;&#10;" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/05/uncontrolled-component-no-re-renders-300x184.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/05/uncontrolled-component-no-re-renders.gif" decoding="async" loading="lazy" class="size-full wp-image-50114" src="../Images/d6a309909348bd9cfe4bb25d025170a0.png" alt="An Uncontrolled Component Does Not Trigger a Re-render" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/05/uncontrolled-component-no-re-renders.gif"/></noscript><figcaption id="caption-attachment-50114" class="wp-caption-text">An uncontrolled component does not trigger re-renders on change.</figcaption></figure>
<p>é¡ºä¾¿è¯´ä¸€ä¸‹ï¼Œä¸Šé¢çš„ä¾‹å­å±•ç¤ºäº† refs çš„ç¬¬äºŒä¸ªç”¨ä¾‹ã€‚</p>
<pre>&lt;input ref={valueRef} /&gt;</pre>
<p>é€šè¿‡<code>ref</code>å±æ€§ï¼ŒReact æä¾›äº†å¯¹ React ç»„ä»¶æˆ– HTML å…ƒç´ çš„ç›´æ¥è®¿é—®ã€‚æ§åˆ¶å°è¾“å‡ºæ˜¾ç¤ºæˆ‘ä»¬ç¡®å®å¯ä»¥è®¿é—®<code>input</code>å…ƒç´ ã€‚å¼•ç”¨å­˜å‚¨åœ¨<code>current</code>å±æ€§ä¸­ã€‚</p>
<p>è¿™æ„æˆäº†<code>useRef</code>çš„ç¬¬äºŒä¸ªç”¨ä¾‹ï¼Œé™¤äº†å°†å®ƒä½œä¸ºä¸€ä¸ªé€šç”¨å®¹å™¨åœ¨æ•´ä¸ªç»„ä»¶ç”Ÿå‘½å‘¨æœŸä¸­ä¿å­˜æ•°æ®ã€‚å¦‚æœéœ€è¦ç›´æ¥è®¿é—® DOM å…ƒç´ ï¼Œå¯ä»¥åˆ©ç”¨<code>ref</code> propã€‚ä¸‹ä¸€ä¸ªç¤ºä¾‹æ˜¾ç¤ºäº†å¦‚ä½•åœ¨ç»„ä»¶åˆå§‹åŒ–åèšç„¦è¾“å…¥å­—æ®µã€‚</p>
<pre>import { useEffect, useRef } from "react";
import "./styles.css";
const AppDemo12 = () =&gt; {
  const inputRef = useRef();
  console.log("render");
  useEffect(() =&gt; {
    console.log("useEffect");
    inputRef.current.focus();
  }, []);
  return (
    &lt;div className="App"&gt;
      &lt;input ref={inputRef} placeholder="input" /&gt;
    &lt;/div&gt;
  );
};</pre>
<p>åœ¨<code>useEffect</code>å›è°ƒä¸­ï¼Œæˆ‘ä»¬è°ƒç”¨æœ¬æœº<code><a href="https://developer.mozilla.org/en-US/docs/Web/API/HTMLOrForeignElement/focus">focus</a></code>æ–¹æ³•ã€‚</p>
<figure id="attachment_50101" aria-describedby="caption-attachment-50101" class="wp-caption aligncenter"><img data-attachment-id="50101" data-permalink="https://blog.logrocket.com/usestate-vs-useref/attachment/focus-input-field/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/05/focus-input-field.gif" data-orig-size="612,374" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Adding focus to an input field" data-image-description="" data-image-caption="&lt;p&gt;Focus an input field with the help of a ref.&lt;/p&gt;&#10;" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/05/focus-input-field-300x183.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/05/focus-input-field.gif" decoding="async" class="size-full wp-image-50101 jetpack-lazy-image" src="../Images/27550bec028f1ff43509195a647126e3.png" alt="Adding Focus to an Input Field Via refs" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2021/05/focus-input-field.gif?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/05/focus-input-field.gif"/><noscript><img data-lazy-fallback="1" data-attachment-id="50101" data-permalink="https://blog.logrocket.com/usestate-vs-useref/attachment/focus-input-field/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/05/focus-input-field.gif" data-orig-size="612,374" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Adding focus to an input field" data-image-description="" data-image-caption="&lt;p&gt;Focus an input field with the help of a ref.&lt;/p&gt;&#10;" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/05/focus-input-field-300x183.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/05/focus-input-field.gif" decoding="async" loading="lazy" class="size-full wp-image-50101" src="../Images/27550bec028f1ff43509195a647126e3.png" alt="Adding Focus to an Input Field Via refs" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/05/focus-input-field.gif"/></noscript><figcaption id="caption-attachment-50101" class="wp-caption-text">Focus an input field with the help of a ref.</figcaption></figure>
<p>å½“æ‚¨éœ€è¦ç›´æ¥è®¿é—® DOM å…ƒç´ æ—¶ï¼Œè¿™ç§æŠ€æœ¯ä¹Ÿå¹¿æ³›ç”¨äºä¸ç¬¬ä¸‰æ–¹(é React)ç»„ä»¶ç»“åˆçš„ React é¡¹ç›®ä¸­ã€‚</p>
<p>å¦ä¸€ä¸ªå¸¸è§çš„ç”¨ä¾‹æ˜¯å½“æ‚¨éœ€è¦å‰ä¸€ä¸ªæ¸²æŸ“å‘¨æœŸçš„çŠ¶æ€å€¼æ—¶ã€‚ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†å¦‚ä½•åšåˆ°è¿™ä¸€ç‚¹ã€‚å½“ç„¶ï¼Œæ‚¨ä¹Ÿå¯ä»¥å°†é€»è¾‘æå–åˆ°ä¸€ä¸ªå®šåˆ¶çš„<code><a href="https://usehooks.com/usePrevious/">usePrevious</a></code>é’©å­ä¸­ã€‚</p>
<pre>import { useEffect, useState, useRef } from "react";
import "./styles.css";
const AppDemo13 = () =&gt; {
  console.log("render");
  const [count, setCount] = useState(0);
  // Get the previous value (was passed into hook on last render)
  const ref = useRef();
  // Store current value in ref
  useEffect(() =&gt; {
    console.log("useEffect");
    ref.current = count;
  }, [count]); // Only re-run if value changes
  return (
    &lt;div className="App"&gt;
      &lt;h1&gt;
        Now: {count}, before: {ref.current}
      &lt;/h1&gt;
      &lt;button onClick={() =&gt; setCount(count + 1)}&gt;Increment&lt;/button&gt;
    &lt;/div&gt;
  );
};</pre>
<p>åœ¨åˆå§‹æ¸²æŸ“ä¹‹åï¼Œæ‰§è¡Œä¸€ä¸ªæ•ˆæœï¼Œå°†çŠ¶æ€å˜é‡<code>count</code>åˆ†é…ç»™<code>ref.current</code>ã€‚å› ä¸ºæ²¡æœ‰é¢å¤–çš„æ¸²æŸ“å‘ç”Ÿï¼Œæ‰€ä»¥æ¸²æŸ“å€¼æ˜¯<code>undefined</code>ã€‚ç‚¹å‡»æŒ‰é’®è§¦å‘çŠ¶æ€æ›´æ–°ï¼Œå› ä¸ºè°ƒç”¨äº†<code>setCount</code>ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼ŒUI è¢«é‡æ–°å‘ˆç°ï¼Œæ ‡ç­¾å‰çš„<strong>æ˜¾ç¤ºæ­£ç¡®çš„å€¼(<code>0</code>)ã€‚æ¸²æŸ“åï¼Œè°ƒç”¨å¦ä¸€ä¸ªæ•ˆæœã€‚ç°åœ¨<code>1</code>è¢«åˆ†é…ç»™æˆ‘ä»¬çš„ refï¼Œä»¥æ­¤ç±»æ¨ã€‚</strong></p>
<figure id="attachment_50116" aria-describedby="caption-attachment-50116" class="wp-caption aligncenter"><img data-attachment-id="50116" data-permalink="https://blog.logrocket.com/usestate-vs-useref/attachment/access-previous-state-useref/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/05/access-previous-state-useref.gif" data-orig-size="612,374" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Accessing previous state via useRef" data-image-description="&lt;p&gt;Access previous state with the help of useRef.&lt;/p&gt;&#10;" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/05/access-previous-state-useref-300x183.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/05/access-previous-state-useref.gif" decoding="async" class="wp-image-50116 size-full jetpack-lazy-image" src="../Images/3513339db32e37846466256401d295e2.png" alt="Accessing Previous State Via useRef" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2021/05/access-previous-state-useref.gif?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/05/access-previous-state-useref.gif"/><noscript><img data-lazy-fallback="1" data-attachment-id="50116" data-permalink="https://blog.logrocket.com/usestate-vs-useref/attachment/access-previous-state-useref/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/05/access-previous-state-useref.gif" data-orig-size="612,374" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Accessing previous state via useRef" data-image-description="&lt;p&gt;Access previous state with the help of useRef.&lt;/p&gt;&#10;" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/05/access-previous-state-useref-300x183.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/05/access-previous-state-useref.gif" decoding="async" loading="lazy" class="wp-image-50116 size-full" src="../Images/3513339db32e37846466256401d295e2.png" alt="Accessing Previous State Via useRef" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/05/access-previous-state-useref.gif"/></noscript><figcaption id="caption-attachment-50116" class="wp-caption-text">Access previous state with the help of <code>useRef</code>.</figcaption></figure>
<p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œæ‰€æœ‰çš„å¼•ç”¨éƒ½éœ€è¦åœ¨<code>useEffect</code>å›è°ƒæˆ–å¤„ç†ç¨‹åºä¸­å¾—åˆ°æ›´æ–°ã€‚åœ¨æ¸²æŸ“æœŸé—´æ”¹å˜ refï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä»é™¤äº†åˆšæ‰æåˆ°çš„åœ°æ–¹ä¹‹å¤–çš„åœ°æ–¹ï¼Œå¯èƒ½ä¼šå¼•å…¥ bugã€‚è¿™åŒæ ·é€‚ç”¨äº<code>useState</code>ã€‚</p>
<h3>ä¸ºä»€ä¹ˆ<code>let</code>ä¸èƒ½å–ä»£<code>useRef</code></h3>
<p>ç°åœ¨æˆ‘è¿˜æ¬ ä½ ä¸€ä¸ªè§£é‡Šï¼Œä¸ºä»€ä¹ˆä¸€ä¸ª<code>let</code>å˜é‡ä¸èƒ½ä»£æ›¿ä¸€ä¸ª ref çš„æ¦‚å¿µã€‚ä¸‹ä¸€ä¸ªä¾‹å­ç”¨æ¥è‡ª<code>useEffect</code>é’©å­å†…éƒ¨çš„æ™®é€š JavaScript å˜é‡èµ‹å€¼æ›¿æ¢äº†<code>useRef</code>çš„ä½¿ç”¨ã€‚</p>
<pre>import { useEffect, useState } from "react";
import "./styles.css";
const AppDemo14 = () =&gt; {
  console.log("render");
  const [count, setCount] = useState(0);
  let prevCount;
  useEffect(() =&gt; {
    console.log("useEffect", prevCount);
    prevCount = count;
  }, [count]);
  return (
    &lt;div className="App"&gt;
      &lt;h1&gt;
        Now: {count}, before: {prevCount}
      &lt;/h1&gt;
      &lt;button onClick={() =&gt; setCount(count + 1)}&gt;Increment&lt;/button&gt;
    &lt;/div&gt;
  );
};</pre>
<p>ç„¶è€Œï¼Œä¸‹é¢çš„å½•éŸ³å°†æ­ç¤ºè¿™æ˜¯è¡Œä¸é€šçš„ã€‚æ§åˆ¶å°è¾“å‡ºåŠ å‰§äº†è¿™ä¸ªé—®é¢˜ï¼Œå› ä¸ºåœ¨æ¯ä¸ªæ–°çš„æ¸²æŸ“å‘¨æœŸä¸­ï¼Œ<code>useEffect</code>å†…éƒ¨çš„èµ‹å€¼éƒ½ä¼šè¢«è¦†ç›–ã€‚<code>undefined</code>å› <code>let prevCount;</code>è€Œè¢«éšå¼èµ‹å€¼ã€‚</p>
<figure id="attachment_50118" aria-describedby="caption-attachment-50118" class="wp-caption aligncenter"><img data-attachment-id="50118" data-permalink="https://blog.logrocket.com/usestate-vs-useref/attachment/normal-variable-assignment-useref/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/05/normal-variable-assignment-useref.gif" data-orig-size="718,342" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="let variables canâ€™t replace useRef" data-image-description="" data-image-caption="&lt;p&gt;A normal variable assignment cannot replace useRef.&lt;/p&gt;&#10;" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/05/normal-variable-assignment-useref-300x143.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/05/normal-variable-assignment-useref.gif" decoding="async" class="size-full wp-image-50118 jetpack-lazy-image" src="../Images/f32320045dea38b3a53db91a3ce906aa.png" alt="A Normal Variable Assignment Cannot Replace useRef" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2021/05/normal-variable-assignment-useref.gif?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/05/normal-variable-assignment-useref.gif"/><noscript><img data-lazy-fallback="1" data-attachment-id="50118" data-permalink="https://blog.logrocket.com/usestate-vs-useref/attachment/normal-variable-assignment-useref/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/05/normal-variable-assignment-useref.gif" data-orig-size="718,342" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="let variables canâ€™t replace useRef" data-image-description="" data-image-caption="&lt;p&gt;A normal variable assignment cannot replace useRef.&lt;/p&gt;&#10;" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/05/normal-variable-assignment-useref-300x143.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/05/normal-variable-assignment-useref.gif" decoding="async" loading="lazy" class="size-full wp-image-50118" src="../Images/f32320045dea38b3a53db91a3ce906aa.png" alt="A Normal Variable Assignment Cannot Replace useRef" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/05/normal-variable-assignment-useref.gif"/></noscript><figcaption id="caption-attachment-50118" class="wp-caption-text">A normal variable assignment cannot replace useRef.</figcaption></figure>
<p>ç”šè‡³å¼ºå¤§çš„ ESLint <a href="https://www.npmjs.com/package/eslint-plugin-react-hooks">é’©å­è§„åˆ™æ’ä»¶</a>ä¹Ÿå‘Šè¯‰ä½ æˆ‘ä»¬åº”è¯¥åˆ©ç”¨<code>useRef</code>æ¥ä»£æ›¿ã€‚</p>
<figure id="attachment_50120" aria-describedby="caption-attachment-50120" class="wp-caption aligncenter"><img data-attachment-id="50120" data-permalink="https://blog.logrocket.com/usestate-vs-useref/attachment/eslint-rules-hooks-plugin-warning/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/05/eslint-rules-hooks-plugin-warning.png" data-orig-size="730,328" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Warning from ESLint plugin" data-image-description="" data-image-caption="&lt;p&gt;The ESLint plugin warns you about using variables instead of refs.&lt;/p&gt;&#10;" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/05/eslint-rules-hooks-plugin-warning-300x135.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/05/eslint-rules-hooks-plugin-warning.png" decoding="async" class="size-full wp-image-50120 jetpack-lazy-image" src="../Images/e85b8bf36d08bf4f9a857f5528a9f8b7.png" alt="Warning From the ESLint Rules of Hooks Plugin " data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2021/05/eslint-rules-hooks-plugin-warning.png 730w, https://blog.logrocket.com/wp-content/uploads/2021/05/eslint-rules-hooks-plugin-warning-300x135.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2021/05/eslint-rules-hooks-plugin-warning.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/05/eslint-rules-hooks-plugin-warning.png"/><noscript><img data-lazy-fallback="1" data-attachment-id="50120" data-permalink="https://blog.logrocket.com/usestate-vs-useref/attachment/eslint-rules-hooks-plugin-warning/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/05/eslint-rules-hooks-plugin-warning.png" data-orig-size="730,328" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Warning from ESLint plugin" data-image-description="" data-image-caption="&lt;p&gt;The ESLint plugin warns you about using variables instead of refs.&lt;/p&gt;&#10;" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/05/eslint-rules-hooks-plugin-warning-300x135.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/05/eslint-rules-hooks-plugin-warning.png" decoding="async" loading="lazy" class="size-full wp-image-50120" src="../Images/e85b8bf36d08bf4f9a857f5528a9f8b7.png" alt="Warning From the ESLint Rules of Hooks Plugin " srcset="https://blog.logrocket.com/wp-content/uploads/2021/05/eslint-rules-hooks-plugin-warning.png 730w, https://blog.logrocket.com/wp-content/uploads/2021/05/eslint-rules-hooks-plugin-warning-300x135.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/05/eslint-rules-hooks-plugin-warning.png"/></noscript><figcaption id="caption-attachment-50120" class="wp-caption-text">The ESLint plugin warns you about using variables instead of refs.</figcaption></figure>
<h2><code>useRef</code>å’Œ<code>useState</code>çš„åŒºåˆ«ä¸€ç›®äº†ç„¶</h2>
<p>ä»¥ä¸‹å·®å¼‚å·²ç»è¿‡è¯¦ç»†è®¨è®ºï¼Œä½†åœ¨æ­¤å†æ¬¡ä»¥ç®€æ´çš„æ€»ç»“å½¢å¼å‘ˆç°:</p>
<ul>
<li>ä¸¤è€…éƒ½åœ¨æ¸²æŸ“å‘¨æœŸå’Œ UI æ›´æ–°æœŸé—´ä¿ç•™äº†å®ƒä»¬çš„æ•°æ®ï¼Œä½†æ˜¯åªæœ‰å¸¦æœ‰ updater å‡½æ•°çš„<code>useState</code>é’©å­ä¼šå¯¼è‡´é‡æ–°æ¸²æŸ“</li>
<li><code>useRef</code>è¿”å›ä¸€ä¸ªå…·æœ‰ä¿å­˜å®é™…å€¼çš„<code>current</code>å±æ€§çš„å¯¹è±¡ã€‚ç›¸åï¼Œ<code>useState</code>è¿”å›ä¸€ä¸ªåŒ…å«ä¸¤ä¸ªå…ƒç´ çš„æ•°ç»„:ç¬¬ä¸€é¡¹æ„æˆäº†å·ï¼Œç¬¬äºŒé¡¹ä»£è¡¨äº†å·æ›´æ–°å‡½æ•°</li>
<li><code>useRef</code>çš„<code>current</code>å±æ€§æ˜¯<a href="https://doppelmutzi.github.io/javascript-to-master-before-learning-react/#immutable-vs-mutable-values">å¯å˜çš„</a>ï¼Œè€Œ<code>useState</code>çš„çŠ¶æ€å˜é‡ä¸æ˜¯ã€‚ä¸<code>useRef</code>çš„<code>current</code>å±æ€§ç›¸åï¼Œä½ ä¸åº”è¯¥ç›´æ¥ç»™<code>useState</code>çš„çŠ¶æ€å˜é‡èµ‹å€¼ã€‚ç›¸åï¼Œæ€»æ˜¯ä½¿ç”¨ updater å‡½æ•°(å³ç¬¬äºŒä¸ªæ•°ç»„é¡¹)ã€‚æ­£å¦‚ React å›¢é˜Ÿåœ¨<a href="https://reactjs.org/docs/react-component.html#state">æ–‡æ¡£</a>ä¸­ä¸ºåŸºäºç±»çš„ç»„ä»¶<code>setState</code>æ‰€å»ºè®®çš„é‚£æ ·(ä½†å¯¹å‡½æ•°ç»„ä»¶ä¹Ÿæ˜¯å¦‚æ­¤)ï¼Œå°†çŠ¶æ€è§†ä¸ºä¸å¯å˜å˜é‡</li>
<li><code>useState</code>å’Œ<code>useRef</code>å¯ä»¥è¢«è®¤ä¸ºæ˜¯æ•°æ®æŒ‚é’©ï¼Œä½†æ˜¯åªæœ‰<code>useRef</code>å¯ä»¥ç”¨äºå¦ä¸€ä¸ªåº”ç”¨é¢†åŸŸ:ç›´æ¥è®¿é—® React ç»„ä»¶æˆ– DOM å…ƒç´ </li>
</ul>
<h2>ç»“è®º</h2>
<p>æœ¬æ–‡è®¨è®ºäº†<code>useState</code>å’Œ<code>useRef</code>æŒ‚é’©ã€‚åœ¨è¿™ä¸€ç‚¹ä¸Šåº”è¯¥å¾ˆæ¸…æ¥šï¼ŒæŒ‚é’©æ²¡æœ‰å¥½åä¹‹åˆ†ã€‚React åº”ç”¨ç¨‹åºéœ€è¦è¿™ä¸¤ä¸ªæŒ‚é’©ï¼Œå› ä¸ºå®ƒä»¬æ˜¯ä¸ºä¸åŒçš„åº”ç”¨ç¨‹åºè®¾è®¡çš„ã€‚</p>
<p>å¦‚æœä½ æƒ³æ›´æ–°æ•°æ®å¹¶å¼•èµ· UI æ›´æ–°ï¼Œ<code>useState</code>å°±æ˜¯ä½ çš„é’©å­ã€‚å¦‚æœåœ¨ç»„ä»¶çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸä¸­ï¼Œæ‚¨éœ€è¦æŸç§æ•°æ®å®¹å™¨ï¼Œè€Œä¸ä¼šå› ä¸ºæ”¹å˜å˜é‡è€Œå¯¼è‡´æ¸²æŸ“å‘¨æœŸï¼Œé‚£ä¹ˆ<code>useRef</code>å°±æ˜¯æ‚¨çš„è§£å†³æ–¹æ¡ˆã€‚</p><div class="code-block code-block-17">
<div class="blog-plug inline-plug react-plug" vwo-el-id="26283398190">
<h2 vwo-el-id="41600691720">ä½¿ç”¨ LogRocket æ¶ˆé™¤ä¼ ç»Ÿååº”é”™è¯¯æŠ¥å‘Šçš„å™ªéŸ³</h2>
<a href="https://lp.logrocket.com/blg/react-signup-issue-free" target="_blank" vwo-el-id="19356441070">LogRocket
</a><p>æ˜¯ä¸€æ¬¾ React analytics è§£å†³æ–¹æ¡ˆï¼Œå¯ä¿æŠ¤æ‚¨å…å—æ•°ç™¾ä¸ªè¯¯æŠ¥é”™è¯¯è­¦æŠ¥çš„å½±å“ï¼Œåªé’ˆå¯¹å°‘æ•°çœŸæ­£é‡è¦çš„é¡¹ç›®ã€‚LogRocket å‘Šè¯‰æ‚¨ React åº”ç”¨ç¨‹åºä¸­å®é™…å½±å“ç”¨æˆ·çš„æœ€å…·å½±å“åŠ›çš„ bug å’Œ UX é—®é¢˜ã€‚</p><a class="signup" href="https://lp.logrocket.com/blg/react-signup-general" target="_blank" rel="noopener noreferrer" vwo-el-id="19356441380">
<img class="first-react-image alignnone size-full wp-image-46 jetpack-lazy-image jetpack-lazy-image--handled" src="../Images/f300c244a1a1cf916df8b4cb02bec6c6.png" vwo-el-id="18272717540" data-lazy-loaded="1" data-original-src="https://files.readme.io/27c94e7-Image_2017-06-05_at_9.46.04_PM.png"/>
</a>
<a class="signup" href="https://lp.logrocket.com/blg/react-signup-general" target="_blank" rel="noopener noreferrer" vwo-el-id="19356441690">
<img class="second-react-image alignnone size-full wp-image-46 jetpack-lazy-image jetpack-lazy-image--handled" src="../Images/d6f5a5dd739296c1dd7aab3d5e77eeb9.png" alt="LogRocket Dashboard Free Trial Banner" vwo-el-id="30720362350" data-lazy-loaded="1" data-original-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png"/>
</a>
<a href="https://lp.logrocket.com/blg/react-signup-issue-free" target="_blank" rel="noopener noreferrer" vwo-el-id="35866400580">LogRocket
</a><p>è‡ªåŠ¨èšåˆå®¢æˆ·ç«¯é”™è¯¯ã€ååº”é”™è¯¯è¾¹ç•Œã€è¿˜åŸçŠ¶æ€ã€ç¼“æ…¢çš„ç»„ä»¶åŠ è½½æ—¶é—´ã€JS å¼‚å¸¸ã€å‰ç«¯æ€§èƒ½æŒ‡æ ‡å’Œç”¨æˆ·äº¤äº’ã€‚ç„¶åï¼ŒLogRocket ä½¿ç”¨æœºå™¨å­¦ä¹ æ¥é€šçŸ¥æ‚¨å½±å“å¤§å¤šæ•°ç”¨æˆ·çš„æœ€å…·å½±å“åŠ›çš„é—®é¢˜ï¼Œå¹¶æä¾›æ‚¨ä¿®å¤å®ƒæ‰€éœ€çš„ä¸Šä¸‹æ–‡ã€‚</p><p vwo-el-id="28675661060">å…³æ³¨é‡è¦çš„ React bugâ€”<a class="signup" href="https://lp.logrocket.com/blg/react-signup-issue-free" target="_blank" rel="noopener noreferrer" vwo-el-id="40093418840">ä»Šå¤©å°±è¯•è¯• LogRocketã€‘ã€‚</a></p>
</div></div>

<p class="clearfix"/>
<p class="clearfix"/>
</article>

</div>    
</body>
</html>