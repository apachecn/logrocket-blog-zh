<html>
<head>
<title>How to deploy Lambda functions in Rust </title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>å¦‚ä½•åœ¨Rustä¸­éƒ¨ç½²Lambdaå‡½æ•°</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://blog.logrocket.com/deploy-lambda-functions-rust/#0001-01-01">https://blog.logrocket.com/deploy-lambda-functions-rust/#0001-01-01</a></blockquote><div><article class="article-post">
<p>å­¦ä¹ å¦‚ä½•ä½¿ç”¨Rustç¼–å†™çš„Lambdaå‡½æ•°å¯¹äºä»Šå¤©çš„å¼€å‘äººå‘˜æ¥è¯´æ˜¯ä¸€é¡¹éå¸¸æœ‰ç”¨çš„æŠ€èƒ½ã€‚AWS Lambdaæä¾›æŒ‰éœ€è®¡ç®—æœåŠ¡ï¼Œæ— éœ€éƒ¨ç½²æˆ–ç»´æŠ¤é•¿æ—¶é—´è¿è¡Œçš„æœåŠ¡å™¨ï¼Œæ— éœ€å®‰è£…å’Œå‡çº§æ“ä½œç³»ç»Ÿæˆ–ä¿®è¡¥å®‰å…¨æ¼æ´ã€‚</p>
<p>åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†å­¦ä¹ å¦‚ä½•åˆ›å»ºå’Œéƒ¨ç½²ç”¨Rustç¼–å†™çš„Lambdaå‡½æ•°ã€‚ä¸ºäº†æ–¹ä¾¿èµ·è§ï¼Œè¿™ä¸ªé¡¹ç›®çš„æ‰€æœ‰ä»£ç éƒ½å¯ä»¥åœ¨æˆ‘çš„GitHubä¸Šæ‰¾åˆ°ã€‚</p>
<p><em>å‘å‰è·³è½¬:</em></p>

<h2 id="cold-starts-rust">å†·å¯åŠ¨å’Œç”Ÿé”ˆ</h2>
<p>Lambdaå¤šå¹´æ¥ä¸€ç›´å­˜åœ¨çš„ä¸€ä¸ªé—®é¢˜æ˜¯å†·å¯åŠ¨é—®é¢˜ã€‚</p>
<p>ä¸€ä¸ªå‡½æ•°ä¸èƒ½ç«‹å³å¯åŠ¨ï¼Œå› ä¸ºå®ƒé€šå¸¸éœ€è¦å‡ ç§’é’Ÿæˆ–æ›´é•¿æ—¶é—´æ¥è¿”å›ä¸€ä¸ªå“åº”ã€‚ä¸åŒçš„ç¼–ç¨‹è¯­è¨€æœ‰ä¸åŒçš„æ€§èƒ½ç‰¹å¾ï¼›åƒJavaè¿™æ ·çš„ä¸€äº›è¯­è¨€ä¼šæœ‰æ›´é•¿çš„å†·å¯åŠ¨æ—¶é—´ï¼Œå› ä¸ºå®ƒä»¬çš„ä¾èµ–æ€§ï¼Œæ¯”å¦‚JVMã€‚</p>
<p>å¦ä¸€æ–¹é¢ï¼ŒRustå…·æœ‰æå°çš„å†·å¯åŠ¨ï¼Œå¹¶ä¸”å·²ç»æˆä¸ºé€šè¿‡é¿å…è¾ƒå¤§å†·å¯åŠ¨æ¥å¯»æ±‚æ˜¾è‘—æ€§èƒ½å¢ç›Šçš„å¼€å‘äººå‘˜çš„ç¼–ç¨‹è¯­è¨€é€‰æ‹©ã€‚</p>
<p>è®©æˆ‘ä»¬è·³è¿›æ¥ã€‚</p>
<h2 id="getting-started">å…¥é—¨æŒ‡å—</h2>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦å®‰è£…å¸¦æœ‰<code><a href="#https://doc.rust-lang.org/cargo/getting-started/installation.html">rustup</a></code>å’Œ<code><a href="https://www.cargo-lambda.info/guide/installation.html">cargo-lambda</a></code>çš„<code><a href="https://doc.rust-lang.org/cargo/">cargo</a></code>ã€‚æˆ‘å°†ä½¿ç”¨<a href="https://blog.logrocket.com/how-to-set-up-m1-macbook-web-development/">å®¶é…¿</a>ï¼Œå› ä¸ºæˆ‘åœ¨Macä¸Šï¼Œä½†ä½ å¯ä»¥çœ‹çœ‹ä¹‹å‰çš„ä¸¤ä¸ªé“¾æ¥ï¼Œåœ¨ä½ è‡ªå·±çš„æœºå™¨ä¸Šå®‰è£…è¯´æ˜ã€‚</p>
<pre>curl https://sh.rustup.rs -sSf | sh
brew tap cargo-lambda/cargo-lambda
brew install cargo-lambda
</pre>
<h3 id="generate-boilerplate-new-command">ç”¨<code>new</code>å‘½ä»¤ç”Ÿæˆæ ·æ¿æ–‡ä»¶</h3>
<p>é¦–å…ˆï¼Œè®©æˆ‘ä»¬ç”¨<code><a href="https://www.cargo-lambda.info/commands/new.html">new</a></code>å‘½ä»¤åˆ›å»ºä¸€ä¸ªæ–°çš„RuståŒ…ã€‚å¦‚æœä½ åŒ…å«äº†<code>--http</code>æ ‡å¿—ï¼Œå®ƒä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªå…¼å®¹<a href="https://docs.aws.amazon.com/lambda/latest/dg/lambda-urls.html"> Lambdaå‡½æ•°URL</a><a href="https://docs.aws.amazon.com/lambda/latest/dg/lambda-urls.html">çš„é¡¹ç›®ã€‚</a></p>
<pre>cargo lambda new --http rustrocket
cd rustrocket
</pre>
<p>è¿™å°±ç”Ÿæˆäº†ä¸€ä¸ªåŸºæœ¬æ¡†æ¶ï¼Œå¼€å§‹ç”¨Rustç¼–å†™AWS Lambdaå‡½æ•°ã€‚æˆ‘ä»¬çš„é¡¹ç›®ç»“æ„åŒ…å«ä»¥ä¸‹æ–‡ä»¶:</p>
<pre>.
â”œâ”€â”€ Cargo.toml
â””â”€â”€ src
    â””â”€â”€ main.rs
</pre>
<p><code>src</code>ç›®å½•ä¸‹çš„<code>main.rs</code>ä¿å­˜ç€æˆ‘ä»¬ç”¨Rustç¼–å†™çš„Lambdaä»£ç ã€‚</p>
<p>æˆ‘ä»¬ä¸€ä¼šå„¿å°±æ¥çœ‹çœ‹è¿™æ®µä»£ç ï¼Œä½†æ˜¯è®©æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹å”¯ä¸€çš„å¦ä¸€ä¸ªæ–‡ä»¶ï¼Œ<code><a href="https://doc.rust-lang.org/cargo/reference/manifest.html">Cargo.toml</a></code> <a href="https://doc.rust-lang.org/cargo/reference/manifest.html">ã€‚</a></p>
<h3 id="cargo-manifest-file">è´§ç‰©æ¸…å•æ–‡ä»¶</h3>
<p>æ˜¯ä¸€ä¸ªRustæ¸…å•æ–‡ä»¶ï¼ŒåŒ…æ‹¬ä¸€ä¸ªç”¨TOMLä¸ºä½ çš„åŒ…ç¼–å†™çš„é…ç½®æ–‡ä»¶ã€‚</p>
<pre class="language-toml hljs"># Cargo.toml

[package]
  name = "rustrocket"
  version = "0.1.0"
  edition = "2021"

[dependencies]
  lambda_http = "0.6.1"
  lambda_runtime = "0.6.1"
  tokio = { version = "1", features = ["macros"] }
  tracing = { version = "0.1", features = ["log"] }
  tracing-subscriber = { version = "0.3", default-features = false, features = ["fmt"] }
</pre>
<ul>
<li>æ‰€æœ‰<code>Cargo.toml</code>æ–‡ä»¶çš„ç¬¬ä¸€éƒ¨åˆ†å®šä¹‰äº†ä¸€ä¸ªåŒ…ã€‚<code>name</code>å’Œ<code>version</code>å­—æ®µæ˜¯å”¯ä¸€éœ€è¦çš„ä¿¡æ¯â€”â€”åœ¨å®˜æ–¹<code><a href="#https://doc.rust-lang.org/cargo/reference/manifest.html#the-package-section">package</a></code>æ–‡æ¡£ä¸­å¯ä»¥æ‰¾åˆ°å…¶ä»–å­—æ®µçš„è¯¦ç»†åˆ—è¡¨</li>
<li>ç¬¬äºŒéƒ¨åˆ†æŒ‡å®šäº†æˆ‘ä»¬çš„<code><a href="#https://doc.rust-lang.org/cargo/reference/specifying-dependencies.html">dependencies</a></code>ï¼Œä»¥åŠè¦å®‰è£…çš„ç‰ˆæœ¬</li>
</ul>
<p>å¯¹äºæˆ‘ä»¬å°†åœ¨æœ¬æ–‡ä¸­åˆ›å»ºçš„ç¤ºä¾‹ï¼Œæˆ‘ä»¬åªéœ€è¦æ·»åŠ ä¸€ä¸ªé¢å¤–çš„ä¾èµ–é¡¹(<code>serde</code>)ã€‚</p>
<p>Serde æ˜¯ä¸€ä¸ªåºåˆ—åŒ–å’Œååºåˆ—åŒ–Rustæ•°æ®ç»“æ„çš„æ¡†æ¶ã€‚åœ¨æ’°å†™æœ¬æ–‡æ—¶ï¼Œå½“å‰ç‰ˆæœ¬æ˜¯<code>1.0.145</code>,ä½†æ˜¯æ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å®‰è£…æœ€æ–°ç‰ˆæœ¬:</p>
<pre>cargo add serde
</pre>
<p>ç°åœ¨æˆ‘ä»¬çš„<code>[dependencies]</code>åŒ…æ‹¬<code>serde = "1.0.145"</code>ã€‚</p>
<h2 id="start-development-server-watch-command">ç”¨<code>watch</code>å‘½ä»¤å¯åŠ¨å¼€å‘æœåŠ¡å™¨</h2>
<p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬ç”¨<code><a href="https://www.cargo-lambda.info/commands/watch.html">watch</a></code>å­å‘½ä»¤å¯åŠ¨ä¸€ä¸ªå¼€å‘æœåŠ¡å™¨ï¼Œæ¨¡æ‹Ÿä¸AWS Lambdaæ§åˆ¶å¹³é¢çš„äº¤äº’ã€‚</p>
<pre>cargo lambda watch
</pre>
<p>ç”±äºæ¨¡æ‹Ÿå™¨æœåŠ¡å™¨åŒ…æ‹¬å¯¹Lambdaå‡½æ•°urlçš„ç°æˆæ”¯æŒï¼Œæ‚¨å¯ä»¥æ‰“å¼€<a href="http://localhost:9000/lambda-url/rustrocket">localhost:9000/Lambda-URL/rust rocket</a>æ¥è°ƒç”¨æ‚¨çš„å‡½æ•°å¹¶åœ¨æµè§ˆå™¨ä¸­æŸ¥çœ‹å®ƒã€‚</p>
<p><img data-attachment-id="139891" data-permalink="https://blog.logrocket.com/deploy-lambda-functions-rust/attachment/lambda-function/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/10/lambda-function.png" data-orig-size="730,106" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="lambda-function" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/10/lambda-function-300x44.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/10/lambda-function.png" decoding="async" class="aligncenter wp-image-139891 size-full jetpack-lazy-image" src="../Images/5b011a79cc38265de60359ac40a35287.png" alt="Invoke your Lambda function and view it in your browser" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/10/lambda-function.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/10/lambda-function-300x44.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/10/lambda-function.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/10/lambda-function.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="139891" data-permalink="https://blog.logrocket.com/deploy-lambda-functions-rust/attachment/lambda-function/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/10/lambda-function.png" data-orig-size="730,106" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="lambda-function" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/10/lambda-function-300x44.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/10/lambda-function.png" decoding="async" loading="lazy" class="aligncenter wp-image-139891 size-full" src="../Images/5b011a79cc38265de60359ac40a35287.png" alt="Invoke your Lambda function and view it in your browser" srcset="https://blog.logrocket.com/wp-content/uploads/2022/10/lambda-function.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/10/lambda-function-300x44.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/10/lambda-function.png"/></noscript>
<p>æ‰“å¼€<code>src</code>ç›®å½•ä¸‹çš„<code>main.rs</code>å¯ä»¥çœ‹åˆ°è¿™ä¸ªå‡½æ•°çš„ä»£ç ã€‚</p>
<pre class="language-rust hljs">// src/main.rs

use lambda_http::{run, service_fn, Body, Error, Request, RequestExt, Response};

async fn function_handler(event: Request) -&gt; Result&lt;Response&lt;Body&gt;, Error&gt; {
    let resp = Response::builder()
        .status(200)
        .header("content-type", "text/html")
        .body("Hello AWS Lambda HTTP request".into())
        .map_err(Box::new)?;
    Ok(resp)
}

#[tokio::main]
async fn main() -&gt; Result&lt;(), Error&gt; {
    tracing_subscriber::fmt()
        .with_max_level(tracing::Level::INFO)
        .with_target(false)
        .without_time()
        .init();
    run(service_fn(function_handler)).await
}
</pre>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬å°†é€šè¿‡æ·»åŠ ä¸€æ¡æ–°æ¶ˆæ¯å¯¹<code>body</code>ä¸­çš„æ–‡æœ¬è¿›è¡Œæ›´æ”¹ã€‚ç”±äºæ ‡é¢˜å·²ç»è®¾ç½®ä¸º<code>text/html</code>ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨HTMLæ ‡ç­¾åŒ…è£…æˆ‘ä»¬çš„æ¶ˆæ¯ã€‚</p>
<p>æˆ‘ä»¬çš„ç»ˆç«¯ä¹Ÿæ˜¾ç¤ºäº†ä¸€äº›è­¦å‘Šï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ›´æ”¹è¿›è¡Œä¿®å¤:</p>
<ul>
<li>å°†<code>event</code>é‡å‘½åä¸º<code>_event</code></li>
<li>ä»å¯¼å…¥ä¸­ç§»é™¤æœªä½¿ç”¨çš„<code>RequestExt</code></li>
</ul>
<pre class="language-rust hljs">// src/main.rs

use lambda_http::{run, service_fn, Body, Error, Request, Response};

async fn function_handler(_event: Request) -&gt; Result&lt;Response&lt;Body&gt;, Error&gt; {
    let resp = Response::builder()
        .status(200)
        .header("content-type", "text/html")
        .body("&lt;h2&gt;Hello from LogRocket&lt;/h2&gt;".into())
        .map_err(Box::new)?;
    Ok(resp)
}
</pre>
<p><code>main()</code>åŠŸèƒ½ä¸ä¼šæ”¹å˜ã€‚è¿”å›æµè§ˆå™¨æŸ¥çœ‹æ›´æ”¹:</p>
<p><img data-attachment-id="139893" data-permalink="https://blog.logrocket.com/deploy-lambda-functions-rust/attachment/main-function/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/10/main-function.png" data-orig-size="730,108" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="main-function" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/10/main-function-300x44.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/10/main-function.png" decoding="async" class="aligncenter wp-image-139893 size-full jetpack-lazy-image" src="../Images/e532414013f98c1904eca12b904d7ce1.png" alt="Main function" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/10/main-function.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/10/main-function-300x44.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/10/main-function.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/10/main-function.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="139893" data-permalink="https://blog.logrocket.com/deploy-lambda-functions-rust/attachment/main-function/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/10/main-function.png" data-orig-size="730,108" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="main-function" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/10/main-function-300x44.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/10/main-function.png" decoding="async" loading="lazy" class="aligncenter wp-image-139893 size-full" src="../Images/e532414013f98c1904eca12b904d7ce1.png" alt="Main function" srcset="https://blog.logrocket.com/wp-content/uploads/2022/10/main-function.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/10/main-function-300x44.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/10/main-function.png"/></noscript>
<h3 id="include-additional-information-project">åœ¨æˆ‘ä»¬çš„é¡¹ç›®ä¸­åŒ…å«é™„åŠ ä¿¡æ¯</h3>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªå¯ä»¥è¢«è°ƒç”¨æ¥æ¥æ”¶å“åº”çš„å‡½æ•°ï¼Œä½†æ˜¯è¿™ä¸ªLambdaä¸èƒ½æ¥å—ç”¨æˆ·çš„ç‰¹å®šè¾“å…¥ï¼Œæˆ‘ä»¬çš„é¡¹ç›®ä¸èƒ½ç”¨äºéƒ¨ç½²å’Œè°ƒç”¨å¤šä¸ªå‡½æ•°ã€‚</p>
<p>ä¸ºæ­¤ï¼Œæˆ‘ä»¬å°†åœ¨åä¸º<code>bin</code>çš„æ–°ç›®å½•ä¸­åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶<code>hello.rs</code>ã€‚</p>
<pre class="language-rust hljs">mkdir src/bin
echo &gt; src/bin/hello.rs
</pre>
<p>ç›®å½•è®©æˆ‘ä»¬èƒ½å¤Ÿåœ¨ä¸€ä¸ªé¡¹ç›®ä¸­åŒ…å«å¤šä¸ªå‡½æ•°å¤„ç†ç¨‹åºï¼Œå¹¶åˆ†åˆ«è°ƒç”¨å®ƒä»¬ã€‚</p>
<p>æˆ‘ä»¬è¿˜å¿…é¡»åœ¨æˆ‘ä»¬çš„<code>Cargo.toml</code>æ–‡ä»¶çš„åº•éƒ¨æ·»åŠ ä¸€ä¸ªåŒ…å«æ–°å¤„ç†ç¨‹åºåç§°çš„<code><a href="https://doc.rust-lang.org/cargo/reference/cargo-targets.html#binaries">bin</a></code>éƒ¨åˆ†ï¼Œå¦‚ä¸‹æ‰€ç¤º:</p>
<pre class="language-toml hljs"># Cargo.toml

[[bin]]
  name = "hello"
</pre>
<p>åŒ…å«ä»¥ä¸‹ä»£ç ï¼Œå°†<code>event</code>æœ‰æ•ˆè´Ÿè½½è½¬æ¢ä¸º<code>Response</code>ï¼Œå¹¶é€šè¿‡<code><a href="#https://doc.rust-lang.org/std/result/%5C">Ok()</a></code>ä¼ é€’ç»™<code>main()</code>å‡½æ•°ï¼Œå¦‚ä¸‹æ‰€ç¤º:</p>
<pre class="language-rust hljs">// src/bin/hello.rs

use lambda_runtime::{service_fn, Error, LambdaEvent};
use serde::{Deserialize, Serialize};

#[derive(Deserialize)]
struct Request {
    command: String,
}

#[derive(Serialize)]
struct Response {
    req_id: String,
    msg: String,
}

pub(crate) async fn my_handler(event: LambdaEvent&lt;Request&gt;) -&gt; Result&lt;Response, Error&gt; {
    let command = event.payload.command;
    let resp = Response {
        req_id: event.context.request_id,
        msg: format!("{}", command),
    };
    Ok(resp)
}

#[tokio::main]
async fn main() -&gt; Result&lt;(), Error&gt; {
    tracing_subscriber::fmt()
        .with_max_level(tracing::Level::INFO)
        .without_time()
        .init();
    let func = service_fn(my_handler);
    lambda_runtime::run(func).await?;
    Ok(())
}
</pre>
<h3 id="send-request-invoke-command">ç”¨<code>invoke</code>å‘½ä»¤å‘é€è¯·æ±‚</h3>
<p>ä½¿ç”¨<code><a href="https://www.cargo-lambda.info/commands/invoke.html">invoke</a></code>å­å‘½ä»¤å‘æ§åˆ¶å¹³é¢ä»¿çœŸå™¨å‘é€è¯·æ±‚ã€‚</p>
<pre class="language-rust hljs">cargo lambda invoke hello \
  --data-ascii '{"command": "hello from logrocket"}'
</pre>
<p>æ‚¨çš„ç»ˆç«¯å°†å¯¹æ­¤ä½œå‡ºå›åº”:</p>
<pre class="language-rust hljs">{
  "req_id":"64d4b99a-1775-41d2-afc4-fbdb36c4502c",
  "msg":"hello from logrocket"
}
</pre>
<h2 id="deploy-project-production"><strong>å°†é¡¹ç›®æŠ•å…¥ç”Ÿäº§</strong></h2>
<p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬åªæ˜¯åœ¨è‡ªå·±çš„æœºå™¨ä¸Šæœ¬åœ°è¿è¡ŒLambdaå¤„ç†ç¨‹åºã€‚ä¸ºäº†åœ¨AWSä¸Šè·å¾—è¿™ä¸ªå¤„ç†ç¨‹åºï¼Œæˆ‘ä»¬éœ€è¦æ„å»ºå’Œéƒ¨ç½²é¡¹ç›®çš„å·¥ä»¶ã€‚</p>
<h3 id="bundle-function-artifacts-build-command">ç”¨<code>build</code>å‘½ä»¤æ†ç»‘åŠŸèƒ½å·¥ä»¶</h3>
<p>ç”¨<code><a href="https://www.cargo-lambda.info/commands/build.html">build</a></code>å­å‘½ä»¤ç¼–è¯‘ä½ çš„å‡½æ•°ã€‚è¿™äº§ç”Ÿäº†å¯ä»¥ä¸Šä¼ åˆ°AWS Lambdaçš„å·¥ä»¶ã€‚</p>
<pre class="language-rust hljs">cargo lambda build
</pre>
<h3 id="create-IAM-role">åˆ›å»ºIAMè§’è‰²</h3>
<p>AWS IAM ( <a href="https://aws.amazon.com/iam/"> i </a> <a href="https://aws.amazon.com/iam/"> dentityå’Œ</a> <a href="https://aws.amazon.com/iam/"> a </a> <a href="https://aws.amazon.com/iam/">è®¿é—®</a> <a href="https://aws.amazon.com/iam/"> m </a> <a href="https://aws.amazon.com/iam/">ç®¡ç†</a>)æ˜¯ä¸€ä¸ªç”¨äºåˆ›å»ºã€åº”ç”¨å’Œç®¡ç†AWSèµ„æºä¸Šçš„è§’è‰²å’Œæƒé™çš„æœåŠ¡ã€‚</p>
<p>å®ƒçš„å¤æ‚æ€§å’ŒåŠŸèƒ½èŒƒå›´ä¿ƒä½¿åƒAmplifyè¿™æ ·çš„å›¢é˜Ÿå›´ç»•IAMå¼€å‘å¤§é‡çš„å·¥å…·èµ„æºã€‚è¿™åŒ…æ‹¬å¸¦æœ‰æ–°æŠ½è±¡çš„<a href="https://docs.aws.amazon.com/amplify/latest/userguide/security-iam.html">åº“å’ŒSDK</a>ï¼Œå…¶æ„å»ºçš„æ˜ç¡®ç›®çš„æ˜¯ç®€åŒ–å¼€å‘è€…ä½¿ç”¨IAMå’Œ<a href="https://docs.amplify.aws/lib/auth/getting-started/q/platform/js/"> Cognito </a>ç­‰æœåŠ¡çš„ä½“éªŒã€‚</p>
<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åªéœ€è¦åˆ›å»ºä¸€ä¸ªåªè¯»è§’è‰²ï¼Œæˆ‘ä»¬å°†æŠŠå®ƒæ”¾åœ¨ä¸€ä¸ªåä¸º<code>rust-role.json</code>çš„æ–‡ä»¶ä¸­ã€‚</p>
<pre class="language-rust hljs">echo &gt; rust-role.json
</pre>
<p>æˆ‘ä»¬å°†ä½¿ç”¨AWS CLIå¹¶å‘é€ä»¥ä¸‹è§’è‰²çš„JSONå®šä¹‰ã€‚åœ¨<code>rust-role.json</code>ä¸­åŒ…å«ä»¥ä¸‹ä»£ç :</p>
<pre class="language-json hljs">{
  "Version": "2012-10-17",
  "Statement": [{
    "Effect": "Allow",
    "Principal": {
      "Service": "lambda.amazonaws.com"
    },
    "Action": "sts:AssumeRole"
    }
  ]
}
</pre>
<p>è¦åšåˆ°è¿™ä¸€ç‚¹ï¼Œé¦–å…ˆå®‰è£…<a href="https://docs.aws.amazon.com/cli/latest/userguide/getting-started-install.html"> AWS CLI </a>ï¼Œå®ƒæä¾›äº†ä¸€ä¸ª<a href="https://awscli.amazonaws.com/v2/documentation/api/latest/reference/iam/index.html">æ‰©å±•çš„</a>åˆ—è¡¨ï¼Œç”¨äºä½¿ç”¨IAMã€‚æˆ‘ä»¬éœ€è¦çš„å”¯ä¸€å‘½ä»¤æ˜¯<code><a href="https://awscli.amazonaws.com/v2/documentation/api/latest/reference/iam/create-role.html">create-role</a></code>å‘½ä»¤ï¼Œä»¥åŠä¸¤ä¸ªé€‰é¡¹:</p>
<ul>
<li>åŒ…å«é’ˆå¯¹<code>--assume-role-policy-document</code>é€‰é¡¹çš„IAMç­–ç•¥</li>
<li>åŒ…å«<code>--role-name</code>é€‰é¡¹çš„åç§°<code>rust-role</code></li>
</ul>
<pre class="language-rust hljs">aws iam create-role \
  --role-name rust-role \
  --assume-role-policy-document file://rust-role.json
</pre>
<p>è¿™å°†è¾“å‡ºä»¥ä¸‹JSONæ–‡ä»¶:</p>
<pre class="language-rust hljs">{
  "Role": {
    "Path": "/",
    "RoleName": "rust-role2",
    "RoleId": "AROARZ5VR5ZCOYN4Z7TLJ",
    "Arn": "arn:aws:iam::124397940292:role/rust-role",
    "CreateDate": "2022-09-15T22:15:24+00:00",
    "AssumeRolePolicyDocument": {
      "Version": "2012-10-17",
      "Statement": [
        {
          "Effect": "Allow",
          "Principal": {
            "Service": "lambda.amazonaws.com"
          },
          "Action": "sts:AssumeRole"
        }
      ]
    }
  }
}
</pre>
<p>å¤åˆ¶<code>Arn</code>çš„å€¼ï¼Œåœ¨æˆ‘çš„ä¾‹å­ä¸­æ˜¯<code>arn:aws:iam::124397940292:role/rust-role</code>ï¼Œå¹¶å°†å…¶åŒ…å«åœ¨<code>--iam-role</code>æ ‡å¿—çš„ä¸‹ä¸€ä¸ªå‘½ä»¤ä¸­ã€‚</p>
<h3 id="upload-AWS-deploy-command">ç”¨<code>deploy</code>å‘½ä»¤ä¸Šä¼ åˆ°AWS</h3>
<p>ä½¿ç”¨<code><a href="https://www.cargo-lambda.info/commands/deploy.html">deploy</a></code>å­å‘½ä»¤å°†æ‚¨çš„å‡½æ•°ä¸Šä¼ åˆ°AWS Lambdaã€‚Cargo Lambdaå°†å°è¯•ä½¿ç”¨Lambdaçš„é»˜è®¤æœåŠ¡è§’è‰²ç­–ç•¥<code>AWSLambdaBasicExecutionRole</code>åˆ›å»ºä¸€ä¸ªæ‰§è¡Œè§’è‰²ã€‚</p>
<p>å¦‚æœè¿™äº›å‘½ä»¤å¤±è´¥å¹¶æ˜¾ç¤ºæƒé™é”™è¯¯ï¼Œé‚£ä¹ˆæ‚¨å°†éœ€è¦é€šè¿‡æ·»åŠ <code>--iam-role FULL_ROLE_ARN</code>æ¥åŒ…å«ä¸Šä¸€èŠ‚ä¸­çš„AWS IAMè§’è‰²ã€‚</p>
<pre class="language-rust hljs">cargo lambda deploy --enable-function-url rustrocket
cargo lambda deploy hello
</pre>
<p>å¦‚æœä¸€åˆ‡æ­£å¸¸ï¼Œæ‚¨å°†è·å¾—ä¸€ä¸ªç”¨äº<code>rustrocket</code>å‡½æ•°çš„Arnå’ŒURLï¼Œä»¥åŠä¸€ä¸ªç”¨äº<code>hello</code>å‡½æ•°çš„Arnï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p>
<pre>ğŸ” function arn: arn:aws:lambda:us-east-1:124397940292:function:rustrocket
ğŸ”— function url: https://bxzpdr7e3cvanutvreecyvlvfu0grvsk.lambda-url.us-east-1.on.aws/
</pre>
<p>æ‰“å¼€<a href="https://bxzpdr7e3cvanutvreecyvlvfu0grvsk.lambda-url.us-east-1.on.aws/">å‡½æ•°URL </a>æŸ¥çœ‹æ‚¨çš„å‡½æ•°:</p>
<p><img data-attachment-id="139895" data-permalink="https://blog.logrocket.com/deploy-lambda-functions-rust/attachment/function-url/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/10/function-url.png" data-orig-size="730,87" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="function-url" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/10/function-url-300x36.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/10/function-url.png" decoding="async" class="aligncenter wp-image-139895 size-full jetpack-lazy-image" src="../Images/961614b0413b723bd0075835b0652f0b.png" alt="Function URL." data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/10/function-url.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/10/function-url-300x36.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/10/function-url.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/10/function-url.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="139895" data-permalink="https://blog.logrocket.com/deploy-lambda-functions-rust/attachment/function-url/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/10/function-url.png" data-orig-size="730,87" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="function-url" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/10/function-url-300x36.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/10/function-url.png" decoding="async" loading="lazy" class="aligncenter wp-image-139895 size-full" src="../Images/961614b0413b723bd0075835b0652f0b.png" alt="Function URL." srcset="https://blog.logrocket.com/wp-content/uploads/2022/10/function-url.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/10/function-url-300x36.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/10/function-url.png"/></noscript>
<p>å¯¹äº<code>hello</code>å¤„ç†ç¨‹åºï¼Œæˆ‘ä»¬å°†å†æ¬¡ä½¿ç”¨<code>invoke</code>å‘½ä»¤ï¼Œä½†æ˜¯è¿™æ¬¡ä½¿ç”¨ä¸€ä¸ªç”¨äºè¿œç¨‹å‡½æ•°çš„<code>--remote</code>æ ‡å¿—ã€‚</p>
<pre class="language-rust hljs">cargo lambda invoke \
  --remote \
  --data-ascii '{"command": "hello from logrocket"}' \
  arn:aws:lambda:us-east-1:124397940292:function:hello
</pre>
<h3 id="alternative-deployment-options">æ›¿ä»£éƒ¨ç½²é€‰é¡¹</h3>
<p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬åªä½¿ç”¨äº†Cargo Lambdaæ¥å¤„ç†æˆ‘ä»¬çš„Lambdaå‡½æ•°ï¼Œä½†æ˜¯è‡³å°‘æœ‰åå‡ ç§ä¸åŒçš„æ–¹å¼æ¥å°†å‡½æ•°éƒ¨ç½²åˆ°AWS Lambdaï¼</p>
<p>è¿™äº›ä¼—å¤šçš„æ–¹æ³•åœ¨æ–¹æ³•ä¸Šæœ‰å¾ˆå¤§çš„ä¸åŒï¼Œä½†å¯ä»¥å¤§è‡´åˆ†ä¸ºä¸‰ç»„:</p>
<ol>
<li>å…¶ä»–å¼€æºé¡¹ç›®ï¼Œå¦‚Cargo Lambdaï¼Œç”±ä¸ªäººæˆ–ä¸€ç¾¤äººç»´æŠ¤ï¼Œå¯èƒ½æ˜¯AWSå‘˜å·¥è‡ªå·±æˆ–AWSé¡¾é—®ï¼Œä»–ä»¬ä¸å¸Œæœ›æ„å»ºAWSçš„å®¢æˆ·ä¸€èµ·å·¥ä½œ</li>
<li>ç”±å¸Œæœ›é€šè¿‡æä¾›æ›´å¥½ã€æ›´ç®€åŒ–çš„å¼€å‘è€…ä½“éªŒæ¥ä¸AWSç«äº‰çš„å…¬å¸æ„å»ºçš„å·¥å…·</li>
<li>ç”±AWSå†…éƒ¨å›¢é˜Ÿåˆ›å»ºå’Œæ¨åŠ¨çš„æœåŠ¡ï¼Œè¿™äº›å›¢é˜Ÿæ„å»ºæ–°äº§å“ï¼Œå¯»æ±‚æ”¹å–„ç°æœ‰AWSå¼€å‘äººå‘˜çš„ç”Ÿæ´»ï¼ŒåŒæ—¶å¼•å…¥æ–°çš„å’Œç»éªŒè¾ƒå°‘çš„å·¥ç¨‹å¸ˆ</li>
</ol>
<p>å…³äºä½¿ç”¨ç¬¬äºŒç±»å’Œç¬¬ä¸‰ç±»å·¥å…·çš„è¯´æ˜ï¼Œè¯·å‚è§<code>aws-lambda-rust-runtime</code> GitHubä»“åº“ä¸Šçš„<a href="https://github.com/awslabs/aws-lambda-rust-runtime#2-deploying-the-binary-to-aws-lambda">å°†äºŒè¿›åˆ¶ä»£ç éƒ¨ç½²åˆ°AWS Lambda </a>ä¸€èŠ‚ã€‚</p>
<h2 id="finalthoughts">æœ€åçš„æƒ³æ³•</h2>
<p>Ruståœ¨AWSçš„æœªæ¥æ˜¯å…‰æ˜çš„ã€‚ä»–ä»¬å¯¹æ”¯æŒè¯¥é¡¹ç›®çš„å›¢é˜Ÿå’ŒåŸºé‡‘ä¼šè¿›è¡Œäº†å¤§é‡æŠ•èµ„ã€‚è¿˜æœ‰å„ç§AWSæœåŠ¡ç°åœ¨ä¹Ÿå¼€å§‹æ•´åˆRustï¼ŒåŒ…æ‹¬:</p>

<p>è¦äº†è§£æ›´å¤šå…³äºåœ¨AWSä¸Šè¿è¡ŒRustçš„ä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹Rustçš„AWS SDKã€‚è¦åœ¨Lambdaä¸Šæ›´æ·±å…¥åœ°ä½¿ç”¨Rustï¼Œè¯·è®¿é—®GitHubä¸Šçš„<a href="https://github.com/awslabs/aws-lambda-rust-runtime"> Rustè¿è¡Œæ—¶åº“</a>ã€‚</p>
<p>æˆ‘å¸Œæœ›è¿™ç¯‡æ–‡ç« å¯¹å¦‚ä½•åœ¨Lambdaä¸Šè¿è¡ŒRustæ˜¯ä¸€ä¸ªæœ‰ç”¨çš„ä»‹ç»ï¼Œè¯·åœ¨ä¸‹é¢ç•™ä¸‹ä½ å¯¹è‡ªå·±ç»å†çš„è¯„è®ºï¼</p><div class="code-block code-block-29">
<div class="blog-plug inline-plug rust-plug"><h2><a href="https://lp.logrocket.com/blg/rust-signup" target="_blank">log rocket</a>:Ruståº”ç”¨çš„webå‰ç«¯çš„å…¨é¢å¯è§æ€§</h2><p>è°ƒè¯•Ruståº”ç”¨ç¨‹åºå¯èƒ½å¾ˆå›°éš¾ï¼Œå°¤å…¶æ˜¯å½“ç”¨æˆ·é‡åˆ°éš¾ä»¥é‡ç°çš„é—®é¢˜æ—¶ã€‚å¦‚æœæ‚¨å¯¹ç›‘æ§å’Œè·Ÿè¸ªRuståº”ç”¨ç¨‹åºçš„æ€§èƒ½ã€è‡ªåŠ¨æ˜¾ç¤ºé”™è¯¯ã€è·Ÿè¸ªç¼“æ…¢çš„ç½‘ç»œè¯·æ±‚å’ŒåŠ è½½æ—¶é—´æ„Ÿå…´è¶£ï¼Œ</p><a href="https://lp.logrocket.com/blg/rust-signup" target="_blank">try LogRocket</a><p>. </p><a class="signup" href="https://lp.logrocket.com/blg/rust-signup" target="_blank" rel="noopener noreferrer"><img class="alignnone size-full wp-image-46 jetpack-lazy-image" src="../Images/d6f5a5dd739296c1dd7aab3d5e77eeb9.png" alt="LogRocket Dashboard Free Trial Banner" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png"/><noscript><img data-lazy-fallback="1" class="alignnone size-full wp-image-46" src="../Images/d6f5a5dd739296c1dd7aab3d5e77eeb9.png" alt="LogRocket Dashboard Free Trial Banner" data-original-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png"/></noscript></a><p>LogRocket å°±åƒæ˜¯ç½‘ç»œå’Œç§»åŠ¨åº”ç”¨ç¨‹åºçš„DVRï¼Œè®°å½•ä½ çš„Ruståº”ç”¨ç¨‹åºä¸Šå‘ç”Ÿçš„ä¸€åˆ‡ã€‚æ‚¨å¯ä»¥æ±‡æ€»å¹¶æŠ¥å‘Šé—®é¢˜å‘ç”Ÿæ—¶åº”ç”¨ç¨‹åºçš„çŠ¶æ€ï¼Œè€Œä¸æ˜¯çŒœæµ‹é—®é¢˜å‘ç”Ÿçš„åŸå› ã€‚LogRocketè¿˜å¯ä»¥ç›‘æ§åº”ç”¨çš„æ€§èƒ½ï¼ŒæŠ¥å‘Šå®¢æˆ·ç«¯CPUè´Ÿè½½ã€å®¢æˆ·ç«¯å†…å­˜ä½¿ç”¨ç­‰æŒ‡æ ‡ã€‚</p><p>ç°ä»£åŒ–è°ƒè¯•Ruståº”ç”¨çš„æ–¹å¼â€” <a class="signup" href="https://lp.logrocket.com/blg/rust-signup" target="_blank" rel="noopener noreferrer">å¼€å§‹å…è´¹ç›‘æ§</a>ã€‚</p></div>


</div>

<p class="clearfix"/>
<p class="clearfix"/>
</article>

</div>    
</body>
</html>