<html>
<head>
<title>Creating a full-stack DeFi app with Polygon - LogRocket Blog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>ä½¿ç”¨ Polygon - LogRocket åšå®¢åˆ›å»ºå…¨æ ˆ DeFi åº”ç”¨ç¨‹åº</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://blog.logrocket.com/creating-full-stack-defi-app-polygon/#0001-01-01">https://blog.logrocket.com/creating-full-stack-defi-app-polygon/#0001-01-01</a></blockquote><div><article class="article-post">
<p>DeFi ç°åœ¨æ˜¯åŠ å¯†è´§å¸é¢†åŸŸçš„ä¸€ä¸ªä¸»è¦è®¨è®ºè¯é¢˜ã€‚DeFi ä»£è¡¨â€œåˆ†æ•£é‡‘èâ€ï¼Œè¿™æ„å‘³ç€æ²¡æœ‰ä¸­å¤®æƒåŠ›æœºæ„æ¥ç›‘ç£å’Œæ§åˆ¶èµ„é‡‘çš„è½¬ç§»ã€‚è¿™ä¹Ÿæ„å‘³ç€ DeFi ä¸­çš„äº¤æ˜“æ˜¯ P2P(ç‚¹å¯¹ç‚¹)ï¼Œè¿™æ„å‘³ç€æ²¡æœ‰ä¸­å¤®æœºæ„è´Ÿè´£è½¬è´¦ï¼Œèµ„é‡‘ç›´æ¥ä»ä¸€ä¸ªå®ä½“å‘é€åˆ°å¦ä¸€ä¸ªå®ä½“ã€‚</p>
<p>åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†å­¦ä¹ å¦‚ä½•é€šè¿‡ä½¿ç”¨ Next.js ä½œä¸ºå‰ç«¯åœ¨å¤šè¾¹å½¢é“¾ä¸Šåˆ¶ä½œä¸€ä¸ªå…¨æ ˆ DeFi åº”ç”¨ç¨‹åºæ¥å¼€å§‹ä½¿ç”¨ DeFiã€‚è¿™ä¸ªåº”ç”¨ç¨‹åºå°†å‘ç”¨æˆ·å‡ºå”®å’Œè´­ä¹° OKToken(ä¸€ä¸ªè™šæ„çš„ä»¤ç‰Œ)ã€‚ä½†æ˜¯ï¼Œæ¯ä¸€æ¬¡è´­ä¹°äº¤æ˜“éƒ½ä¼šä»æ‚¨é€šè¿‡<a href="https://www.investopedia.com/polygon-matic-definition-5217569#:~:text=MATIC%20is%20an%20ERC%2D20%20token%2C%20meaning%20that%20it%27s%20compatible%20with%20other%20Ethereum%2Dbased%20digital%20currencies.%20MATIC%20is%20used%20to%20govern%20and%20secure%20the%20Polygon%20network%20and%20to%20pay%20network%20transaction%20fees.3" target="_blank" rel="noopener"> MATIC </a>è·å¾—çš„ä»£å¸æ•°é‡ä¸­å‡å°‘ä¸€ä¸ªä»£å¸(å‡ºå”®ä¼šä½¿è¯¥æ•°é‡å¢åŠ ä¸€ä¸ª)ã€‚è¿™ä¸æ˜¯ä¸€ä¸ªç†æƒ³çš„æ¼”ç¤ºï¼Œä½†é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæ‚¨å¯ä»¥äº†è§£å¦‚ä½•åœ¨ Solidity smart contracts ä¸­ä½¿ç”¨è‡ªå·±çš„é€»è¾‘ï¼Œå¹¶å­¦ä¹ ä½¿ç”¨ Polygon åˆ›å»ºè‡ªå·±çš„å…¨æ ˆ DeFi appã€‚</p>
<h3>å†…å®¹</h3>

<h3>è¦æ±‚</h3>
<p>è¦å¼€å§‹å­¦ä¹ æœ¬æ•™ç¨‹ï¼Œè¯·ç¡®ä¿æ‚¨å…·å¤‡ä»¥ä¸‹æ¡ä»¶:</p>

<p>æ—¢ç„¶æ‚¨å·²ç»æ£€æŸ¥äº†éœ€æ±‚ï¼Œè®©æˆ‘ä»¬ç»§ç»­åˆ›å»ºæˆ‘ä»¬çš„ Hardhat é¡¹ç›®ï¼Œä»¥ä¾¿ä¸æˆ‘ä»¬çš„<a href="https://blog.logrocket.com/daml-vs-solidity-choose-smart-contract-language/" target="_blank" rel="noopener"> Solidity smart contracts </a>ä¸€èµ·å·¥ä½œã€‚</p>
<h2 id="creating-hardhat-project">åˆ›å»ºå®‰å…¨å¸½é¡¹ç›®</h2>
<p>å¯¼èˆªåˆ°ä¸€ä¸ªå®‰å…¨ç›®å½•ï¼Œå¹¶åœ¨ç»ˆç«¯ä¸­è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥åˆå§‹åŒ–æ‚¨çš„ Hardhat é¡¹ç›®:</p>
<pre class="language-shell hljs">npx hardhat
</pre>
<p>è¿è¡Œè¯¥å‘½ä»¤åï¼Œæ‚¨åº”è¯¥ä¼šåœ¨ç»ˆç«¯ä¸­çœ‹åˆ°ä¸‹é¢çš„ Hardhat åˆå§‹åŒ–å‘å¯¼ã€‚</p>
<p><img data-attachment-id="117374" data-permalink="https://blog.logrocket.com/creating-full-stack-defi-app-polygon/hardhat-initialization/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/06/hardhat-initialization.png" data-orig-size="1802,1050" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="hardhat-initialization" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/06/hardhat-initialization-300x175.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/06/hardhat-initialization-1024x597.png" decoding="async" class="size-full wp-image-117374 aligncenter jetpack-lazy-image" src="../Images/233735526913384681be14d9952b211e.png" alt="hardhat-initialization" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/06/hardhat-initialization.png 1802w, https://blog.logrocket.com/wp-content/uploads/2022/06/hardhat-initialization-300x175.png 300w, https://blog.logrocket.com/wp-content/uploads/2022/06/hardhat-initialization-1024x597.png 1024w, https://blog.logrocket.com/wp-content/uploads/2022/06/hardhat-initialization-768x448.png 768w, https://blog.logrocket.com/wp-content/uploads/2022/06/hardhat-initialization-1536x895.png 1536w" data-lazy-sizes="(max-width: 1802px) 100vw, 1802px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/06/hardhat-initialization.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/06/hardhat-initialization.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="117374" data-permalink="https://blog.logrocket.com/creating-full-stack-defi-app-polygon/hardhat-initialization/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/06/hardhat-initialization.png" data-orig-size="1802,1050" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="hardhat-initialization" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/06/hardhat-initialization-300x175.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/06/hardhat-initialization-1024x597.png" decoding="async" loading="lazy" class="size-full wp-image-117374 aligncenter" src="../Images/233735526913384681be14d9952b211e.png" alt="hardhat-initialization" srcset="https://blog.logrocket.com/wp-content/uploads/2022/06/hardhat-initialization.png 1802w, https://blog.logrocket.com/wp-content/uploads/2022/06/hardhat-initialization-300x175.png 300w, https://blog.logrocket.com/wp-content/uploads/2022/06/hardhat-initialization-1024x597.png 1024w, https://blog.logrocket.com/wp-content/uploads/2022/06/hardhat-initialization-768x448.png 768w, https://blog.logrocket.com/wp-content/uploads/2022/06/hardhat-initialization-1536x895.png 1536w" sizes="(max-width: 1802px) 100vw, 1802px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/06/hardhat-initialization.png"/></noscript>
<p>ä»åˆ—è¡¨ä¸­é€‰æ‹©<strong>åˆ›å»ºä¸€ä¸ªé«˜çº§ç¤ºä¾‹é¡¹ç›®</strong>ã€‚ç„¶åä¼šé—®ä½ è¦åœ¨å“ªé‡Œåˆå§‹åŒ– Hardhat é¡¹ç›®ï¼›ä¸è¦æ›´æ”¹å­—æ®µï¼Œåªéœ€æŒ‰ä¸‹<strong>å›è½¦</strong>ï¼Œé¡¹ç›®å°±ä¼šåœ¨å½“å‰ç›®å½•ä¸‹åˆå§‹åŒ–ã€‚</p>
<p>ç„¶åä¼šè¯¢é—®æ‚¨æ˜¯å¦è¦å®‰è£…è¿è¡Œ Hardhat é¡¹ç›®æ‰€éœ€çš„ä¾èµ–é¡¹ã€‚æŒ‰ä¸‹<strong> y </strong>å› ä¸ºæˆ‘ä»¬å°†éœ€è¦è¿™äº›ä¾èµ–é¡¹ï¼Œç°åœ¨å®‰è£…å®ƒä»¬æ˜¯æœ€å¥½çš„ä¸»æ„ã€‚</p>
<p>ä¾èµ–é¡¹çš„å®‰è£…å°†å¼€å§‹ï¼Œå¯èƒ½éœ€è¦å‡ ç§’æˆ–å‡ åˆ†é’Ÿçš„æ—¶é—´ï¼Œå…·ä½“å–å†³äºæ‚¨æ­£åœ¨è¿è¡Œçš„è®¡ç®—æœºã€‚ç°åœ¨ï¼Œåœ¨ç»ˆç«¯ä¸­è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥å®‰è£…å¦ä¸€ä¸ªä¾èµ–é¡¹ï¼Œæˆ‘ä»¬å°†éœ€è¦å®ƒæ¥ç®€åŒ–æˆ‘ä»¬çš„ Solidity å¥‘çº¦å¼€å‘:</p>
<pre class="language-shell hljs">npm install @openzeppelin/contracts
</pre>
<p>OpenZeppelin æä¾›æ™ºèƒ½åˆçº¦æ ‡å‡†ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è‡ªå·±çš„æ™ºèƒ½åˆçº¦ä¸­ä½¿ç”¨è¿™äº›æ ‡å‡†æ¥è½»æ¾åˆ›å»º Ownableã€ERC-20 å’Œ ERC-721 ç­‰åˆçº¦ã€‚</p>
<p>æˆåŠŸå®‰è£…ä¾èµ–é¡¹åï¼Œåœ¨ä»£ç ç¼–è¾‘å™¨ä¸­æ‰“å¼€ç›®å½•ã€‚åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘å°†ä½¿ç”¨ VS ä»£ç ã€‚</p>
<p>æˆ‘ä»¬å°†åˆ›å»ºä¸¤ä¸ªæ™ºèƒ½åˆåŒ:ç¬¬ä¸€ä¸ªæ˜¯æˆ‘ä»¬çš„ ERC-20 ä»¤ç‰Œæœ¬èº«ï¼Œç¬¬äºŒä¸ªæ˜¯ä¾›åº”å•†åˆåŒï¼Œè¿™å°†ä¿ƒè¿›è¿™äº›ä»¤ç‰Œçš„è´­ä¹°å’Œé”€å”®ã€‚</p>
<h2 id="creating-smart-contracts">åˆ›å»ºæˆ‘ä»¬çš„æ™ºèƒ½åˆåŒ</h2>
<p>ç°åœ¨ï¼Œè½¬åˆ°<code>contracts</code>æ–‡ä»¶å¤¹ï¼Œåˆ›å»ºä¸€ä¸ªåä¸º<code>OKToken.sol</code>çš„æ–° Solidity æ–‡ä»¶ï¼Œå®ƒå°†åŒ…å«æˆ‘ä»¬çš„ ERC-20 ä»¤ç‰ŒåˆåŒã€‚</p>
<p>å¯¹æ­¤æ–‡ä»¶ä½¿ç”¨ä»¥ä¸‹ä»£ç :</p>
<pre class="language-sol hljs">// SPDX-License-Identifier: Unlicense
pragma solidity ^0.8.4;
import "@openzeppelin/contracts/token/ERC20/ERC20.sol";

contract OKToken is ERC20 {
    constructor() ERC20("OKT", "OKToken"){
        _mint(msg.sender, 10000 * 10 ** 18);
    }
}
</pre>
<p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬ä»<code>@openzeppelin/contracts</code>å¯¼å…¥<code>ERC20.sol</code>æ–‡ä»¶ï¼Œè¿™å°†å¸®åŠ©æˆ‘ä»¬è½»æ¾åœ°å¼€å§‹ä½¿ç”¨ ERC-20 ä»¤ç‰Œã€‚ç„¶åï¼Œåœ¨æ„é€ å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬ä¸ºä»¤ç‰Œæä¾›äº†ç¬¦å·<code>"OKT"</code>å’Œåç§°<code>"OKToken"</code>ã€‚</p>
<p>ä»£å¸åˆåŒåˆ°æ­¤ä¸ºæ­¢ï¼ç°åœ¨ï¼Œè®©æˆ‘ä»¬å¤„ç†ä¾›åº”å•†åˆåŒã€‚åœ¨<code>contracts</code>æ–‡ä»¶å¤¹ä¸‹ï¼Œç”¨ä»¥ä¸‹ä»£ç åˆ›å»ºä¸€ä¸ªåä¸º<code>OKVendor.sol</code>çš„æ–°æ–‡ä»¶:</p>
<pre class="language-sol hljs">// SPDX-License-Identifier: MIT
pragma solidity ^0.8.4;
import "./OKToken.sol";
import "@openzeppelin/contracts/access/Ownable.sol";

contract OKVendor is Ownable {
  OKToken yourToken;
  uint256 public tokensPerNativeCurrency = 100;
  event BuyTokens(address buyer, uint256 amountOfNativeCurrency, uint256 amountOfTokens);
  constructor(address tokenAddress) {
    yourToken = OKToken(tokenAddress);
  }

  function buyTokens() public payable returns (uint256 tokenAmount) {
    require(msg.value &gt; 0, "You need to send some NativeCurrency to proceed");
    uint256 amountToBuy = msg.value * tokensPerNativeCurrency;

    uint256 vendorBalance = yourToken.balanceOf(address(this));
    require(vendorBalance &gt;= amountToBuy, "Vendor contract has not enough tokens to perform transaction");

    (bool sent) = yourToken.transfer(msg.sender, amountToBuy);
    require(sent, "Failed to transfer token to user");
    tokensPerNativeCurrency = tokensPerNativeCurrency - 1;

    emit BuyTokens(msg.sender, msg.value, amountToBuy);
    return amountToBuy;
  }
  function sellTokens(uint256 tokenAmountToSell) public {

    require(tokenAmountToSell &gt; 0, "Specify an amount of token greater than zero");

    uint256 userBalance = yourToken.balanceOf(msg.sender);
    require(userBalance &gt;= tokenAmountToSell, "You have insufficient tokens");

    uint256 amountOfNativeCurrencyToTransfer = tokenAmountToSell / tokensPerNativeCurrency;
    uint256 ownerNativeCurrencyBalance = address(this).balance;
    require(ownerNativeCurrencyBalance &gt;= amountOfNativeCurrencyToTransfer, "Vendor has insufficient funds");
    (bool sent) = yourToken.transferFrom(msg.sender, address(this), tokenAmountToSell);
    require(sent, "Failed to transfer tokens from user to vendor");

    (sent,) = msg.sender.call{value: amountOfNativeCurrencyToTransfer}("");
    tokensPerNativeCurrency = tokensPerNativeCurrency + 1;
    require(sent, "Failed to send NativeCurrency to the user");
  }
  function getNumberOfTokensInNativeCurrency() public view returns(uint256) {
    return tokensPerNativeCurrency;
  }

  function withdraw() public onlyOwner {
    uint256 ownerBalance = address(this).balance;
    require(ownerBalance &gt; 0, "No NativeCurrency present in Vendor");
    (bool sent,) = msg.sender.call{value: address(this).balance}("");
    require(sent, "Failed to withdraw");
  }
}
</pre>
<p>è¿™å°†æœ‰åŠ©äºæˆ‘ä»¬æ–¹ä¾¿ä»£å¸çš„ä¹°å–ã€‚</p>
<p>åœ¨ä¸Šé¢çš„å¥‘çº¦ä¸­ï¼Œé¦–å…ˆæˆ‘ä»¬å¯¼å…¥æˆ‘ä»¬çš„ä»¤ç‰Œå¥‘çº¦ï¼Œæˆ‘ä»¬éœ€è¦å®ƒæ¥ä½¿ç”¨ä¾›åº”å•†å¥‘çº¦å’Œè°ƒç”¨å‡½æ•°ä¸æˆ‘ä»¬çš„ä»¤ç‰Œå¥‘çº¦è¿›è¡Œäº¤äº’ã€‚</p>
<p>æˆ‘ä»¬ä¹Ÿåœ¨ä»<code>@openzeppelin/contracts</code>å¯¼å…¥<code>Ownable.sol</code>ã€‚è¿™æ„å‘³ç€æ™ºèƒ½åˆçº¦çš„æ‰€æœ‰è€…å¯ä»¥è½¬ç§»å…¶æ‰€æœ‰æƒï¼Œå¹¶å¯ä»¥è®¿é—®æ‰€æœ‰è€…ä¸“æœ‰çš„åŠŸèƒ½ã€‚</p>
<p>åœ¨åˆå§‹åŒ–æ™ºèƒ½åˆçº¦ä¹‹åï¼Œæˆ‘ä»¬å®šä¹‰äº†å˜é‡<code>tokensPerNativeCurrency</code>,è¯¥å˜é‡è¡¨ç¤ºå¯ä»¥ä½¿ç”¨ 1 MATIC è´­ä¹°çš„ä»¤ç‰Œæ•°é‡ã€‚æˆ‘ä»¬å°†æ ¹æ®æ‰€è¿›è¡Œçš„äº¤æ˜“æ›´æ”¹è¯¥å·ç ã€‚</p>
<p>ç„¶åï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œå®ƒå°†æ¥å— OKToken çš„å¥‘çº¦åœ°å€ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ä¸éƒ¨ç½²çš„å¥‘çº¦è¿›è¡Œé€šä¿¡ï¼Œå¹¶å¯¹å®ƒä»¬æ‰§è¡ŒåŠŸèƒ½ã€‚</p>
<p>åœ¨<code>buyTokens()</code>å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬æ‰§è¡Œæ£€æŸ¥ä»¥ç¡®ä¿å‘æ™ºèƒ½åˆåŒå‘é€äº†é€‚å½“æ•°é‡çš„ MATICï¼Œå¹¶ä¸”ä¾›åº”å•†åˆåŒå…·æœ‰æ‰€éœ€æ•°é‡çš„ä»¤ç‰Œã€‚ç„¶åï¼Œæˆ‘ä»¬ä»ä¹‹å‰åˆ›å»ºçš„ OKToken å®ä¾‹ä¸­è°ƒç”¨å‡½æ•°<code>transfer()</code>,å°†ä»¤ç‰Œä¼ é€’ç»™è¯·æ±‚å‘é€è€…ã€‚</p>
<p>åœ¨<code>sellTokens()</code>å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬æ‰§è¡Œæ£€æŸ¥ä»¥ç¡®ä¿è¯·æ±‚å‘é€è€…æœ‰è¶³å¤Ÿçš„ä»¤ç‰Œï¼Œä»¥åŠä¾›åº”å•†åˆåŒæ˜¯å¦æœ‰è¶³å¤Ÿçš„ä»¤ç‰Œå‘é€å›è¯·æ±‚å‘é€è€…ã€‚ç„¶åï¼Œæˆ‘ä»¬ä½¿ç”¨ä¹‹å‰åˆ›å»ºçš„ OKToken å®ä¾‹ä¸­çš„<code>transferFrom()</code>å‡½æ•°å°†ä»¤ç‰Œä»è¯·æ±‚å‘é€è€…çš„é’±åŒ…è½¬ç§»åˆ°æ™ºèƒ½å¥‘çº¦ã€‚ç„¶è€Œï¼Œå‘é€è€…éœ€è¦æ‰¹å‡†è¯¥äº¤æ˜“ï¼›åœ¨å‘å‡ºè¯·æ±‚ä¹‹å‰ï¼Œæˆ‘ä»¬åœ¨å®¢æˆ·ç«¯æ‰§è¡Œè¿™ç§æ‰¹å‡†ã€‚å½“æˆ‘ä»¬åˆ¶ä½œè¿™ä¸ªåº”ç”¨ç¨‹åºçš„å‰ç«¯æ—¶ï¼Œæˆ‘ä»¬å°†è®¨è®ºè¿™ä¸€éƒ¨åˆ†ã€‚</p>
<p>æœ€åï¼Œæˆ‘ä»¬æœ‰<code>withdraw()</code>å‡½æ•°ï¼Œåªæœ‰åˆåŒçš„æ‰€æœ‰è€…æ‰èƒ½è®¿é—®å®ƒã€‚å®ƒå…è®¸ä»–ä»¬æ’¤å›åˆåŒä¸Šçš„æ‰€æœ‰æ¡æ¬¾ã€‚</p>
<p>ç°åœ¨æˆ‘ä»¬å·²ç»å‡†å¤‡å¥½äº†æ™ºèƒ½åˆçº¦ï¼Œè®©æˆ‘ä»¬å°†å®ƒä»¬éƒ¨ç½²åˆ° Polygon Mumbai testnetï¼</p>
<h2 id="deploying-smart-contracts">éƒ¨ç½²æˆ‘ä»¬çš„æ™ºèƒ½åˆåŒ</h2>
<p>æˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªè„šæœ¬æ¥éƒ¨ç½²æˆ‘ä»¬çš„åˆåŒå¤šè¾¹å½¢å­Ÿä¹°ã€‚ä¸€æ—¦éƒ¨ç½²äº†å¥‘çº¦ï¼Œæˆ‘ä»¬å°†ä»¥ç¼–ç¨‹æ–¹å¼å°†å­˜å‚¨åœ¨éƒ¨ç½²è€…é’±åŒ…ä¸­çš„æ‰€æœ‰ä»¤ç‰Œå‘é€ç»™ä¾›åº”å•†å¥‘çº¦ã€‚</p>
<p>é¦–å…ˆè½¬åˆ°<code>hardhat.config.js</code>å¹¶åœ¨<code>module.exports</code>ä¸‹ï¼Œæ·»åŠ ä»¥ä¸‹å¯¹è±¡ï¼Œä»¥ä¾¿ Hardhat çŸ¥é“è¦è¿æ¥åˆ°å“ªä¸ªç½‘ç»œ:</p>
<pre class="language-js hljs">networks: {
  mumbai: {
    url: "https://matic-mumbai.chainstacklabs.com",
    accounts: ["PRIVATE KEY HERE"],
  }
}
</pre>
<p>æˆ‘ä»¬å°†ä¸ºç½‘ç»œæä¾›ä¸€ä¸ªåç§°(åœ¨æœ¬ä¾‹ä¸­ä¸º<code>mumbai</code>),å¹¶æä¾›ä¸€ä¸ª RPC URLã€‚æåˆ°çš„ RPC ç½‘å€æ˜¯ä¸ºå¤šè¾¹å½¢å­Ÿä¹°ã€‚å¦‚æœä½ æƒ³ä½¿ç”¨å¤šè¾¹å½¢ Mainnetï¼Œä½ å¯ä»¥é€‰æ‹©ä½ çš„ RPC ç½‘å€ã€‚è¯·è®°ä½è¾“å…¥æ‚¨è‡ªå·±çš„é’±åŒ…ç§äººå¯†é’¥å’Œä¸€äº›æµ‹è¯•ç ï¼Œä»¥æ”¯ä»˜æ™ºèƒ½åˆåŒéƒ¨ç½²æµç¨‹ä¸­æ¶‰åŠçš„æ±½æ²¹è´¹ã€‚</p>
<p>ç°åœ¨ï¼Œåœ¨<code>scripts</code>æ–‡ä»¶å¤¹ä¸‹ï¼Œåˆ›å»ºä¸€ä¸ªåä¸º<code>deploy.js</code>çš„æ–°æ–‡ä»¶ã€‚ç²˜è´´ä»¥ä¸‹å†…å®¹:</p>
<pre class="language-js hljs">const { BigNumber, utils } = require("ethers");
const hardhat = require("hardhat");
async function main() {
  const OKToken = await hardhat.ethers.getContractFactory("OKToken");
  const oktoken = await OKToken.deploy();
  await oktoken.deployed();
  console.log("[ğŸ“¥] OKToken deployed to address: " + oktoken.address);
  const OKVendor = await hardhat.ethers.getContractFactory("OKVendor");
  const okvendor = await OKVendor.deploy(oktoken.address);
  console.log("[ğŸ“¥] OKVendor deployed to address: " + okvendor.address);
  await oktoken.deployed();
  // Transfer oktokens to vendor
  await oktoken.functions.transfer(okvendor.address, utils.parseEther("10000"));
  console.log("[ğŸš€] Tokens transferred to OKVendor");
}
main()
  .then(() =&gt; process.exit(0))
  .catch((error) =&gt; {
    console.error(error);
    process.exit(1);
});
</pre>
<p>åœ¨ä¸Šé¢çš„æ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬æ­£åœ¨æŒ‡å¯¼ Hardhat å¦‚ä½•éƒ¨ç½²æˆ‘ä»¬çš„åˆåŒã€‚<code>main()</code>å‡½æ•°æ˜¯è¿™é‡Œçš„å…¥å£ç‚¹ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬è·å¾—<code>OKToken</code>å¥‘çº¦å¹¶éƒ¨ç½²å®ƒã€‚ç„¶åï¼Œæˆ‘ä»¬è·å¾—<code>OKVendor</code>å¥‘çº¦ï¼Œåœ¨æ„é€ å‡½æ•°ä¸­æä¾›<code>OKToken</code>å¥‘çº¦åœ°å€ï¼Œå¹¶éƒ¨ç½²å¥‘çº¦ã€‚ç„¶åï¼Œæˆ‘ä»¬å°†æ‰€æœ‰èµ„é‡‘ä»<code>OKToken</code>åˆåŒè½¬ç§»åˆ°<code>OKVendor</code>åˆåŒã€‚</p>
<p>åœ¨ç»ˆç«¯ä¸­è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥è¿è¡Œè„šæœ¬ï¼Œå¹¶å°†æˆ‘ä»¬çš„åˆåŒéƒ¨ç½²åˆ° Polygon Mumbai ç½‘ç»œ:</p>
<pre class="language-shell hljs">npx hardhat run --network mumbai scripts/deploy.js --show-stack-traces
</pre>
<p>è¯·æ³¨æ„ï¼Œç½‘ç»œåç§°å¿…é¡»ä¸<code>hardhat.config.js</code>ä¸­æåˆ°çš„åç§°ç›¸åŒ¹é…ã€‚è¿è¡Œè¯¥è„šæœ¬åï¼Œåº”è¯¥å·²ç»éƒ¨ç½²äº†å¥‘çº¦ï¼Œæ‚¨åº”è¯¥åœ¨ç»ˆç«¯ä¸­çœ‹åˆ°ä»¥ä¸‹å†…å®¹:</p>
<p><img data-attachment-id="117383" data-permalink="https://blog.logrocket.com/creating-full-stack-defi-app-polygon/deployed-oktoken-contracts/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/06/deployed-OKToken-contracts.png" data-orig-size="730,138" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="deployed OKToken contracts" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/06/deployed-OKToken-contracts-300x57.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/06/deployed-OKToken-contracts.png" decoding="async" class="size-full wp-image-117383 aligncenter jetpack-lazy-image" src="../Images/1ccd24c710417430de8a87a5f8364c8e.png" alt="deployed OKToken contracts" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/06/deployed-OKToken-contracts.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/06/deployed-OKToken-contracts-300x57.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/06/deployed-OKToken-contracts.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/06/deployed-OKToken-contracts.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="117383" data-permalink="https://blog.logrocket.com/creating-full-stack-defi-app-polygon/deployed-oktoken-contracts/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/06/deployed-OKToken-contracts.png" data-orig-size="730,138" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="deployed OKToken contracts" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/06/deployed-OKToken-contracts-300x57.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/06/deployed-OKToken-contracts.png" decoding="async" loading="lazy" class="size-full wp-image-117383 aligncenter" src="../Images/1ccd24c710417430de8a87a5f8364c8e.png" alt="deployed OKToken contracts" srcset="https://blog.logrocket.com/wp-content/uploads/2022/06/deployed-OKToken-contracts.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/06/deployed-OKToken-contracts-300x57.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/06/deployed-OKToken-contracts.png"/></noscript>
<p>å¦‚æœæ‚¨çœ‹åˆ°ç±»ä¼¼ä»¥ä¸‹å†…å®¹çš„è¾“å‡ºï¼Œåˆ™æ‚¨çš„æ™ºèƒ½åˆçº¦å·²æˆåŠŸéƒ¨ç½²å’Œé…ç½®ã€‚ç°åœ¨ï¼Œè®©æˆ‘ä»¬ç»§ç»­åˆ›å»º Next.js åº”ç”¨ç¨‹åºã€‚</p>
<h2 id="creating-next-js-defi-app">åˆ›å»º Next.js DeFi åº”ç”¨ç¨‹åº</h2>
<p>åœ¨åŒä¸€ç›®å½•ä¸‹ï¼Œåœ¨ç»ˆç«¯ä¸­è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥åˆ›å»º Next.js åº”ç”¨ç¨‹åº:</p>
<pre class="language-shell hljs">npx create-next-app frontend
</pre>
<p>ä¸Šè¿°å‘½ä»¤å°†åˆ›å»ºä¸€ä¸ªæ–°çš„åº”ç”¨ç¨‹åºï¼Œå¹¶è‡ªåŠ¨å®‰è£…å¿…è¦çš„ä¾èµ–é¡¹ã€‚</p>
<p>å¯¼èˆªåˆ°<code>frontend</code>æ–‡ä»¶å¤¹ï¼Œåœ¨ç»ˆç«¯ä¸­ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥å®‰è£…é™„åŠ çš„ä¾èµ–é¡¹ï¼Œè¿™å°†å¸®åŠ©æˆ‘ä»¬ä¸æ™ºèƒ½åˆåŒè¿›è¡Œäº¤äº’:</p>
<pre class="language-shell hljs">yarn add @thirdweb-dev/react @thirdweb-dev/sdk ethers web3
</pre>
<p>æˆ‘ä»¬æ­£åœ¨å®‰è£…<code>@thirdweb-dev/react</code>å’Œ<code>@thirdweb-dev/sdk</code>ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨<a href="https://blog.logrocket.com/understanding-resolving-metamask-error-codes/" target="_blank" rel="noopener">å…ƒæ©ç </a>è½»æ¾è®¤è¯ç”¨æˆ·å¹¶å°†å…¶é’±åŒ…è¿æ¥åˆ°æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºã€‚<code>ethers</code>æ˜¯ thirdweb å¿…éœ€çš„ä¾èµ–é¡¹ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¹Ÿéœ€è¦å®‰è£…å®ƒã€‚æœ€åï¼Œæˆ‘ä»¬æ­£åœ¨å®‰è£…<code>web3</code>ï¼Œä»¥ä¾¿æˆ‘ä»¬å¯ä»¥ä¸æˆ‘ä»¬çš„æ™ºèƒ½åˆåŒè¿›è¡Œäº¤äº’ã€‚</p>
<h2 id="adding-thirdweb-provider">æ·»åŠ ç¬¬ä¸‰æ–¹ web æä¾›ç¨‹åº</h2>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦å°†æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºå°è£…åœ¨ä¸€ä¸ª<code>thirdwebProvider</code>ä¸­ï¼Œè¿™æ · thirdweb æ‰èƒ½æ­£å¸¸è¿è¡Œã€‚</p>
<p>è½¬åˆ°<code>pages</code>æ–‡ä»¶å¤¹ä¸‹çš„<code>_app.js</code>æ–‡ä»¶ï¼Œæ·»åŠ ä»¥ä¸‹å†…å®¹:</p>
<pre class="language-js hljs">import { thirdwebProvider, ChainId } from "@thirdweb-dev/react";
import "../styles/globals.css";
function MyApp({ Component, pageProps }) {
  return (
    &lt;thirdwebProvider desiredChainId={ChainId.Mumbai}&gt;
      &lt;Component {...pageProps} /&gt;
    &lt;/thirdwebProvider&gt;
  );
}
export default MyApp;
</pre>
<p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬å¯¼å…¥äº†<code>thirdwebProvider</code>ï¼Œå¹¶å°†æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºå°è£…åœ¨å…¶ä¸­ã€‚æˆ‘ä»¬è¿˜æä¾›äº†å¤šè¾¹å½¢å­Ÿä¹°çš„é“¾ ID çš„<code>desiredChainId</code>ã€‚å¦‚æœæ‚¨æ„¿æ„ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å¤šè¾¹å½¢ Mainnet çš„é“¾ IDã€‚</p>
<p>åœ¨ Next.js åº”ç”¨ç¨‹åºæ ¹ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªåä¸º<code>contracts.js</code>çš„æ–°æ–‡ä»¶ï¼Œå¹¶æ·»åŠ ä»¥ä¸‹å†…å®¹:</p>
<pre class="language-js hljs">export const oktoken = {
  contractAddress: "0xE83DD81890C76BB8c4b8Bc6365Ad95E5e71495E5",
  abi: [
    {
      inputs: [],
      stateMutability: "nonpayable",
      type: "constructor",
    },
    {
      anonymous: false,
      inputs: [
        {
          indexed: true,
          internalType: "address",
          name: "owner",
          type: "address",
        },
        {
          indexed: true,
          internalType: "address",
          name: "spender",
          type: "address",
        },
        {
          indexed: false,
          internalType: "uint256",
          name: "value",
          type: "uint256",
        },
      ],
      name: "Approval",
      type: "event",
    },
    {
      anonymous: false,
      inputs: [
        {
          indexed: true,
          internalType: "address",
          name: "from",
          type: "address",
        },
        {
          indexed: true,
          internalType: "address",
          name: "to",
          type: "address",
        },
        {
          indexed: false,
          internalType: "uint256",
          name: "value",
          type: "uint256",
        },
      ],
      name: "Transfer",
      type: "event",
    },
    {
      inputs: [
        {
          internalType: "address",
          name: "owner",
          type: "address",
        },
        {
          internalType: "address",
          name: "spender",
          type: "address",
        },
      ],
      name: "allowance",
      outputs: [
        {
          internalType: "uint256",
          name: "",
          type: "uint256",
        },
      ],
      stateMutability: "view",
      type: "function",
    },
    {
      inputs: [
        {
          internalType: "address",
          name: "spender",
          type: "address",
        },
        {
          internalType: "uint256",
          name: "amount",
          type: "uint256",
        },
      ],
      name: "approve",
      outputs: [
        {
          internalType: "bool",
          name: "",
          type: "bool",
        },
      ],
      stateMutability: "nonpayable",
      type: "function",
    },
    {
      inputs: [
        {
          internalType: "address",
          name: "account",
          type: "address",
        },
      ],
      name: "balanceOf",
      outputs: [
        {
          internalType: "uint256",
          name: "",
          type: "uint256",
        },
      ],
      stateMutability: "view",
      type: "function",
    },
    {
      inputs: [],
      name: "decimals",
      outputs: [
        {
          internalType: "uint8",
          name: "",
          type: "uint8",
        },
      ],
      stateMutability: "view",
      type: "function",
    },
    {
      inputs: [
        {
          internalType: "address",
          name: "spender",
          type: "address",
        },
        {
          internalType: "uint256",
          name: "subtractedValue",
          type: "uint256",
        },
      ],
      name: "decreaseAllowance",
      outputs: [
        {
          internalType: "bool",
          name: "",
          type: "bool",
        },
      ],
      stateMutability: "nonpayable",
      type: "function",
    },
    {
      inputs: [
        {
          internalType: "address",
          name: "spender",
          type: "address",
        },
        {
          internalType: "uint256",
          name: "addedValue",
          type: "uint256",
        },
      ],
      name: "increaseAllowance",
      outputs: [
        {
          internalType: "bool",
          name: "",
          type: "bool",
        },
      ],
      stateMutability: "nonpayable",
      type: "function",
    },
    {
      inputs: [],
      name: "name",
      outputs: [
        {
          internalType: "string",
          name: "",
          type: "string",
        },
      ],
      stateMutability: "view",
      type: "function",
    },
    {
      inputs: [],
      name: "symbol",
      outputs: [
        {
          internalType: "string",
          name: "",
          type: "string",
        },
      ],
      stateMutability: "view",
      type: "function",
    },
    {
      inputs: [],
      name: "totalSupply",
      outputs: [
        {
          internalType: "uint256",
          name: "",
          type: "uint256",
        },
      ],
      stateMutability: "view",
      type: "function",
    },
    {
      inputs: [
        {
          internalType: "address",
          name: "to",
          type: "address",
        },
        {
          internalType: "uint256",
          name: "amount",
          type: "uint256",
        },
      ],
      name: "transfer",
      outputs: [
        {
          internalType: "bool",
          name: "",
          type: "bool",
        },
      ],
      stateMutability: "nonpayable",
      type: "function",
    },
    {
      inputs: [
        {
          internalType: "address",
          name: "from",
          type: "address",
        },
        {
          internalType: "address",
          name: "to",
          type: "address",
        },
        {
          internalType: "uint256",
          name: "amount",
          type: "uint256",
        },
      ],
      name: "transferFrom",
      outputs: [
        {
          internalType: "bool",
          name: "",
          type: "bool",
        },
      ],
      stateMutability: "nonpayable",
      type: "function",
    },
  ],
};
export const okvendor = {
  contractAddress: "0xAa3b8cbB24aF3EF68a0B1760704C969E57c53D7A",
  abi: [
    {
      inputs: [
        {
          internalType: "address",
          name: "tokenAddress",
          type: "address",
        },
      ],
      stateMutability: "nonpayable",
      type: "constructor",
    },
    {
      anonymous: false,
      inputs: [
        {
          indexed: false,
          internalType: "address",
          name: "buyer",
          type: "address",
        },
        {
          indexed: false,
          internalType: "uint256",
          name: "amountOfNativeCurrency",
          type: "uint256",
        },
        {
          indexed: false,
          internalType: "uint256",
          name: "amountOfTokens",
          type: "uint256",
        },
      ],
      name: "BuyTokens",
      type: "event",
    },
    {
      anonymous: false,
      inputs: [
        {
          indexed: true,
          internalType: "address",
          name: "previousOwner",
          type: "address",
        },
        {
          indexed: true,
          internalType: "address",
          name: "newOwner",
          type: "address",
        },
      ],
      name: "OwnershipTransferred",
      type: "event",
    },
    {
      inputs: [],
      name: "buyTokens",
      outputs: [
        {
          internalType: "uint256",
          name: "tokenAmount",
          type: "uint256",
        },
      ],
      stateMutability: "payable",
      type: "function",
    },
    {
      inputs: [],
      name: "getNumberOfTokensInNativeCurrency",
      outputs: [
        {
          internalType: "uint256",
          name: "",
          type: "uint256",
        },
      ],
      stateMutability: "view",
      type: "function",
    },
    {
      inputs: [],
      name: "owner",
      outputs: [
        {
          internalType: "address",
          name: "",
          type: "address",
        },
      ],
      stateMutability: "view",
      type: "function",
    },
    {
      inputs: [],
      name: "renounceOwnership",
      outputs: [],
      stateMutability: "nonpayable",
      type: "function",
    },
    {
      inputs: [
        {
          internalType: "uint256",
          name: "tokenAmountToSell",
          type: "uint256",
        },
      ],
      name: "sellTokens",
      outputs: [],
      stateMutability: "nonpayable",
      type: "function",
    },
    {
      inputs: [],
      name: "tokensPerNativeCurrency",
      outputs: [
        {
          internalType: "uint256",
          name: "",
          type: "uint256",
        },
      ],
      stateMutability: "view",
      type: "function",
    },
    {
      inputs: [
        {
          internalType: "address",
          name: "newOwner",
          type: "address",
        },
      ],
      name: "transferOwnership",
      outputs: [],
      stateMutability: "nonpayable",
      type: "function",
    },
    {
      inputs: [],
      name: "withdraw",
      outputs: [],
      stateMutability: "nonpayable",
      type: "function",
    },
  ],
};
</pre>
<p>è®°ä½ç”¨æ‚¨è‡ªå·±çš„åœ°å€æ›¿æ¢åˆåŒåœ°å€ï¼Œä»¥ä¾¿ Next.js åº”ç”¨ç¨‹åºå°è¯•è¿æ¥åˆ°æ­£ç¡®çš„æ™ºèƒ½åˆåŒã€‚</p>
<p>ç°åœ¨è®©æˆ‘ä»¬å¼€å§‹ç¼–å†™æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºã€‚æ‰“å¼€<code>pages</code>æ–‡ä»¶å¤¹ä¸‹çš„<code>index.js</code>æ–‡ä»¶ï¼Œæ·»åŠ ä»¥ä¸‹å†…å®¹:</p>
<pre class="language-js hljs">import { useAddress, useContract, useMetamask } from "@thirdweb-dev/react";
import Head from "next/head";
import Image from "next/image";
import { oktoken, okvendor } from "../contracts";
import styles from "../styles/Home.module.css";
import { useEffect, useState } from "react";
import Web3 from "web3";
const web3 = new Web3(Web3.givenProvider);
export default function Home() {
  const [tokensPerCurrency, setTokensPerCurrency] = useState(0);
  const [tokens, setTokens] = useState(0);
  const address = useAddress();
  const connectUsingMetamask = useMetamask();
  const account = web3.defaultAccount;
  const purchase = async () =&gt; {
    const contract = new web3.eth.Contract(
      okvendor.abi,
      okvendor.contractAddress
    );
    const ethToSend = tokens / tokensPerCurrency;
    const purchase = await contract.methods.buyTokens().send({
      from: address,
      value: web3.utils.toWei(ethToSend.toString(), "ether"),
    });
    console.log(purchase);
    await fetchPrice();
  };
  const sell = async () =&gt; {
    const vendorContract = new web3.eth.Contract(
      okvendor.abi,
      okvendor.contractAddress
    );
    const tokenContract = new web3.eth.Contract(
      oktoken.abi,
      oktoken.contractAddress
    );
    const approve = await tokenContract.methods
      .approve(
        okvendor.contractAddress,
        web3.utils.toWei(tokens.toString(), "ether")
      )
      .send({
        from: address,
      });
    const sellTokens = await vendorContract.methods.sellTokens(tokens).send({
      from: address,
    });
    await fetchPrice();
  };
  const fetchPrice = async () =&gt; {
    const contract = new web3.eth.Contract(
      okvendor.abi,
      okvendor.contractAddress
    );
    const priceFromContract = await contract.methods
      .getNumberOfTokensInNativeCurrency()
      .call();
    setTokensPerCurrency(priceFromContract);
  };
  useEffect(() =&gt; {
    fetchPrice();
  }, []);
  return (
    &lt;div&gt;
      &lt;Head&gt;
        &lt;title&gt;Exchange OKTokens&lt;/title&gt;
      &lt;/Head&gt;
      {address ? (
        &lt;div&gt;
          &lt;p&gt;Tokens per currency: {tokensPerCurrency}&lt;/p&gt;
          &lt;div&gt;
            &lt;input
              type="number"
              value={tokens}
              onChange={(e) =&gt; setTokens(e.target.value)}
            /&gt;
          &lt;/div&gt;
          &lt;button onClick={purchase}&gt;Purchase&lt;/button&gt;
          &lt;button onClick={sell}&gt;Sell&lt;/button&gt;
        &lt;/div&gt;
      ) : (
        &lt;div&gt;
          &lt;button onClick={connectUsingMetamask}&gt;Connect using MetaMask&lt;/button&gt;
        &lt;/div&gt;
      )}
    &lt;/div&gt;
  );
}
</pre>
<p>è¿™æ˜¯ä¸€ä¸ªå¾ˆé•¿çš„ä»£ç å—ï¼Œæ‰€ä»¥è®©æˆ‘ä»¬ä¸€æ­¥ä¸€æ­¥åœ°çœ‹çœ‹ä»£ç åœ¨åšä»€ä¹ˆ:</p>
<ul>
<li>ä½¿ç”¨ thirdweb è®¾ç½®çš„æä¾›ç¨‹åºåˆå§‹åŒ–<code>web3</code>åŒ…</li>
<li>ä½¿ç”¨ç¬¬ä¸‰ä¸ª web æŒ‚é’©<code>useMetamask()</code>è¿›è¡ŒéªŒè¯ï¼Œä½¿ç”¨<code>useAddress()</code>æ£€æŸ¥éªŒè¯çŠ¶æ€ï¼Œå¦‚æœç”¨æˆ·æ²¡æœ‰ä½¿ç”¨å…ƒæ©ç è¿æ¥é’±åŒ…ï¼Œåˆ™å‘ˆç°ç™»å½•æŒ‰é’®</li>
<li>åœ¨æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºä¸­è®¾ç½®å„ç§çŠ¶æ€æ¥æ˜ å°„æ–‡æœ¬æ¡†</li>
<li>åˆ›å»ºä¸€ä¸ª<code>fetchPrice()</code>å‡½æ•°æ¥ä¸æˆ‘ä»¬çš„æ™ºèƒ½åˆçº¦äº¤äº’ï¼Œå¹¶æ£€æŸ¥ä¸€ä¸ª MATIC å¯ä»¥è·å¾—å¤šå°‘ä»¤ç‰Œï¼ŒåŒæ—¶è¿˜åˆ›å»ºä¸€ä¸ª<code>useEffect</code>æ¥åœ¨é¡µé¢åŠ è½½æ—¶æ£€æŸ¥è¿™ä¸ªä»·æ ¼</li>
<li>åˆ›å»ºä¸€ä¸ª<code>purchase()</code>å‡½æ•°ï¼Œè¯¥å‡½æ•°åˆå§‹åŒ–æˆ‘ä»¬çš„ä¾›åº”å•†å¥‘çº¦å¹¶ä»å¥‘çº¦ä¸­è°ƒç”¨<code>buyTokens()</code>å‡½æ•°ï¼Œç„¶åéšè¯¥äº‹åŠ¡ä¸€èµ·å‘é€ä¸€äº› MATICã€‚ç„¶åï¼Œæˆ‘ä»¬ç»™<code>fetchPrice()</code>æ‰“ç”µè¯ï¼Œä»¥ä¾¿æ˜¾ç¤ºæœ€æ–°çš„ä»·æ ¼</li>
</ul>
<p>æœ€åï¼Œæˆ‘ä»¬æ­£åœ¨åˆ›å»ºä¸€ä¸ª<code>sell()</code>å‡½æ•°ï¼Œå®ƒåˆå§‹åŒ–ä»¤ç‰Œå’Œä¾›åº”å•†å¥‘çº¦ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬ä¸ token contract çš„<code>approve()</code>å‡½æ•°è¿›è¡Œäº¤äº’ï¼Œå¹¶å…è®¸ä¾›åº”å•†åˆåŒä»£è¡¨æˆ‘ä»¬è½¬ç§»èµ„é‡‘ã€‚ç„¶åï¼Œæˆ‘ä»¬ä»ä¾›åº”å•†å¥‘çº¦ä¸­è°ƒç”¨<code>sellTokens()</code>å‡½æ•°ï¼Œæœ€ç»ˆå‡ºå”®ä»¤ç‰Œå¹¶æ¥æ”¶ MATICã€‚æˆ‘ä»¬ä¹Ÿåœ¨å‘¼å«<code>fetchPrice()</code>ä»¥è·å¾—äº¤æ˜“åçš„æœ€æ–°ä»·æ ¼ã€‚</p>
<p>æˆ‘ä»¬ç®€å•çš„ DeFi åº”ç”¨ç¨‹åºæ˜¯å®Œæ•´çš„ï¼æ‚¨å¯ä»¥é€šè¿‡è¿è¡Œä»¥ä¸‹å‘½ä»¤åœ¨æµè§ˆå™¨ä¸­æŸ¥çœ‹æ­¤åº”ç”¨ç¨‹åº:</p>
<pre class="language-shell hljs">yarn dev
</pre>
<p>ç°åœ¨ä¸€æ—¦ä½ è®¿é—®<a href="http://localhost:3000" rel="nofollow"> http://localhost:3000 </a>ï¼Œä½ åº”è¯¥ä¼šçœ‹åˆ°ä¸‹é¢çš„å±å¹•ï¼Œä½ åº”è¯¥å¯ä»¥è¿›è¡Œäº¤æ˜“ã€‚</p>
<p><img data-attachment-id="117386" data-permalink="https://blog.logrocket.com/creating-full-stack-defi-app-polygon/transaction-functionality/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/06/transaction-functionality.png" data-orig-size="185,109" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="transaction functionality" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/06/transaction-functionality.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/06/transaction-functionality.png" decoding="async" class="size-full wp-image-117386 aligncenter jetpack-lazy-image" src="../Images/dcc80c76154f37696e90d6cac8ef2da7.png" alt="transaction functionality" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/06/transaction-functionality.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/06/transaction-functionality.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="117386" data-permalink="https://blog.logrocket.com/creating-full-stack-defi-app-polygon/transaction-functionality/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/06/transaction-functionality.png" data-orig-size="185,109" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="transaction functionality" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/06/transaction-functionality.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/06/transaction-functionality.png" decoding="async" loading="lazy" class="size-full wp-image-117386 aligncenter" src="../Images/dcc80c76154f37696e90d6cac8ef2da7.png" alt="transaction functionality" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/06/transaction-functionality.png"/></noscript>
<h2>ç»“è®º</h2>
<p>è¿™æ˜¯ä¸€ä¸ªç®€å•çš„æ•™ç¨‹ï¼Œä»‹ç»å¦‚ä½•åŸºäºå¤šè¾¹å½¢åˆ›å»ºè‡ªå·±çš„å…¨æ ˆ DeFi åº”ç”¨ç¨‹åºã€‚æ‚¨å¯ä»¥åœ¨æ™ºèƒ½åˆçº¦ä¸Šå®ç°æ‚¨è‡ªå·±çš„é€»è¾‘ï¼Œæ ¹æ®æ‚¨çš„ç»„ç»‡ä½¿å®ƒå˜å¾—æ›´å¥½ã€‚æˆ‘å»ºè®®ä¿®æ”¹ä¸€ä¸‹ä»£ç ï¼Œè¿™æ ·ä½ å°±èƒ½ä»¥æœ€å¥½çš„æ–¹å¼å­¦ä¹ ã€‚</p><div class="code-block code-block-26">
<div class="blog-plug inline-plug blockchain-plug"><h2>åŠ å…¥åƒ Bitso å’Œ Coinsquare è¿™æ ·çš„ç»„ç»‡ï¼Œä»–ä»¬ä½¿ç”¨ LogRocket ä¸»åŠ¨ç›‘æ§ä»–ä»¬çš„ Web3 åº”ç”¨</h2><p>å½±å“ç”¨æˆ·åœ¨æ‚¨çš„åº”ç”¨ä¸­æ¿€æ´»å’Œäº¤æ˜“çš„èƒ½åŠ›çš„å®¢æˆ·ç«¯é—®é¢˜ä¼šæå¤§åœ°å½±å“æ‚¨çš„åº•çº¿ã€‚å¦‚æœæ‚¨å¯¹ç›‘æ§ UX é—®é¢˜ã€è‡ªåŠ¨æ˜¾ç¤º JavaScript é”™è¯¯ã€è·Ÿè¸ªç¼“æ…¢çš„ç½‘ç»œè¯·æ±‚å’Œç»„ä»¶åŠ è½½æ—¶é—´æ„Ÿå…´è¶£ï¼Œ</p><a target="_blank" href="https://lp.logrocket.com/blg/web3-signup">try LogRocket</a><p>.</p><a class="signup" href="https://lp.logrocket.com/blg/web3-signup" target="_blank" rel="noopener noreferrer"><img class="alignnone size-full wp-image-46 jetpack-lazy-image" src="../Images/dacb06c713aec161ffeaffae5bd048cd.png" alt="LogRocket Dashboard Free Trial Banner" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2019/12/cpu-memory-usage.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/12/cpu-memory-usage.png"/><noscript><img data-lazy-fallback="1" class="alignnone size-full wp-image-46" src="../Images/dacb06c713aec161ffeaffae5bd048cd.png" alt="LogRocket Dashboard Free Trial Banner" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/12/cpu-memory-usage.png"/></noscript></a><a href="https://lp.logrocket.com/blg/web3-signup" target="_blank" rel="noopener noreferrer">https://logrocket.com/signup/</a><p>LogRocket å°±åƒæ˜¯ç½‘ç»œå’Œç§»åŠ¨åº”ç”¨çš„ DVRï¼Œè®°å½•ä½ çš„ç½‘ç»œåº”ç”¨æˆ–ç½‘ç«™ä¸Šå‘ç”Ÿçš„ä¸€åˆ‡ã€‚æ‚¨å¯ä»¥æ±‡æ€»å’ŒæŠ¥å‘Šå…³é”®çš„å‰ç«¯æ€§èƒ½æŒ‡æ ‡ï¼Œé‡æ”¾ç”¨æˆ·ä¼šè¯å’Œåº”ç”¨ç¨‹åºçŠ¶æ€ï¼Œè®°å½•ç½‘ç»œè¯·æ±‚ï¼Œå¹¶è‡ªåŠ¨æ˜¾ç¤ºæ‰€æœ‰é”™è¯¯ï¼Œè€Œä¸æ˜¯çŒœæµ‹é—®é¢˜å‘ç”Ÿçš„åŸå› ã€‚</p><p>ç°ä»£åŒ–æ‚¨è°ƒè¯• web å’Œç§»åŠ¨åº”ç”¨çš„æ–¹å¼â€” <a class="signup" href="https://lp.logrocket.com/blg/web3-signup" target="_blank" rel="noopener noreferrer">å¼€å§‹å…è´¹ç›‘æ§</a>ã€‚</p></div>
</div>

<p class="clearfix"/>
<p class="clearfix"/>
</article>

</div>    
</body>
</html>