<html>
<head>
<title>Implementing a secure password reset in Node.js - LogRocket Blog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>åœ¨ Node.js - LogRocket åšå®¢ä¸­å®ç°å®‰å…¨å¯†ç é‡ç½®</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://blog.logrocket.com/implementing-secure-password-reset-node-js/#0001-01-01">https://blog.logrocket.com/implementing-secure-password-reset-node-js/#0001-01-01</a></blockquote><div><article class="article-post">
<p><em> <strong>ç¼–è€…æŒ‰:</strong>è¿™ç¯‡å…³äºåœ¨ Node.js ä¸­å®ç°å®‰å…¨å¯†ç é‡ç½®çš„æŒ‡å—æœ€åä¸€æ¬¡æ›´æ–°æ˜¯åœ¨ 2023 å¹´ 1 æœˆ 6 æ—¥ï¼Œæ›´æ–°äº†æ‰€æœ‰è¿‡æ—¶çš„ä¿¡æ¯ï¼Œå¢åŠ äº†å…³äº Postman ä¸­ API æµ‹è¯•çš„ä¸€èŠ‚ï¼Œå¹¶æ¾„æ¸…äº†å…³äºåœ¨ Node.js ä¸­å®ç°å¿˜è®°å¯†ç é‡ç½®çš„ä¸€èŠ‚ï¼Œä½ å¯ä»¥åœ¨è¿™é‡Œäº†è§£æ›´å¤šå…³äº web å®‰å…¨çš„<a href="https://blog.logrocket.com/web-security-101/">ã€‚</a></em></p>
<p>åˆ›å»ºä¸€ä¸ªä½ èƒ½è®°ä½çš„å¼ºå¯†ç å¹¶ä¸å®¹æ˜“ã€‚ä¸ºä¸åŒç½‘ç«™ä½¿ç”¨å”¯ä¸€å¯†ç çš„ç”¨æˆ·(è¿™æ˜¯ç†æƒ³çš„)æ›´å®¹æ˜“å¿˜è®°ä»–ä»¬çš„å¯†ç ã€‚å› æ­¤ï¼Œæ·»åŠ ä¸€ä¸ªå…è®¸ç”¨æˆ·åœ¨å¿˜è®°å¯†ç æ—¶å®‰å…¨é‡ç½®å¯†ç çš„åŠŸèƒ½è‡³å…³é‡è¦ã€‚</p>
<p>è¿™ç¯‡æ–‡ç« æ˜¯å…³äºç”¨<a href="http://nodejs.org"> Node.js </a>å’Œ<a href="https://expressjs.com/"> Express.js </a>æ„å»ºä¸€ä¸ªå®‰å…¨çš„é‡ç½®å¯†ç ç‰¹æ€§ã€‚ç°åœ¨ï¼Œè®©æˆ‘ä»¬å¼€å§‹å§ã€‚</p>
<p><em>å‘å‰è·³è½¬:</em></p>

<h2 id="creating-workflow-password-reset">ä¸ºæ‚¨çš„å¯†ç é‡ç½®åŠŸèƒ½åˆ›å»ºå·¥ä½œæµç¨‹</h2>
<p>é¦–å…ˆï¼ŒæŒ‰ç…§æœ¬æ•™ç¨‹ï¼Œè¿™é‡Œæœ‰ä¸€äº›éœ€è¦æ³¨æ„çš„è¦æ±‚:</p>
<ul>
<li>ä½ åº”è¯¥å¯¹<a href="https://blog.logrocket.com/12-tips-for-writing-clean-and-scalable-javascript-3ffe30abfe20/"> JavaScript </a>å’Œ<a href="https://blog.logrocket.com/node-js-logging-best-practices-essential-guide/"> Node.js </a>æœ‰åŸºæœ¬çš„äº†è§£</li>
<li>æ‚¨å·²ç»å®‰è£…äº† Node.jsï¼Œæˆ–è€…æ‚¨å¯ä»¥ä¸‹è½½å¹¶å®‰è£…æœ€æ–°ç‰ˆæœ¬çš„<a href="https://nodejs.org/en/"> Node.js </a></li>
<li>ä½ å·²ç»å®‰è£…äº†<a href="https://www.mongodb.com/"> MongoDB </a>æ•°æ®åº“ï¼Œæˆ–è€…åœ¨<a href="http://mongodb.com"> MongoDB </a>ç½‘ç«™ä¸Šåˆ›å»ºä¸€ä¸ªè´¦æˆ·å¹¶è®¾ç½®ä¸€ä¸ªå…è´¹çš„æ•°æ®åº“</li>
</ul>
<p>å¯†ç é‡ç½®çš„å·¥ä½œæµå¯ä»¥é‡‡ç”¨ä¸åŒçš„å½¢çŠ¶å’Œå¤§å°ï¼Œè¿™å–å†³äºæ‚¨å¸Œæœ›åº”ç”¨ç¨‹åºçš„å¯ç”¨æ€§å’Œå®‰å…¨æ€§ã€‚</p>
<p>åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†é€æ­¥å®ç°ä¸€ä¸ªæ ‡å‡†çš„ã€å®‰å…¨çš„å¯†ç é‡ç½®è®¾è®¡ã€‚ä¸‹å›¾è¯´æ˜äº†æ­¤åŠŸèƒ½çš„å·¥ä½œæµç¨‹ã€‚ä»¥ä¸‹æ˜¯æ¶‰åŠçš„å…³é”®æ­¥éª¤:</p>
<ul>
<li>è¯·æ±‚å¯†ç é‡ç½®:å¦‚æœç”¨æˆ·å­˜åœ¨ï¼Œä»–ä»¬å¯ä»¥é€šè¿‡è¯·æ±‚é‡ç½®æ¥å¯åŠ¨å¯†ç é‡ç½®è¿‡ç¨‹</li>
<li>éªŒè¯ç”¨æˆ·ä¿¡æ¯:ç³»ç»Ÿå°†é€šè¿‡å¯¹ç…§ç”¨æˆ·å¸æˆ·è®°å½•æ£€æŸ¥æ‰€æä¾›çš„ä¿¡æ¯æ¥éªŒè¯ç”¨æˆ·çš„èº«ä»½</li>
<li>æä¾›èº«ä»½ä¿¡æ¯:ç³»ç»Ÿä¼šæç¤ºç”¨æˆ·æä¾›é¢å¤–çš„èº«ä»½ä¿¡æ¯ï¼Œå¦‚å›ç­”å®‰å…¨é—®é¢˜æˆ–è¾“å…¥å‘é€åˆ°å…¶ç”µå­é‚®ä»¶æˆ–ç”µè¯çš„ä»£ç </li>
<li>é‡ç½®å¯†ç æˆ–æ‹’ç»è¯·æ±‚:å¦‚æœç”¨æˆ·çš„èº«ä»½éªŒè¯æˆåŠŸï¼Œç³»ç»Ÿå°†é‡ç½®ä»–ä»¬çš„å¯†ç ã€‚å¦‚æœéªŒè¯å¤±è´¥ï¼Œå¯†ç é‡ç½®è¯·æ±‚å°†è¢«æ‹’ç»</li>
</ul>
<p>æŒ‰ç…§è¿™äº›æ­¥éª¤ï¼Œæ‚¨å¯ä»¥åˆ›å»ºä¸€ä¸ªæ—¢å®‰å…¨åˆæ˜“äºç”¨æˆ·ä½¿ç”¨çš„å¯†ç é‡ç½®åŠŸèƒ½ã€‚ä»¥ä¸‹æ˜¯é‡è®¾å¯†ç å·¥ä½œæµç¨‹çš„å¯è§†åŒ–ç¤ºä¾‹:</p>
<p><img data-attachment-id="156432" data-permalink="https://blog.logrocket.com/implementing-secure-password-reset-node-js/attachment/reset-password-workflow-2/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/02/reset-password-workflow-1.png" data-orig-size="730,609" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Reset password workflow in Node.js" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/02/reset-password-workflow-1-300x250.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/02/reset-password-workflow-1.png" decoding="async" class="aligncenter size-full wp-image-156432 jetpack-lazy-image" src="../Images/75cc4abefc7ef4903888f0290c87b044.png" alt="Reset Password Workflow in Node.js" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2021/02/reset-password-workflow-1.png 730w, https://blog.logrocket.com/wp-content/uploads/2021/02/reset-password-workflow-1-300x250.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2021/02/reset-password-workflow-1.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/02/reset-password-workflow-1.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="156432" data-permalink="https://blog.logrocket.com/implementing-secure-password-reset-node-js/attachment/reset-password-workflow-2/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/02/reset-password-workflow-1.png" data-orig-size="730,609" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Reset password workflow in Node.js" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/02/reset-password-workflow-1-300x250.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/02/reset-password-workflow-1.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-156432" src="../Images/75cc4abefc7ef4903888f0290c87b044.png" alt="Reset Password Workflow in Node.js" srcset="https://blog.logrocket.com/wp-content/uploads/2021/02/reset-password-workflow-1.png 730w, https://blog.logrocket.com/wp-content/uploads/2021/02/reset-password-workflow-1-300x250.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/02/reset-password-workflow-1.png"/></noscript>
<h2 id="implement-forgot-password-node">å¦‚ä½•åœ¨ Node.js ä¸­å®ç°å¿˜è®°å¯†ç </h2>
<p>è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªç®€å•çš„é¡¹ç›®æ¥æ¼”ç¤ºå¦‚ä½•å®ç°å¯†ç é‡ç½®ç‰¹æ€§ã€‚æ³¨æ„ï¼Œä½ å¯ä»¥åœ¨ GitHub ä¸Šç”¨ Node.js æ‰¾åˆ°<a href="https://github.com/ezesundayeze/forgotpassword">å®Œæˆçš„å…³äºå¯†ç é‡ç½®çš„é¡¹ç›®ï¼Œä¹Ÿå¯ä»¥è·³è½¬åˆ°æœ¬æ•™ç¨‹çš„å¯†ç é‡ç½®éƒ¨åˆ†ã€‚è®©æˆ‘ä»¬é¦–å…ˆç”¨</a><a href="https://blog.logrocket.com/advanced-package-manager-features-npm-yarn-pnpm/"> npm åŒ…ç®¡ç†å™¨</a>åˆå§‹åŒ–æˆ‘ä»¬çš„é¡¹ç›®ã€‚</p>
<p>åœ¨æ‚¨çš„ç»ˆç«¯/å‘½ä»¤æç¤ºç¬¦ä¸‹è¿è¡Œ<code>npm init</code>,å¹¶æŒ‰ç…§è¯´æ˜è®¾ç½®é¡¹ç›®ã€‚</p>
<h3 id="folder-structure-files">æ–‡ä»¶å¤¹ç»“æ„å’Œæ–‡ä»¶</h3>
<p>æˆ‘ä»¬çš„æ–‡ä»¶å¤¹ç»“æ„å°†å¦‚ä¸‹æ‰€ç¤º:</p>
<ul>
<li>æ§åˆ¶å™¨</li>
<li>æœåŠ¡</li>
<li>æ¨¡å‹<ul>
<li><code>user.model.js</code></li>
<li><code>token.model.js</code></li>
</ul>
</li>
<li>è·¯çº¿</li>
<li>å®ç”¨å·¥å…·<ul>
<li><code>Emails</code><ul>
<li><code>Template</code><ul>
<li><code>requestResetPassword.handlebars</code></li>
<li><code>resetPassword.handlebars</code></li>
</ul>
</li>
<li><code>sendEmail.js</code></li>
</ul>
</li>
</ul>
</li>
<li><code>index.js</code></li>
<li><code>db.js</code></li>
<li><code>package.json</code></li>
</ul>
<h3 id="dependencies-password-reset">ä½¿ç”¨å¯†ç é‡ç½®è®¾ç½®é¡¹ç›®çš„ä¾èµ–å…³ç³»</h3>
<p>è¿è¡Œä»¥ä¸‹ä»£ç ï¼Œå®‰è£…æˆ‘ä»¬å°†åœ¨æ­¤é¡¹ç›®ä¸­ä½¿ç”¨çš„ npm ä¾èµ–é¡¹:</p>
<pre class="language-shell hljs">npm install bcrypt, cors, dotenv, express, express-async-errors, handlebars, jsonwebtoken, mongoose, nodemailer, nodemon</pre>
<p>æˆ‘ä»¬å°†ä½¿ç”¨ä»¥ä¸‹å†…å®¹:</p>
<ul>
<li><code>bcrypt</code>:å“ˆå¸Œå¯†ç ï¼Œé‡ç½®ä»¤ç‰Œ</li>
<li><code>cors</code>:ç¦ç”¨<a href="https://blog.logrocket.com/the-ultimate-guide-to-enabling-cross-origin-resource-sharing-cors/">è·¨äº§åœ°èµ„æºå…±äº«</a>ï¼Œè‡³å°‘ä¸ºäº†å¼€å‘ç›®çš„</li>
<li><code>dotenv</code>:å…è®¸æˆ‘ä»¬çš„èŠ‚ç‚¹è¿›ç¨‹è®¿é—®ç¯å¢ƒå˜é‡</li>
<li><code>express-async-errors</code>:æ•æ‰æ‰€æœ‰çš„<code>async</code>é”™è¯¯ï¼Œè¿™æ ·æˆ‘ä»¬çš„æ•´ä¸ªä»£ç åº“å°±ä¸ä¼šè¢«<code>try-catch</code>å¼„å¾—ä¹±ä¸ƒå…«ç³Ÿ</li>
<li><code>handlebars</code>:ä½œä¸º<a href="https://blog.logrocket.com/top-express-js-template-engines-for-dynamic-html-pages/">æ¨¡æ¿å¼•æ“</a>å‘é€ HTML é‚®ä»¶</li>
<li><code>mongoose</code>:ä½œä¸ºä¸ MongoDB æ•°æ®åº“æ¥å£çš„é©±åŠ¨ç¨‹åº</li>
<li><code>nodemailer</code>:å‘é€ç”µå­é‚®ä»¶</li>
<li><code>nodemon</code>:æ–‡ä»¶æ”¹å˜æ—¶é‡å¯æœåŠ¡å™¨</li>
</ul>
<h3 id="creating-environment-variables">åˆ›å»ºç¯å¢ƒå˜é‡</h3>
<p>åœ¨æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºä¸­ï¼Œä¸€äº›å˜é‡ä¼šæ ¹æ®æˆ‘ä»¬è¿è¡Œåº”ç”¨ç¨‹åºçš„ç¯å¢ƒè€Œå˜åŒ–â€”â€”ç”Ÿäº§ã€å¼€å‘æˆ–è¯•è¿è¡Œã€‚å¯¹äºè¿™äº›å˜é‡ï¼Œæˆ‘ä»¬å°†æŠŠå®ƒä»¬æ·»åŠ åˆ°ç¯å¢ƒå˜é‡ä¸­ã€‚</p>
<p>é¦–å…ˆï¼Œåœ¨æ ¹ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª<code>.env</code>æ–‡ä»¶ï¼Œå¹¶å°†ä»¥ä¸‹å˜é‡ç²˜è´´åˆ°å…¶ä¸­ã€‚æˆ‘ä»¬æ­£åœ¨æ·»åŠ ä¸€ä¸ª<code>bcrypt salt</code>ï¼Œæˆ‘ä»¬çš„<code>database URL</code>ï¼Œä¸€ä¸ª<code>JWT_SECRET</code>ï¼Œå’Œä¸€ä¸ª<code>client URL</code>ã€‚åœ¨æ¥ä¸‹æ¥çš„è¿‡ç¨‹ä¸­ï¼Œæ‚¨å°†çœ‹åˆ°æˆ‘ä»¬å°†å¦‚ä½•ä½¿ç”¨å®ƒä»¬:</p>
<pre class="language-shell hljs"># .env
BCRYPT_SALT=10
DB_URL=mongodb://127.0.0.1:27017/testDB
JWT_SECRET=mfefkuhio3k2rjkofn2mbikbkwjhnkj
CLIENT_URL=localhost://8090
</pre>
<h2 id="connecting-mongodb-database">è¿æ¥åˆ° MongoDB æ•°æ®åº“</h2>
<p>è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªåˆ° MongoDB çš„è¿æ¥ã€‚è¿™æ®µä»£ç åº”è¯¥åœ¨ä½ çš„<code>db.js</code>æ–‡ä»¶çš„æ ¹ç›®å½•ä¸‹:</p>
<pre class="language-javascript hljs">// db.js
const mongoose = require("mongoose");
let DB_URL = process.env.DB_URL;// here we are using the MongoDB Url we defined in our ENV file

module.exports = async function connection() {
  try {
    await mongoose.connect(
      DB_URL,
      {
        useNewUrlParser: true,
        useUnifiedTopology: true,
        useFindAndModify: false,
        useCreateIndex: true,
        autoIndex: true,
      },
      (error) =&gt; {
        if (error) return new Error("Failed to connect to database");
        console.log("connected");
      }
    );
  } catch (error) {
    console.log(error);
  }
};
</pre>
<h2 id="setting-express-js-app">è®¾ç½® Express.js åº”ç”¨ç¨‹åº</h2>
<p>è®©æˆ‘ä»¬æ„å»ºæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºå…¥å£ç‚¹ï¼Œå¹¶åœ¨<code>port 8080</code>æä¾›æœåŠ¡ã€‚å¤åˆ¶å¹¶ç²˜è´´åˆ°æ ¹ç›®å½•ä¸‹çš„<code>index.js</code>æ–‡ä»¶ä¸­:</p>
<pre class="language-javascript hljs">// index.js
require("express-async-errors");
require("dotenv").config();
const express = require("express");
const app = express();
const connection = require("./db");
const cors = require("cors");

const port = 8080;
(async function db() {
  await connection();
})();

app.use(cors());
app.use(express.json());
app.use("/api/v1", require("./routes/index.route"));
app.use((error, req, res, next) =&gt; {
  res.status(500).json({ error: error.message });
});

app.listen(port, () =&gt; {
  console.log("Listening to Port ", port);
});

module.exports = app;
</pre>
<h2 id="token-user-models">è®¾ç½®<code>token</code>å’Œ<code>user</code>æ¨¡å‹</h2>
<p>ä¸ºäº†åˆ›å»ºä¸€ä¸ªå¯†ç é‡ç½®ç³»ç»Ÿï¼Œæˆ‘ä»¬éœ€è¦å»ºç«‹ä¸¤ä¸ªç‹¬ç«‹çš„æ¨¡å‹:ä¸€ä¸ª<code>user</code>æ¨¡å‹å’Œä¸€ä¸ª<code>token</code>æ¨¡å‹ã€‚<code>user</code>æ¨¡å‹å°†åŒ…å«æ¯ä¸ªç”¨æˆ·çš„ä¿¡æ¯ï¼Œæ¯”å¦‚ä»–ä»¬çš„ç”µå­é‚®ä»¶åœ°å€ã€ç”¨æˆ·åå’Œæ•£åˆ—å¯†ç ã€‚è¯¥æ¨¡å‹å°†ç”¨äºéªŒè¯è¯·æ±‚å¯†ç é‡ç½®çš„ç”¨æˆ·çš„èº«ä»½ï¼Œå¹¶åœ¨è¯·æ±‚é‡ç½®åæ›´æ–°å…¶å¯†ç ã€‚</p>
<h3 id="token-model"><code>token</code>å‹å·</h3>
<p>æˆ‘ä»¬çš„<code>token</code>æ¨¡å‹å°†æœ‰å¤§çº¦ä¸€ä¸ªå°æ—¶çš„åˆ°æœŸæ—¶é—´ã€‚åœ¨æ­¤æœŸé—´ï¼Œç”¨æˆ·éœ€è¦å®Œæˆå¯†ç é‡ç½®è¿‡ç¨‹ã€‚å¦åˆ™ï¼Œ<code>token</code>å°†ä»æ•°æ®åº“ä¸­åˆ é™¤ã€‚ä½¿ç”¨ MongoDBï¼Œæ‚¨ä¸å¿…ç¼–å†™é¢å¤–çš„ä»£ç æ¥å®ç°è¿™ä¸€ç‚¹ã€‚å°±åƒè¿™æ ·åœ¨ä½ çš„æ—¥æœŸå­—æ®µä¸­è®¾ç½®<code>expires</code>:</p>
<pre class="language-javascript hljs">createdAt: {
  type: Date,
  default: Date.now,
  expires: 3600,// this is the expiry time
},
</pre>
<p>æ‚¨åº”è¯¥å°†è¿™æ®µä»£ç æ·»åŠ åˆ°æ¨¡å‹ç›®å½•ä¸­çš„æ–‡ä»¶<code>token.model.js</code>ä¸­ã€‚è¿™æ˜¯æˆ‘ä»¬çš„æ¨¡å‹çš„æ ·å­:</p>
<pre class="language-javascript hljs">// models/token.model.js
const mongoose = require("mongoose");
const Schema = mongoose.Schema;
const tokenSchema = new Schema({
  userId: {
    type: Schema.Types.ObjectId,
    required: true,
    ref: "user",
  },
  token: {
    type: String,
    required: true,
  },
  createdAt: {
    type: Date,
    default: Date.now,
    expires: 3600,// this is the expiry time in seconds
  },
});
module.exports = mongoose.model("Token", tokenSchema);
</pre>
<h3 id="user-model"><code>user</code>å‹å·</h3>
<p><code>user</code>æ¨¡å‹å°†å®šä¹‰ç”¨æˆ·æ•°æ®å¦‚ä½•ä¿å­˜åœ¨æ•°æ®åº“ä¸­ã€‚ç¡®ä¿å®‰å…¨å­˜å‚¨å¯†ç éå¸¸é‡è¦ï¼Œå› ä¸ºä»¥æ˜æ–‡å½¢å¼å­˜å‚¨å¯†ç å­˜åœ¨å®‰å…¨é£é™©ã€‚ä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸ªå®‰å…¨çš„å•å‘æ•£åˆ—ç®—æ³•ï¼Œæ¯”å¦‚ bcrypt ï¼Œå®ƒåŒ…å«ä¸€ä¸ª salt æ¥è¿›ä¸€æ­¥å¢åŠ æ•£åˆ—çš„å¼ºåº¦ã€‚</p>
<p>åœ¨ä¸‹é¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨<a href="https://www.npmjs.com/package/bcrypt"> bcrypt </a>å¯¹å¯†ç è¿›è¡Œå“ˆå¸Œå¤„ç†ä»¥ä¿æŠ¤å®ƒä»¬ï¼Œå¹¶ä¸”å³ä½¿æ•°æ®åº“é­åˆ°ç ´åï¼Œä¹Ÿå‡ ä¹ä¸å¯èƒ½é€†è½¬å“ˆå¸Œè¿‡ç¨‹ã€‚å³ä½¿ä½œä¸ºç®¡ç†å‘˜ï¼Œæˆ‘ä»¬ä¹Ÿä¸åº”è¯¥çŸ¥é“ç”¨æˆ·çš„æ˜æ–‡å¯†ç ï¼Œä½¿ç”¨å®‰å…¨å“ˆå¸Œç®—æ³•ä¹Ÿæœ‰åŠ©äºç¡®ä¿è¿™ä¸€ç‚¹:</p>
<pre class="language-javascript hljs">// user.model.js
const mongoose = require("mongoose");
const bcrypt = require("bcrypt");
const Schema = mongoose.Schema;
const bcryptSalt = process.env.BCRYPT_SALT;
const userSchema = new Schema(
  {
    name: {
      type: String,
      trim: true,
      required: true,
      unique: true,
    },
    email: {
      type: String,
      trim: true,
      unique: true,
      required: true,
    },
    password: { type: String },
  },
  {
    timestamps: true,
  }
);
userSchema.pre("save", async function (next) {
  if (!this.isModified("password")) {
    return next();
  }
  const hash = await bcrypt.hash(this.password, Number(bcryptSalt));
  this.password = hash;
  next();
});
module.exports = mongoose.model("user", userSchema);
</pre>
<p>åœ¨ä¿å­˜å¯†ç ä¹‹å‰ï¼Œä½¿ç”¨<code>pre-save</code> <a href="https://blog.logrocket.com/mern-stack-tutorial/"> MongoDB é’©å­</a>å¯¹å¯†ç è¿›è¡Œå“ˆå¸Œå¤„ç†ï¼Œå¦‚ä¸‹é¢çš„ä»£ç æ‰€ç¤ºã€‚å¦‚åœ¨<code>.env</code>æ–‡ä»¶ä¸­æ‰€æŒ‡å®šçš„ï¼Œä½¿ç”¨<code>10</code>çš„ç›æ¥å¢åŠ æ•£åˆ—çš„å¼ºåº¦ï¼Œå¹¶é™ä½å¯†ç è¢«æ¶æ„å‚ä¸è€…çŒœåˆ°çš„å¯èƒ½æ€§:</p>
<pre class="language-javascript hljs">...
userSchema.pre("save", async function (next) {
  if (!this.isModified("password")) {
    return next();
  }
  const hash = await bcrypt.hash(this.password, Number(bcryptSalt));
  this.password = hash;
  next();
});
</pre>
<h2 id="services-password-reset">ä¸ºå¯†ç é‡ç½®è¿‡ç¨‹åˆ›å»ºæœåŠ¡</h2>
<p>æˆ‘ä»¬å°†æœ‰ä¸‰ä¸ªæœåŠ¡æ¥å®Œå…¨å¯åŠ¨å’Œå¤„ç†æˆ‘ä»¬çš„å¯†ç é‡ç½®å‘¨æœŸ:</p>
<ul>
<li>æ³¨å†Œè¿‡ç¨‹:å…è®¸ç”¨æˆ·åˆ›å»ºå¸æˆ·çš„è®¾ç½®</li>
<li>å¯†ç é‡ç½®è¯·æ±‚:è¯¥æœåŠ¡å°†å…è®¸ç”¨æˆ·è¯·æ±‚å¯†ç é‡ç½®ä»¤ç‰Œæ¥éªŒè¯ç”¨æˆ·çš„å¸æˆ·æ‰€æœ‰æƒ</li>
<li>å¯†ç é‡ç½®:è¾“å…¥æ”¶åˆ°çš„å¯†ç é‡ç½®ä»¤ç‰Œï¼Œåˆ›å»ºå¹¶ç¡®è®¤æ–°å¯†ç ï¼Œå¹¶ç”¨æ–°å¯†ç æ›´æ–°å¸æˆ·</li>
</ul>
<h3 id="sign-up-service">æ³¨å†ŒæœåŠ¡</h3>
<p>å½“ç„¶ï¼Œå¦‚æœç”¨æˆ·æ²¡æœ‰å¸æˆ·ï¼Œæˆ‘ä»¬æ— æ³•é‡ç½®ä»–ä»¬çš„å¯†ç ã€‚å› æ­¤ï¼Œè¯¥æœåŠ¡å°†ä¸ºæ–°ç”¨æˆ·åˆ›å»ºä¸€ä¸ªå¸æˆ·ã€‚</p>
<p>ä¸‹é¢çš„ä»£ç åº”è¯¥åœ¨<code>service/auth.service.js</code>æ–‡ä»¶ä¸­:</p>
<pre class="language-javascript hljs">// service/auth.service.js
const JWT = require("jsonwebtoken");
const User = require("../models/User.model");
const Token = require("../models/Token.model");
const sendEmail = require("../utils/email/sendEmail");
const crypto = require("crypto");
const bcrypt = require("bcrypt");

const signup = async (data) =&gt; {
  let user = await User.findOne({ email: data.email });
  if (user) {
    throw new Error("Email already exist");
  }
  user = new User(data);
  const token = JWT.sign({ id: user._id }, JWTSecret);
  await user.save();
  return (data = {
    userId: user._id,
    email: user.email,
    name: user.name,
    token: token,
  });
};
</pre>
<h2 id="password-request-service">è®¾ç½®å¯†ç é‡ç½®è¯·æ±‚æœåŠ¡</h2>
<p>æŒ‰ç…§æˆ‘ä»¬çš„å·¥ä½œæµç¨‹ï¼Œç¬¬ä¸€æ­¥æ˜¯è¯·æ±‚å¯†ç é‡ç½®ä»¤ç‰Œï¼Œå¯¹å—ï¼Ÿ</p>
<p>æ˜¯çš„ï¼Œè®©æˆ‘ä»¬ä»è¿™é‡Œå¼€å§‹ã€‚åœ¨ä¸‹é¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å­˜åœ¨ã€‚å¦‚æœç”¨æˆ·å­˜åœ¨ï¼Œæˆ‘ä»¬æ£€æŸ¥æ˜¯å¦å·²ç»ä¸ºè¯¥ç”¨æˆ·åˆ›å»ºäº†ä¸€ä¸ªç°æœ‰çš„<code>token</code>ã€‚å¦‚æœå­˜åœ¨ï¼Œæˆ‘ä»¬åˆ é™¤<code>token</code>,å¦‚ä¸‹æ‰€ç¤º:</p>
<pre class="language-javascript hljs">//auth.service.js  
const user = await User.findOne({ email });

  if (!user) {
      throw new Error("User does not exist");
  }
  let token = await Token.findOne({ userId: user._id });
  if (token) { 
        await token.deleteOne()
  };
</pre>
<p>ç°åœ¨ï¼Œæ³¨æ„è¿™éƒ¨åˆ†ï¼åœ¨è¿™æ®µä»£ç ä¸­ï¼Œä½¿ç”¨<a href="https://nodejs.org/api/crypto.html"> Node.js crypto API </a>ç”Ÿæˆäº†ä¸€ä¸ªæ–°çš„éšæœºæ•°<code>token</code>ã€‚æ­¤<code>token</code>å°†å‘é€ç»™ç”¨æˆ·ï¼Œå¹¶å¯ç”¨äºé‡ç½®å…¶å¯†ç :</p>
<pre class="language-javascript hljs">let resetToken = crypto.randomBytes(32).toString("hex");</pre>
<p>ç°åœ¨ï¼Œä¸ºè¿™ä¸ª<code>token</code>åˆ›å»ºä¸€ä¸ª<code>hash</code>ï¼Œæˆ‘ä»¬å°†æŠŠå®ƒä¿å­˜åœ¨æ•°æ®åº“ä¸­ï¼Œå› ä¸ºåœ¨æˆ‘ä»¬çš„æ•°æ®åº“ä¸­ä¿å­˜æ™®é€šçš„<code>resetToken</code>ä¼šæš´éœ²æ¼æ´ï¼Œè¿™å°†ç ´åè®¾ç½®å®‰å…¨å¯†ç é‡ç½®çš„æ•´ä¸ªç›®çš„:</p>
<pre class="language-javascript hljs">const hash = await bcrypt.hash(resetToken, Number(bcryptSalt));</pre>
<p>ç„¶è€Œï¼Œæˆ‘ä»¬å°†æŠŠæ™®é€šçš„<code>token</code>å‘é€åˆ°ç”¨æˆ·çš„ç”µå­é‚®ä»¶ï¼Œå¦‚ä¸‹é¢çš„ä»£ç æ‰€ç¤ºï¼Œç„¶ååœ¨ä¸‹ä¸€éƒ¨åˆ†ï¼Œæˆ‘ä»¬å°†éªŒè¯<code>token</code>å¹¶å…è®¸ä»–ä»¬åˆ›å»ºä¸€ä¸ªæ–°å¯†ç :</p>
<pre class="language-javascript hljs">// service/auth.service.js
const JWT = require("jsonwebtoken");
const User = require("../models/User.model");
const Token = require("../models/Token.model");
const sendEmail = require("../utils/email/sendEmail");
const crypto = require("crypto");
const bcrypt = require("bcrypt");

const requestPasswordReset = async (email) =&gt; {

  const user = await User.findOne({ email });

  if (!user) throw new Error("User does not exist");
  let token = await Token.findOne({ userId: user._id });
  if (token) await token.deleteOne();
  let resetToken = crypto.randomBytes(32).toString("hex");
  const hash = await bcrypt.hash(resetToken, Number(bcryptSalt));

  await new Token({
    userId: user._id,
    token: hash,
    createdAt: Date.now(),
  }).save();

  const link = `${clientURL}/passwordReset?token=${resetToken}&amp;id=${user._id}`;
  sendEmail(user.email,"Password Reset Request",{name: user.name,link: link,},"./template/requestResetPassword.handlebars");
  return link;
};
</pre>
<p>é‡ç½®å¯†ç é“¾æ¥åŒ…å«<code>token</code>å’Œ<code>userID</code>ï¼Œä¸¤è€…éƒ½å°†ç”¨äºåœ¨ç”¨æˆ·é‡ç½®å¯†ç ä¹‹å‰éªŒè¯ç”¨æˆ·çš„èº«ä»½ã€‚</p>
<p>å®ƒè¿˜åŒ…å«<code>clientURL</code>ï¼Œè¿™æ˜¯ç”¨æˆ·å¿…é¡»å•å‡»æ‰èƒ½ç»§ç»­é‡ç½®è¿‡ç¨‹çš„æ ¹åŸŸ:</p>
<pre class="language-javascript hljs">const link = `${clientURL}/passwordReset?token=${resetToken}&amp;id=${user._id}`;
</pre>
<p>å¯¹äºé‡ç½®ç”¨æˆ·å¯†ç çš„è¯·æ±‚ï¼Œç”¨æˆ·å°†å‘é€ä¸€ä¸ª POST è¯·æ±‚ï¼Œå…¶ç”µå­é‚®ä»¶æ˜¯è¯·æ±‚æ­£æ–‡ä¸­çš„å”¯ä¸€é¡¹ç›®:</p>
<pre class="language-json hljs">{
   email:"<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="ef8a978e829f838a8a828e8683af88828e8683c18c8082">[emailÂ protected]</a>"
}
</pre>
<p>åœ¨<a href="https://github.com/ezesundayeze/forgotpassword/blob/master/utils/email/sendEmail.js"> GitHub åº“</a>å¯ä»¥æ‰¾åˆ°å‡½æ•°<code>sendEmail</code>ï¼Œåœ¨è¿™é‡Œå¯ä»¥æ‰¾åˆ°é‚®ä»¶æ¨¡æ¿<a href="https://github.com/ezesundayeze/forgotpassword/blob/master/utils/email/template/requestResetPassword.handlebars">ã€‚æˆ‘ä»¬ä½¿ç”¨</a><a href="https://nodemailer.com/about/">node mailer</a>(node . js çš„ npm åŒ…ï¼Œä½¿å¼€å‘äººå‘˜èƒ½å¤Ÿé€šè¿‡å„ç§ç”µå­é‚®ä»¶æœåŠ¡æä¾›å•†è½»æ¾åœ°ä»ä»–ä»¬çš„åº”ç”¨ç¨‹åºå‘é€ç”µå­é‚®ä»¶)å’Œ<a href="https://handlebarsjs.com/"> handlebars </a>æ¨¡æ¿å¼•æ“æ¥å‘é€ç”µå­é‚®ä»¶ã€‚</p>
<h3 id="resetting-password-service">é‡ç½®å¯†ç æœåŠ¡</h3>
<p>å“¦ï¼Œçœ‹å“ªï¼æˆ‘æ”¶åˆ°äº†ä¸€å°ç”µå­é‚®ä»¶ï¼Œç¡®è®¤æˆ‘æå‡ºäº†å¯†ç é‡ç½®è¯·æ±‚ã€‚ç°åœ¨ï¼Œæ¥ä¸‹æ¥æˆ‘å°†ç‚¹å‡»<strong>é“¾æ¥</strong>:</p>
<p><img data-attachment-id="156430" data-permalink="https://blog.logrocket.com/implementing-secure-password-reset-node-js/attachment/email-confirmation-reset-password-node/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/02/email-confirmation-reset-password-node.png" data-orig-size="730,344" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Email confirmation of reset password link" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/02/email-confirmation-reset-password-node-300x141.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/02/email-confirmation-reset-password-node.png" decoding="async" class="aligncenter size-full wp-image-156430 jetpack-lazy-image" src="../Images/b499c2cd2249e6378e097718d3d67b23.png" alt="Email Confirmation of Reset Password Link" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2021/02/email-confirmation-reset-password-node.png 730w, https://blog.logrocket.com/wp-content/uploads/2021/02/email-confirmation-reset-password-node-300x141.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2021/02/email-confirmation-reset-password-node.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/02/email-confirmation-reset-password-node.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="156430" data-permalink="https://blog.logrocket.com/implementing-secure-password-reset-node-js/attachment/email-confirmation-reset-password-node/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/02/email-confirmation-reset-password-node.png" data-orig-size="730,344" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Email confirmation of reset password link" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/02/email-confirmation-reset-password-node-300x141.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/02/email-confirmation-reset-password-node.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-156430" src="../Images/b499c2cd2249e6378e097718d3d67b23.png" alt="Email Confirmation of Reset Password Link" srcset="https://blog.logrocket.com/wp-content/uploads/2021/02/email-confirmation-reset-password-node.png 730w, https://blog.logrocket.com/wp-content/uploads/2021/02/email-confirmation-reset-password-node-300x141.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/02/email-confirmation-reset-password-node.png"/></noscript>
<p>ä¸€æ—¦ä½ ç‚¹å‡»<strong>é“¾æ¥</strong>ï¼Œå®ƒä¼šæŠŠä½ å¸¦åˆ°å¯†ç é‡ç½®é¡µé¢ã€‚ä½ å¯ä»¥ç”¨ä»»ä½•ä½ æƒ³è¦çš„æŠ€æœ¯æ¥æ„å»ºè¿™ä¸ªå‰ç«¯ï¼Œå› ä¸ºè¿™åªæ˜¯ä¸€ä¸ª APIã€‚</p>
<p>æ­¤æ—¶ï¼Œæˆ‘ä»¬å°†å‘å›ä¸€ä¸ª<code>token</code>ã€ä¸€ä¸ªæ–°çš„<code>password</code>å’Œä¸€ä¸ª<code>userID</code>æ¥éªŒè¯ç”¨æˆ·ï¼Œç„¶ååˆ›å»ºä¸€ä¸ªæ–°çš„å¯†ç ã€‚</p>
<p>ä¸‹é¢æ˜¯æˆ‘ä»¬å°†å‘é€å›é‡ç½®å¯†ç  API çš„å†…å®¹:</p>
<pre class="language-json hljs">{
    "token":"4f546b55258a10288c7e28650fbebcc51d1252b2a69823f8cd1c65144c69664e",
    "userId":"600205cc5fdfce952e9813d8",
    "password":"kjgjgkflgk.hlkhol"
}
</pre>
<p>å®ƒå°†ç”±ä¸‹é¢çš„ä»£ç å¤„ç†:</p>
<pre class="language-javascript hljs">// service/auth.service.js
const resetPassword = async (userId, token, password) =&gt; {
  let passwordResetToken = await Token.findOne({ userId });
  if (!passwordResetToken) {
    throw new Error("Invalid or expired password reset token");
  }
  const isValid = await bcrypt.compare(token, passwordResetToken.token);
  if (!isValid) {
    throw new Error("Invalid or expired password reset token");
  }
  const hash = await bcrypt.hash(password, Number(bcryptSalt));
  await User.updateOne(
    { _id: userId },
    { $set: { password: hash } },
    { new: true }
  );
  const user = await User.findById({ _id: userId });
  sendEmail(
    user.email,
    "Password Reset Successfully",
    {
      name: user.name,
    },
    "./template/resetPassword.handlebars"
  );
  await passwordResetToken.deleteOne();
  return true;
};
</pre>
<p>æ³¨æ„æˆ‘ä»¬æ˜¯å¦‚ä½•ä½¿ç”¨ bcrypt æ¥æ¯”è¾ƒæœåŠ¡å™¨æ”¶åˆ°çš„<code>token</code>å’Œæ•°æ®åº“ä¸­çš„æ•£åˆ—ç‰ˆæœ¬çš„ï¼Ÿï¼š</p>
<pre class="language-javascript hljs">const isValid = await bcrypt.compare(token, passwordResetToken.token);</pre>
<p>å¦‚æœå®ƒä»¬ç›¸åŒï¼Œé‚£ä¹ˆæˆ‘ä»¬ç»§ç»­æ•£åˆ—æ–°å¯†ç :</p>
<pre class="language-javascript hljs">  const hash = await bcrypt.hash(password, Number(bcryptSalt));
</pre>
<p>ç„¶åï¼Œç”¨æ–°å¯†ç æ›´æ–°ç”¨æˆ·å¸æˆ·:</p>
<pre class="language-javascript hljs">await User.updateOne(
    { _id: userId },
    { $set: { password: hash } },
    { new: true }
  );
</pre>
<p>åªæ˜¯ä¸ºäº†è®©ç”¨æˆ·äº†è§£æ¯ä¸€æ­¥ï¼Œæˆ‘ä»¬å°†å‘ä»–ä»¬å‘é€ä¸€å°ç”µå­é‚®ä»¶æ¥ç¡®è®¤<code>password</code>ä¸­çš„æ›´æ”¹ï¼Œå¹¶ä»æ•°æ®åº“ä¸­åˆ é™¤<code>token</code>ã€‚</p>
<p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å·²ç»èƒ½å¤Ÿåˆ›å»ºæœåŠ¡æ¥æ³¨å†Œæ–°ç”¨æˆ·å¹¶é‡ç½®ä»–ä»¬çš„å¯†ç ã€‚</p>
<p>å¤ªæ£’äº†ã€‚</p>
<h2 id="controllers-password-reset">å¯†ç é‡ç½®æœåŠ¡çš„æ§åˆ¶å™¨</h2>
<p>ä»¥ä¸‹æ˜¯è¿™äº›æœåŠ¡çš„æ§åˆ¶å™¨ã€‚æ§åˆ¶å™¨ä»ç”¨æˆ·å¤„æ”¶é›†æ•°æ®ï¼Œå°†å®ƒä»¬å‘é€ç»™æœåŠ¡ä»¥å¤„ç†æ•°æ®ï¼Œç„¶åå°†ç»“æœè¿”å›ç»™ç”¨æˆ·:</p>
<pre class="language-javascript hljs">controllers/auth.controller.js
// controllers/auth.controller.js
const {
  signup,
  requestPasswordReset,
  resetPassword,
} = require("../services/auth.service");

const signUpController = async (req, res, next) =&gt; {
  const signupService = await signup(req.body);
  return res.json(signupService);
};

const resetPasswordRequestController = async (req, res, next) =&gt; {
  const requestPasswordResetService = await requestPasswordReset(
    req.body.email
  );
  return res.json(requestPasswordResetService);
};

const resetPasswordController = async (req, res, next) =&gt; {
  const resetPasswordService = await resetPassword(
    req.body.userId,
    req.body.token,
    req.body.password
  );
  return res.json(resetPasswordService);
};

module.exports = {
  signUpController,
  resetPasswordRequestController,
  resetPasswordController,
};
</pre>
<h2 id="testing-api-postman">ç”¨ Postman æµ‹è¯• API</h2>
<p>è®©æˆ‘ä»¬ä½¿ç”¨ Postman æ¥æµ‹è¯• APIï¼Œä»¥ç¡®ä¿æ­£ç¡®çš„åŠŸèƒ½ã€‚æˆ‘ä»¬å°†å‘å‡ºå„ç§è¯·æ±‚æ¥æ¨¡æ‹Ÿæ•´ä¸ªè¿‡ç¨‹ï¼Œä»è¯·æ±‚å¯†ç é‡ç½®ä»¤ç‰Œåˆ°æœ€ç»ˆé‡ç½®å¯†ç ã€‚</p>
<h3 id="reset-password-request-sample">é‡ç½®å¯†ç è¯·æ±‚ç¤ºä¾‹</h3>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬å°†å‘å¯†ç é‡ç½®è¯·æ±‚ç«¯ç‚¹å‘å‡º POST è¯·æ±‚ï¼Œè¯·æ±‚æ­£æ–‡ä¸­åŒ…å«ç”¨æˆ·çš„ç”µå­é‚®ä»¶ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º:</p>
<p><img data-attachment-id="156428" data-permalink="https://blog.logrocket.com/implementing-secure-password-reset-node-js/attachment/restting-password-testing-postman/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/02/restting-password-testing-postman.png" data-orig-size="730,277" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Postman testing for reset password with Node.js" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/02/restting-password-testing-postman-300x114.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/02/restting-password-testing-postman.png" decoding="async" class="aligncenter size-full wp-image-156428 jetpack-lazy-image" src="../Images/3f0e1b449d977352bb7a36e38b860940.png" alt="Postman Testing for Reset Password With Node.js" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2021/02/restting-password-testing-postman.png 730w, https://blog.logrocket.com/wp-content/uploads/2021/02/restting-password-testing-postman-300x114.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2021/02/restting-password-testing-postman.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/02/restting-password-testing-postman.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="156428" data-permalink="https://blog.logrocket.com/implementing-secure-password-reset-node-js/attachment/restting-password-testing-postman/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/02/restting-password-testing-postman.png" data-orig-size="730,277" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Postman testing for reset password with Node.js" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/02/restting-password-testing-postman-300x114.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/02/restting-password-testing-postman.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-156428" src="../Images/3f0e1b449d977352bb7a36e38b860940.png" alt="Postman Testing for Reset Password With Node.js" srcset="https://blog.logrocket.com/wp-content/uploads/2021/02/restting-password-testing-postman.png 730w, https://blog.logrocket.com/wp-content/uploads/2021/02/restting-password-testing-postman-300x114.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/02/restting-password-testing-postman.png"/></noscript>
<p>æ³¨æ„ï¼Œå“åº”åŒ…æ‹¬ä¸€ä¸ªå¸¦æœ‰<code>token</code>å’Œ<code>userId</code>çš„é“¾æ¥ã€‚æ‚¨å¯ä»¥è®¾è®¡æ‚¨çš„ç³»ç»Ÿä»¥ä»»ä½•é€‚åˆæ‚¨éœ€è¦çš„æ–¹å¼è¿”å›è¿™äº›æ•°æ®ã€‚å‰ç«¯å°†ä½¿ç”¨æ­¤ä¿¡æ¯è¿›è¡Œä¸‹ä¸€æ­¥:é‡ç½®å¯†ç ã€‚</p>
<p>è¦é‡ç½®å¯†ç ï¼Œå®¢æˆ·ç«¯å°†å‘é‡ç½®å¯†ç ç«¯ç‚¹å‘é€ä¸€ä¸ª POST è¯·æ±‚ï¼ŒåŒ…å«<code>userId</code>ã€<code>token</code>å’Œæ–°çš„<code>password</code>ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º:</p>
<p><img data-attachment-id="156426" data-permalink="https://blog.logrocket.com/implementing-secure-password-reset-node-js/attachment/post-request-node-js/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/02/post-request-node-js.png" data-orig-size="730,346" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="POST request for password reset" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/02/post-request-node-js-300x142.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/02/post-request-node-js.png" decoding="async" class="aligncenter size-full wp-image-156426 jetpack-lazy-image" src="../Images/82fbd33d2229c3dec067971b9ed6dedc.png" alt="POST Request For Password Reset" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2021/02/post-request-node-js.png 730w, https://blog.logrocket.com/wp-content/uploads/2021/02/post-request-node-js-300x142.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2021/02/post-request-node-js.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/02/post-request-node-js.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="156426" data-permalink="https://blog.logrocket.com/implementing-secure-password-reset-node-js/attachment/post-request-node-js/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/02/post-request-node-js.png" data-orig-size="730,346" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="POST request for password reset" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/02/post-request-node-js-300x142.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/02/post-request-node-js.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-156426" src="../Images/82fbd33d2229c3dec067971b9ed6dedc.png" alt="POST Request For Password Reset" srcset="https://blog.logrocket.com/wp-content/uploads/2021/02/post-request-node-js.png 730w, https://blog.logrocket.com/wp-content/uploads/2021/02/post-request-node-js-300x142.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/02/post-request-node-js.png"/></noscript>
<p>å°±æ˜¯è¿™æ ·ã€‚æˆ‘ä¹Ÿæ”¶åˆ°äº†ä¸€å°é‚®ä»¶ï¼ŒğŸ˜„ï¼š</p>
<p><img data-attachment-id="156424" data-permalink="https://blog.logrocket.com/implementing-secure-password-reset-node-js/attachment/password-reset-final/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/02/password-reset-final.png" data-orig-size="730,160" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Successful password reset with Node.js" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/02/password-reset-final-300x66.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/02/password-reset-final.png" decoding="async" class="aligncenter size-full wp-image-156424 jetpack-lazy-image" src="../Images/016b63d2ef8678e8f97b116877b93de6.png" alt="Successful Password Reset With Node.js " data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2021/02/password-reset-final.png 730w, https://blog.logrocket.com/wp-content/uploads/2021/02/password-reset-final-300x66.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2021/02/password-reset-final.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/02/password-reset-final.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="156424" data-permalink="https://blog.logrocket.com/implementing-secure-password-reset-node-js/attachment/password-reset-final/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/02/password-reset-final.png" data-orig-size="730,160" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Successful password reset with Node.js" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/02/password-reset-final-300x66.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/02/password-reset-final.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-156424" src="../Images/016b63d2ef8678e8f97b116877b93de6.png" alt="Successful Password Reset With Node.js " srcset="https://blog.logrocket.com/wp-content/uploads/2021/02/password-reset-final.png 730w, https://blog.logrocket.com/wp-content/uploads/2021/02/password-reset-final-300x66.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/02/password-reset-final.png"/></noscript>
<p>æ­å–œæ‚¨ï¼Œæ‚¨å·²ç»åœ¨ Node.js ä¸­ä¸ºæ‚¨çš„ç”¨æˆ·åˆ›å»ºäº†ä¸€ä¸ªå®‰å…¨çš„é‡ç½®å¯†ç ç‰¹æ€§ã€‚</p>
<p>æ¥ä¸‹æ¥ä½ èƒ½åšä»€ä¹ˆï¼Ÿæ‚¨å¯ä»¥åšä¸€äº›äº‹æƒ…æ¥ä½¿è¿™ä¸ªå¯†ç é‡ç½®åŠŸèƒ½æ›´åŠ å®‰å…¨ã€‚</p>
<p>æ‚¨å¯ä»¥è¦æ±‚ç”¨æˆ·æä¾›ä»–ä»¬çš„å®‰å…¨é—®é¢˜çš„ç­”æ¡ˆ(ä»–ä»¬å¿…é¡»å·²ç»åˆ›å»ºäº†è¿™äº›é—®é¢˜å’Œç­”æ¡ˆ)ã€‚ç¡®ä¿ä½¿ç”¨å®‰å…¨çš„æ‰˜ç®¡æœåŠ¡ã€‚ä¸€ä¸ªä¸å®‰å…¨çš„æ‰˜ç®¡æœåŠ¡å¯ä»¥ä¸ºä½ ä½œä¸ºç®¡ç†å‘˜åˆ›é€ ä¸€ä¸ªåé—¨ã€‚å¦‚æœä½ çš„ä¸»æœºæœåŠ¡æ²¡æœ‰åšå¥½ï¼Œå³ä½¿ä½ çš„ç³»ç»Ÿçœ‹èµ·æ¥å¾ˆå®‰å…¨ï¼Œåäººä¹Ÿå¯èƒ½ä¼šç ´åå®ƒã€‚</p>
<p>æ‚¨è¿˜å¯ä»¥ä½¿ç”¨<a href="https://googleauthenticator.net/"> Google Authenticator </a>æˆ– SMS å®ç°åŒå› ç´ è®¤è¯(2FA)ã€‚è¿™æ ·ï¼Œå³ä½¿ç”¨æˆ·çš„ç”µå­é‚®ä»¶å·²ç»è¢«æ”»ç ´ï¼Œé»‘å®¢ä¹Ÿéœ€è¦æ‹¥æœ‰ç”¨æˆ·çš„æ‰‹æœºã€‚</p>
<p>è®°ä½ï¼Œæ ¹æœ¬ä¸è¦å­˜å‚¨ç”¨æˆ·çš„å¯†ç ã€‚æ¯æ¬¡å¿˜è®°å¯†ç éƒ½è¦é‡æ–°è®¾ç½®ï¼Œå‹åŠ›å¾ˆå¤§ã€‚ç›¸åï¼Œä½ å¯ä»¥å…è®¸ä½ çš„ç”¨æˆ·ä½¿ç”¨å·²ç»å­˜åœ¨çš„æœåŠ¡ç™»å½•ï¼Œæ¯”å¦‚è„¸ä¹¦ã€GitHubã€Gmail ç­‰ç­‰ã€‚è¿™æ ·ï¼Œä»–ä»¬å°±å†ä¹Ÿä¸éœ€è¦è®°ä½ä»–ä»¬çš„å¯†ç äº†ã€‚ä»–ä»¬åªéœ€è¦æ‹…å¿ƒä»–ä»¬åœ¨ç¬¬ä¸‰æ–¹ç½‘ç«™ä¸Šçš„å¯†ç ã€‚</p>
<p>å¦‚æœä½ æƒ³ç©ç©å·²ç»å®Œæˆçš„é¡¹ç›®ï¼Œä½ å¯ä»¥åœ¨<a href="https://github.com/ezesundayeze/forgotpassword"> GitHub </a>ä¸ŠæŸ¥çœ‹ã€‚</p>
<h2>ç»“è®º</h2>
<p>æ•°å­—å®‰å…¨ä¸æ˜¯ä¸€ä¸ªç¬‘è¯ã€‚é»‘å®¢æ€»æ˜¯åœ¨å¯»æ‰¾æ–°çš„æ–¹æ³•æ¥å…¥ä¾µç³»ç»Ÿï¼Œæ‰€ä»¥ä½ åº”è¯¥æ€»æ˜¯åœ¨å¯»æ‰¾æ–°çš„æ–¹æ³•æ¥ä½¿ä»–ä»¬çš„ç”Ÿæ´»å˜å¾—å›°éš¾ã€‚</p><div class="code-block code-block-54">
<hr/>
<h3>æ›´å¤šæ¥è‡ª LogRocket çš„ç²¾å½©æ–‡ç« :</h3>

<hr/></div>
<p>æ‚¨çš„ç”¨æˆ·ç›¸ä¿¡æ‚¨ä¼šä¿æŠ¤ä»–ä»¬çš„æ•°æ®ï¼Œæ‚¨ä¸æƒ³è®©ä»–ä»¬å¤±æœ›ã€‚ä½ æœ‰ä»€ä¹ˆå…¶ä»–æ–¹æ³•å¯ä»¥è®©å¯†ç é‡è®¾åŠŸèƒ½æ›´å®‰å…¨ï¼Ÿæ„Ÿè°¢é˜…è¯»ã€‚</p><div class="code-block code-block-23">
<div class="blog-plug inline-plug node-plug"><h2>200 åª<img src="../Images/61167b9d027ca73ed5aaf59a9ec31267.png" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2019/10/green-check.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" class=" jetpack-lazy-image" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/10/green-check.png"/> <noscript> <img data-lazy-fallback="1" src="../Images/61167b9d027ca73ed5aaf59a9ec31267.png" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/10/green-check.png"/> </noscript>æ˜¾ç¤ºå™¨å‡ºç°æ•…éšœï¼Œç”Ÿäº§ä¸­ç½‘ç»œè¯·æ±‚ç¼“æ…¢</h2><p>éƒ¨ç½²åŸºäºèŠ‚ç‚¹çš„ web åº”ç”¨ç¨‹åºæˆ–ç½‘ç«™æ˜¯å®¹æ˜“çš„éƒ¨åˆ†ã€‚ç¡®ä¿æ‚¨çš„èŠ‚ç‚¹å®ä¾‹ç»§ç»­ä¸ºæ‚¨çš„åº”ç”¨ç¨‹åºæä¾›èµ„æºæ˜¯äº‹æƒ…å˜å¾—æ›´åŠ å›°éš¾çš„åœ°æ–¹ã€‚å¦‚æœæ‚¨å¯¹ç¡®ä¿å¯¹åç«¯æˆ–ç¬¬ä¸‰æ–¹æœåŠ¡çš„è¯·æ±‚æˆåŠŸæ„Ÿå…´è¶£ï¼Œ</p><a href="https://lp.logrocket.com/blg/node-signup" target="_blank">try LogRocket</a><p>. </p><a class="signup" href="https://lp.logrocket.com/blg/node-signup" target="_blank" rel="noopener noreferrer"><img src="../Images/cae72fd2a54c5f02a6398c4867894844.png" alt="LogRocket Network Request Monitoring" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2019/12/network-request-filter-2-1.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" class=" jetpack-lazy-image" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/12/network-request-filter-2-1.png"/><noscript><img data-lazy-fallback="1" src="../Images/cae72fd2a54c5f02a6398c4867894844.png" alt="LogRocket Network Request Monitoring" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/12/network-request-filter-2-1.png"/></noscript></a><a href="https://lp.logrocket.com/blg/node-signup" target="_blank" rel="noopener noreferrer">https://logrocket.com/signup/</a><p>LogRocket å°±åƒæ˜¯ç½‘ç»œå’Œç§»åŠ¨åº”ç”¨ç¨‹åºçš„ DVRï¼Œè®°å½•ä¸‹ç”¨æˆ·ä¸ä½ çš„åº”ç”¨ç¨‹åºäº¤äº’æ—¶å‘ç”Ÿçš„ä¸€åˆ‡ã€‚æ‚¨å¯ä»¥æ±‡æ€»å¹¶æŠ¥å‘Šæœ‰é—®é¢˜çš„ç½‘ç»œè¯·æ±‚ï¼Œä»¥å¿«é€Ÿäº†è§£æ ¹æœ¬åŸå› ï¼Œè€Œä¸æ˜¯çŒœæµ‹é—®é¢˜å‘ç”Ÿçš„åŸå› ã€‚</p><p>LogRocket æ£€æµ‹æ‚¨çš„åº”ç”¨ç¨‹åºä»¥è®°å½•åŸºçº¿æ€§èƒ½è®¡æ—¶ï¼Œå¦‚é¡µé¢åŠ è½½æ—¶é—´ã€åˆ°è¾¾ç¬¬ä¸€ä¸ªå­—èŠ‚çš„æ—¶é—´ã€æ…¢é€Ÿç½‘ç»œè¯·æ±‚ï¼Œè¿˜è®°å½• Reduxã€NgRx å’Œ Vuex æ“ä½œ/çŠ¶æ€ã€‚</p><a class="signup" href="https://lp.logrocket.com/blg/node-signup" target="_blank" rel="noopener noreferrer">Start monitoring for free</a><p>. </p></div>
</div>

<p class="clearfix"/>
<p class="clearfix"/>
</article>

</div>    
</body>
</html>